/*! For license information please see bundle.729c8bf93b770d6d5207.min.js.LICENSE.txt */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var i in n)("object"==typeof exports?exports:e)[i]=n[i]}}(globalThis,(function(){return(()=>{var e={5886:e=>{"use strict";e.exports=n,e.exports.default=n;var t=1e20;function n(e,t,n,i,r,s){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=i||.25,this.fontFamily=r||"sans-serif",this.fontWeight=s||"normal",this.radius=n||8;var o=this.size=this.fontSize+2*this.buffer,a=o+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function i(e,t,n,i,s,o){for(var a=0;a<t;a++)r(e,a,t,n,i,s,o);for(var l=0;l<n;l++)r(e,l*t,1,t,i,s,o)}function r(e,n,i,r,s,o,a){var l,c,u,d;for(o[0]=0,a[0]=-t,a[1]=t,l=0;l<r;l++)s[l]=e[n+l*i];for(l=1,c=0,u=0;l<r;l++){do{d=o[c],u=(s[l]-s[d]+l*l-d*d)/(l-d)/2}while(u<=a[c]&&--c>-1);o[++c]=l,a[c]=u,a[c+1]=t}for(l=0,c=0;l<r;l++){for(;a[c+1]<l;)c++;d=o[c],e[n+l*i]=s[d]+(l-d)*(l-d)}}n.prototype._draw=function(e,n){var r,s,o,a,l,c,u,d,h,p=this.ctx.measureText(e),f=p.width,m=2*this.buffer;n&&this.useMetrics?(l=Math.floor(p.actualBoundingBoxAscent),d=this.buffer+Math.ceil(p.actualBoundingBoxAscent),c=this.buffer,u=this.buffer,r=(s=Math.min(this.size,Math.ceil(p.actualBoundingBoxRight-p.actualBoundingBoxLeft)))+m,o=(a=Math.min(this.size-c,Math.ceil(p.actualBoundingBoxAscent+p.actualBoundingBoxDescent)))+m,this.ctx.textBaseline="alphabetic"):(r=s=this.size,o=a=this.size,l=19*this.fontSize/24,c=u=0,d=this.middle,this.ctx.textBaseline="middle"),s&&a&&(this.ctx.clearRect(u,c,s,a),this.ctx.fillText(e,this.buffer,d),h=this.ctx.getImageData(u,c,s,a));var g=new Uint8ClampedArray(r*o);return function(e,n,i,r,s,o,a){o.fill(t,0,n*i),a.fill(0,0,n*i);for(var l=(n-r)/2,c=0;c<s;c++)for(var u=0;u<r;u++){var d=(c+l)*n+u+l,h=e.data[4*(c*r+u)+3]/255;if(1===h)o[d]=0,a[d]=t;else if(0===h)o[d]=t,a[d]=0;else{var p=Math.max(0,.5-h),f=Math.max(0,h-.5);o[d]=p*p,a[d]=f*f}}}(h,r,o,s,a,this.gridOuter,this.gridInner),i(this.gridOuter,r,o,this.f,this.v,this.z),i(this.gridInner,r,o,this.f,this.v,this.z),function(e,t,n,i,r,s,o){for(var a=0;a<t*n;a++){var l=Math.sqrt(i[a])-Math.sqrt(r[a]);e[a]=Math.round(255-255*(l/s+o))}}(g,r,o,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:g,metrics:{width:s,height:a,sdfWidth:r,sdfHeight:o,top:l,left:0,advance:f}}},n.prototype.draw=function(e){return this._draw(e,!1).data},n.prototype.drawWithMetrics=function(e){return this._draw(e,!0)}},9823:(e,t,n)=>{e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){e.exports=n(3615)},function(e,t){e.exports=n(7378)},function(e,t,n){"use strict";n.r(t);var i=n(1),r=n(0),s=function(){return(s=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},o=0,a=i.forwardRef((function(e,t){var n=e.title,r=void 0===n?null:n,a=e.description,l=void 0===a?null:a,c=e.size,u=void 0===c?null:c,d=e.color,h=void 0===d?"currentColor":d,p=e.horizontal,f=void 0===p?null:p,m=e.vertical,g=void 0===m?null:m,y=e.rotate,v=void 0===y?null:y,b=e.spin,w=void 0===b?null:b,x=e.style,_=void 0===x?{}:x,E=e.children,S=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["title","description","size","color","horizontal","vertical","rotate","spin","style","children"]);o++;var C,T=null!==w&&w,A=i.Children.map(E,(function(e){var t=e;!0!==T&&(T=!0===(null===w?t.props.spin:w));var n=t.props.size;"number"==typeof u&&"number"==typeof t.props.size&&(n=t.props.size/u);var r={size:n,color:null===h?t.props.color:h,horizontal:null===f?t.props.horizontal:f,vertical:null===g?t.props.vertical:g,rotate:null===v?t.props.rotate:v,spin:null===w?t.props.spin:w,inStack:!0};return i.cloneElement(t,r)}));null!==u&&(_.width="string"==typeof u?u:1.5*u+"rem");var k,N="stack_labelledby_"+o,M="stack_describedby_"+o;if(r)C=l?N+" "+M:N;else if(k="presentation",l)throw new Error("title attribute required when description is set");return i.createElement("svg",s({ref:t,viewBox:"0 0 24 24",style:_,role:k,"aria-labelledby":C},S),r&&i.createElement("title",{id:N},r),l&&i.createElement("desc",{id:M},l),T&&i.createElement("style",null,"@keyframes spin { to { transform: rotate(360deg) } }","@keyframes spin-inverse { to { transform: rotate(-360deg) } }"),A)}));a.displayName="Stack",a.propTypes={size:r.oneOfType([r.number,r.string]),color:r.string,horizontal:r.bool,vertical:r.bool,rotate:r.number,spin:r.oneOfType([r.bool,r.number]),children:r.oneOfType([r.arrayOf(r.node),r.node]).isRequired,className:r.string,style:r.object},a.defaultProps={size:null,color:null,horizontal:null,vertical:null,rotate:null,spin:null};var l=a;n.d(t,"Icon",(function(){return d})),n.d(t,"Stack",(function(){return l}));var c=function(){return(c=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},u=0,d=i.forwardRef((function(e,t){var n=e.path,r=e.id,s=void 0===r?++u:r,o=e.title,a=void 0===o?null:o,l=e.description,d=void 0===l?null:l,h=e.size,p=void 0===h?null:h,f=e.color,m=void 0===f?"currentColor":f,g=e.horizontal,y=void 0!==g&&g,v=e.vertical,b=void 0!==v&&v,w=e.rotate,x=void 0===w?0:w,_=e.spin,E=void 0!==_&&_,S=e.style,C=void 0===S?{}:S,T=e.inStack,A=void 0!==T&&T,k=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["path","id","title","description","size","color","horizontal","vertical","rotate","spin","style","inStack"]),N={},M=[];null!==p&&(A?M.push("scale("+p+")"):(C.width="string"==typeof p?p:1.5*p+"rem",C.height=C.width)),y&&M.push("scaleX(-1)"),b&&M.push("scaleY(-1)"),0!==x&&M.push("rotate("+x+"deg)"),null!==m&&(N.fill=m);var P=i.createElement("path",c({d:n,style:N},A?k:{})),L=P;M.length>0&&(C.transform=M.join(" "),C.transformOrigin="center",A&&(L=i.createElement("g",{style:C},P,i.createElement("rect",{width:"24",height:"24",fill:"transparent"}))));var O,R=L,I=!0===E||"number"!=typeof E?2:E,D=!A&&(y||b);if(I<0&&(D=!D),E&&(R=i.createElement("g",{style:{animation:"spin"+(D?"-inverse":"")+" linear "+Math.abs(I)+"s infinite",transformOrigin:"center"}},L,!(y||b||0!==x)&&i.createElement("rect",{width:"24",height:"24",fill:"transparent"}))),A)return R;var F,B="icon_labelledby_"+s,z="icon_describedby_"+s;if(a)O=d?B+" "+z:B;else if(F="presentation",d)throw new Error("title attribute required when description is set");return i.createElement("svg",c({ref:t,viewBox:"0 0 24 24",style:C,role:F,"aria-labelledby":O},k),a&&i.createElement("title",{id:B},a),d&&i.createElement("desc",{id:z},d),!A&&E&&(D?i.createElement("style",null,"@keyframes spin-inverse { to { transform: rotate(-360deg) } }"):i.createElement("style",null,"@keyframes spin { to { transform: rotate(360deg) } }")),R)}));d.displayName="Icon",d.propTypes={path:r.string.isRequired,size:r.oneOfType([r.number,r.string]),color:r.string,horizontal:r.bool,vertical:r.bool,rotate:r.number,spin:r.oneOfType([r.bool,r.number]),style:r.object,inStack:r.bool,className:r.string},d.defaultProps={size:null,color:"currentColor",horizontal:!1,vertical:!1,rotate:0,spin:!1},t.default=d}])},1857:e=>{"use strict";var t=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===n}(e)}(e)};var n="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function i(e,t){return!1!==t.clone&&t.isMergeableObject(e)?l((n=e,Array.isArray(n)?[]:{}),e,t):e;var n}function r(e,t,n){return e.concat(t).map((function(e){return i(e,n)}))}function s(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter((function(t){return e.propertyIsEnumerable(t)})):[]}(e))}function o(e,t){try{return t in e}catch(e){return!1}}function a(e,t,n){var r={};return n.isMergeableObject(e)&&s(e).forEach((function(t){r[t]=i(e[t],n)})),s(t).forEach((function(s){(function(e,t){return o(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))})(e,s)||(o(e,s)&&n.isMergeableObject(t[s])?r[s]=function(e,t){if(!t.customMerge)return l;var n=t.customMerge(e);return"function"==typeof n?n:l}(s,n)(e[s],t[s],n):r[s]=i(t[s],n))})),r}function l(e,n,s){(s=s||{}).arrayMerge=s.arrayMerge||r,s.isMergeableObject=s.isMergeableObject||t,s.cloneUnlessOtherwiseSpecified=i;var o=Array.isArray(n);return o===Array.isArray(e)?o?s.arrayMerge(e,n,s):a(e,n,s):i(n,s)}l.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,n){return l(e,n,t)}),{})};var c=l;e.exports=c},6722:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.DomHandler=void 0;var s=n(7294),o=n(1901);r(n(1901),t);var a=/\s+/g,l={normalizeWhitespace:!1,withStartIndices:!1,withEndIndices:!1},c=function(){function e(e,t,n){this.dom=[],this.root=new o.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,"function"==typeof t&&(n=t,t=l),"object"==typeof e&&(t=e,e=void 0),this.callback=null!=e?e:null,this.options=null!=t?t:l,this.elementCB=null!=n?n:null}return e.prototype.onparserinit=function(e){this.parser=e},e.prototype.onreset=function(){var e;this.dom=[],this.root=new o.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null!==(e=this.parser)&&void 0!==e?e:null},e.prototype.onend=function(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))},e.prototype.onerror=function(e){this.handleCallback(e)},e.prototype.onclosetag=function(){this.lastNode=null;var e=this.tagStack.pop();this.options.withEndIndices&&(e.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(e)},e.prototype.onopentag=function(e,t){var n=this.options.xmlMode?s.ElementType.Tag:void 0,i=new o.Element(e,t,void 0,n);this.addNode(i),this.tagStack.push(i)},e.prototype.ontext=function(e){var t=this.options.normalizeWhitespace,n=this.lastNode;if(n&&n.type===s.ElementType.Text)t?n.data=(n.data+e).replace(a," "):n.data+=e;else{t&&(e=e.replace(a," "));var i=new o.Text(e);this.addNode(i),this.lastNode=i}},e.prototype.oncomment=function(e){if(this.lastNode&&this.lastNode.type===s.ElementType.Comment)this.lastNode.data+=e;else{var t=new o.Comment(e);this.addNode(t),this.lastNode=t}},e.prototype.oncommentend=function(){this.lastNode=null},e.prototype.oncdatastart=function(){var e=new o.Text(""),t=new o.NodeWithChildren(s.ElementType.CDATA,[e]);this.addNode(t),e.parent=t,this.lastNode=e},e.prototype.oncdataend=function(){this.lastNode=null},e.prototype.onprocessinginstruction=function(e,t){var n=new o.ProcessingInstruction(e,t);this.addNode(n)},e.prototype.handleCallback=function(e){if("function"==typeof this.callback)this.callback(e,this.dom);else if(e)throw e},e.prototype.addNode=function(e){var t=this.tagStack[this.tagStack.length-1],n=t.children[t.children.length-1];this.options.withStartIndices&&(e.startIndex=this.parser.startIndex),this.options.withEndIndices&&(e.endIndex=this.parser.endIndex),t.children.push(e),n&&(e.prev=n,n.next=e),e.parent=t,this.lastNode=null},e}();t.DomHandler=c,t.default=c},1901:function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__assign||function(){return s=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},s.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.cloneNode=t.hasChildren=t.isDocument=t.isDirective=t.isComment=t.isText=t.isCDATA=t.isTag=t.Element=t.Document=t.NodeWithChildren=t.ProcessingInstruction=t.Comment=t.Text=t.DataNode=t.Node=void 0;var o=n(7294),a=new Map([[o.ElementType.Tag,1],[o.ElementType.Script,1],[o.ElementType.Style,1],[o.ElementType.Directive,1],[o.ElementType.Text,3],[o.ElementType.CDATA,4],[o.ElementType.Comment,8],[o.ElementType.Root,9]]),l=function(){function e(e){this.type=e,this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}return Object.defineProperty(e.prototype,"nodeType",{get:function(){var e;return null!==(e=a.get(this.type))&&void 0!==e?e:1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentNode",{get:function(){return this.parent},set:function(e){this.parent=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previousSibling",{get:function(){return this.prev},set:function(e){this.prev=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextSibling",{get:function(){return this.next},set:function(e){this.next=e},enumerable:!1,configurable:!0}),e.prototype.cloneNode=function(e){return void 0===e&&(e=!1),_(this,e)},e}();t.Node=l;var c=function(e){function t(t,n){var i=e.call(this,t)||this;return i.data=n,i}return r(t,e),Object.defineProperty(t.prototype,"nodeValue",{get:function(){return this.data},set:function(e){this.data=e},enumerable:!1,configurable:!0}),t}(l);t.DataNode=c;var u=function(e){function t(t){return e.call(this,o.ElementType.Text,t)||this}return r(t,e),t}(c);t.Text=u;var d=function(e){function t(t){return e.call(this,o.ElementType.Comment,t)||this}return r(t,e),t}(c);t.Comment=d;var h=function(e){function t(t,n){var i=e.call(this,o.ElementType.Directive,n)||this;return i.name=t,i}return r(t,e),t}(c);t.ProcessingInstruction=h;var p=function(e){function t(t,n){var i=e.call(this,t)||this;return i.children=n,i}return r(t,e),Object.defineProperty(t.prototype,"firstChild",{get:function(){var e;return null!==(e=this.children[0])&&void 0!==e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastChild",{get:function(){return this.children.length>0?this.children[this.children.length-1]:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"childNodes",{get:function(){return this.children},set:function(e){this.children=e},enumerable:!1,configurable:!0}),t}(l);t.NodeWithChildren=p;var f=function(e){function t(t){return e.call(this,o.ElementType.Root,t)||this}return r(t,e),t}(p);t.Document=f;var m=function(e){function t(t,n,i,r){void 0===i&&(i=[]),void 0===r&&(r="script"===t?o.ElementType.Script:"style"===t?o.ElementType.Style:o.ElementType.Tag);var s=e.call(this,r,i)||this;return s.name=t,s.attribs=n,s}return r(t,e),Object.defineProperty(t.prototype,"tagName",{get:function(){return this.name},set:function(e){this.name=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attributes",{get:function(){var e=this;return Object.keys(this.attribs).map((function(t){var n,i;return{name:t,value:e.attribs[t],namespace:null===(n=e["x-attribsNamespace"])||void 0===n?void 0:n[t],prefix:null===(i=e["x-attribsPrefix"])||void 0===i?void 0:i[t]}}))},enumerable:!1,configurable:!0}),t}(p);function g(e){return o.isTag(e)}function y(e){return e.type===o.ElementType.CDATA}function v(e){return e.type===o.ElementType.Text}function b(e){return e.type===o.ElementType.Comment}function w(e){return e.type===o.ElementType.Directive}function x(e){return e.type===o.ElementType.Root}function _(e,t){var n;if(void 0===t&&(t=!1),v(e))n=new u(e.data);else if(b(e))n=new d(e.data);else if(g(e)){var i=t?E(e.children):[],r=new m(e.name,s({},e.attribs),i);i.forEach((function(e){return e.parent=r})),e["x-attribsNamespace"]&&(r["x-attribsNamespace"]=s({},e["x-attribsNamespace"])),e["x-attribsPrefix"]&&(r["x-attribsPrefix"]=s({},e["x-attribsPrefix"])),n=r}else if(y(e)){i=t?E(e.children):[];var a=new p(o.ElementType.CDATA,i);i.forEach((function(e){return e.parent=a})),n=a}else if(x(e)){i=t?E(e.children):[];var l=new f(i);i.forEach((function(e){return e.parent=l})),e["x-mode"]&&(l["x-mode"]=e["x-mode"]),n=l}else{if(!w(e))throw new Error("Not implemented yet: "+e.type);var c=new h(e.name,e.data);null!=e["x-name"]&&(c["x-name"]=e["x-name"],c["x-publicId"]=e["x-publicId"],c["x-systemId"]=e["x-systemId"]),n=c}return n.startIndex=e.startIndex,n.endIndex=e.endIndex,n}function E(e){for(var t=e.map((function(e){return _(e,!0)})),n=1;n<t.length;n++)t[n].prev=t[n-1],t[n-1].next=t[n];return t}t.Element=m,t.isTag=g,t.isCDATA=y,t.isText=v,t.isComment=b,t.isDirective=w,t.isDocument=x,t.hasChildren=function(e){return Object.prototype.hasOwnProperty.call(e,"children")},t.cloneNode=_},7294:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.Doctype=t.CDATA=t.Tag=t.Style=t.Script=t.Comment=t.Directive=t.Text=t.Root=t.isTag=t.ElementType=void 0,function(e){e.Root="root",e.Text="text",e.Directive="directive",e.Comment="comment",e.Script="script",e.Style="style",e.Tag="tag",e.CDATA="cdata",e.Doctype="doctype"}(n=t.ElementType||(t.ElementType={})),t.isTag=function(e){return e.type===n.Tag||e.type===n.Script||e.type===n.Style},t.Root=n.Root,t.Text=n.Text,t.Directive=n.Directive,t.Comment=n.Comment,t.Script=n.Script,t.Style=n.Style,t.Tag=n.Tag,t.CDATA=n.CDATA,t.Doctype=n.Doctype},1106:e=>{"use strict";function t(e,t,s){s=s||2;var o,a,l,d,h,f,m,g=t&&t.length,y=g?t[0]*s:e.length,v=n(e,0,y,s,!0),b=[];if(!v||v.next===v.prev)return b;if(g&&(v=function(e,t,r,s){var o,a,l,d=[];for(o=0,a=t.length;o<a;o++)(l=n(e,t[o]*s,o<a-1?t[o+1]*s:e.length,s,!1))===l.next&&(l.steiner=!0),d.push(p(l));for(d.sort(c),o=0;o<d.length;o++)r=i(r=u(d[o],r),r.next);return r}(e,t,v,s)),e.length>80*s){o=l=e[0],a=d=e[1];for(var w=s;w<y;w+=s)(h=e[w])<o&&(o=h),(f=e[w+1])<a&&(a=f),h>l&&(l=h),f>d&&(d=f);m=0!==(m=Math.max(l-o,d-a))?1/m:0}return r(v,b,s,o,a,m),b}function n(e,t,n,i,r){var s,o;if(r===T(e,t,n,i)>0)for(s=t;s<n;s+=i)o=E(s,e[s],e[s+1],o);else for(s=n-i;s>=t;s-=i)o=E(s,e[s],e[s+1],o);return o&&y(o,o.next)&&(S(o),o=o.next),o}function i(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!y(i,i.next)&&0!==g(i.prev,i,i.next))i=i.next;else{if(S(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function r(e,t,n,c,u,d,p){if(e){!p&&d&&function(e,t,n,i){var r=e;do{null===r.z&&(r.z=h(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,s,o,a,l,c=1;do{for(n=e,e=null,s=null,o=0;n;){for(o++,i=n,a=0,t=0;t<c&&(a++,i=i.nextZ);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(o>1)}(r)}(e,c,u,d);for(var f,m,g=e;e.prev!==e.next;)if(f=e.prev,m=e.next,d?o(e,c,u,d):s(e))t.push(f.i/n),t.push(e.i/n),t.push(m.i/n),S(e),e=m.next,g=m.next;else if((e=m)===g){p?1===p?r(e=a(i(e),t,n),t,n,c,u,d,2):2===p&&l(e,t,n,c,u,d):r(i(e),t,n,c,u,d,1);break}}}function s(e){var t=e.prev,n=e,i=e.next;if(g(t,n,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(f(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&g(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function o(e,t,n,i){var r=e.prev,s=e,o=e.next;if(g(r,s,o)>=0)return!1;for(var a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,c=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,u=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,d=h(a,l,t,n,i),p=h(c,u,t,n,i),m=e.prevZ,y=e.nextZ;m&&m.z>=d&&y&&y.z<=p;){if(m!==e.prev&&m!==e.next&&f(r.x,r.y,s.x,s.y,o.x,o.y,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;if(m=m.prevZ,y!==e.prev&&y!==e.next&&f(r.x,r.y,s.x,s.y,o.x,o.y,y.x,y.y)&&g(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(;m&&m.z>=d;){if(m!==e.prev&&m!==e.next&&f(r.x,r.y,s.x,s.y,o.x,o.y,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;y&&y.z<=p;){if(y!==e.prev&&y!==e.next&&f(r.x,r.y,s.x,s.y,o.x,o.y,y.x,y.y)&&g(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function a(e,t,n){var r=e;do{var s=r.prev,o=r.next.next;!y(s,o)&&v(s,r,r.next,o)&&x(s,o)&&x(o,s)&&(t.push(s.i/n),t.push(r.i/n),t.push(o.i/n),S(r),S(r.next),r=e=o),r=r.next}while(r!==e);return i(r)}function l(e,t,n,s,o,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&m(l,c)){var u=_(l,c);return l=i(l,l.next),u=i(u,u.next),r(l,t,n,s,o,a),void r(u,t,n,s,o,a)}c=c.next}l=l.next}while(l!==e)}function c(e,t){return e.x-t.x}function u(e,t){var n=function(e,t){var n,i=t,r=e.x,s=e.y,o=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){var a=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>o){if(o=a,a===r){if(s===i.y)return i;if(s===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(r===o)return n;var l,c=n,u=n.x,h=n.y,p=1/0;i=n;do{r>=i.x&&i.x>=u&&r!==i.x&&f(s<h?r:o,s,u,h,s<h?o:r,s,i.x,i.y)&&(l=Math.abs(s-i.y)/(r-i.x),x(i,e)&&(l<p||l===p&&(i.x>n.x||i.x===n.x&&d(n,i)))&&(n=i,p=l)),i=i.next}while(i!==c);return n}(e,t);if(!n)return t;var r=_(n,e),s=i(n,n.next);return i(r,r.next),t===n?s:t}function d(e,t){return g(e.prev,e,t.prev)<0&&g(t.next,e,e.next)<0}function h(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function p(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function f(e,t,n,i,r,s,o,a){return(r-o)*(t-a)-(e-o)*(s-a)>=0&&(e-o)*(i-a)-(n-o)*(t-a)>=0&&(n-o)*(s-a)-(r-o)*(i-a)>=0}function m(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&v(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(x(e,t)&&x(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(g(e.prev,e,t.prev)||g(e,t.prev,t))||y(e,t)&&g(e.prev,e,e.next)>0&&g(t.prev,t,t.next)>0)}function g(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function y(e,t){return e.x===t.x&&e.y===t.y}function v(e,t,n,i){var r=w(g(e,t,n)),s=w(g(e,t,i)),o=w(g(n,i,e)),a=w(g(n,i,t));return r!==s&&o!==a||(!(0!==r||!b(e,n,t))||(!(0!==s||!b(e,i,t))||(!(0!==o||!b(n,e,i))||!(0!==a||!b(n,t,i)))))}function b(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function w(e){return e>0?1:e<0?-1:0}function x(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function _(e,t){var n=new C(e.i,e.x,e.y),i=new C(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function E(e,t,n,i){var r=new C(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function S(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function C(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function T(e,t,n,i){for(var r=0,s=t,o=n-i;s<n;s+=i)r+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return r}e.exports=t,e.exports.default=t,t.deviation=function(e,t,n,i){var r=t&&t.length,s=r?t[0]*n:e.length,o=Math.abs(T(e,0,s,n));if(r)for(var a=0,l=t.length;a<l;a++){var c=t[a]*n,u=a<l-1?t[a+1]*n:e.length;o-=Math.abs(T(e,c,u,n))}var d=0;for(a=0;a<i.length;a+=3){var h=i[a]*n,p=i[a+1]*n,f=i[a+2]*n;d+=Math.abs((e[h]-e[f])*(e[p+1]-e[h+1])-(e[h]-e[p])*(e[f+1]-e[h+1]))}return 0===o&&0===d?0:Math.abs((d-o)/o)},t.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var s=0;s<e[r].length;s++)for(var o=0;o<t;o++)n.vertices.push(e[r][s][o]);r>0&&(i+=e[r-1].length,n.holes.push(i))}return n}},9529:function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.decodeHTML=t.decodeHTMLStrict=t.decodeXML=void 0;var r=i(n(2834)),s=i(n(2061)),o=i(n(5529)),a=i(n(8787)),l=/&(?:[a-zA-Z0-9]+|#[xX][\da-fA-F]+|#\d+);/g;function c(e){var t=d(e);return function(e){return String(e).replace(l,t)}}t.decodeXML=c(o.default),t.decodeHTMLStrict=c(r.default);var u=function(e,t){return e<t?1:-1};function d(e){return function(t){if("#"===t.charAt(1)){var n=t.charAt(2);return"X"===n||"x"===n?a.default(parseInt(t.substr(3),16)):a.default(parseInt(t.substr(2),10))}return e[t.slice(1,-1)]||t}}t.decodeHTML=function(){for(var e=Object.keys(s.default).sort(u),t=Object.keys(r.default).sort(u),n=0,i=0;n<t.length;n++)e[i]===t[n]?(t[n]+=";?",i++):t[n]+=";";var o=new RegExp("&(?:"+t.join("|")+"|#[xX][\\da-fA-F]+;?|#\\d+;?)","g"),a=d(r.default);function l(e){return";"!==e.substr(-1)&&(e+=";"),a(e)}return function(e){return String(e).replace(o,l)}}()},8787:function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(8124)),s=String.fromCodePoint||function(e){var t="";return e>65535&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|1023&e),t+=String.fromCharCode(e)};t.default=function(e){return e>=55296&&e<=57343||e>1114111?"�":(e in r.default&&(e=r.default[e]),s(e))}},6336:function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.escapeUTF8=t.escape=t.encodeNonAsciiHTML=t.encodeHTML=t.encodeXML=void 0;var r=u(i(n(5529)).default),s=d(r);t.encodeXML=g(r);var o,a,l=u(i(n(2834)).default),c=d(l);function u(e){return Object.keys(e).sort().reduce((function(t,n){return t[e[n]]="&"+n+";",t}),{})}function d(e){for(var t=[],n=[],i=0,r=Object.keys(e);i<r.length;i++){var s=r[i];1===s.length?t.push("\\"+s):n.push(s)}t.sort();for(var o=0;o<t.length-1;o++){for(var a=o;a<t.length-1&&t[a].charCodeAt(1)+1===t[a+1].charCodeAt(1);)a+=1;var l=1+a-o;l<3||t.splice(o,l,t[o]+"-"+t[a])}return n.unshift("["+t.join("")+"]"),new RegExp(n.join("|"),"g")}t.encodeHTML=(o=l,a=c,function(e){return e.replace(a,(function(e){return o[e]})).replace(h,f)}),t.encodeNonAsciiHTML=g(l);var h=/(?:[\x80-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/g,p=null!=String.prototype.codePointAt?function(e){return e.codePointAt(0)}:function(e){return 1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)-56320+65536};function f(e){return"&#x"+(e.length>1?p(e):e.charCodeAt(0)).toString(16).toUpperCase()+";"}var m=new RegExp(s.source+"|"+h.source,"g");function g(e){return function(t){return t.replace(m,(function(t){return e[t]||f(t)}))}}t.escape=function(e){return e.replace(m,f)},t.escapeUTF8=function(e){return e.replace(s,f)}},9625:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decodeXMLStrict=t.decodeHTML5Strict=t.decodeHTML4Strict=t.decodeHTML5=t.decodeHTML4=t.decodeHTMLStrict=t.decodeHTML=t.decodeXML=t.encodeHTML5=t.encodeHTML4=t.escapeUTF8=t.escape=t.encodeNonAsciiHTML=t.encodeHTML=t.encodeXML=t.encode=t.decodeStrict=t.decode=void 0;var i=n(9529),r=n(6336);t.decode=function(e,t){return(!t||t<=0?i.decodeXML:i.decodeHTML)(e)},t.decodeStrict=function(e,t){return(!t||t<=0?i.decodeXML:i.decodeHTMLStrict)(e)},t.encode=function(e,t){return(!t||t<=0?r.encodeXML:r.encodeHTML)(e)};var s=n(6336);Object.defineProperty(t,"encodeXML",{enumerable:!0,get:function(){return s.encodeXML}}),Object.defineProperty(t,"encodeHTML",{enumerable:!0,get:function(){return s.encodeHTML}}),Object.defineProperty(t,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return s.encodeNonAsciiHTML}}),Object.defineProperty(t,"escape",{enumerable:!0,get:function(){return s.escape}}),Object.defineProperty(t,"escapeUTF8",{enumerable:!0,get:function(){return s.escapeUTF8}}),Object.defineProperty(t,"encodeHTML4",{enumerable:!0,get:function(){return s.encodeHTML}}),Object.defineProperty(t,"encodeHTML5",{enumerable:!0,get:function(){return s.encodeHTML}});var o=n(9529);Object.defineProperty(t,"decodeXML",{enumerable:!0,get:function(){return o.decodeXML}}),Object.defineProperty(t,"decodeHTML",{enumerable:!0,get:function(){return o.decodeHTML}}),Object.defineProperty(t,"decodeHTMLStrict",{enumerable:!0,get:function(){return o.decodeHTMLStrict}}),Object.defineProperty(t,"decodeHTML4",{enumerable:!0,get:function(){return o.decodeHTML}}),Object.defineProperty(t,"decodeHTML5",{enumerable:!0,get:function(){return o.decodeHTML}}),Object.defineProperty(t,"decodeHTML4Strict",{enumerable:!0,get:function(){return o.decodeHTMLStrict}}),Object.defineProperty(t,"decodeHTML5Strict",{enumerable:!0,get:function(){return o.decodeHTMLStrict}}),Object.defineProperty(t,"decodeXMLStrict",{enumerable:!0,get:function(){return o.decodeXML}})},1272:(e,t,n)=>{var i;!function(r,s,o,a){"use strict";var l,c=["","webkit","Moz","MS","ms","o"],u=s.createElement("div"),d=Math.round,h=Math.abs,p=Date.now;function f(e,t,n){return setTimeout(x(e,n),t)}function m(e,t,n){return!!Array.isArray(e)&&(g(e,n[t],n),!0)}function g(e,t,n){var i;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==a)for(i=0;i<e.length;)t.call(n,e[i],i,e),i++;else for(i in e)e.hasOwnProperty(i)&&t.call(n,e[i],i,e)}function y(e,t,n){var i="DEPRECATED METHOD: "+t+"\n"+n+" AT \n";return function(){var t=new Error("get-stack-trace"),n=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",s=r.console&&(r.console.warn||r.console.log);return s&&s.call(r.console,i,n),e.apply(this,arguments)}}l="function"!=typeof Object.assign?function(e){if(e===a||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(i!==a&&null!==i)for(var r in i)i.hasOwnProperty(r)&&(t[r]=i[r])}return t}:Object.assign;var v=y((function(e,t,n){for(var i=Object.keys(t),r=0;r<i.length;)(!n||n&&e[i[r]]===a)&&(e[i[r]]=t[i[r]]),r++;return e}),"extend","Use `assign`."),b=y((function(e,t){return v(e,t,!0)}),"merge","Use `assign`.");function w(e,t,n){var i,r=t.prototype;(i=e.prototype=Object.create(r)).constructor=e,i._super=r,n&&l(i,n)}function x(e,t){return function(){return e.apply(t,arguments)}}function _(e,t){return"function"==typeof e?e.apply(t&&t[0]||a,t):e}function E(e,t){return e===a?t:e}function S(e,t,n){g(k(t),(function(t){e.addEventListener(t,n,!1)}))}function C(e,t,n){g(k(t),(function(t){e.removeEventListener(t,n,!1)}))}function T(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function A(e,t){return e.indexOf(t)>-1}function k(e){return e.trim().split(/\s+/g)}function N(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var i=0;i<e.length;){if(n&&e[i][n]==t||!n&&e[i]===t)return i;i++}return-1}function M(e){return Array.prototype.slice.call(e,0)}function P(e,t,n){for(var i=[],r=[],s=0;s<e.length;){var o=t?e[s][t]:e[s];N(r,o)<0&&i.push(e[s]),r[s]=o,s++}return n&&(i=t?i.sort((function(e,n){return e[t]>n[t]})):i.sort()),i}function L(e,t){for(var n,i,r=t[0].toUpperCase()+t.slice(1),s=0;s<c.length;){if((i=(n=c[s])?n+r:t)in e)return i;s++}return a}var O=1;function R(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||r}var I="ontouchstart"in r,D=L(r,"PointerEvent")!==a,F=I&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),B="touch",z="mouse",j=24,V=["x","y"],U=["clientX","clientY"];function H(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){_(e.options.enable,[e])&&n.handler(t)},this.init()}function $(e,t,n){var i=n.pointers.length,r=n.changedPointers.length,s=1&t&&i-r==0,o=12&t&&i-r==0;n.isFirst=!!s,n.isFinal=!!o,s&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,i=t.pointers,r=i.length;n.firstInput||(n.firstInput=q(t));r>1&&!n.firstMultiple?n.firstMultiple=q(t):1===r&&(n.firstMultiple=!1);var s=n.firstInput,o=n.firstMultiple,l=o?o.center:s.center,c=t.center=W(i);t.timeStamp=p(),t.deltaTime=t.timeStamp-s.timeStamp,t.angle=K(l,c),t.distance=X(l,c),function(e,t){var n=t.center,i=e.offsetDelta||{},r=e.prevDelta||{},s=e.prevInput||{};1!==t.eventType&&4!==s.eventType||(r=e.prevDelta={x:s.deltaX||0,y:s.deltaY||0},i=e.offsetDelta={x:n.x,y:n.y});t.deltaX=r.x+(n.x-i.x),t.deltaY=r.y+(n.y-i.y)}(n,t),t.offsetDirection=Y(t.deltaX,t.deltaY);var u=G(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=u.x,t.overallVelocityY=u.y,t.overallVelocity=h(u.x)>h(u.y)?u.x:u.y,t.scale=o?(d=o.pointers,f=i,X(f[0],f[1],U)/X(d[0],d[1],U)):1,t.rotation=o?function(e,t){return K(t[1],t[0],U)+K(e[1],e[0],U)}(o.pointers,i):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,i,r,s,o=e.lastInterval||t,l=t.timeStamp-o.timeStamp;if(8!=t.eventType&&(l>25||o.velocity===a)){var c=t.deltaX-o.deltaX,u=t.deltaY-o.deltaY,d=G(l,c,u);i=d.x,r=d.y,n=h(d.x)>h(d.y)?d.x:d.y,s=Y(c,u),e.lastInterval=t}else n=o.velocity,i=o.velocityX,r=o.velocityY,s=o.direction;t.velocity=n,t.velocityX=i,t.velocityY=r,t.direction=s}(n,t);var d,f;var m=e.element;T(t.srcEvent.target,m)&&(m=t.srcEvent.target);t.target=m}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function q(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:d(e.pointers[n].clientX),clientY:d(e.pointers[n].clientY)},n++;return{timeStamp:p(),pointers:t,center:W(t),deltaX:e.deltaX,deltaY:e.deltaY}}function W(e){var t=e.length;if(1===t)return{x:d(e[0].clientX),y:d(e[0].clientY)};for(var n=0,i=0,r=0;r<t;)n+=e[r].clientX,i+=e[r].clientY,r++;return{x:d(n/t),y:d(i/t)}}function G(e,t,n){return{x:t/e||0,y:n/e||0}}function Y(e,t){return e===t?1:h(e)>=h(t)?e<0?2:4:t<0?8:16}function X(e,t,n){n||(n=V);var i=t[n[0]]-e[n[0]],r=t[n[1]]-e[n[1]];return Math.sqrt(i*i+r*r)}function K(e,t,n){n||(n=V);var i=t[n[0]]-e[n[0]],r=t[n[1]]-e[n[1]];return 180*Math.atan2(r,i)/Math.PI}H.prototype={handler:function(){},init:function(){this.evEl&&S(this.element,this.evEl,this.domHandler),this.evTarget&&S(this.target,this.evTarget,this.domHandler),this.evWin&&S(R(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&C(this.element,this.evEl,this.domHandler),this.evTarget&&C(this.target,this.evTarget,this.domHandler),this.evWin&&C(R(this.element),this.evWin,this.domHandler)}};var Z={mousedown:1,mousemove:2,mouseup:4},J="mousedown",Q="mousemove mouseup";function ee(){this.evEl=J,this.evWin=Q,this.pressed=!1,H.apply(this,arguments)}w(ee,H,{handler:function(e){var t=Z[e.type];1&t&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:z,srcEvent:e}))}});var te={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},ne={2:B,3:"pen",4:z,5:"kinect"},ie="pointerdown",re="pointermove pointerup pointercancel";function se(){this.evEl=ie,this.evWin=re,H.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}r.MSPointerEvent&&!r.PointerEvent&&(ie="MSPointerDown",re="MSPointerMove MSPointerUp MSPointerCancel"),w(se,H,{handler:function(e){var t=this.store,n=!1,i=e.type.toLowerCase().replace("ms",""),r=te[i],s=ne[e.pointerType]||e.pointerType,o=s==B,a=N(t,e.pointerId,"pointerId");1&r&&(0===e.button||o)?a<0&&(t.push(e),a=t.length-1):12&r&&(n=!0),a<0||(t[a]=e,this.callback(this.manager,r,{pointers:t,changedPointers:[e],pointerType:s,srcEvent:e}),n&&t.splice(a,1))}});var oe={touchstart:1,touchmove:2,touchend:4,touchcancel:8},ae="touchstart",le="touchstart touchmove touchend touchcancel";function ce(){this.evTarget=ae,this.evWin=le,this.started=!1,H.apply(this,arguments)}function ue(e,t){var n=M(e.touches),i=M(e.changedTouches);return 12&t&&(n=P(n.concat(i),"identifier",!0)),[n,i]}w(ce,H,{handler:function(e){var t=oe[e.type];if(1===t&&(this.started=!0),this.started){var n=ue.call(this,e,t);12&t&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:B,srcEvent:e})}}});var de={touchstart:1,touchmove:2,touchend:4,touchcancel:8},he="touchstart touchmove touchend touchcancel";function pe(){this.evTarget=he,this.targetIds={},H.apply(this,arguments)}function fe(e,t){var n=M(e.touches),i=this.targetIds;if(3&t&&1===n.length)return i[n[0].identifier]=!0,[n,n];var r,s,o=M(e.changedTouches),a=[],l=this.target;if(s=n.filter((function(e){return T(e.target,l)})),1===t)for(r=0;r<s.length;)i[s[r].identifier]=!0,r++;for(r=0;r<o.length;)i[o[r].identifier]&&a.push(o[r]),12&t&&delete i[o[r].identifier],r++;return a.length?[P(s.concat(a),"identifier",!0),a]:void 0}w(pe,H,{handler:function(e){var t=de[e.type],n=fe.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:B,srcEvent:e})}});function me(){H.apply(this,arguments);var e=x(this.handler,this);this.touch=new pe(this.manager,e),this.mouse=new ee(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function ge(e,t){1&e?(this.primaryTouch=t.changedPointers[0].identifier,ye.call(this,t)):12&e&&ye.call(this,t)}function ye(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var i=this.lastTouches;setTimeout((function(){var e=i.indexOf(n);e>-1&&i.splice(e,1)}),2500)}}function ve(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var r=this.lastTouches[i],s=Math.abs(t-r.x),o=Math.abs(n-r.y);if(s<=25&&o<=25)return!0}return!1}w(me,H,{handler:function(e,t,n){var i=n.pointerType==B,r=n.pointerType==z;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(i)ge.call(this,t,n);else if(r&&ve.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var be=L(u.style,"touchAction"),we=be!==a,xe="compute",_e="auto",Ee="manipulation",Se="none",Ce="pan-x",Te="pan-y",Ae=function(){if(!we)return!1;var e={},t=r.CSS&&r.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){e[n]=!t||r.CSS.supports("touch-action",n)})),e}();function ke(e,t){this.manager=e,this.set(t)}ke.prototype={set:function(e){e==xe&&(e=this.compute()),we&&this.manager.element.style&&Ae[e]&&(this.manager.element.style[be]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return g(this.manager.recognizers,(function(t){_(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(A(e,Se))return Se;var t=A(e,Ce),n=A(e,Te);if(t&&n)return Se;if(t||n)return t?Ce:Te;if(A(e,Ee))return Ee;return _e}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var i=this.actions,r=A(i,Se)&&!Ae.none,s=A(i,Te)&&!Ae["pan-y"],o=A(i,Ce)&&!Ae["pan-x"];if(r){var a=1===e.pointers.length,l=e.distance<2,c=e.deltaTime<250;if(a&&l&&c)return}if(!o||!s)return r||s&&6&n||o&&n&j?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var Ne=32;function Me(e){this.options=l({},this.defaults,e||{}),this.id=O++,this.manager=null,this.options.enable=E(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function Pe(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function Le(e){return 16==e?"down":8==e?"up":2==e?"left":4==e?"right":""}function Oe(e,t){var n=t.manager;return n?n.get(e):e}function Re(){Me.apply(this,arguments)}function Ie(){Re.apply(this,arguments),this.pX=null,this.pY=null}function De(){Re.apply(this,arguments)}function Fe(){Me.apply(this,arguments),this._timer=null,this._input=null}function Be(){Re.apply(this,arguments)}function ze(){Re.apply(this,arguments)}function je(){Me.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Ve(e,t){return(t=t||{}).recognizers=E(t.recognizers,Ve.defaults.preset),new Ue(e,t)}Me.prototype={defaults:{},set:function(e){return l(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(m(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=Oe(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return m(e,"dropRecognizeWith",this)||(e=Oe(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(m(e,"requireFailure",this))return this;var t=this.requireFail;return-1===N(t,e=Oe(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(m(e,"dropRequireFailure",this))return this;e=Oe(e,this);var t=N(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,n=this.state;function i(n){t.manager.emit(n,e)}n<8&&i(t.options.event+Pe(n)),i(t.options.event),e.additionalEvent&&i(e.additionalEvent),n>=8&&i(t.options.event+Pe(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=Ne},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(33&this.requireFail[e].state))return!1;e++}return!0},recognize:function(e){var t=l({},e);if(!_(this.options.enable,[this,t]))return this.reset(),void(this.state=Ne);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},w(Re,Me,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,i=6&t,r=this.attrTest(e);return i&&(8&n||!r)?16|t:i||r?4&n?8|t:2&t?4|t:2:Ne}}),w(Ie,Re,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return 6&e&&t.push(Te),e&j&&t.push(Ce),t},directionTest:function(e){var t=this.options,n=!0,i=e.distance,r=e.direction,s=e.deltaX,o=e.deltaY;return r&t.direction||(6&t.direction?(r=0===s?1:s<0?2:4,n=s!=this.pX,i=Math.abs(e.deltaX)):(r=0===o?1:o<0?8:16,n=o!=this.pY,i=Math.abs(e.deltaY))),e.direction=r,n&&i>t.threshold&&r&t.direction},attrTest:function(e){return Re.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=Le(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),w(De,Re,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Se]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),w(Fe,Me,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[_e]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,r=e.deltaTime>t.time;if(this._input=e,!i||!n||12&e.eventType&&!r)this.reset();else if(1&e.eventType)this.reset(),this._timer=f((function(){this.state=8,this.tryEmit()}),t.time,this);else if(4&e.eventType)return 8;return Ne},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&4&e.eventType?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=p(),this.manager.emit(this.options.event,this._input)))}}),w(Be,Re,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Se]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),w(ze,Re,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return Ie.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return 30&n?t=e.overallVelocity:6&n?t=e.overallVelocityX:n&j&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&h(t)>this.options.velocity&&4&e.eventType},emit:function(e){var t=Le(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),w(je,Me,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ee]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,r=e.deltaTime<t.time;if(this.reset(),1&e.eventType&&0===this.count)return this.failTimeout();if(i&&r&&n){if(4!=e.eventType)return this.failTimeout();var s=!this.pTime||e.timeStamp-this.pTime<t.interval,o=!this.pCenter||X(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,o&&s?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=f((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return Ne},failTimeout:function(){return this._timer=f((function(){this.state=Ne}),this.options.interval,this),Ne},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Ve.VERSION="2.0.7",Ve.defaults={domEvents:!1,touchAction:xe,enable:!0,inputTarget:null,inputClass:null,preset:[[Be,{enable:!1}],[De,{enable:!1},["rotate"]],[ze,{direction:6}],[Ie,{direction:6},["swipe"]],[je],[je,{event:"doubletap",taps:2},["tap"]],[Fe]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function Ue(e,t){var n;this.options=l({},Ve.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new((n=this).options.inputClass||(D?se:F?pe:I?me:ee))(n,$),this.touchAction=new ke(this,this.options.touchAction),He(this,!0),g(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function He(e,t){var n,i=e.element;i.style&&(g(e.options.cssProps,(function(r,s){n=L(i.style,s),t?(e.oldCssProps[n]=i.style[n],i.style[n]=r):i.style[n]=e.oldCssProps[n]||""})),t||(e.oldCssProps={}))}Ue.prototype={set:function(e){return l(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var n;this.touchAction.preventDefaults(e);var i=this.recognizers,r=t.curRecognizer;(!r||r&&8&r.state)&&(r=t.curRecognizer=null);for(var s=0;s<i.length;)n=i[s],2===t.stopped||r&&n!=r&&!n.canRecognizeWith(r)?n.reset():n.recognize(e),!r&&14&n.state&&(r=t.curRecognizer=n),s++}},get:function(e){if(e instanceof Me)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(m(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(m(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=N(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(e!==a&&t!==a){var n=this.handlers;return g(k(e),(function(e){n[e]=n[e]||[],n[e].push(t)})),this}},off:function(e,t){if(e!==a){var n=this.handlers;return g(k(e),(function(e){t?n[e]&&n[e].splice(N(n[e],t),1):delete n[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var n=s.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t,t.target.dispatchEvent(n)}(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var i=0;i<n.length;)n[i](t),i++}},destroy:function(){this.element&&He(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},l(Ve,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:Ne,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:j,DIRECTION_ALL:30,Manager:Ue,Input:H,TouchAction:ke,TouchInput:pe,MouseInput:ee,PointerEventInput:se,TouchMouseInput:me,SingleTouchInput:ce,Recognizer:Me,AttrRecognizer:Re,Tap:je,Pan:Ie,Swipe:ze,Pinch:De,Rotate:Be,Press:Fe,on:S,off:C,each:g,merge:b,extend:v,assign:l,inherit:w,bindFn:x,prefixed:L}),(void 0!==r?r:"undefined"!=typeof self?self:{}).Hammer=Ve,(i=function(){return Ve}.call(t,n,t,e))===a||(e.exports=i)}(window,document)},5839:(e,t,n)=>{"use strict";var i=n(9185),r={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},s={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},a={};function l(e){return i.isMemo(e)?o:a[e.$$typeof]||r}a[i.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},a[i.Memo]=o;var c=Object.defineProperty,u=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,h=Object.getOwnPropertyDescriptor,p=Object.getPrototypeOf,f=Object.prototype;e.exports=function e(t,n,i){if("string"!=typeof n){if(f){var r=p(n);r&&r!==f&&e(t,r,i)}var o=u(n);d&&(o=o.concat(d(n)));for(var a=l(t),m=l(n),g=0;g<o.length;++g){var y=o[g];if(!(s[y]||i&&i[y]||m&&m[y]||a&&a[y])){var v=h(n,y);try{c(t,y,v)}catch(e){}}}}return t}},7848:function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return o(t,e),t},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.parseFeed=t.FeedHandler=void 0;var c,u,d=l(n(6722)),h=a(n(3114)),p=n(4418);!function(e){e[e.image=0]="image",e[e.audio=1]="audio",e[e.video=2]="video",e[e.document=3]="document",e[e.executable=4]="executable"}(c||(c={})),function(e){e[e.sample=0]="sample",e[e.full=1]="full",e[e.nonstop=2]="nonstop"}(u||(u={}));var f=function(e){function t(t,n){return"object"==typeof t&&(n=t=void 0),e.call(this,t,n)||this}return r(t,e),t.prototype.onend=function(){var e,t,n=y(x,this.dom);if(n){var i={};if("feed"===n.name){var r=n.children;i.type="atom",w(i,"id","id",r),w(i,"title","title",r);var s=b("href",y("link",r));s&&(i.link=s),w(i,"description","subtitle",r),(o=v("updated",r))&&(i.updated=new Date(o)),w(i,"author","email",r,!0),i.items=g("entry",r).map((function(e){var t={},n=e.children;w(t,"id","id",n),w(t,"title","title",n);var i=b("href",y("link",n));i&&(t.link=i);var r=v("summary",n)||v("content",n);r&&(t.description=r);var s=v("updated",n);return s&&(t.pubDate=new Date(s)),t.media=m(n),t}))}else{var o;r=null!==(t=null===(e=y("channel",n.children))||void 0===e?void 0:e.children)&&void 0!==t?t:[];i.type=n.name.substr(0,3),i.id="",w(i,"title","title",r),w(i,"link","link",r),w(i,"description","description",r),(o=v("lastBuildDate",r))&&(i.updated=new Date(o)),w(i,"author","managingEditor",r,!0),i.items=g("item",n.children).map((function(e){var t={},n=e.children;w(t,"id","guid",n),w(t,"title","title",n),w(t,"link","link",n),w(t,"description","description",n);var i=v("pubDate",n);return i&&(t.pubDate=new Date(i)),t.media=m(n),t}))}this.feed=i,this.handleCallback(null)}else this.handleCallback(new Error("couldn't find root of feed"))},t}(d.default);function m(e){return g("media:content",e).map((function(e){var t={medium:e.attribs.medium,isDefault:!!e.attribs.isDefault};return e.attribs.url&&(t.url=e.attribs.url),e.attribs.fileSize&&(t.fileSize=parseInt(e.attribs.fileSize,10)),e.attribs.type&&(t.type=e.attribs.type),e.attribs.expression&&(t.expression=e.attribs.expression),e.attribs.bitrate&&(t.bitrate=parseInt(e.attribs.bitrate,10)),e.attribs.framerate&&(t.framerate=parseInt(e.attribs.framerate,10)),e.attribs.samplingrate&&(t.samplingrate=parseInt(e.attribs.samplingrate,10)),e.attribs.channels&&(t.channels=parseInt(e.attribs.channels,10)),e.attribs.duration&&(t.duration=parseInt(e.attribs.duration,10)),e.attribs.height&&(t.height=parseInt(e.attribs.height,10)),e.attribs.width&&(t.width=parseInt(e.attribs.width,10)),e.attribs.lang&&(t.lang=e.attribs.lang),t}))}function g(e,t){return h.getElementsByTagName(e,t,!0)}function y(e,t){return h.getElementsByTagName(e,t,!0,1)[0]}function v(e,t,n){return void 0===n&&(n=!1),h.getText(h.getElementsByTagName(e,t,n,1)).trim()}function b(e,t){return t?t.attribs[e]:null}function w(e,t,n,i,r){void 0===r&&(r=!1);var s=v(n,i,r);s&&(e[t]=s)}function x(e){return"rss"===e||"feed"===e||"rdf:RDF"===e}t.FeedHandler=f,t.parseFeed=function(e,t){void 0===t&&(t={xmlMode:!0});var n=new f(t);return new p.Parser(n,t).end(e),n.feed}},4418:function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var r=i(n(4614)),s=new Set(["input","option","optgroup","select","button","datalist","textarea"]),o=new Set(["p"]),a={tr:new Set(["tr","th","td"]),th:new Set(["th"]),td:new Set(["thead","th","td"]),body:new Set(["head","link","script"]),li:new Set(["li"]),p:o,h1:o,h2:o,h3:o,h4:o,h5:o,h6:o,select:s,input:s,output:s,button:s,datalist:s,textarea:s,option:new Set(["option"]),optgroup:new Set(["optgroup","option"]),dd:new Set(["dt","dd"]),dt:new Set(["dt","dd"]),address:o,article:o,aside:o,blockquote:o,details:o,div:o,dl:o,fieldset:o,figcaption:o,figure:o,footer:o,form:o,header:o,hr:o,main:o,nav:o,ol:o,pre:o,section:o,table:o,ul:o,rt:new Set(["rt","rp"]),rp:new Set(["rt","rp"]),tbody:new Set(["thead","tbody"]),tfoot:new Set(["thead","tbody"])},l=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),c=new Set(["math","svg"]),u=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),d=/\s|\//,h=function(){function e(e,t){var n,i,s,o,a;void 0===t&&(t={}),this.startIndex=0,this.endIndex=null,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.options=t,this.cbs=null!=e?e:{},this.lowerCaseTagNames=null!==(n=t.lowerCaseTags)&&void 0!==n?n:!t.xmlMode,this.lowerCaseAttributeNames=null!==(i=t.lowerCaseAttributeNames)&&void 0!==i?i:!t.xmlMode,this.tokenizer=new(null!==(s=t.Tokenizer)&&void 0!==s?s:r.default)(this.options,this),null===(a=(o=this.cbs).onparserinit)||void 0===a||a.call(o,this)}return e.prototype.updatePosition=function(e){null===this.endIndex?this.tokenizer.sectionStart<=e?this.startIndex=0:this.startIndex=this.tokenizer.sectionStart-e:this.startIndex=this.endIndex+1,this.endIndex=this.tokenizer.getAbsoluteIndex()},e.prototype.ontext=function(e){var t,n;this.updatePosition(1),this.endIndex--,null===(n=(t=this.cbs).ontext)||void 0===n||n.call(t,e)},e.prototype.onopentagname=function(e){var t,n;if(this.lowerCaseTagNames&&(e=e.toLowerCase()),this.tagname=e,!this.options.xmlMode&&Object.prototype.hasOwnProperty.call(a,e))for(var i=void 0;this.stack.length>0&&a[e].has(i=this.stack[this.stack.length-1]);)this.onclosetag(i);!this.options.xmlMode&&l.has(e)||(this.stack.push(e),c.has(e)?this.foreignContext.push(!0):u.has(e)&&this.foreignContext.push(!1)),null===(n=(t=this.cbs).onopentagname)||void 0===n||n.call(t,e),this.cbs.onopentag&&(this.attribs={})},e.prototype.onopentagend=function(){var e,t;this.updatePosition(1),this.attribs&&(null===(t=(e=this.cbs).onopentag)||void 0===t||t.call(e,this.tagname,this.attribs),this.attribs=null),!this.options.xmlMode&&this.cbs.onclosetag&&l.has(this.tagname)&&this.cbs.onclosetag(this.tagname),this.tagname=""},e.prototype.onclosetag=function(e){if(this.updatePosition(1),this.lowerCaseTagNames&&(e=e.toLowerCase()),(c.has(e)||u.has(e))&&this.foreignContext.pop(),!this.stack.length||!this.options.xmlMode&&l.has(e))this.options.xmlMode||"br"!==e&&"p"!==e||(this.onopentagname(e),this.closeCurrentTag());else{var t=this.stack.lastIndexOf(e);if(-1!==t)if(this.cbs.onclosetag)for(t=this.stack.length-t;t--;)this.cbs.onclosetag(this.stack.pop());else this.stack.length=t;else"p"!==e||this.options.xmlMode||(this.onopentagname(e),this.closeCurrentTag())}},e.prototype.onselfclosingtag=function(){this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?this.closeCurrentTag():this.onopentagend()},e.prototype.closeCurrentTag=function(){var e,t,n=this.tagname;this.onopentagend(),this.stack[this.stack.length-1]===n&&(null===(t=(e=this.cbs).onclosetag)||void 0===t||t.call(e,n),this.stack.pop())},e.prototype.onattribname=function(e){this.lowerCaseAttributeNames&&(e=e.toLowerCase()),this.attribname=e},e.prototype.onattribdata=function(e){this.attribvalue+=e},e.prototype.onattribend=function(e){var t,n;null===(n=(t=this.cbs).onattribute)||void 0===n||n.call(t,this.attribname,this.attribvalue,e),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribname="",this.attribvalue=""},e.prototype.getInstructionName=function(e){var t=e.search(d),n=t<0?e:e.substr(0,t);return this.lowerCaseTagNames&&(n=n.toLowerCase()),n},e.prototype.ondeclaration=function(e){if(this.cbs.onprocessinginstruction){var t=this.getInstructionName(e);this.cbs.onprocessinginstruction("!"+t,"!"+e)}},e.prototype.onprocessinginstruction=function(e){if(this.cbs.onprocessinginstruction){var t=this.getInstructionName(e);this.cbs.onprocessinginstruction("?"+t,"?"+e)}},e.prototype.oncomment=function(e){var t,n,i,r;this.updatePosition(4),null===(n=(t=this.cbs).oncomment)||void 0===n||n.call(t,e),null===(r=(i=this.cbs).oncommentend)||void 0===r||r.call(i)},e.prototype.oncdata=function(e){var t,n,i,r,s,o;this.updatePosition(1),this.options.xmlMode||this.options.recognizeCDATA?(null===(n=(t=this.cbs).oncdatastart)||void 0===n||n.call(t),null===(r=(i=this.cbs).ontext)||void 0===r||r.call(i,e),null===(o=(s=this.cbs).oncdataend)||void 0===o||o.call(s)):this.oncomment("[CDATA["+e+"]]")},e.prototype.onerror=function(e){var t,n;null===(n=(t=this.cbs).onerror)||void 0===n||n.call(t,e)},e.prototype.onend=function(){var e,t;if(this.cbs.onclosetag)for(var n=this.stack.length;n>0;this.cbs.onclosetag(this.stack[--n]));null===(t=(e=this.cbs).onend)||void 0===t||t.call(e)},e.prototype.reset=function(){var e,t,n,i;null===(t=(e=this.cbs).onreset)||void 0===t||t.call(e),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack=[],null===(i=(n=this.cbs).onparserinit)||void 0===i||i.call(n,this)},e.prototype.parseComplete=function(e){this.reset(),this.end(e)},e.prototype.write=function(e){this.tokenizer.write(e)},e.prototype.end=function(e){this.tokenizer.end(e)},e.prototype.pause=function(){this.tokenizer.pause()},e.prototype.resume=function(){this.tokenizer.resume()},e.prototype.parseChunk=function(e){this.write(e)},e.prototype.done=function(e){this.end(e)},e}();t.Parser=h},4614:function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(8787)),s=i(n(2834)),o=i(n(2061)),a=i(n(5529));function l(e){return" "===e||"\n"===e||"\t"===e||"\f"===e||"\r"===e}function c(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}function u(e,t,n){var i=e.toLowerCase();return e===i?function(e,r){r===i?e._state=t:(e._state=n,e._index--)}:function(r,s){s===i||s===e?r._state=t:(r._state=n,r._index--)}}function d(e,t){var n=e.toLowerCase();return function(i,r){r===n||r===e?i._state=t:(i._state=3,i._index--)}}var h=u("C",24,16),p=u("D",25,16),f=u("A",26,16),m=u("T",27,16),g=u("A",28,16),y=d("R",35),v=d("I",36),b=d("P",37),w=d("T",38),x=u("R",40,1),_=u("I",41,1),E=u("P",42,1),S=u("T",43,1),C=d("Y",45),T=d("L",46),A=d("E",47),k=u("Y",49,1),N=u("L",50,1),M=u("E",51,1),P=d("I",54),L=d("T",55),O=d("L",56),R=d("E",57),I=u("I",58,1),D=u("T",59,1),F=u("L",60,1),B=u("E",61,1),z=u("#",63,64),j=u("X",66,65),V=function(){function e(e,t){var n;this._state=1,this.buffer="",this.sectionStart=0,this._index=0,this.bufferOffset=0,this.baseState=1,this.special=1,this.running=!0,this.ended=!1,this.cbs=t,this.xmlMode=!!(null==e?void 0:e.xmlMode),this.decodeEntities=null===(n=null==e?void 0:e.decodeEntities)||void 0===n||n}return e.prototype.reset=function(){this._state=1,this.buffer="",this.sectionStart=0,this._index=0,this.bufferOffset=0,this.baseState=1,this.special=1,this.running=!0,this.ended=!1},e.prototype.write=function(e){this.ended&&this.cbs.onerror(Error(".write() after done!")),this.buffer+=e,this.parse()},e.prototype.end=function(e){this.ended&&this.cbs.onerror(Error(".end() after done!")),e&&this.write(e),this.ended=!0,this.running&&this.finish()},e.prototype.pause=function(){this.running=!1},e.prototype.resume=function(){this.running=!0,this._index<this.buffer.length&&this.parse(),this.ended&&this.finish()},e.prototype.getAbsoluteIndex=function(){return this.bufferOffset+this._index},e.prototype.stateText=function(e){"<"===e?(this._index>this.sectionStart&&this.cbs.ontext(this.getSection()),this._state=2,this.sectionStart=this._index):!this.decodeEntities||"&"!==e||1!==this.special&&4!==this.special||(this._index>this.sectionStart&&this.cbs.ontext(this.getSection()),this.baseState=1,this._state=62,this.sectionStart=this._index)},e.prototype.isTagStartChar=function(e){return c(e)||this.xmlMode&&!l(e)&&"/"!==e&&">"!==e},e.prototype.stateBeforeTagName=function(e){"/"===e?this._state=5:"<"===e?(this.cbs.ontext(this.getSection()),this.sectionStart=this._index):">"===e||1!==this.special||l(e)?this._state=1:"!"===e?(this._state=15,this.sectionStart=this._index+1):"?"===e?(this._state=17,this.sectionStart=this._index+1):this.isTagStartChar(e)?(this._state=this.xmlMode||"s"!==e&&"S"!==e?this.xmlMode||"t"!==e&&"T"!==e?3:52:32,this.sectionStart=this._index):this._state=1},e.prototype.stateInTagName=function(e){("/"===e||">"===e||l(e))&&(this.emitToken("onopentagname"),this._state=8,this._index--)},e.prototype.stateBeforeClosingTagName=function(e){l(e)||(">"===e?this._state=1:1!==this.special?4===this.special||"s"!==e&&"S"!==e?4!==this.special||"t"!==e&&"T"!==e?(this._state=1,this._index--):this._state=53:this._state=33:this.isTagStartChar(e)?(this._state=6,this.sectionStart=this._index):(this._state=20,this.sectionStart=this._index))},e.prototype.stateInClosingTagName=function(e){(">"===e||l(e))&&(this.emitToken("onclosetag"),this._state=7,this._index--)},e.prototype.stateAfterClosingTagName=function(e){">"===e&&(this._state=1,this.sectionStart=this._index+1)},e.prototype.stateBeforeAttributeName=function(e){">"===e?(this.cbs.onopentagend(),this._state=1,this.sectionStart=this._index+1):"/"===e?this._state=4:l(e)||(this._state=9,this.sectionStart=this._index)},e.prototype.stateInSelfClosingTag=function(e){">"===e?(this.cbs.onselfclosingtag(),this._state=1,this.sectionStart=this._index+1,this.special=1):l(e)||(this._state=8,this._index--)},e.prototype.stateInAttributeName=function(e){("="===e||"/"===e||">"===e||l(e))&&(this.cbs.onattribname(this.getSection()),this.sectionStart=-1,this._state=10,this._index--)},e.prototype.stateAfterAttributeName=function(e){"="===e?this._state=11:"/"===e||">"===e?(this.cbs.onattribend(void 0),this._state=8,this._index--):l(e)||(this.cbs.onattribend(void 0),this._state=9,this.sectionStart=this._index)},e.prototype.stateBeforeAttributeValue=function(e){'"'===e?(this._state=12,this.sectionStart=this._index+1):"'"===e?(this._state=13,this.sectionStart=this._index+1):l(e)||(this._state=14,this.sectionStart=this._index,this._index--)},e.prototype.handleInAttributeValue=function(e,t){e===t?(this.emitToken("onattribdata"),this.cbs.onattribend(t),this._state=8):this.decodeEntities&&"&"===e&&(this.emitToken("onattribdata"),this.baseState=this._state,this._state=62,this.sectionStart=this._index)},e.prototype.stateInAttributeValueDoubleQuotes=function(e){this.handleInAttributeValue(e,'"')},e.prototype.stateInAttributeValueSingleQuotes=function(e){this.handleInAttributeValue(e,"'")},e.prototype.stateInAttributeValueNoQuotes=function(e){l(e)||">"===e?(this.emitToken("onattribdata"),this.cbs.onattribend(null),this._state=8,this._index--):this.decodeEntities&&"&"===e&&(this.emitToken("onattribdata"),this.baseState=this._state,this._state=62,this.sectionStart=this._index)},e.prototype.stateBeforeDeclaration=function(e){this._state="["===e?23:"-"===e?18:16},e.prototype.stateInDeclaration=function(e){">"===e&&(this.cbs.ondeclaration(this.getSection()),this._state=1,this.sectionStart=this._index+1)},e.prototype.stateInProcessingInstruction=function(e){">"===e&&(this.cbs.onprocessinginstruction(this.getSection()),this._state=1,this.sectionStart=this._index+1)},e.prototype.stateBeforeComment=function(e){"-"===e?(this._state=19,this.sectionStart=this._index+1):this._state=16},e.prototype.stateInComment=function(e){"-"===e&&(this._state=21)},e.prototype.stateInSpecialComment=function(e){">"===e&&(this.cbs.oncomment(this.buffer.substring(this.sectionStart,this._index)),this._state=1,this.sectionStart=this._index+1)},e.prototype.stateAfterComment1=function(e){this._state="-"===e?22:19},e.prototype.stateAfterComment2=function(e){">"===e?(this.cbs.oncomment(this.buffer.substring(this.sectionStart,this._index-2)),this._state=1,this.sectionStart=this._index+1):"-"!==e&&(this._state=19)},e.prototype.stateBeforeCdata6=function(e){"["===e?(this._state=29,this.sectionStart=this._index+1):(this._state=16,this._index--)},e.prototype.stateInCdata=function(e){"]"===e&&(this._state=30)},e.prototype.stateAfterCdata1=function(e){this._state="]"===e?31:29},e.prototype.stateAfterCdata2=function(e){">"===e?(this.cbs.oncdata(this.buffer.substring(this.sectionStart,this._index-2)),this._state=1,this.sectionStart=this._index+1):"]"!==e&&(this._state=29)},e.prototype.stateBeforeSpecialS=function(e){"c"===e||"C"===e?this._state=34:"t"===e||"T"===e?this._state=44:(this._state=3,this._index--)},e.prototype.stateBeforeSpecialSEnd=function(e){2!==this.special||"c"!==e&&"C"!==e?3!==this.special||"t"!==e&&"T"!==e?this._state=1:this._state=48:this._state=39},e.prototype.stateBeforeSpecialLast=function(e,t){("/"===e||">"===e||l(e))&&(this.special=t),this._state=3,this._index--},e.prototype.stateAfterSpecialLast=function(e,t){">"===e||l(e)?(this.special=1,this._state=6,this.sectionStart=this._index-t,this._index--):this._state=1},e.prototype.parseFixedEntity=function(e){if(void 0===e&&(e=this.xmlMode?a.default:s.default),this.sectionStart+1<this._index){var t=this.buffer.substring(this.sectionStart+1,this._index);Object.prototype.hasOwnProperty.call(e,t)&&(this.emitPartial(e[t]),this.sectionStart=this._index+1)}},e.prototype.parseLegacyEntity=function(){for(var e=this.sectionStart+1,t=Math.min(this._index-e,6);t>=2;){var n=this.buffer.substr(e,t);if(Object.prototype.hasOwnProperty.call(o.default,n))return this.emitPartial(o.default[n]),void(this.sectionStart+=t+1);t--}},e.prototype.stateInNamedEntity=function(e){";"===e?(this.parseFixedEntity(),1===this.baseState&&this.sectionStart+1<this._index&&!this.xmlMode&&this.parseLegacyEntity(),this._state=this.baseState):(e<"0"||e>"9")&&!c(e)&&(this.xmlMode||this.sectionStart+1===this._index||(1!==this.baseState?"="!==e&&this.parseFixedEntity(o.default):this.parseLegacyEntity()),this._state=this.baseState,this._index--)},e.prototype.decodeNumericEntity=function(e,t,n){var i=this.sectionStart+e;if(i!==this._index){var s=this.buffer.substring(i,this._index),o=parseInt(s,t);this.emitPartial(r.default(o)),this.sectionStart=n?this._index+1:this._index}this._state=this.baseState},e.prototype.stateInNumericEntity=function(e){";"===e?this.decodeNumericEntity(2,10,!0):(e<"0"||e>"9")&&(this.xmlMode?this._state=this.baseState:this.decodeNumericEntity(2,10,!1),this._index--)},e.prototype.stateInHexEntity=function(e){";"===e?this.decodeNumericEntity(3,16,!0):(e<"a"||e>"f")&&(e<"A"||e>"F")&&(e<"0"||e>"9")&&(this.xmlMode?this._state=this.baseState:this.decodeNumericEntity(3,16,!1),this._index--)},e.prototype.cleanup=function(){this.sectionStart<0?(this.buffer="",this.bufferOffset+=this._index,this._index=0):this.running&&(1===this._state?(this.sectionStart!==this._index&&this.cbs.ontext(this.buffer.substr(this.sectionStart)),this.buffer="",this.bufferOffset+=this._index,this._index=0):this.sectionStart===this._index?(this.buffer="",this.bufferOffset+=this._index,this._index=0):(this.buffer=this.buffer.substr(this.sectionStart),this._index-=this.sectionStart,this.bufferOffset+=this.sectionStart),this.sectionStart=0)},e.prototype.parse=function(){for(;this._index<this.buffer.length&&this.running;){var e=this.buffer.charAt(this._index);1===this._state?this.stateText(e):12===this._state?this.stateInAttributeValueDoubleQuotes(e):9===this._state?this.stateInAttributeName(e):19===this._state?this.stateInComment(e):20===this._state?this.stateInSpecialComment(e):8===this._state?this.stateBeforeAttributeName(e):3===this._state?this.stateInTagName(e):6===this._state?this.stateInClosingTagName(e):2===this._state?this.stateBeforeTagName(e):10===this._state?this.stateAfterAttributeName(e):13===this._state?this.stateInAttributeValueSingleQuotes(e):11===this._state?this.stateBeforeAttributeValue(e):5===this._state?this.stateBeforeClosingTagName(e):7===this._state?this.stateAfterClosingTagName(e):32===this._state?this.stateBeforeSpecialS(e):21===this._state?this.stateAfterComment1(e):14===this._state?this.stateInAttributeValueNoQuotes(e):4===this._state?this.stateInSelfClosingTag(e):16===this._state?this.stateInDeclaration(e):15===this._state?this.stateBeforeDeclaration(e):22===this._state?this.stateAfterComment2(e):18===this._state?this.stateBeforeComment(e):33===this._state?this.stateBeforeSpecialSEnd(e):53===this._state?I(this,e):39===this._state?x(this,e):40===this._state?_(this,e):41===this._state?E(this,e):34===this._state?y(this,e):35===this._state?v(this,e):36===this._state?b(this,e):37===this._state?w(this,e):38===this._state?this.stateBeforeSpecialLast(e,2):42===this._state?S(this,e):43===this._state?this.stateAfterSpecialLast(e,6):44===this._state?C(this,e):29===this._state?this.stateInCdata(e):45===this._state?T(this,e):46===this._state?A(this,e):47===this._state?this.stateBeforeSpecialLast(e,3):48===this._state?k(this,e):49===this._state?N(this,e):50===this._state?M(this,e):51===this._state?this.stateAfterSpecialLast(e,5):52===this._state?P(this,e):54===this._state?L(this,e):55===this._state?O(this,e):56===this._state?R(this,e):57===this._state?this.stateBeforeSpecialLast(e,4):58===this._state?D(this,e):59===this._state?F(this,e):60===this._state?B(this,e):61===this._state?this.stateAfterSpecialLast(e,5):17===this._state?this.stateInProcessingInstruction(e):64===this._state?this.stateInNamedEntity(e):23===this._state?h(this,e):62===this._state?z(this,e):24===this._state?p(this,e):25===this._state?f(this,e):30===this._state?this.stateAfterCdata1(e):31===this._state?this.stateAfterCdata2(e):26===this._state?m(this,e):27===this._state?g(this,e):28===this._state?this.stateBeforeCdata6(e):66===this._state?this.stateInHexEntity(e):65===this._state?this.stateInNumericEntity(e):63===this._state?j(this,e):this.cbs.onerror(Error("unknown _state"),this._state),this._index++}this.cleanup()},e.prototype.finish=function(){this.sectionStart<this._index&&this.handleTrailingData(),this.cbs.onend()},e.prototype.handleTrailingData=function(){var e=this.buffer.substr(this.sectionStart);29===this._state||30===this._state||31===this._state?this.cbs.oncdata(e):19===this._state||21===this._state||22===this._state?this.cbs.oncomment(e):64!==this._state||this.xmlMode?65!==this._state||this.xmlMode?66!==this._state||this.xmlMode?3!==this._state&&8!==this._state&&11!==this._state&&10!==this._state&&9!==this._state&&13!==this._state&&12!==this._state&&14!==this._state&&6!==this._state&&this.cbs.ontext(e):(this.decodeNumericEntity(3,16,!1),this.sectionStart<this._index&&(this._state=this.baseState,this.handleTrailingData())):(this.decodeNumericEntity(2,10,!1),this.sectionStart<this._index&&(this._state=this.baseState,this.handleTrailingData())):(this.parseLegacyEntity(),this.sectionStart<this._index&&(this._state=this.baseState,this.handleTrailingData()))},e.prototype.getSection=function(){return this.buffer.substring(this.sectionStart,this._index)},e.prototype.emitToken=function(e){this.cbs[e](this.getSection()),this.sectionStart=-1},e.prototype.emitPartial=function(e){1!==this.baseState?this.cbs.onattribdata(e):this.cbs.ontext(e)},e}();t.default=V},2904:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t},o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RssHandler=t.DefaultHandler=t.DomUtils=t.ElementType=t.Tokenizer=t.createDomStream=t.parseDOM=t.parseDocument=t.DomHandler=t.Parser=void 0;var l=n(4418);Object.defineProperty(t,"Parser",{enumerable:!0,get:function(){return l.Parser}});var c=n(6722);function u(e,t){var n=new c.DomHandler(void 0,t);return new l.Parser(n,t).end(e),n.root}Object.defineProperty(t,"DomHandler",{enumerable:!0,get:function(){return c.DomHandler}}),Object.defineProperty(t,"DefaultHandler",{enumerable:!0,get:function(){return c.DomHandler}}),t.parseDocument=u,t.parseDOM=function(e,t){return u(e,t).children},t.createDomStream=function(e,t,n){var i=new c.DomHandler(e,t,n);return new l.Parser(i,t)};var d=n(4614);Object.defineProperty(t,"Tokenizer",{enumerable:!0,get:function(){return a(d).default}});var h=s(n(3930));t.ElementType=h,o(n(7848),t),t.DomUtils=s(n(3114));var p=n(7848);Object.defineProperty(t,"RssHandler",{enumerable:!0,get:function(){return p.FeedHandler}})},2573:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.attributeNames=t.elementNames=void 0,t.elementNames=new Map([["altglyph","altGlyph"],["altglyphdef","altGlyphDef"],["altglyphitem","altGlyphItem"],["animatecolor","animateColor"],["animatemotion","animateMotion"],["animatetransform","animateTransform"],["clippath","clipPath"],["feblend","feBlend"],["fecolormatrix","feColorMatrix"],["fecomponenttransfer","feComponentTransfer"],["fecomposite","feComposite"],["feconvolvematrix","feConvolveMatrix"],["fediffuselighting","feDiffuseLighting"],["fedisplacementmap","feDisplacementMap"],["fedistantlight","feDistantLight"],["fedropshadow","feDropShadow"],["feflood","feFlood"],["fefunca","feFuncA"],["fefuncb","feFuncB"],["fefuncg","feFuncG"],["fefuncr","feFuncR"],["fegaussianblur","feGaussianBlur"],["feimage","feImage"],["femerge","feMerge"],["femergenode","feMergeNode"],["femorphology","feMorphology"],["feoffset","feOffset"],["fepointlight","fePointLight"],["fespecularlighting","feSpecularLighting"],["fespotlight","feSpotLight"],["fetile","feTile"],["feturbulence","feTurbulence"],["foreignobject","foreignObject"],["glyphref","glyphRef"],["lineargradient","linearGradient"],["radialgradient","radialGradient"],["textpath","textPath"]]),t.attributeNames=new Map([["definitionurl","definitionURL"],["attributename","attributeName"],["attributetype","attributeType"],["basefrequency","baseFrequency"],["baseprofile","baseProfile"],["calcmode","calcMode"],["clippathunits","clipPathUnits"],["diffuseconstant","diffuseConstant"],["edgemode","edgeMode"],["filterunits","filterUnits"],["glyphref","glyphRef"],["gradienttransform","gradientTransform"],["gradientunits","gradientUnits"],["kernelmatrix","kernelMatrix"],["kernelunitlength","kernelUnitLength"],["keypoints","keyPoints"],["keysplines","keySplines"],["keytimes","keyTimes"],["lengthadjust","lengthAdjust"],["limitingconeangle","limitingConeAngle"],["markerheight","markerHeight"],["markerunits","markerUnits"],["markerwidth","markerWidth"],["maskcontentunits","maskContentUnits"],["maskunits","maskUnits"],["numoctaves","numOctaves"],["pathlength","pathLength"],["patterncontentunits","patternContentUnits"],["patterntransform","patternTransform"],["patternunits","patternUnits"],["pointsatx","pointsAtX"],["pointsaty","pointsAtY"],["pointsatz","pointsAtZ"],["preservealpha","preserveAlpha"],["preserveaspectratio","preserveAspectRatio"],["primitiveunits","primitiveUnits"],["refx","refX"],["refy","refY"],["repeatcount","repeatCount"],["repeatdur","repeatDur"],["requiredextensions","requiredExtensions"],["requiredfeatures","requiredFeatures"],["specularconstant","specularConstant"],["specularexponent","specularExponent"],["spreadmethod","spreadMethod"],["startoffset","startOffset"],["stddeviation","stdDeviation"],["stitchtiles","stitchTiles"],["surfacescale","surfaceScale"],["systemlanguage","systemLanguage"],["tablevalues","tableValues"],["targetx","targetX"],["targety","targetY"],["textlength","textLength"],["viewbox","viewBox"],["viewtarget","viewTarget"],["xchannelselector","xChannelSelector"],["ychannelselector","yChannelSelector"],["zoomandpan","zoomAndPan"]])},1236:function(e,t,n){"use strict";var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},i.apply(this,arguments)},r=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(3930)),l=n(9625),c=n(2573),u=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);var d=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function h(e,t){void 0===t&&(t={});for(var n=("length"in e?e:[e]),i="",r=0;r<n.length;r++)i+=p(n[r],t);return i}function p(e,t){switch(e.type){case a.Root:return h(e.children,t);case a.Directive:case a.Doctype:return"<"+e.data+">";case a.Comment:return function(e){return"\x3c!--"+e.data+"--\x3e"}(e);case a.CDATA:return function(e){return"<![CDATA["+e.children[0].data+"]]>"}(e);case a.Script:case a.Style:case a.Tag:return function(e,t){var n;"foreign"===t.xmlMode&&(e.name=null!==(n=c.elementNames.get(e.name))&&void 0!==n?n:e.name,e.parent&&f.has(e.parent.name)&&(t=i(i({},t),{xmlMode:!1})));!t.xmlMode&&m.has(e.name)&&(t=i(i({},t),{xmlMode:"foreign"}));var r="<"+e.name,s=function(e,t){if(e)return Object.keys(e).map((function(n){var i,r,s=null!==(i=e[n])&&void 0!==i?i:"";return"foreign"===t.xmlMode&&(n=null!==(r=c.attributeNames.get(n))&&void 0!==r?r:n),t.emptyAttrs||t.xmlMode||""!==s?n+'="'+(!1!==t.decodeEntities?l.encodeXML(s):s.replace(/"/g,"&quot;"))+'"':n})).join(" ")}(e.attribs,t);s&&(r+=" "+s);0===e.children.length&&(t.xmlMode?!1!==t.selfClosingTags:t.selfClosingTags&&d.has(e.name))?(t.xmlMode||(r+=" "),r+="/>"):(r+=">",e.children.length>0&&(r+=h(e.children,t)),!t.xmlMode&&d.has(e.name)||(r+="</"+e.name+">"));return r}(e,t);case a.Text:return function(e,t){var n=e.data||"";!1===t.decodeEntities||!t.xmlMode&&e.parent&&u.has(e.parent.name)||(n=l.encodeXML(n));return n}(e,t)}}t.default=h;var f=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),m=new Set(["svg","math"])},3930:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.Doctype=t.CDATA=t.Tag=t.Style=t.Script=t.Comment=t.Directive=t.Text=t.Root=t.isTag=t.ElementType=void 0,function(e){e.Root="root",e.Text="text",e.Directive="directive",e.Comment="comment",e.Script="script",e.Style="style",e.Tag="tag",e.CDATA="cdata",e.Doctype="doctype"}(n=t.ElementType||(t.ElementType={})),t.isTag=function(e){return e.type===n.Tag||e.type===n.Script||e.type===n.Style},t.Root=n.Root,t.Text=n.Text,t.Directive=n.Directive,t.Comment=n.Comment,t.Script=n.Script,t.Style=n.Style,t.Tag=n.Tag,t.CDATA=n.CDATA,t.Doctype=n.Doctype},6042:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uniqueSort=t.compareDocumentPosition=t.removeSubsets=void 0;var i=n(6722);function r(e,t){var n=[],r=[];if(e===t)return 0;for(var s=i.hasChildren(e)?e:e.parent;s;)n.unshift(s),s=s.parent;for(s=i.hasChildren(t)?t:t.parent;s;)r.unshift(s),s=s.parent;for(var o=Math.min(n.length,r.length),a=0;a<o&&n[a]===r[a];)a++;if(0===a)return 1;var l=n[a-1],c=l.children,u=n[a],d=r[a];return c.indexOf(u)>c.indexOf(d)?l===t?20:4:l===e?10:2}t.removeSubsets=function(e){for(var t=e.length;--t>=0;){var n=e[t];if(t>0&&e.lastIndexOf(n,t-1)>=0)e.splice(t,1);else for(var i=n.parent;i;i=i.parent)if(e.includes(i)){e.splice(t,1);break}}return e},t.compareDocumentPosition=r,t.uniqueSort=function(e){return(e=e.filter((function(e,t,n){return!n.includes(e,t+1)}))).sort((function(e,t){var n=r(e,t);return 2&n?-1:4&n?1:0})),e}},3114:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.hasChildren=t.isDocument=t.isComment=t.isText=t.isCDATA=t.isTag=void 0,r(n(2553),t),r(n(3434),t),r(n(6470),t),r(n(3636),t),r(n(3754),t),r(n(6042),t);var s=n(6722);Object.defineProperty(t,"isTag",{enumerable:!0,get:function(){return s.isTag}}),Object.defineProperty(t,"isCDATA",{enumerable:!0,get:function(){return s.isCDATA}}),Object.defineProperty(t,"isText",{enumerable:!0,get:function(){return s.isText}}),Object.defineProperty(t,"isComment",{enumerable:!0,get:function(){return s.isComment}}),Object.defineProperty(t,"isDocument",{enumerable:!0,get:function(){return s.isDocument}}),Object.defineProperty(t,"hasChildren",{enumerable:!0,get:function(){return s.hasChildren}})},3754:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getElementsByTagType=t.getElementsByTagName=t.getElementById=t.getElements=t.testElement=void 0;var i=n(6722),r=n(3636),s={tag_name:function(e){return"function"==typeof e?function(t){return i.isTag(t)&&e(t.name)}:"*"===e?i.isTag:function(t){return i.isTag(t)&&t.name===e}},tag_type:function(e){return"function"==typeof e?function(t){return e(t.type)}:function(t){return t.type===e}},tag_contains:function(e){return"function"==typeof e?function(t){return i.isText(t)&&e(t.data)}:function(t){return i.isText(t)&&t.data===e}}};function o(e,t){return"function"==typeof t?function(n){return i.isTag(n)&&t(n.attribs[e])}:function(n){return i.isTag(n)&&n.attribs[e]===t}}function a(e,t){return function(n){return e(n)||t(n)}}function l(e){var t=Object.keys(e).map((function(t){var n=e[t];return t in s?s[t](n):o(t,n)}));return 0===t.length?null:t.reduce(a)}t.testElement=function(e,t){var n=l(e);return!n||n(t)},t.getElements=function(e,t,n,i){void 0===i&&(i=1/0);var s=l(e);return s?r.filter(s,t,n,i):[]},t.getElementById=function(e,t,n){return void 0===n&&(n=!0),Array.isArray(t)||(t=[t]),r.findOne(o("id",e),t,n)},t.getElementsByTagName=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=1/0),r.filter(s.tag_name(e),t,n,i)},t.getElementsByTagType=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=1/0),r.filter(s.tag_type(e),t,n,i)}},6470:(e,t)=>{"use strict";function n(e){if(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.parent){var t=e.parent.children;t.splice(t.lastIndexOf(e),1)}}Object.defineProperty(t,"__esModule",{value:!0}),t.prepend=t.prependChild=t.append=t.appendChild=t.replaceElement=t.removeElement=void 0,t.removeElement=n,t.replaceElement=function(e,t){var n=t.prev=e.prev;n&&(n.next=t);var i=t.next=e.next;i&&(i.prev=t);var r=t.parent=e.parent;if(r){var s=r.children;s[s.lastIndexOf(e)]=t}},t.appendChild=function(e,t){if(n(t),t.next=null,t.parent=e,e.children.push(t)>1){var i=e.children[e.children.length-2];i.next=t,t.prev=i}else t.prev=null},t.append=function(e,t){n(t);var i=e.parent,r=e.next;if(t.next=r,t.prev=e,e.next=t,t.parent=i,r){if(r.prev=t,i){var s=i.children;s.splice(s.lastIndexOf(r),0,t)}}else i&&i.children.push(t)},t.prependChild=function(e,t){if(n(t),t.parent=e,t.prev=null,1!==e.children.unshift(t)){var i=e.children[1];i.prev=t,t.next=i}else t.next=null},t.prepend=function(e,t){n(t);var i=e.parent;if(i){var r=i.children;r.splice(r.indexOf(e),0,t)}e.prev&&(e.prev.next=t),t.parent=i,t.prev=e.prev,t.next=e,e.prev=t}},3636:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findAll=t.existsOne=t.findOne=t.findOneChild=t.find=t.filter=void 0;var i=n(6722);function r(e,t,n,s){for(var o=[],a=0,l=t;a<l.length;a++){var c=l[a];if(e(c)&&(o.push(c),--s<=0))break;if(n&&i.hasChildren(c)&&c.children.length>0){var u=r(e,c.children,n,s);if(o.push.apply(o,u),(s-=u.length)<=0)break}}return o}t.filter=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=1/0),Array.isArray(t)||(t=[t]),r(e,t,n,i)},t.find=r,t.findOneChild=function(e,t){return t.find(e)},t.findOne=function e(t,n,r){void 0===r&&(r=!0);for(var s=null,o=0;o<n.length&&!s;o++){var a=n[o];i.isTag(a)&&(t(a)?s=a:r&&a.children.length>0&&(s=e(t,a.children)))}return s},t.existsOne=function e(t,n){return n.some((function(n){return i.isTag(n)&&(t(n)||n.children.length>0&&e(t,n.children))}))},t.findAll=function(e,t){for(var n,r,s=[],o=t.filter(i.isTag);r=o.shift();){var a=null===(n=r.children)||void 0===n?void 0:n.filter(i.isTag);a&&a.length>0&&o.unshift.apply(o,a),e(r)&&s.push(r)}return s}},2553:function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.innerText=t.textContent=t.getText=t.getInnerHTML=t.getOuterHTML=void 0;var r=n(6722),s=i(n(1236)),o=n(3930);function a(e,t){return s.default(e,t)}t.getOuterHTML=a,t.getInnerHTML=function(e,t){return r.hasChildren(e)?e.children.map((function(e){return a(e,t)})).join(""):""},t.getText=function e(t){return Array.isArray(t)?t.map(e).join(""):r.isTag(t)?"br"===t.name?"\n":e(t.children):r.isCDATA(t)?e(t.children):r.isText(t)?t.data:""},t.textContent=function e(t){return Array.isArray(t)?t.map(e).join(""):r.isTag(t)||r.isCDATA(t)?e(t.children):r.isText(t)?t.data:""},t.innerText=function e(t){return Array.isArray(t)?t.map(e).join(""):r.hasChildren(t)&&t.type===o.ElementType.Tag||r.isCDATA(t)?e(t.children):r.isText(t)?t.data:""}},3434:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.prevElementSibling=t.nextElementSibling=t.getName=t.hasAttrib=t.getAttributeValue=t.getSiblings=t.getParent=t.getChildren=void 0;var i=n(6722),r=[];function s(e){var t;return null!==(t=e.children)&&void 0!==t?t:r}function o(e){return e.parent||null}t.getChildren=s,t.getParent=o,t.getSiblings=function(e){var t=o(e);if(null!=t)return s(t);for(var n=[e],i=e.prev,r=e.next;null!=i;)n.unshift(i),i=i.prev;for(;null!=r;)n.push(r),r=r.next;return n},t.getAttributeValue=function(e,t){var n;return null===(n=e.attribs)||void 0===n?void 0:n[t]},t.hasAttrib=function(e,t){return null!=e.attribs&&Object.prototype.hasOwnProperty.call(e.attribs,t)&&null!=e.attribs[t]},t.getName=function(e){return e.name},t.nextElementSibling=function(e){for(var t=e.next;null!==t&&!i.isTag(t);)t=t.next;return t},t.prevElementSibling=function(e){for(var t=e.prev;null!==t&&!i.isTag(t);)t=t.prev;return t}},5182:e=>{e.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},2525:e=>{"use strict";var t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;function r(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(e){i[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(e){return!1}}()?Object.assign:function(e,s){for(var o,a,l=r(e),c=1;c<arguments.length;c++){for(var u in o=Object(arguments[c]))n.call(o,u)&&(l[u]=o[u]);if(t){a=t(o);for(var d=0;d<a.length;d++)i.call(o,a[d])&&(l[a[d]]=o[a[d]])}}return l}},6381:function(e,t){var n,i,r;i=[],n=function e(){"use strict";var t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{},n=!t.document&&!!t.postMessage,i=n&&/blob:/i.test((t.location||{}).protocol),r={},s=0,o={parse:function(n,i){var a=(i=i||{}).dynamicTyping||!1;if(x(a)&&(i.dynamicTypingFunction=a,a={}),i.dynamicTyping=a,i.transform=!!x(i.transform)&&i.transform,i.worker&&o.WORKERS_SUPPORTED){var l=function(){if(!o.WORKERS_SUPPORTED)return!1;var n,i,a=(n=t.URL||t.webkitURL||null,i=e.toString(),o.BLOB_URL||(o.BLOB_URL=n.createObjectURL(new Blob(["(",i,")();"],{type:"text/javascript"})))),l=new t.Worker(a);return l.onmessage=g,l.id=s++,r[l.id]=l}();return l.userStep=i.step,l.userChunk=i.chunk,l.userComplete=i.complete,l.userError=i.error,i.step=x(i.step),i.chunk=x(i.chunk),i.complete=x(i.complete),i.error=x(i.error),delete i.worker,void l.postMessage({input:n,config:i,workerId:l.id})}var p=null;return o.NODE_STREAM_INPUT,"string"==typeof n?p=i.download?new c(i):new d(i):!0===n.readable&&x(n.read)&&x(n.on)?p=new h(i):(t.File&&n instanceof File||n instanceof Object)&&(p=new u(i)),p.stream(n)},unparse:function(e,t){var n=!1,i=!0,r=",",s="\r\n",a='"',l=a+a,c=!1,u=null,d=!1;!function(){if("object"==typeof t){if("string"!=typeof t.delimiter||o.BAD_DELIMITERS.filter((function(e){return-1!==t.delimiter.indexOf(e)})).length||(r=t.delimiter),("boolean"==typeof t.quotes||"function"==typeof t.quotes||Array.isArray(t.quotes))&&(n=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(c=t.skipEmptyLines),"string"==typeof t.newline&&(s=t.newline),"string"==typeof t.quoteChar&&(a=t.quoteChar),"boolean"==typeof t.header&&(i=t.header),Array.isArray(t.columns)){if(0===t.columns.length)throw new Error("Option columns is empty");u=t.columns}void 0!==t.escapeChar&&(l=t.escapeChar+a),"boolean"==typeof t.escapeFormulae&&(d=t.escapeFormulae)}}();var h=new RegExp(f(a),"g");if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return p(null,e,c);if("object"==typeof e[0])return p(u||Object.keys(e[0]),e,c)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:"object"==typeof e.data[0]?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),p(e.fields||[],e.data||[],c);throw new Error("Unable to serialize unrecognized input");function p(e,t,n){var o="";"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t));var a=Array.isArray(e)&&0<e.length,l=!Array.isArray(t[0]);if(a&&i){for(var c=0;c<e.length;c++)0<c&&(o+=r),o+=m(e[c],c);0<t.length&&(o+=s)}for(var u=0;u<t.length;u++){var d=a?e.length:t[u].length,h=!1,p=a?0===Object.keys(t[u]).length:0===t[u].length;if(n&&!a&&(h="greedy"===n?""===t[u].join("").trim():1===t[u].length&&0===t[u][0].length),"greedy"===n&&a){for(var f=[],g=0;g<d;g++){var y=l?e[g]:g;f.push(t[u][y])}h=""===f.join("").trim()}if(!h){for(var v=0;v<d;v++){0<v&&!p&&(o+=r);var b=a&&l?e[v]:v;o+=m(t[u][b],v)}u<t.length-1&&(!n||0<d&&!p)&&(o+=s)}}return o}function m(e,t){if(null==e)return"";if(e.constructor===Date)return JSON.stringify(e).slice(1,25);!0===d&&"string"==typeof e&&null!==e.match(/^[=+\-@].*$/)&&(e="'"+e);var i=e.toString().replace(h,l),s="boolean"==typeof n&&n||"function"==typeof n&&n(e,t)||Array.isArray(n)&&n[t]||function(e,t){for(var n=0;n<t.length;n++)if(-1<e.indexOf(t[n]))return!0;return!1}(i,o.BAD_DELIMITERS)||-1<i.indexOf(r)||" "===i.charAt(0)||" "===i.charAt(i.length-1);return s?a+i+a:i}}};if(o.RECORD_SEP=String.fromCharCode(30),o.UNIT_SEP=String.fromCharCode(31),o.BYTE_ORDER_MARK="\ufeff",o.BAD_DELIMITERS=["\r","\n",'"',o.BYTE_ORDER_MARK],o.WORKERS_SUPPORTED=!n&&!!t.Worker,o.NODE_STREAM_INPUT=1,o.LocalChunkSize=10485760,o.RemoteChunkSize=5242880,o.DefaultDelimiter=",",o.Parser=m,o.ParserHandle=p,o.NetworkStreamer=c,o.FileStreamer=u,o.StringStreamer=d,o.ReadableStreamStreamer=h,t.jQuery){var a=t.jQuery;a.fn.parse=function(e){var n=e.config||{},i=[];return this.each((function(e){if("INPUT"!==a(this).prop("tagName").toUpperCase()||"file"!==a(this).attr("type").toLowerCase()||!t.FileReader||!this.files||0===this.files.length)return!0;for(var r=0;r<this.files.length;r++)i.push({file:this.files[r],inputElem:this,instanceConfig:a.extend({},n)})})),r(),this;function r(){if(0!==i.length){var t,n,r,l,c=i[0];if(x(e.before)){var u=e.before(c.file,c.inputElem);if("object"==typeof u){if("abort"===u.action)return t="AbortError",n=c.file,r=c.inputElem,l=u.reason,void(x(e.error)&&e.error({name:t},n,r,l));if("skip"===u.action)return void s();"object"==typeof u.config&&(c.instanceConfig=a.extend(c.instanceConfig,u.config))}else if("skip"===u)return void s()}var d=c.instanceConfig.complete;c.instanceConfig.complete=function(e){x(d)&&d(e,c.file,c.inputElem),s()},o.parse(c.file,c.instanceConfig)}else x(e.complete)&&e.complete()}function s(){i.splice(0,1),r()}}}function l(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var t=b(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new p(t),(this._handle.streamer=this)._config=t}.call(this,e),this.parseChunk=function(e,n){if(this.isFirstChunk&&x(this._config.beforeFirstChunk)){var r=this._config.beforeFirstChunk(e);void 0!==r&&(e=r)}this.isFirstChunk=!1,this._halted=!1;var s=this._partialLine+e;this._partialLine="";var a=this._handle.parse(s,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var l=a.meta.cursor;this._finished||(this._partialLine=s.substring(l-this._baseIndex),this._baseIndex=l),a&&a.data&&(this._rowCount+=a.data.length);var c=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(i)t.postMessage({results:a,workerId:o.WORKER_ID,finished:c});else if(x(this._config.chunk)&&!n){if(this._config.chunk(a,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);a=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(a.data),this._completeResults.errors=this._completeResults.errors.concat(a.errors),this._completeResults.meta=a.meta),this._completed||!c||!x(this._config.complete)||a&&a.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),c||a&&a.meta.paused||this._nextChunk(),a}this._halted=!0},this._sendError=function(e){x(this._config.error)?this._config.error(e):i&&this._config.error&&t.postMessage({workerId:o.WORKER_ID,error:e,finished:!1})}}function c(e){var t;(e=e||{}).chunkSize||(e.chunkSize=o.RemoteChunkSize),l.call(this,e),this._nextChunk=n?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),n||(t.onload=w(this._chunkLoaded,this),t.onerror=w(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!n),this._config.downloadRequestHeaders){var e=this._config.downloadRequestHeaders;for(var i in e)t.setRequestHeader(i,e[i])}if(this._config.chunkSize){var r=this._start+this._config.chunkSize-1;t.setRequestHeader("Range","bytes="+this._start+"-"+r)}try{t.send(this._config.downloadRequestBody)}catch(e){this._chunkError(e.message)}n&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){4===t.readyState&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:t.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(e){var t=e.getResponseHeader("Content-Range");return null===t?-1:parseInt(t.substring(t.lastIndexOf("/")+1))}(t),this.parseChunk(t.responseText)))},this._chunkError=function(e){var n=t.statusText||e;this._sendError(new Error(n))}}function u(e){var t,n;(e=e||{}).chunkSize||(e.chunkSize=o.LocalChunkSize),l.call(this,e);var i="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,n=e.slice||e.webkitSlice||e.mozSlice,i?((t=new FileReader).onload=w(this._chunkLoaded,this),t.onerror=w(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input;if(this._config.chunkSize){var r=Math.min(this._start+this._config.chunkSize,this._input.size);e=n.call(e,this._start,r)}var s=t.readAsText(e,this._config.encoding);i||this._chunkLoaded({target:{result:s}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function d(e){var t;l.call(this,e=e||{}),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var e,n=this._config.chunkSize;return n?(e=t.substring(0,n),t=t.substring(n)):(e=t,t=""),this._finished=!t,this.parseChunk(e)}}}function h(e){l.call(this,e=e||{});var t=[],n=!0,i=!1;this.pause=function(){l.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){l.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){i&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):n=!0},this._streamData=w((function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),n&&(n=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(e){this._streamError(e)}}),this),this._streamError=w((function(e){this._streamCleanUp(),this._sendError(e)}),this),this._streamEnd=w((function(){this._streamCleanUp(),i=!0,this._streamData("")}),this),this._streamCleanUp=w((function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)}),this)}function p(e){var t,n,i,r=Math.pow(2,53),s=-r,a=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,l=/^(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))$/,c=this,u=0,d=0,h=!1,p=!1,g=[],y={data:[],errors:[],meta:{}};if(x(e.step)){var v=e.step;e.step=function(t){if(y=t,E())_();else{if(_(),0===y.data.length)return;u+=t.data.length,e.preview&&u>e.preview?n.abort():(y.data=y.data[0],v(y,c))}}}function w(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function _(){if(y&&i&&(C("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+o.DefaultDelimiter+"'"),i=!1),e.skipEmptyLines)for(var t=0;t<y.data.length;t++)w(y.data[t])&&y.data.splice(t--,1);return E()&&function(){if(y)if(Array.isArray(y.data[0])){for(var t=0;E()&&t<y.data.length;t++)y.data[t].forEach(n);y.data.splice(0,1)}else y.data.forEach(n);function n(t,n){x(e.transformHeader)&&(t=e.transformHeader(t,n)),g.push(t)}}(),function(){if(!y||!e.header&&!e.dynamicTyping&&!e.transform)return y;function t(t,n){var i,r=e.header?{}:[];for(i=0;i<t.length;i++){var s=i,o=t[i];e.header&&(s=i>=g.length?"__parsed_extra":g[i]),e.transform&&(o=e.transform(o,s)),o=S(s,o),"__parsed_extra"===s?(r[s]=r[s]||[],r[s].push(o)):r[s]=o}return e.header&&(i>g.length?C("FieldMismatch","TooManyFields","Too many fields: expected "+g.length+" fields but parsed "+i,d+n):i<g.length&&C("FieldMismatch","TooFewFields","Too few fields: expected "+g.length+" fields but parsed "+i,d+n)),r}var n=1;return!y.data.length||Array.isArray(y.data[0])?(y.data=y.data.map(t),n=y.data.length):y.data=t(y.data,0),e.header&&y.meta&&(y.meta.fields=g),d+=n,y}()}function E(){return e.header&&0===g.length}function S(t,n){return i=t,e.dynamicTypingFunction&&void 0===e.dynamicTyping[i]&&(e.dynamicTyping[i]=e.dynamicTypingFunction(i)),!0===(e.dynamicTyping[i]||e.dynamicTyping)?"true"===n||"TRUE"===n||"false"!==n&&"FALSE"!==n&&(function(e){if(a.test(e)){var t=parseFloat(e);if(s<t&&t<r)return!0}return!1}(n)?parseFloat(n):l.test(n)?new Date(n):""===n?null:n):n;var i}function C(e,t,n,i){var r={type:e,code:t,message:n};void 0!==i&&(r.row=i),y.errors.push(r)}this.parse=function(r,s,a){var l=e.quoteChar||'"';if(e.newline||(e.newline=function(e,t){e=e.substring(0,1048576);var n=new RegExp(f(t)+"([^]*?)"+f(t),"gm"),i=(e=e.replace(n,"")).split("\r"),r=e.split("\n"),s=1<r.length&&r[0].length<i[0].length;if(1===i.length||s)return"\n";for(var o=0,a=0;a<i.length;a++)"\n"===i[a][0]&&o++;return o>=i.length/2?"\r\n":"\r"}(r,l)),i=!1,e.delimiter)x(e.delimiter)&&(e.delimiter=e.delimiter(r),y.meta.delimiter=e.delimiter);else{var c=function(t,n,i,r,s){var a,l,c,u;s=s||[",","\t","|",";",o.RECORD_SEP,o.UNIT_SEP];for(var d=0;d<s.length;d++){var h=s[d],p=0,f=0,g=0;c=void 0;for(var y=new m({comments:r,delimiter:h,newline:n,preview:10}).parse(t),v=0;v<y.data.length;v++)if(i&&w(y.data[v]))g++;else{var b=y.data[v].length;f+=b,void 0!==c?0<b&&(p+=Math.abs(b-c),c=b):c=b}0<y.data.length&&(f/=y.data.length-g),(void 0===l||p<=l)&&(void 0===u||u<f)&&1.99<f&&(l=p,a=h,u=f)}return{successful:!!(e.delimiter=a),bestDelimiter:a}}(r,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess);c.successful?e.delimiter=c.bestDelimiter:(i=!0,e.delimiter=o.DefaultDelimiter),y.meta.delimiter=e.delimiter}var u=b(e);return e.preview&&e.header&&u.preview++,t=r,n=new m(u),y=n.parse(t,s,a),_(),h?{meta:{paused:!0}}:y||{meta:{paused:!1}}},this.paused=function(){return h},this.pause=function(){h=!0,n.abort(),t=x(e.chunk)?"":t.substring(n.getCharIndex())},this.resume=function(){c.streamer._halted?(h=!1,c.streamer.parseChunk(t,!0)):setTimeout(c.resume,3)},this.aborted=function(){return p},this.abort=function(){p=!0,n.abort(),y.meta.aborted=!0,x(e.complete)&&e.complete(y),t=""}}function f(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function m(e){var t,n=(e=e||{}).delimiter,i=e.newline,r=e.comments,s=e.step,a=e.preview,l=e.fastMode,c=t=void 0===e.quoteChar?'"':e.quoteChar;if(void 0!==e.escapeChar&&(c=e.escapeChar),("string"!=typeof n||-1<o.BAD_DELIMITERS.indexOf(n))&&(n=","),r===n)throw new Error("Comment character same as delimiter");!0===r?r="#":("string"!=typeof r||-1<o.BAD_DELIMITERS.indexOf(r))&&(r=!1),"\n"!==i&&"\r"!==i&&"\r\n"!==i&&(i="\n");var u=0,d=!1;this.parse=function(e,o,h){if("string"!=typeof e)throw new Error("Input must be a string");var p=e.length,m=n.length,g=i.length,y=r.length,v=x(s),b=[],w=[],_=[],E=u=0;if(!e)return D();if(l||!1!==l&&-1===e.indexOf(t)){for(var S=e.split(i),C=0;C<S.length;C++){if(_=S[C],u+=_.length,C!==S.length-1)u+=i.length;else if(h)return D();if(!r||_.substring(0,y)!==r){if(v){if(b=[],L(_.split(n)),F(),d)return D()}else L(_.split(n));if(a&&a<=C)return b=b.slice(0,a),D(!0)}}return D()}for(var T=e.indexOf(n,u),A=e.indexOf(i,u),k=new RegExp(f(c)+f(t),"g"),N=e.indexOf(t,u);;)if(e[u]!==t)if(r&&0===_.length&&e.substring(u,u+y)===r){if(-1===A)return D();u=A+g,A=e.indexOf(i,u),T=e.indexOf(n,u)}else if(-1!==T&&(T<A||-1===A))_.push(e.substring(u,T)),u=T+m,T=e.indexOf(n,u);else{if(-1===A)break;if(_.push(e.substring(u,A)),I(A+g),v&&(F(),d))return D();if(a&&b.length>=a)return D(!0)}else for(N=u,u++;;){if(-1===(N=e.indexOf(t,N+1)))return h||w.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:b.length,index:u}),R();if(N===p-1)return R(e.substring(u,N).replace(k,t));if(t!==c||e[N+1]!==c){if(t===c||0===N||e[N-1]!==c){-1!==T&&T<N+1&&(T=e.indexOf(n,N+1)),-1!==A&&A<N+1&&(A=e.indexOf(i,N+1));var M=O(-1===A?T:Math.min(T,A));if(e[N+1+M]===n){_.push(e.substring(u,N).replace(k,t)),e[u=N+1+M+m]!==t&&(N=e.indexOf(t,u)),T=e.indexOf(n,u),A=e.indexOf(i,u);break}var P=O(A);if(e.substring(N+1+P,N+1+P+g)===i){if(_.push(e.substring(u,N).replace(k,t)),I(N+1+P+g),T=e.indexOf(n,u),N=e.indexOf(t,u),v&&(F(),d))return D();if(a&&b.length>=a)return D(!0);break}w.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:b.length,index:u}),N++}}else N++}return R();function L(e){b.push(e),E=u}function O(t){var n=0;if(-1!==t){var i=e.substring(N+1,t);i&&""===i.trim()&&(n=i.length)}return n}function R(t){return h||(void 0===t&&(t=e.substring(u)),_.push(t),u=p,L(_),v&&F()),D()}function I(t){u=t,L(_),_=[],A=e.indexOf(i,u)}function D(e){return{data:b,errors:w,meta:{delimiter:n,linebreak:i,aborted:d,truncated:!!e,cursor:E+(o||0)}}}function F(){s(D()),b=[],w=[]}},this.abort=function(){d=!0},this.getCharIndex=function(){return u}}function g(e){var t=e.data,n=r[t.workerId],i=!1;if(t.error)n.userError(t.error,t.file);else if(t.results&&t.results.data){var s={abort:function(){i=!0,y(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:v,resume:v};if(x(n.userStep)){for(var o=0;o<t.results.data.length&&(n.userStep({data:t.results.data[o],errors:t.results.errors,meta:t.results.meta},s),!i);o++);delete t.results}else x(n.userChunk)&&(n.userChunk(t.results,s,t.file),delete t.results)}t.finished&&!i&&y(t.workerId,t.results)}function y(e,t){var n=r[e];x(n.userComplete)&&n.userComplete(t),n.terminate(),delete r[e]}function v(){throw new Error("Not implemented.")}function b(e){if("object"!=typeof e||null===e)return e;var t=Array.isArray(e)?[]:{};for(var n in e)t[n]=b(e[n]);return t}function w(e,t){return function(){e.apply(t,arguments)}}function x(e){return"function"==typeof e}return i&&(t.onmessage=function(e){var n=e.data;if(void 0===o.WORKER_ID&&n&&(o.WORKER_ID=n.workerId),"string"==typeof n.input)t.postMessage({workerId:o.WORKER_ID,results:o.parse(n.input,n.config),finished:!0});else if(t.File&&n.input instanceof File||n.input instanceof Object){var i=o.parse(n.input,n.config);i&&t.postMessage({workerId:o.WORKER_ID,results:i,finished:!0})}}),(c.prototype=Object.create(l.prototype)).constructor=c,(u.prototype=Object.create(l.prototype)).constructor=u,(d.prototype=Object.create(d.prototype)).constructor=d,(h.prototype=Object.create(l.prototype)).constructor=h,o},void 0===(r="function"==typeof n?n.apply(t,i):n)||(e.exports=r)},8523:function(e,t){var n,i,r;i=[],void 0===(r="function"==typeof(n=function(){return function(e){function t(e){return" "===e||"\t"===e||"\n"===e||"\f"===e||"\r"===e}function n(t){var n,i=t.exec(e.substring(m));if(i)return n=i[0],m+=n.length,n}for(var i,r,s,o,a,l=e.length,c=/^[ \t\n\r\u000c]+/,u=/^[, \t\n\r\u000c]+/,d=/^[^ \t\n\r\u000c]+/,h=/[,]+$/,p=/^\d+$/,f=/^-?(?:[0-9]+|[0-9]*\.[0-9]+)(?:[eE][+-]?[0-9]+)?$/,m=0,g=[];;){if(n(u),m>=l)return g;i=n(d),r=[],","===i.slice(-1)?(i=i.replace(h,""),v()):y()}function y(){for(n(c),s="",o="in descriptor";;){if(a=e.charAt(m),"in descriptor"===o)if(t(a))s&&(r.push(s),s="",o="after descriptor");else{if(","===a)return m+=1,s&&r.push(s),void v();if("("===a)s+=a,o="in parens";else{if(""===a)return s&&r.push(s),void v();s+=a}}else if("in parens"===o)if(")"===a)s+=a,o="in descriptor";else{if(""===a)return r.push(s),void v();s+=a}else if("after descriptor"===o)if(t(a));else{if(""===a)return void v();o="in descriptor",m-=1}m+=1}}function v(){var t,n,s,o,a,l,c,u,d,h=!1,m={};for(o=0;o<r.length;o++)l=(a=r[o])[a.length-1],c=a.substring(0,a.length-1),u=parseInt(c,10),d=parseFloat(c),p.test(c)&&"w"===l?((t||n)&&(h=!0),0===u?h=!0:t=u):f.test(c)&&"x"===l?((t||n||s)&&(h=!0),d<0?h=!0:n=d):p.test(c)&&"h"===l?((s||n)&&(h=!0),0===u?h=!0:s=u):h=!0;h?console&&console.log&&console.log("Invalid srcset descriptor found in '"+e+"' at '"+a+"'."):(m.url=i,t&&(m.w=t),n&&(m.d=n),s&&(m.h=s),g.push(m))}}})?n.apply(t,i):n)||(e.exports=r)},405:(e,t,n)=>{var i=n(5182);e.exports=p,e.exports.parse=s,e.exports.compile=function(e,t){return a(s(e,t),t)},e.exports.tokensToFunction=a,e.exports.tokensToRegExp=h;var r=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function s(e,t){for(var n,i=[],s=0,o=0,a="",u=t&&t.delimiter||"/";null!=(n=r.exec(e));){var d=n[0],h=n[1],p=n.index;if(a+=e.slice(o,p),o=p+d.length,h)a+=h[1];else{var f=e[o],m=n[2],g=n[3],y=n[4],v=n[5],b=n[6],w=n[7];a&&(i.push(a),a="");var x=null!=m&&null!=f&&f!==m,_="+"===b||"*"===b,E="?"===b||"*"===b,S=n[2]||u,C=y||v;i.push({name:g||s++,prefix:m||"",delimiter:S,optional:E,repeat:_,partial:x,asterisk:!!w,pattern:C?c(C):w?".*":"[^"+l(S)+"]+?"})}}return o<e.length&&(a+=e.substr(o)),a&&i.push(a),i}function o(e){return encodeURI(e).replace(/[\/?#]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}))}function a(e,t){for(var n=new Array(e.length),r=0;r<e.length;r++)"object"==typeof e[r]&&(n[r]=new RegExp("^(?:"+e[r].pattern+")$",d(t)));return function(t,r){for(var s="",a=t||{},l=(r||{}).pretty?o:encodeURIComponent,c=0;c<e.length;c++){var u=e[c];if("string"!=typeof u){var d,h=a[u.name];if(null==h){if(u.optional){u.partial&&(s+=u.prefix);continue}throw new TypeError('Expected "'+u.name+'" to be defined')}if(i(h)){if(!u.repeat)throw new TypeError('Expected "'+u.name+'" to not repeat, but received `'+JSON.stringify(h)+"`");if(0===h.length){if(u.optional)continue;throw new TypeError('Expected "'+u.name+'" to not be empty')}for(var p=0;p<h.length;p++){if(d=l(h[p]),!n[c].test(d))throw new TypeError('Expected all "'+u.name+'" to match "'+u.pattern+'", but received `'+JSON.stringify(d)+"`");s+=(0===p?u.prefix:u.delimiter)+d}}else{if(d=u.asterisk?encodeURI(h).replace(/[?#]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})):l(h),!n[c].test(d))throw new TypeError('Expected "'+u.name+'" to match "'+u.pattern+'", but received "'+d+'"');s+=u.prefix+d}}else s+=u}return s}}function l(e){return e.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function c(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function u(e,t){return e.keys=t,e}function d(e){return e&&e.sensitive?"":"i"}function h(e,t,n){i(t)||(n=t||n,t=[]);for(var r=(n=n||{}).strict,s=!1!==n.end,o="",a=0;a<e.length;a++){var c=e[a];if("string"==typeof c)o+=l(c);else{var h=l(c.prefix),p="(?:"+c.pattern+")";t.push(c),c.repeat&&(p+="(?:"+h+p+")*"),o+=p=c.optional?c.partial?h+"("+p+")?":"(?:"+h+"("+p+"))?":h+"("+p+")"}}var f=l(n.delimiter||"/"),m=o.slice(-f.length)===f;return r||(o=(m?o.slice(0,-f.length):o)+"(?:"+f+"(?=$))?"),o+=s?"$":r&&m?"":"(?="+f+"|$)",u(new RegExp("^"+o,d(n)),t)}function p(e,t,n){return i(t)||(n=t||n,t=[]),n=n||{},e instanceof RegExp?function(e,t){var n=e.source.match(/\((?!\?)/g);if(n)for(var i=0;i<n.length;i++)t.push({name:i,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return u(e,t)}(e,t):i(e)?function(e,t,n){for(var i=[],r=0;r<e.length;r++)i.push(p(e[r],t,n).source);return u(new RegExp("(?:"+i.join("|")+")",d(n)),t)}(e,t,n):function(e,t,n){return h(s(e,n),t,n)}(e,t,n)}},686:e=>{var t=String,n=function(){return{isColorSupported:!1,reset:t,bold:t,dim:t,italic:t,underline:t,inverse:t,hidden:t,strikethrough:t,black:t,red:t,green:t,yellow:t,blue:t,magenta:t,cyan:t,white:t,gray:t,bgBlack:t,bgRed:t,bgGreen:t,bgYellow:t,bgBlue:t,bgMagenta:t,bgCyan:t,bgWhite:t}};e.exports=n(),e.exports.createColors=n},9956:(e,t,n)=>{"use strict";let i=n(2531);class AtRule extends i{constructor(e){super(e),this.type="atrule"}append(...e){return this.proxyOf.nodes||(this.nodes=[]),super.append(...e)}prepend(...e){return this.proxyOf.nodes||(this.nodes=[]),super.prepend(...e)}}e.exports=AtRule,AtRule.default=AtRule,i.registerAtRule(AtRule)},8321:(e,t,n)=>{"use strict";let i=n(7067);class Comment extends i{constructor(e){super(e),this.type="comment"}}e.exports=Comment,Comment.default=Comment},2531:(e,t,n)=>{"use strict";let i,r,s,{isClean:o,my:a}=n(2899),l=n(9560),c=n(8321),u=n(7067);function d(e){return e.map((e=>(e.nodes&&(e.nodes=d(e.nodes)),delete e.source,e)))}function h(e){if(e[o]=!1,e.proxyOf.nodes)for(let t of e.proxyOf.nodes)h(t)}class Container extends u{push(e){return e.parent=this,this.proxyOf.nodes.push(e),this}each(e){if(!this.proxyOf.nodes)return;let t,n,i=this.getIterator();for(;this.indexes[i]<this.proxyOf.nodes.length&&(t=this.indexes[i],n=e(this.proxyOf.nodes[t],t),!1!==n);)this.indexes[i]+=1;return delete this.indexes[i],n}walk(e){return this.each(((t,n)=>{let i;try{i=e(t,n)}catch(e){throw t.addToError(e)}return!1!==i&&t.walk&&(i=t.walk(e)),i}))}walkDecls(e,t){return t?e instanceof RegExp?this.walk(((n,i)=>{if("decl"===n.type&&e.test(n.prop))return t(n,i)})):this.walk(((n,i)=>{if("decl"===n.type&&n.prop===e)return t(n,i)})):(t=e,this.walk(((e,n)=>{if("decl"===e.type)return t(e,n)})))}walkRules(e,t){return t?e instanceof RegExp?this.walk(((n,i)=>{if("rule"===n.type&&e.test(n.selector))return t(n,i)})):this.walk(((n,i)=>{if("rule"===n.type&&n.selector===e)return t(n,i)})):(t=e,this.walk(((e,n)=>{if("rule"===e.type)return t(e,n)})))}walkAtRules(e,t){return t?e instanceof RegExp?this.walk(((n,i)=>{if("atrule"===n.type&&e.test(n.name))return t(n,i)})):this.walk(((n,i)=>{if("atrule"===n.type&&n.name===e)return t(n,i)})):(t=e,this.walk(((e,n)=>{if("atrule"===e.type)return t(e,n)})))}walkComments(e){return this.walk(((t,n)=>{if("comment"===t.type)return e(t,n)}))}append(...e){for(let t of e){let e=this.normalize(t,this.last);for(let t of e)this.proxyOf.nodes.push(t)}return this.markDirty(),this}prepend(...e){e=e.reverse();for(let t of e){let e=this.normalize(t,this.first,"prepend").reverse();for(let t of e)this.proxyOf.nodes.unshift(t);for(let t in this.indexes)this.indexes[t]=this.indexes[t]+e.length}return this.markDirty(),this}cleanRaws(e){if(super.cleanRaws(e),this.nodes)for(let t of this.nodes)t.cleanRaws(e)}insertBefore(e,t){let n,i=0===(e=this.index(e))&&"prepend",r=this.normalize(t,this.proxyOf.nodes[e],i).reverse();for(let t of r)this.proxyOf.nodes.splice(e,0,t);for(let t in this.indexes)n=this.indexes[t],e<=n&&(this.indexes[t]=n+r.length);return this.markDirty(),this}insertAfter(e,t){e=this.index(e);let n,i=this.normalize(t,this.proxyOf.nodes[e]).reverse();for(let t of i)this.proxyOf.nodes.splice(e+1,0,t);for(let t in this.indexes)n=this.indexes[t],e<n&&(this.indexes[t]=n+i.length);return this.markDirty(),this}removeChild(e){let t;e=this.index(e),this.proxyOf.nodes[e].parent=void 0,this.proxyOf.nodes.splice(e,1);for(let n in this.indexes)t=this.indexes[n],t>=e&&(this.indexes[n]=t-1);return this.markDirty(),this}removeAll(){for(let e of this.proxyOf.nodes)e.parent=void 0;return this.proxyOf.nodes=[],this.markDirty(),this}replaceValues(e,t,n){return n||(n=t,t={}),this.walkDecls((i=>{t.props&&!t.props.includes(i.prop)||t.fast&&!i.value.includes(t.fast)||(i.value=i.value.replace(e,n))})),this.markDirty(),this}every(e){return this.nodes.every(e)}some(e){return this.nodes.some(e)}index(e){return"number"==typeof e?e:(e.proxyOf&&(e=e.proxyOf),this.proxyOf.nodes.indexOf(e))}get first(){if(this.proxyOf.nodes)return this.proxyOf.nodes[0]}get last(){if(this.proxyOf.nodes)return this.proxyOf.nodes[this.proxyOf.nodes.length-1]}normalize(e,t){if("string"==typeof e)e=d(i(e).nodes);else if(Array.isArray(e)){e=e.slice(0);for(let t of e)t.parent&&t.parent.removeChild(t,"ignore")}else if("root"===e.type&&"document"!==this.type){e=e.nodes.slice(0);for(let t of e)t.parent&&t.parent.removeChild(t,"ignore")}else if(e.type)e=[e];else if(e.prop){if(void 0===e.value)throw new Error("Value field is missed in node creation");"string"!=typeof e.value&&(e.value=String(e.value)),e=[new l(e)]}else if(e.selector)e=[new r(e)];else if(e.name)e=[new s(e)];else{if(!e.text)throw new Error("Unknown node type in node creation");e=[new c(e)]}return e.map((e=>(e[a]||Container.rebuild(e),(e=e.proxyOf).parent&&e.parent.removeChild(e),e[o]&&h(e),void 0===e.raws.before&&t&&void 0!==t.raws.before&&(e.raws.before=t.raws.before.replace(/\S/g,"")),e.parent=this.proxyOf,e)))}getProxyProcessor(){return{set:(e,t,n)=>(e[t]===n||(e[t]=n,"name"!==t&&"params"!==t&&"selector"!==t||e.markDirty()),!0),get:(e,t)=>"proxyOf"===t?e:e[t]?"each"===t||"string"==typeof t&&t.startsWith("walk")?(...n)=>e[t](...n.map((e=>"function"==typeof e?(t,n)=>e(t.toProxy(),n):e))):"every"===t||"some"===t?n=>e[t](((e,...t)=>n(e.toProxy(),...t))):"root"===t?()=>e.root().toProxy():"nodes"===t?e.nodes.map((e=>e.toProxy())):"first"===t||"last"===t?e[t].toProxy():e[t]:e[t]}}getIterator(){this.lastEach||(this.lastEach=0),this.indexes||(this.indexes={}),this.lastEach+=1;let e=this.lastEach;return this.indexes[e]=0,e}}Container.registerParse=e=>{i=e},Container.registerRule=e=>{r=e},Container.registerAtRule=e=>{s=e},e.exports=Container,Container.default=Container,Container.rebuild=e=>{"atrule"===e.type?Object.setPrototypeOf(e,s.prototype):"rule"===e.type?Object.setPrototypeOf(e,r.prototype):"decl"===e.type?Object.setPrototypeOf(e,l.prototype):"comment"===e.type&&Object.setPrototypeOf(e,c.prototype),e[a]=!0,e.nodes&&e.nodes.forEach((e=>{Container.rebuild(e)}))}},5723:(e,t,n)=>{"use strict";let i=n(686),r=n(5219);class CssSyntaxError extends Error{constructor(e,t,n,i,r,s){super(e),this.name="CssSyntaxError",this.reason=e,r&&(this.file=r),i&&(this.source=i),s&&(this.plugin=s),void 0!==t&&void 0!==n&&("number"==typeof t?(this.line=t,this.column=n):(this.line=t.line,this.column=t.column,this.endLine=n.line,this.endColumn=n.column)),this.setMessage(),Error.captureStackTrace&&Error.captureStackTrace(this,CssSyntaxError)}setMessage(){this.message=this.plugin?this.plugin+": ":"",this.message+=this.file?this.file:"<css input>",void 0!==this.line&&(this.message+=":"+this.line+":"+this.column),this.message+=": "+this.reason}showSourceCode(e){if(!this.source)return"";let t=this.source;null==e&&(e=i.isColorSupported),r&&e&&(t=r(t));let n,s,o=t.split(/\r?\n/),a=Math.max(this.line-3,0),l=Math.min(this.line+2,o.length),c=String(l).length;if(e){let{bold:e,red:t,gray:r}=i.createColors(!0);n=n=>e(t(n)),s=e=>r(e)}else n=s=e=>e;return o.slice(a,l).map(((e,t)=>{let i=a+1+t,r=" "+(" "+i).slice(-c)+" | ";if(i===this.line){let t=s(r.replace(/\d/g," "))+e.slice(0,this.column-1).replace(/[^\t]/g," ");return n(">")+s(r)+e+"\n "+t+n("^")}return" "+s(r)+e})).join("\n")}toString(){let e=this.showSourceCode();return e&&(e="\n\n"+e+"\n"),this.name+": "+this.message+e}}e.exports=CssSyntaxError,CssSyntaxError.default=CssSyntaxError},9560:(e,t,n)=>{"use strict";let i=n(7067);class Declaration extends i{constructor(e){e&&void 0!==e.value&&"string"!=typeof e.value&&(e={...e,value:String(e.value)}),super(e),this.type="decl"}get variable(){return this.prop.startsWith("--")||"$"===this.prop[0]}}e.exports=Declaration,Declaration.default=Declaration},815:(e,t,n)=>{"use strict";let i,r,s=n(2531);class Document extends s{constructor(e){super({type:"document",...e}),this.nodes||(this.nodes=[])}toResult(e={}){return new i(new r,this,e).stringify()}}Document.registerLazyResult=e=>{i=e},Document.registerProcessor=e=>{r=e},e.exports=Document,Document.default=Document},6027:(e,t,n)=>{"use strict";let i=n(9560),r=n(3086),s=n(8321),o=n(9956),a=n(8313),l=n(8973),c=n(1854);function u(e,t){if(Array.isArray(e))return e.map((e=>u(e)));let{inputs:n,...d}=e;if(n){t=[];for(let e of n){let n={...e,__proto__:a.prototype};n.map&&(n.map={...n.map,__proto__:r.prototype}),t.push(n)}}if(d.nodes&&(d.nodes=e.nodes.map((e=>u(e,t)))),d.source){let{inputId:e,...n}=d.source;d.source=n,null!=e&&(d.source.input=t[e])}if("root"===d.type)return new l(d);if("decl"===d.type)return new i(d);if("rule"===d.type)return new c(d);if("comment"===d.type)return new s(d);if("atrule"===d.type)return new o(d);throw new Error("Unknown node type: "+e.type)}e.exports=u,u.default=u},8313:(e,t,n)=>{"use strict";let{SourceMapConsumer:i,SourceMapGenerator:r}=n(1305),{fileURLToPath:s,pathToFileURL:o}=n(6659),{resolve:a,isAbsolute:l}=n(4029),{nanoid:c}=n(8773),u=n(5219),d=n(5723),h=n(3086),p=Symbol("fromOffsetCache"),f=Boolean(i&&r),m=Boolean(a&&l);class Input{constructor(e,t={}){if(null==e||"object"==typeof e&&!e.toString)throw new Error(`PostCSS received ${e} instead of CSS string`);if(this.css=e.toString(),"\ufeff"===this.css[0]||"￾"===this.css[0]?(this.hasBOM=!0,this.css=this.css.slice(1)):this.hasBOM=!1,t.from&&(!m||/^\w+:\/\//.test(t.from)||l(t.from)?this.file=t.from:this.file=a(t.from)),m&&f){let e=new h(this.css,t);if(e.text){this.map=e;let t=e.consumer().file;!this.file&&t&&(this.file=this.mapResolve(t))}}this.file||(this.id="<input css "+c(6)+">"),this.map&&(this.map.file=this.from)}fromOffset(e){let t,n;if(this[p])n=this[p];else{let e=this.css.split("\n");n=new Array(e.length);let t=0;for(let i=0,r=e.length;i<r;i++)n[i]=t,t+=e[i].length+1;this[p]=n}t=n[n.length-1];let i=0;if(e>=t)i=n.length-1;else{let t,r=n.length-2;for(;i<r;)if(t=i+(r-i>>1),e<n[t])r=t-1;else{if(!(e>=n[t+1])){i=t;break}i=t+1}}return{line:i+1,col:e-n[i]+1}}error(e,t,n,i={}){let r,s,a;if(t&&"object"==typeof t){let e=t,i=n;if("number"==typeof t.offset){let i=this.fromOffset(e.offset);t=i.line,n=i.col}else t=e.line,n=e.column;if("number"==typeof i.offset){let e=this.fromOffset(i.offset);s=e.line,a=e.col}else s=i.line,a=i.column}else if(!n){let e=this.fromOffset(t);t=e.line,n=e.col}let l=this.origin(t,n,s,a);return r=l?new d(e,void 0===l.endLine?l.line:{line:l.line,column:l.column},void 0===l.endLine?l.column:{line:l.endLine,column:l.endColumn},l.source,l.file,i.plugin):new d(e,void 0===s?t:{line:t,column:n},void 0===s?n:{line:s,column:a},this.css,this.file,i.plugin),r.input={line:t,column:n,endLine:s,endColumn:a,source:this.css},this.file&&(o&&(r.input.url=o(this.file).toString()),r.input.file=this.file),r}origin(e,t,n,i){if(!this.map)return!1;let r,a,c=this.map.consumer(),u=c.originalPositionFor({line:e,column:t});if(!u.source)return!1;"number"==typeof n&&(r=c.originalPositionFor({line:n,column:i})),a=l(u.source)?o(u.source):new URL(u.source,this.map.consumer().sourceRoot||o(this.map.mapFile));let d={url:a.toString(),line:u.line,column:u.column,endLine:r&&r.line,endColumn:r&&r.column};if("file:"===a.protocol){if(!s)throw new Error("file: protocol is not available in this PostCSS build");d.file=s(a)}let h=c.sourceContentFor(u.source);return h&&(d.source=h),d}mapResolve(e){return/^\w+:\/\//.test(e)?e:a(this.map.consumer().sourceRoot||this.map.root||".",e)}get from(){return this.file||this.id}toJSON(){let e={};for(let t of["hasBOM","css","file","id"])null!=this[t]&&(e[t]=this[t]);return this.map&&(e.map={...this.map},e.map.consumerCache&&(e.map.consumerCache=void 0)),e}}e.exports=Input,Input.default=Input,u&&u.registerInput&&u.registerInput(Input)},3521:(e,t,n)=>{"use strict";let{isClean:i,my:r}=n(2899),s=n(7157),o=n(4414),a=n(2531),l=n(815),c=(n(3098),n(7282)),u=n(8561),d=n(8973);const h={document:"Document",root:"Root",atrule:"AtRule",rule:"Rule",decl:"Declaration",comment:"Comment"},p={postcssPlugin:!0,prepare:!0,Once:!0,Document:!0,Root:!0,Declaration:!0,Rule:!0,AtRule:!0,Comment:!0,DeclarationExit:!0,RuleExit:!0,AtRuleExit:!0,CommentExit:!0,RootExit:!0,DocumentExit:!0,OnceExit:!0},f={postcssPlugin:!0,prepare:!0,Once:!0};function m(e){return"object"==typeof e&&"function"==typeof e.then}function g(e){let t=!1,n=h[e.type];return"decl"===e.type?t=e.prop.toLowerCase():"atrule"===e.type&&(t=e.name.toLowerCase()),t&&e.append?[n,n+"-"+t,0,n+"Exit",n+"Exit-"+t]:t?[n,n+"-"+t,n+"Exit",n+"Exit-"+t]:e.append?[n,0,n+"Exit"]:[n,n+"Exit"]}function y(e){let t;return t="document"===e.type?["Document",0,"DocumentExit"]:"root"===e.type?["Root",0,"RootExit"]:g(e),{node:e,events:t,eventIndex:0,visitors:[],visitorIndex:0,iterator:0}}function v(e){return e[i]=!1,e.nodes&&e.nodes.forEach((e=>v(e))),e}let b={};class LazyResult{constructor(e,t,n){let i;if(this.stringified=!1,this.processed=!1,"object"!=typeof t||null===t||"root"!==t.type&&"document"!==t.type)if(t instanceof LazyResult||t instanceof c)i=v(t.root),t.map&&(void 0===n.map&&(n.map={}),n.map.inline||(n.map.inline=!1),n.map.prev=t.map);else{let e=u;n.syntax&&(e=n.syntax.parse),n.parser&&(e=n.parser),e.parse&&(e=e.parse);try{i=e(t,n)}catch(e){this.processed=!0,this.error=e}i&&!i[r]&&a.rebuild(i)}else i=v(t);this.result=new c(e,i,n),this.helpers={...b,result:this.result,postcss:b},this.plugins=this.processor.plugins.map((e=>"object"==typeof e&&e.prepare?{...e,...e.prepare(this.result)}:e))}get[Symbol.toStringTag](){return"LazyResult"}get processor(){return this.result.processor}get opts(){return this.result.opts}get css(){return this.stringify().css}get content(){return this.stringify().content}get map(){return this.stringify().map}get root(){return this.sync().root}get messages(){return this.sync().messages}warnings(){return this.sync().warnings()}toString(){return this.css}then(e,t){return this.async().then(e,t)}catch(e){return this.async().catch(e)}finally(e){return this.async().then(e,e)}async(){return this.error?Promise.reject(this.error):this.processed?Promise.resolve(this.result):(this.processing||(this.processing=this.runAsync()),this.processing)}sync(){if(this.error)throw this.error;if(this.processed)return this.result;if(this.processed=!0,this.processing)throw this.getAsyncError();for(let e of this.plugins){if(m(this.runOnRoot(e)))throw this.getAsyncError()}if(this.prepareVisitors(),this.hasListener){let e=this.result.root;for(;!e[i];)e[i]=!0,this.walkSync(e);if(this.listeners.OnceExit)if("document"===e.type)for(let t of e.nodes)this.visitSync(this.listeners.OnceExit,t);else this.visitSync(this.listeners.OnceExit,e)}return this.result}stringify(){if(this.error)throw this.error;if(this.stringified)return this.result;this.stringified=!0,this.sync();let e=this.result.opts,t=o;e.syntax&&(t=e.syntax.stringify),e.stringifier&&(t=e.stringifier),t.stringify&&(t=t.stringify);let n=new s(t,this.result.root,this.result.opts).generate();return this.result.css=n[0],this.result.map=n[1],this.result}walkSync(e){e[i]=!0;let t=g(e);for(let n of t)if(0===n)e.nodes&&e.each((e=>{e[i]||this.walkSync(e)}));else{let t=this.listeners[n];if(t&&this.visitSync(t,e.toProxy()))return}}visitSync(e,t){for(let[n,i]of e){let e;this.result.lastPlugin=n;try{e=i(t,this.helpers)}catch(e){throw this.handleError(e,t.proxyOf)}if("root"!==t.type&&"document"!==t.type&&!t.parent)return!0;if(m(e))throw this.getAsyncError()}}runOnRoot(e){this.result.lastPlugin=e;try{if("object"==typeof e&&e.Once){if("document"===this.result.root.type){let t=this.result.root.nodes.map((t=>e.Once(t,this.helpers)));return m(t[0])?Promise.all(t):t}return e.Once(this.result.root,this.helpers)}if("function"==typeof e)return e(this.result.root,this.result)}catch(e){throw this.handleError(e)}}getAsyncError(){throw new Error("Use process(css).then(cb) to work with async plugins")}handleError(e,t){let n=this.result.lastPlugin;try{t&&t.addToError(e),this.error=e,"CssSyntaxError"!==e.name||e.plugin?n.postcssVersion:(e.plugin=n.postcssPlugin,e.setMessage())}catch(e){console&&console.error&&console.error(e)}return e}async runAsync(){this.plugin=0;for(let e=0;e<this.plugins.length;e++){let t=this.plugins[e],n=this.runOnRoot(t);if(m(n))try{await n}catch(e){throw this.handleError(e)}}if(this.prepareVisitors(),this.hasListener){let e=this.result.root;for(;!e[i];){e[i]=!0;let t=[y(e)];for(;t.length>0;){let e=this.visitTick(t);if(m(e))try{await e}catch(e){let n=t[t.length-1].node;throw this.handleError(e,n)}}}if(this.listeners.OnceExit)for(let[t,n]of this.listeners.OnceExit){this.result.lastPlugin=t;try{if("document"===e.type){let t=e.nodes.map((e=>n(e,this.helpers)));await Promise.all(t)}else await n(e,this.helpers)}catch(e){throw this.handleError(e)}}}return this.processed=!0,this.stringify()}prepareVisitors(){this.listeners={};let e=(e,t,n)=>{this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push([e,n])};for(let t of this.plugins)if("object"==typeof t)for(let n in t){if(!p[n]&&/^[A-Z]/.test(n))throw new Error(`Unknown event ${n} in ${t.postcssPlugin}. Try to update PostCSS (${this.processor.version} now).`);if(!f[n])if("object"==typeof t[n])for(let i in t[n])e(t,"*"===i?n:n+"-"+i.toLowerCase(),t[n][i]);else"function"==typeof t[n]&&e(t,n,t[n])}this.hasListener=Object.keys(this.listeners).length>0}visitTick(e){let t=e[e.length-1],{node:n,visitors:r}=t;if("root"!==n.type&&"document"!==n.type&&!n.parent)return void e.pop();if(r.length>0&&t.visitorIndex<r.length){let[e,i]=r[t.visitorIndex];t.visitorIndex+=1,t.visitorIndex===r.length&&(t.visitors=[],t.visitorIndex=0),this.result.lastPlugin=e;try{return i(n.toProxy(),this.helpers)}catch(e){throw this.handleError(e,n)}}if(0!==t.iterator){let r,s=t.iterator;for(;r=n.nodes[n.indexes[s]];)if(n.indexes[s]+=1,!r[i])return r[i]=!0,void e.push(y(r));t.iterator=0,delete n.indexes[s]}let s=t.events;for(;t.eventIndex<s.length;){let e=s[t.eventIndex];if(t.eventIndex+=1,0===e)return void(n.nodes&&n.nodes.length&&(n[i]=!0,t.iterator=n.getIterator()));if(this.listeners[e])return void(t.visitors=this.listeners[e])}e.pop()}}LazyResult.registerPostcss=e=>{b=e},e.exports=LazyResult,LazyResult.default=LazyResult,d.registerLazyResult(LazyResult),l.registerLazyResult(LazyResult)},4436:e=>{"use strict";let t={split(e,t,n){let i=[],r="",s=!1,o=0,a=!1,l=!1;for(let n of e)l?l=!1:"\\"===n?l=!0:a?n===a&&(a=!1):'"'===n||"'"===n?a=n:"("===n?o+=1:")"===n?o>0&&(o-=1):0===o&&t.includes(n)&&(s=!0),s?(""!==r&&i.push(r.trim()),r="",s=!1):r+=n;return(n||""!==r)&&i.push(r.trim()),i},space:e=>t.split(e,[" ","\n","\t"]),comma:e=>t.split(e,[","],!0)};e.exports=t,t.default=t},7157:(e,t,n)=>{"use strict";let{SourceMapConsumer:i,SourceMapGenerator:r}=n(1305),{dirname:s,resolve:o,relative:a,sep:l}=n(4029),{pathToFileURL:c}=n(6659),u=n(8313),d=Boolean(i&&r),h=Boolean(s&&o&&a&&l);e.exports=class MapGenerator{constructor(e,t,n,i){this.stringify=e,this.mapOpts=n.map||{},this.root=t,this.opts=n,this.css=i}isMap(){return void 0!==this.opts.map?!!this.opts.map:this.previous().length>0}previous(){if(!this.previousMaps)if(this.previousMaps=[],this.root)this.root.walk((e=>{if(e.source&&e.source.input.map){let t=e.source.input.map;this.previousMaps.includes(t)||this.previousMaps.push(t)}}));else{let e=new u(this.css,this.opts);e.map&&this.previousMaps.push(e.map)}return this.previousMaps}isInline(){if(void 0!==this.mapOpts.inline)return this.mapOpts.inline;let e=this.mapOpts.annotation;return(void 0===e||!0===e)&&(!this.previous().length||this.previous().some((e=>e.inline)))}isSourcesContent(){return void 0!==this.mapOpts.sourcesContent?this.mapOpts.sourcesContent:!this.previous().length||this.previous().some((e=>e.withContent()))}clearAnnotation(){if(!1!==this.mapOpts.annotation)if(this.root){let e;for(let t=this.root.nodes.length-1;t>=0;t--)e=this.root.nodes[t],"comment"===e.type&&0===e.text.indexOf("# sourceMappingURL=")&&this.root.removeChild(t)}else this.css&&(this.css=this.css.replace(/(\n)?\/\*#[\S\s]*?\*\/$/gm,""))}setSourcesContent(){let e={};if(this.root)this.root.walk((t=>{if(t.source){let n=t.source.input.from;n&&!e[n]&&(e[n]=!0,this.map.setSourceContent(this.toUrl(this.path(n)),t.source.input.css))}}));else if(this.css){let e=this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>";this.map.setSourceContent(e,this.css)}}applyPrevMaps(){for(let e of this.previous()){let t,n=this.toUrl(this.path(e.file)),r=e.root||s(e.file);!1===this.mapOpts.sourcesContent?(t=new i(e.text),t.sourcesContent&&(t.sourcesContent=t.sourcesContent.map((()=>null)))):t=e.consumer(),this.map.applySourceMap(t,n,this.toUrl(this.path(r)))}}isAnnotation(){return!!this.isInline()||(void 0!==this.mapOpts.annotation?this.mapOpts.annotation:!this.previous().length||this.previous().some((e=>e.annotation)))}toBase64(e){return Buffer?Buffer.from(e).toString("base64"):window.btoa(unescape(encodeURIComponent(e)))}addAnnotation(){let e;e=this.isInline()?"data:application/json;base64,"+this.toBase64(this.map.toString()):"string"==typeof this.mapOpts.annotation?this.mapOpts.annotation:"function"==typeof this.mapOpts.annotation?this.mapOpts.annotation(this.opts.to,this.root):this.outputFile()+".map";let t="\n";this.css.includes("\r\n")&&(t="\r\n"),this.css+=t+"/*# sourceMappingURL="+e+" */"}outputFile(){return this.opts.to?this.path(this.opts.to):this.opts.from?this.path(this.opts.from):"to.css"}generateMap(){if(this.root)this.generateString();else if(1===this.previous().length){let e=this.previous()[0].consumer();e.file=this.outputFile(),this.map=r.fromSourceMap(e)}else this.map=new r({file:this.outputFile()}),this.map.addMapping({source:this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>",generated:{line:1,column:0},original:{line:1,column:0}});return this.isSourcesContent()&&this.setSourcesContent(),this.root&&this.previous().length>0&&this.applyPrevMaps(),this.isAnnotation()&&this.addAnnotation(),this.isInline()?[this.css]:[this.css,this.map]}path(e){if(0===e.indexOf("<"))return e;if(/^\w+:\/\//.test(e))return e;if(this.mapOpts.absolute)return e;let t=this.opts.to?s(this.opts.to):".";return"string"==typeof this.mapOpts.annotation&&(t=s(o(t,this.mapOpts.annotation))),e=a(t,e)}toUrl(e){return"\\"===l&&(e=e.replace(/\\/g,"/")),encodeURI(e).replace(/[#?]/g,encodeURIComponent)}sourcePath(e){if(this.mapOpts.from)return this.toUrl(this.mapOpts.from);if(this.mapOpts.absolute){if(c)return c(e.source.input.from).toString();throw new Error("`map.absolute` option is not available in this PostCSS build")}return this.toUrl(this.path(e.source.input.from))}generateString(){this.css="",this.map=new r({file:this.outputFile()});let e,t,n=1,i=1,s="<no source>",o={source:"",generated:{line:0,column:0},original:{line:0,column:0}};this.stringify(this.root,((r,a,l)=>{if(this.css+=r,a&&"end"!==l&&(o.generated.line=n,o.generated.column=i-1,a.source&&a.source.start?(o.source=this.sourcePath(a),o.original.line=a.source.start.line,o.original.column=a.source.start.column-1,this.map.addMapping(o)):(o.source=s,o.original.line=1,o.original.column=0,this.map.addMapping(o))),e=r.match(/\n/g),e?(n+=e.length,t=r.lastIndexOf("\n"),i=r.length-t):i+=r.length,a&&"start"!==l){let e=a.parent||{raws:{}};("decl"!==a.type||a!==e.last||e.raws.semicolon)&&(a.source&&a.source.end?(o.source=this.sourcePath(a),o.original.line=a.source.end.line,o.original.column=a.source.end.column-1,o.generated.line=n,o.generated.column=i-2,this.map.addMapping(o)):(o.source=s,o.original.line=1,o.original.column=0,o.generated.line=n,o.generated.column=i-1,this.map.addMapping(o)))}}))}generate(){if(this.clearAnnotation(),h&&d&&this.isMap())return this.generateMap();{let e="";return this.stringify(this.root,(t=>{e+=t})),[e]}}}},3614:(e,t,n)=>{"use strict";let i=n(7157),r=n(4414),s=(n(3098),n(8561));const o=n(7282);class NoWorkResult{constructor(e,t,n){let s;t=t.toString(),this.stringified=!1,this._processor=e,this._css=t,this._opts=n,this._map=void 0;let a=r;this.result=new o(this._processor,s,this._opts),this.result.css=t;let l=this;Object.defineProperty(this.result,"root",{get:()=>l.root});let c=new i(a,s,this._opts,t);if(c.isMap()){let[e,t]=c.generate();e&&(this.result.css=e),t&&(this.result.map=t)}}get[Symbol.toStringTag](){return"NoWorkResult"}get processor(){return this.result.processor}get opts(){return this.result.opts}get css(){return this.result.css}get content(){return this.result.css}get map(){return this.result.map}get root(){if(this._root)return this._root;let e,t=s;try{e=t(this._css,this._opts)}catch(e){this.error=e}if(this.error)throw this.error;return this._root=e,e}get messages(){return[]}warnings(){return[]}toString(){return this._css}then(e,t){return this.async().then(e,t)}catch(e){return this.async().catch(e)}finally(e){return this.async().then(e,e)}async(){return this.error?Promise.reject(this.error):Promise.resolve(this.result)}sync(){if(this.error)throw this.error;return this.result}}e.exports=NoWorkResult,NoWorkResult.default=NoWorkResult},7067:(e,t,n)=>{"use strict";let{isClean:i,my:r}=n(2899),s=n(5723),o=n(9101),a=n(4414);function l(e,t){let n=new e.constructor;for(let i in e){if(!Object.prototype.hasOwnProperty.call(e,i))continue;if("proxyCache"===i)continue;let r=e[i],s=typeof r;"parent"===i&&"object"===s?t&&(n[i]=t):"source"===i?n[i]=r:Array.isArray(r)?n[i]=r.map((e=>l(e,n))):("object"===s&&null!==r&&(r=l(r)),n[i]=r)}return n}class Node{constructor(e={}){this.raws={},this[i]=!1,this[r]=!0;for(let t in e)if("nodes"===t){this.nodes=[];for(let n of e[t])"function"==typeof n.clone?this.append(n.clone()):this.append(n)}else this[t]=e[t]}error(e,t={}){if(this.source){let{start:n,end:i}=this.rangeBy(t);return this.source.input.error(e,{line:n.line,column:n.column},{line:i.line,column:i.column},t)}return new s(e)}warn(e,t,n){let i={node:this};for(let e in n)i[e]=n[e];return e.warn(t,i)}remove(){return this.parent&&this.parent.removeChild(this),this.parent=void 0,this}toString(e=a){e.stringify&&(e=e.stringify);let t="";return e(this,(e=>{t+=e})),t}assign(e={}){for(let t in e)this[t]=e[t];return this}clone(e={}){let t=l(this);for(let n in e)t[n]=e[n];return t}cloneBefore(e={}){let t=this.clone(e);return this.parent.insertBefore(this,t),t}cloneAfter(e={}){let t=this.clone(e);return this.parent.insertAfter(this,t),t}replaceWith(...e){if(this.parent){let t=this,n=!1;for(let i of e)i===this?n=!0:n?(this.parent.insertAfter(t,i),t=i):this.parent.insertBefore(t,i);n||this.remove()}return this}next(){if(!this.parent)return;let e=this.parent.index(this);return this.parent.nodes[e+1]}prev(){if(!this.parent)return;let e=this.parent.index(this);return this.parent.nodes[e-1]}before(e){return this.parent.insertBefore(this,e),this}after(e){return this.parent.insertAfter(this,e),this}root(){let e=this;for(;e.parent&&"document"!==e.parent.type;)e=e.parent;return e}raw(e,t){return(new o).raw(this,e,t)}cleanRaws(e){delete this.raws.before,delete this.raws.after,e||delete this.raws.between}toJSON(e,t){let n={},i=null==t;t=t||new Map;let r=0;for(let e in this){if(!Object.prototype.hasOwnProperty.call(this,e))continue;if("parent"===e||"proxyCache"===e)continue;let i=this[e];if(Array.isArray(i))n[e]=i.map((e=>"object"==typeof e&&e.toJSON?e.toJSON(null,t):e));else if("object"==typeof i&&i.toJSON)n[e]=i.toJSON(null,t);else if("source"===e){let s=t.get(i.input);null==s&&(s=r,t.set(i.input,r),r++),n[e]={inputId:s,start:i.start,end:i.end}}else n[e]=i}return i&&(n.inputs=[...t.keys()].map((e=>e.toJSON()))),n}positionInside(e){let t=this.toString(),n=this.source.start.column,i=this.source.start.line;for(let r=0;r<e;r++)"\n"===t[r]?(n=1,i+=1):n+=1;return{line:i,column:n}}positionBy(e){let t=this.source.start;if(e.index)t=this.positionInside(e.index);else if(e.word){let n=this.toString().indexOf(e.word);-1!==n&&(t=this.positionInside(n))}return t}rangeBy(e){let t={line:this.source.start.line,column:this.source.start.column},n=this.source.end?{line:this.source.end.line,column:this.source.end.column+1}:{line:t.line,column:t.column+1};if(e.word){let i=this.toString().indexOf(e.word);-1!==i&&(t=this.positionInside(i),n=this.positionInside(i+e.word.length))}else e.start?t={line:e.start.line,column:e.start.column}:e.index&&(t=this.positionInside(e.index)),e.end?n={line:e.end.line,column:e.end.column}:e.endIndex?n=this.positionInside(e.endIndex):e.index&&(n=this.positionInside(e.index+1));return(n.line<t.line||n.line===t.line&&n.column<=t.column)&&(n={line:t.line,column:t.column+1}),{start:t,end:n}}getProxyProcessor(){return{set:(e,t,n)=>(e[t]===n||(e[t]=n,"prop"!==t&&"value"!==t&&"name"!==t&&"params"!==t&&"important"!==t&&"text"!==t||e.markDirty()),!0),get:(e,t)=>"proxyOf"===t?e:"root"===t?()=>e.root().toProxy():e[t]}}toProxy(){return this.proxyCache||(this.proxyCache=new Proxy(this,this.getProxyProcessor())),this.proxyCache}addToError(e){if(e.postcssNode=this,e.stack&&this.source&&/\n\s{4}at /.test(e.stack)){let t=this.source;e.stack=e.stack.replace(/\n\s{4}at /,`$&${t.input.from}:${t.start.line}:${t.start.column}$&`)}return e}markDirty(){if(this[i]){this[i]=!1;let e=this;for(;e=e.parent;)e[i]=!1}}get proxyOf(){return this}}e.exports=Node,Node.default=Node},8561:(e,t,n)=>{"use strict";let i=n(2531),r=n(8935),s=n(8313);function o(e,t){let n=new s(e,t),i=new r(n);try{i.parse()}catch(e){throw e}return i.root}e.exports=o,o.default=o,i.registerParse(o)},8935:(e,t,n)=>{"use strict";let i=n(9560),r=n(2132),s=n(8321),o=n(9956),a=n(8973),l=n(1854);const c={empty:!0,space:!0};e.exports=class Parser{constructor(e){this.input=e,this.root=new a,this.current=this.root,this.spaces="",this.semicolon=!1,this.customProperty=!1,this.createTokenizer(),this.root.source={input:e,start:{offset:0,line:1,column:1}}}createTokenizer(){this.tokenizer=r(this.input)}parse(){let e;for(;!this.tokenizer.endOfFile();)switch(e=this.tokenizer.nextToken(),e[0]){case"space":this.spaces+=e[1];break;case";":this.freeSemicolon(e);break;case"}":this.end(e);break;case"comment":this.comment(e);break;case"at-word":this.atrule(e);break;case"{":this.emptyRule(e);break;default:this.other(e)}this.endFile()}comment(e){let t=new s;this.init(t,e[2]),t.source.end=this.getPosition(e[3]||e[2]);let n=e[1].slice(2,-2);if(/^\s*$/.test(n))t.text="",t.raws.left=n,t.raws.right="";else{let e=n.match(/^(\s*)([^]*\S)(\s*)$/);t.text=e[2],t.raws.left=e[1],t.raws.right=e[3]}}emptyRule(e){let t=new l;this.init(t,e[2]),t.selector="",t.raws.between="",this.current=t}other(e){let t=!1,n=null,i=!1,r=null,s=[],o=e[1].startsWith("--"),a=[],l=e;for(;l;){if(n=l[0],a.push(l),"("===n||"["===n)r||(r=l),s.push("("===n?")":"]");else if(o&&i&&"{"===n)r||(r=l),s.push("}");else if(0===s.length){if(";"===n){if(i)return void this.decl(a,o);break}if("{"===n)return void this.rule(a);if("}"===n){this.tokenizer.back(a.pop()),t=!0;break}":"===n&&(i=!0)}else n===s[s.length-1]&&(s.pop(),0===s.length&&(r=null));l=this.tokenizer.nextToken()}if(this.tokenizer.endOfFile()&&(t=!0),s.length>0&&this.unclosedBracket(r),t&&i){if(!o)for(;a.length&&(l=a[a.length-1][0],"space"===l||"comment"===l);)this.tokenizer.back(a.pop());this.decl(a,o)}else this.unknownWord(a)}rule(e){e.pop();let t=new l;this.init(t,e[0][2]),t.raws.between=this.spacesAndCommentsFromEnd(e),this.raw(t,"selector",e),this.current=t}decl(e,t){let n=new i;this.init(n,e[0][2]);let r,s=e[e.length-1];for(";"===s[0]&&(this.semicolon=!0,e.pop()),n.source.end=this.getPosition(s[3]||s[2]||function(e){for(let t=e.length-1;t>=0;t--){let n=e[t],i=n[3]||n[2];if(i)return i}}(e));"word"!==e[0][0];)1===e.length&&this.unknownWord(e),n.raws.before+=e.shift()[1];for(n.source.start=this.getPosition(e[0][2]),n.prop="";e.length;){let t=e[0][0];if(":"===t||"space"===t||"comment"===t)break;n.prop+=e.shift()[1]}for(n.raws.between="";e.length;){if(r=e.shift(),":"===r[0]){n.raws.between+=r[1];break}"word"===r[0]&&/\w/.test(r[1])&&this.unknownWord([r]),n.raws.between+=r[1]}"_"!==n.prop[0]&&"*"!==n.prop[0]||(n.raws.before+=n.prop[0],n.prop=n.prop.slice(1));let o,a=[];for(;e.length&&(o=e[0][0],"space"===o||"comment"===o);)a.push(e.shift());this.precheckMissedSemicolon(e);for(let t=e.length-1;t>=0;t--){if(r=e[t],"!important"===r[1].toLowerCase()){n.important=!0;let i=this.stringFrom(e,t);i=this.spacesFromEnd(e)+i," !important"!==i&&(n.raws.important=i);break}if("important"===r[1].toLowerCase()){let i=e.slice(0),r="";for(let e=t;e>0;e--){let t=i[e][0];if(0===r.trim().indexOf("!")&&"space"!==t)break;r=i.pop()[1]+r}0===r.trim().indexOf("!")&&(n.important=!0,n.raws.important=r,e=i)}if("space"!==r[0]&&"comment"!==r[0])break}e.some((e=>"space"!==e[0]&&"comment"!==e[0]))&&(n.raws.between+=a.map((e=>e[1])).join(""),a=[]),this.raw(n,"value",a.concat(e),t),n.value.includes(":")&&!t&&this.checkMissedSemicolon(e)}atrule(e){let t,n,i,r=new o;r.name=e[1].slice(1),""===r.name&&this.unnamedAtrule(r,e),this.init(r,e[2]);let s=!1,a=!1,l=[],c=[];for(;!this.tokenizer.endOfFile();){if(t=(e=this.tokenizer.nextToken())[0],"("===t||"["===t?c.push("("===t?")":"]"):"{"===t&&c.length>0?c.push("}"):t===c[c.length-1]&&c.pop(),0===c.length){if(";"===t){r.source.end=this.getPosition(e[2]),this.semicolon=!0;break}if("{"===t){a=!0;break}if("}"===t){if(l.length>0){for(i=l.length-1,n=l[i];n&&"space"===n[0];)n=l[--i];n&&(r.source.end=this.getPosition(n[3]||n[2]))}this.end(e);break}l.push(e)}else l.push(e);if(this.tokenizer.endOfFile()){s=!0;break}}r.raws.between=this.spacesAndCommentsFromEnd(l),l.length?(r.raws.afterName=this.spacesAndCommentsFromStart(l),this.raw(r,"params",l),s&&(e=l[l.length-1],r.source.end=this.getPosition(e[3]||e[2]),this.spaces=r.raws.between,r.raws.between="")):(r.raws.afterName="",r.params=""),a&&(r.nodes=[],this.current=r)}end(e){this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.semicolon=!1,this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.spaces="",this.current.parent?(this.current.source.end=this.getPosition(e[2]),this.current=this.current.parent):this.unexpectedClose(e)}endFile(){this.current.parent&&this.unclosedBlock(),this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.current.raws.after=(this.current.raws.after||"")+this.spaces}freeSemicolon(e){if(this.spaces+=e[1],this.current.nodes){let e=this.current.nodes[this.current.nodes.length-1];e&&"rule"===e.type&&!e.raws.ownSemicolon&&(e.raws.ownSemicolon=this.spaces,this.spaces="")}}getPosition(e){let t=this.input.fromOffset(e);return{offset:e,line:t.line,column:t.col}}init(e,t){this.current.push(e),e.source={start:this.getPosition(t),input:this.input},e.raws.before=this.spaces,this.spaces="","comment"!==e.type&&(this.semicolon=!1)}raw(e,t,n,i){let r,s,o,a,l=n.length,u="",d=!0;for(let e=0;e<l;e+=1)r=n[e],s=r[0],"space"!==s||e!==l-1||i?"comment"===s?(a=n[e-1]?n[e-1][0]:"empty",o=n[e+1]?n[e+1][0]:"empty",c[a]||c[o]||","===u.slice(-1)?d=!1:u+=r[1]):u+=r[1]:d=!1;if(!d){let i=n.reduce(((e,t)=>e+t[1]),"");e.raws[t]={value:u,raw:i}}e[t]=u}spacesAndCommentsFromEnd(e){let t,n="";for(;e.length&&(t=e[e.length-1][0],"space"===t||"comment"===t);)n=e.pop()[1]+n;return n}spacesAndCommentsFromStart(e){let t,n="";for(;e.length&&(t=e[0][0],"space"===t||"comment"===t);)n+=e.shift()[1];return n}spacesFromEnd(e){let t,n="";for(;e.length&&(t=e[e.length-1][0],"space"===t);)n=e.pop()[1]+n;return n}stringFrom(e,t){let n="";for(let i=t;i<e.length;i++)n+=e[i][1];return e.splice(t,e.length-t),n}colon(e){let t,n,i,r=0;for(let[s,o]of e.entries()){if(t=o,n=t[0],"("===n&&(r+=1),")"===n&&(r-=1),0===r&&":"===n){if(i){if("word"===i[0]&&"progid"===i[1])continue;return s}this.doubleColon(t)}i=t}return!1}unclosedBracket(e){throw this.input.error("Unclosed bracket",{offset:e[2]},{offset:e[2]+1})}unknownWord(e){throw this.input.error("Unknown word",{offset:e[0][2]},{offset:e[0][2]+e[0][1].length})}unexpectedClose(e){throw this.input.error("Unexpected }",{offset:e[2]},{offset:e[2]+1})}unclosedBlock(){let e=this.current.source.start;throw this.input.error("Unclosed block",e.line,e.column)}doubleColon(e){throw this.input.error("Double colon",{offset:e[2]},{offset:e[2]+e[1].length})}unnamedAtrule(e,t){throw this.input.error("At-rule without name",{offset:t[2]},{offset:t[2]+t[1].length})}precheckMissedSemicolon(){}checkMissedSemicolon(e){let t=this.colon(e);if(!1===t)return;let n,i=0;for(let r=t-1;r>=0&&(n=e[r],"space"===n[0]||(i+=1,2!==i));r--);throw this.input.error("Missed semicolon","word"===n[0]?n[3]+1:n[2])}}},1722:(e,t,n)=>{"use strict";let i=n(5723),r=n(9560),s=n(3521),o=n(2531),a=n(7231),l=n(4414),c=n(6027),u=n(815),d=n(846),h=n(8321),p=n(9956),f=n(7282),m=n(8313),g=n(8561),y=n(4436),v=n(1854),b=n(8973),w=n(7067);function x(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),new a(e)}x.plugin=function(e,t){function n(...n){let i=t(...n);return i.postcssPlugin=e,i.postcssVersion=(new a).version,i}let i;return console&&console.warn&&(console.warn(e+": postcss.plugin was deprecated. Migration guide:\nhttps://evilmartians.com/chronicles/postcss-8-plugin-migration"),process.env.LANG&&process.env.LANG.startsWith("cn")&&console.warn(e+": 里面 postcss.plugin 被弃用. 迁移指南:\nhttps://www.w3ctech.com/topic/2226")),Object.defineProperty(n,"postcss",{get:()=>(i||(i=n()),i)}),n.process=function(e,t,i){return x([n(i)]).process(e,t)},n},x.stringify=l,x.parse=g,x.fromJSON=c,x.list=y,x.comment=e=>new h(e),x.atRule=e=>new p(e),x.decl=e=>new r(e),x.rule=e=>new v(e),x.root=e=>new b(e),x.document=e=>new u(e),x.CssSyntaxError=i,x.Declaration=r,x.Container=o,x.Processor=a,x.Document=u,x.Comment=h,x.Warning=d,x.AtRule=p,x.Result=f,x.Input=m,x.Rule=v,x.Root=b,x.Node=w,s.registerPostcss(x),e.exports=x,x.default=x},3086:(e,t,n)=>{"use strict";let{SourceMapConsumer:i,SourceMapGenerator:r}=n(1305),{existsSync:s,readFileSync:o}=n(9550),{dirname:a,join:l}=n(4029);class PreviousMap{constructor(e,t){if(!1===t.map)return;this.loadAnnotation(e),this.inline=this.startWith(this.annotation,"data:");let n=t.map?t.map.prev:void 0,i=this.loadMap(t.from,n);!this.mapFile&&t.from&&(this.mapFile=t.from),this.mapFile&&(this.root=a(this.mapFile)),i&&(this.text=i)}consumer(){return this.consumerCache||(this.consumerCache=new i(this.text)),this.consumerCache}withContent(){return!!(this.consumer().sourcesContent&&this.consumer().sourcesContent.length>0)}startWith(e,t){return!!e&&e.substr(0,t.length)===t}getAnnotationURL(e){return e.replace(/^\/\*\s*# sourceMappingURL=/,"").trim()}loadAnnotation(e){let t=e.match(/\/\*\s*# sourceMappingURL=/gm);if(!t)return;let n=e.lastIndexOf(t.pop()),i=e.indexOf("*/",n);n>-1&&i>-1&&(this.annotation=this.getAnnotationURL(e.substring(n,i)))}decodeInline(e){if(/^data:application\/json;charset=utf-?8,/.test(e)||/^data:application\/json,/.test(e))return decodeURIComponent(e.substr(RegExp.lastMatch.length));if(/^data:application\/json;charset=utf-?8;base64,/.test(e)||/^data:application\/json;base64,/.test(e))return t=e.substr(RegExp.lastMatch.length),Buffer?Buffer.from(t,"base64").toString():window.atob(t);var t;let n=e.match(/data:application\/json;([^,]+),/)[1];throw new Error("Unsupported source map encoding "+n)}loadFile(e){if(this.root=a(e),s(e))return this.mapFile=e,o(e,"utf-8").toString().trim()}loadMap(e,t){if(!1===t)return!1;if(t){if("string"==typeof t)return t;if("function"!=typeof t){if(t instanceof i)return r.fromSourceMap(t).toString();if(t instanceof r)return t.toString();if(this.isMap(t))return JSON.stringify(t);throw new Error("Unsupported previous source map format: "+t.toString())}{let n=t(e);if(n){let e=this.loadFile(n);if(!e)throw new Error("Unable to load previous source map: "+n.toString());return e}}}else{if(this.inline)return this.decodeInline(this.annotation);if(this.annotation){let t=this.annotation;return e&&(t=l(a(e),t)),this.loadFile(t)}}}isMap(e){return"object"==typeof e&&("string"==typeof e.mappings||"string"==typeof e._mappings||Array.isArray(e.sections))}}e.exports=PreviousMap,PreviousMap.default=PreviousMap},7231:(e,t,n)=>{"use strict";let i=n(3614),r=n(3521),s=n(815),o=n(8973);class Processor{constructor(e=[]){this.version="8.4.13",this.plugins=this.normalize(e)}use(e){return this.plugins=this.plugins.concat(this.normalize([e])),this}process(e,t={}){return 0===this.plugins.length&&void 0===t.parser&&void 0===t.stringifier&&void 0===t.syntax?new i(this,e,t):new r(this,e,t)}normalize(e){let t=[];for(let n of e)if(!0===n.postcss?n=n():n.postcss&&(n=n.postcss),"object"==typeof n&&Array.isArray(n.plugins))t=t.concat(n.plugins);else if("object"==typeof n&&n.postcssPlugin)t.push(n);else if("function"==typeof n)t.push(n);else{if("object"!=typeof n||!n.parse&&!n.stringify)throw new Error(n+" is not a PostCSS plugin")}return t}}e.exports=Processor,Processor.default=Processor,o.registerProcessor(Processor),s.registerProcessor(Processor)},7282:(e,t,n)=>{"use strict";let i=n(846);class Result{constructor(e,t,n){this.processor=e,this.messages=[],this.root=t,this.opts=n,this.css=void 0,this.map=void 0}toString(){return this.css}warn(e,t={}){t.plugin||this.lastPlugin&&this.lastPlugin.postcssPlugin&&(t.plugin=this.lastPlugin.postcssPlugin);let n=new i(e,t);return this.messages.push(n),n}warnings(){return this.messages.filter((e=>"warning"===e.type))}get content(){return this.css}}e.exports=Result,Result.default=Result},8973:(e,t,n)=>{"use strict";let i,r,s=n(2531);class Root extends s{constructor(e){super(e),this.type="root",this.nodes||(this.nodes=[])}removeChild(e,t){let n=this.index(e);return!t&&0===n&&this.nodes.length>1&&(this.nodes[1].raws.before=this.nodes[n].raws.before),super.removeChild(e)}normalize(e,t,n){let i=super.normalize(e);if(t)if("prepend"===n)this.nodes.length>1?t.raws.before=this.nodes[1].raws.before:delete t.raws.before;else if(this.first!==t)for(let e of i)e.raws.before=t.raws.before;return i}toResult(e={}){return new i(new r,this,e).stringify()}}Root.registerLazyResult=e=>{i=e},Root.registerProcessor=e=>{r=e},e.exports=Root,Root.default=Root},1854:(e,t,n)=>{"use strict";let i=n(2531),r=n(4436);class Rule extends i{constructor(e){super(e),this.type="rule",this.nodes||(this.nodes=[])}get selectors(){return r.comma(this.selector)}set selectors(e){let t=this.selector?this.selector.match(/,\s*/):null,n=t?t[0]:","+this.raw("between","beforeOpen");this.selector=e.join(n)}}e.exports=Rule,Rule.default=Rule,i.registerRule(Rule)},9101:e=>{"use strict";const t={colon:": ",indent:"    ",beforeDecl:"\n",beforeRule:"\n",beforeOpen:" ",beforeClose:"\n",beforeComment:"\n",after:"\n",emptyBody:"",commentLeft:" ",commentRight:" ",semicolon:!1};class Stringifier{constructor(e){this.builder=e}stringify(e,t){if(!this[e.type])throw new Error("Unknown AST node type "+e.type+". Maybe you need to change PostCSS stringifier.");this[e.type](e,t)}document(e){this.body(e)}root(e){this.body(e),e.raws.after&&this.builder(e.raws.after)}comment(e){let t=this.raw(e,"left","commentLeft"),n=this.raw(e,"right","commentRight");this.builder("/*"+t+e.text+n+"*/",e)}decl(e,t){let n=this.raw(e,"between","colon"),i=e.prop+n+this.rawValue(e,"value");e.important&&(i+=e.raws.important||" !important"),t&&(i+=";"),this.builder(i,e)}rule(e){this.block(e,this.rawValue(e,"selector")),e.raws.ownSemicolon&&this.builder(e.raws.ownSemicolon,e,"end")}atrule(e,t){let n="@"+e.name,i=e.params?this.rawValue(e,"params"):"";if(void 0!==e.raws.afterName?n+=e.raws.afterName:i&&(n+=" "),e.nodes)this.block(e,n+i);else{let r=(e.raws.between||"")+(t?";":"");this.builder(n+i+r,e)}}body(e){let t=e.nodes.length-1;for(;t>0&&"comment"===e.nodes[t].type;)t-=1;let n=this.raw(e,"semicolon");for(let i=0;i<e.nodes.length;i++){let r=e.nodes[i],s=this.raw(r,"before");s&&this.builder(s),this.stringify(r,t!==i||n)}}block(e,t){let n,i=this.raw(e,"between","beforeOpen");this.builder(t+i+"{",e,"start"),e.nodes&&e.nodes.length?(this.body(e),n=this.raw(e,"after")):n=this.raw(e,"after","emptyBody"),n&&this.builder(n),this.builder("}",e,"end")}raw(e,n,i){let r;if(i||(i=n),n&&(r=e.raws[n],void 0!==r))return r;let s=e.parent;if("before"===i){if(!s||"root"===s.type&&s.first===e)return"";if(s&&"document"===s.type)return""}if(!s)return t[i];let o=e.root();if(o.rawCache||(o.rawCache={}),void 0!==o.rawCache[i])return o.rawCache[i];if("before"===i||"after"===i)return this.beforeAfter(e,i);{let t="raw"+((a=i)[0].toUpperCase()+a.slice(1));this[t]?r=this[t](o,e):o.walk((e=>{if(r=e.raws[n],void 0!==r)return!1}))}var a;return void 0===r&&(r=t[i]),o.rawCache[i]=r,r}rawSemicolon(e){let t;return e.walk((e=>{if(e.nodes&&e.nodes.length&&"decl"===e.last.type&&(t=e.raws.semicolon,void 0!==t))return!1})),t}rawEmptyBody(e){let t;return e.walk((e=>{if(e.nodes&&0===e.nodes.length&&(t=e.raws.after,void 0!==t))return!1})),t}rawIndent(e){if(e.raws.indent)return e.raws.indent;let t;return e.walk((n=>{let i=n.parent;if(i&&i!==e&&i.parent&&i.parent===e&&void 0!==n.raws.before){let e=n.raws.before.split("\n");return t=e[e.length-1],t=t.replace(/\S/g,""),!1}})),t}rawBeforeComment(e,t){let n;return e.walkComments((e=>{if(void 0!==e.raws.before)return n=e.raws.before,n.includes("\n")&&(n=n.replace(/[^\n]+$/,"")),!1})),void 0===n?n=this.raw(t,null,"beforeDecl"):n&&(n=n.replace(/\S/g,"")),n}rawBeforeDecl(e,t){let n;return e.walkDecls((e=>{if(void 0!==e.raws.before)return n=e.raws.before,n.includes("\n")&&(n=n.replace(/[^\n]+$/,"")),!1})),void 0===n?n=this.raw(t,null,"beforeRule"):n&&(n=n.replace(/\S/g,"")),n}rawBeforeRule(e){let t;return e.walk((n=>{if(n.nodes&&(n.parent!==e||e.first!==n)&&void 0!==n.raws.before)return t=n.raws.before,t.includes("\n")&&(t=t.replace(/[^\n]+$/,"")),!1})),t&&(t=t.replace(/\S/g,"")),t}rawBeforeClose(e){let t;return e.walk((e=>{if(e.nodes&&e.nodes.length>0&&void 0!==e.raws.after)return t=e.raws.after,t.includes("\n")&&(t=t.replace(/[^\n]+$/,"")),!1})),t&&(t=t.replace(/\S/g,"")),t}rawBeforeOpen(e){let t;return e.walk((e=>{if("decl"!==e.type&&(t=e.raws.between,void 0!==t))return!1})),t}rawColon(e){let t;return e.walkDecls((e=>{if(void 0!==e.raws.between)return t=e.raws.between.replace(/[^\s:]/g,""),!1})),t}beforeAfter(e,t){let n;n="decl"===e.type?this.raw(e,null,"beforeDecl"):"comment"===e.type?this.raw(e,null,"beforeComment"):"before"===t?this.raw(e,null,"beforeRule"):this.raw(e,null,"beforeClose");let i=e.parent,r=0;for(;i&&"root"!==i.type;)r+=1,i=i.parent;if(n.includes("\n")){let t=this.raw(e,null,"indent");if(t.length)for(let e=0;e<r;e++)n+=t}return n}rawValue(e,t){let n=e[t],i=e.raws[t];return i&&i.value===n?i.raw:n}}e.exports=Stringifier,Stringifier.default=Stringifier},4414:(e,t,n)=>{"use strict";let i=n(9101);function r(e,t){new i(t).stringify(e)}e.exports=r,r.default=r},2899:e=>{"use strict";e.exports.isClean=Symbol("isClean"),e.exports.my=Symbol("my")},2132:e=>{"use strict";const t="'".charCodeAt(0),n='"'.charCodeAt(0),i="\\".charCodeAt(0),r="/".charCodeAt(0),s="\n".charCodeAt(0),o=" ".charCodeAt(0),a="\f".charCodeAt(0),l="\t".charCodeAt(0),c="\r".charCodeAt(0),u="[".charCodeAt(0),d="]".charCodeAt(0),h="(".charCodeAt(0),p=")".charCodeAt(0),f="{".charCodeAt(0),m="}".charCodeAt(0),g=";".charCodeAt(0),y="*".charCodeAt(0),v=":".charCodeAt(0),b="@".charCodeAt(0),w=/[\t\n\f\r "#'()/;[\\\]{}]/g,x=/[\t\n\f\r !"#'():;@[\\\]{}]|\/(?=\*)/g,_=/.[\n"'(/\\]/,E=/[\da-f]/i;e.exports=function(e,S={}){let C,T,A,k,N,M,P,L,O,R,I=e.css.valueOf(),D=S.ignoreErrors,F=I.length,B=0,z=[],j=[];function V(t){throw e.error("Unclosed "+t,B)}return{back:function(e){j.push(e)},nextToken:function(e){if(j.length)return j.pop();if(B>=F)return;let S=!!e&&e.ignoreUnclosed;switch(C=I.charCodeAt(B),C){case s:case o:case l:case c:case a:T=B;do{T+=1,C=I.charCodeAt(T)}while(C===o||C===s||C===l||C===c||C===a);R=["space",I.slice(B,T)],B=T-1;break;case u:case d:case f:case m:case v:case g:case p:{let e=String.fromCharCode(C);R=[e,e,B];break}case h:if(L=z.length?z.pop()[1]:"",O=I.charCodeAt(B+1),"url"===L&&O!==t&&O!==n&&O!==o&&O!==s&&O!==l&&O!==a&&O!==c){T=B;do{if(M=!1,T=I.indexOf(")",T+1),-1===T){if(D||S){T=B;break}V("bracket")}for(P=T;I.charCodeAt(P-1)===i;)P-=1,M=!M}while(M);R=["brackets",I.slice(B,T+1),B,T],B=T}else T=I.indexOf(")",B+1),k=I.slice(B,T+1),-1===T||_.test(k)?R=["(","(",B]:(R=["brackets",k,B,T],B=T);break;case t:case n:A=C===t?"'":'"',T=B;do{if(M=!1,T=I.indexOf(A,T+1),-1===T){if(D||S){T=B+1;break}V("string")}for(P=T;I.charCodeAt(P-1)===i;)P-=1,M=!M}while(M);R=["string",I.slice(B,T+1),B,T],B=T;break;case b:w.lastIndex=B+1,w.test(I),T=0===w.lastIndex?I.length-1:w.lastIndex-2,R=["at-word",I.slice(B,T+1),B,T],B=T;break;case i:for(T=B,N=!0;I.charCodeAt(T+1)===i;)T+=1,N=!N;if(C=I.charCodeAt(T+1),N&&C!==r&&C!==o&&C!==s&&C!==l&&C!==c&&C!==a&&(T+=1,E.test(I.charAt(T)))){for(;E.test(I.charAt(T+1));)T+=1;I.charCodeAt(T+1)===o&&(T+=1)}R=["word",I.slice(B,T+1),B,T],B=T;break;default:C===r&&I.charCodeAt(B+1)===y?(T=I.indexOf("*/",B+2)+1,0===T&&(D||S?T=I.length:V("comment")),R=["comment",I.slice(B,T+1),B,T],B=T):(x.lastIndex=B+1,x.test(I),T=0===x.lastIndex?I.length-1:x.lastIndex-2,R=["word",I.slice(B,T+1),B,T],z.push(R),B=T)}return B++,R},endOfFile:function(){return 0===j.length&&B>=F},position:function(){return B}}}},3098:e=>{"use strict";let t={};e.exports=function(e){t[e]||(t[e]=!0,"undefined"!=typeof console&&console.warn&&console.warn(e))}},846:e=>{"use strict";class Warning{constructor(e,t={}){if(this.type="warning",this.text=e,t.node&&t.node.source){let e=t.node.rangeBy(t);this.line=e.start.line,this.column=e.start.column,this.endLine=e.end.line,this.endColumn=e.end.column}for(let e in t)this[e]=t[e]}toString(){return this.node?this.node.error(this.text,{plugin:this.plugin,index:this.index,word:this.word}).message:this.plugin?this.plugin+": "+this.text:this.text}}e.exports=Warning,Warning.default=Warning},8772:(e,t,n)=>{"use strict";var i=n(331);function r(){}function s(){}s.resetWarningCache=r,e.exports=function(){function e(e,t,n,r,s,o){if(o!==i){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:s,resetWarningCache:r};return n.PropTypes=n,n}},3615:(e,t,n)=>{e.exports=n(8772)()},331:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},3215:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncedTable=t.debug=void 0;const i=n(2040),r="DEBUG_SYNCEDTABLE",s="undefined"!=typeof window;t.debug=function(...e){s&&window[r]&&window[r](...e)};const o={array:"array",localStorage:"localStorage",object:"object"};class SyncedTable{constructor({name:e,filter:n,onChange:r,onReady:l,db:c,skipFirstTrigger:u=!1,select:d="*",storageType:h="object",patchText:p=!1,patchJSON:f=!1,onError:m}){if(this.throttle=100,this.batch_size=50,this.skipFirstTrigger=!1,this.columns=[],this._multiSubscriptions=[],this._singleSubscriptions=[],this.items=[],this.itemsObj={},this.isSynced=!1,this.updatePatches=async e=>{var t,n;let r=e.map((e=>e.current)),s=[],o=[];if(this.columns&&this.columns.length&&(null===(t=this.tableHandler)||void 0===t?void 0:t.updateBatch)&&(this.patchText||this.patchJSON)){const t=this.columns.filter((e=>"text"===e.data_type));if(this.patchText&&t.length){r=[];const n=[this.synced_field,...this.id_fields];await Promise.all(e.slice(0).map((async(e,a)=>{const{current:l,initial:c}={...e};let u;c&&(t.map((e=>{!n.includes(e.name)&&e.name in l&&(null!=u||(u={...l}),u[e.name]=(0,i.getTextPatch)(c[e.name],l[e.name]))})),u&&this.wal&&(o.push(u),s.push([this.wal.getIdObj(u),this.wal.getDeltaObj(u)]))),u||r.push(l)})))}}if(s.length)try{await(null===(n=this.tableHandler)||void 0===n?void 0:n.updateBatch(s))}catch(e){console.log("failed to patch update",e),r=r.concat(o)}return r.filter((e=>e))},this._notifySubscribers=(e=[])=>{if(!this.isSynced)return;let t=[],n=[],i=[];if(e.map((({idObj:e,newItem:r,delta:s})=>{this.singleSubscriptions.filter((t=>this.matchesIdObj(t.idObj,e))).map((async e=>{try{await e.notify(r,s)}catch(e){console.error("SyncedTable failed to notify: ",e)}})),this.matchesFilter(r)&&(t.push(r),n.push(s),i.push(e))})),this.onChange||this.multiSubscriptions.length){let e=[],i=[];if(this.getItems().map((r=>{e.push({...r});const s=t.findIndex((e=>this.matchesIdObj(r,e)));i.push(n[s])})),this.onChange)try{this.onChange(e,i)}catch(e){console.error("SyncedTable failed to notify onChange: ",e)}this.multiSubscriptions.map((async t=>{try{await t.notify(e,i)}catch(e){console.error("SyncedTable failed to notify: ",e)}}))}},this.unsubscribe=e=>(this.singleSubscriptions=this.singleSubscriptions.filter((t=>t._onChange!==e)),this.multiSubscriptions=this.multiSubscriptions.filter((t=>t._onChange!==e)),(0,t.debug)("unsubscribe",this),"ok"),this.unsync=()=>{this.dbSync&&this.dbSync.unsync&&this.dbSync.unsync()},this.destroy=()=>{this.unsync(),this.multiSubscriptions=[],this.singleSubscriptions=[],this.itemsObj={},this.items=[],this.onChange=void 0},this.delete=async(e,t=!1)=>{var n;const i=this.getIdObj(e);return this.setItem(i,void 0,!0,!0),!t&&(null===(n=this.tableHandler)||void 0===n?void 0:n.delete)&&await this.tableHandler.delete(i),this._notifySubscribers(),!0},this.checkItemCols=e=>{if(this.columns&&this.columns.length){const t=Object.keys({...e}).filter((e=>!this.columns.find((t=>t.name===e))));if(t.length)throw"Unexpected columns in sync item update: "+t.join(", ")}},this.upsert=async(e,t=!1)=>{var n,r;if(!(e&&e.length||t))throw"No data provided for upsert";let s,o=[],l=[];await Promise.all(e.map((async(e,n)=>{var r;let c={...e.idObj},u={...e.delta};Object.keys(u).map((e=>{void 0===u[e]&&(u[e]=null)})),t||this.checkItemCols({...e.delta,...e.idObj});let d=this.getItem(c),h=d.index,p=d.data;!t&&!(0,i.isEmpty)(u)||(0,i.isEmpty)(p)||(u=this.getDelta(p||{},u)),t||(u[this.synced_field]=Date.now());let f={...p,...u,...c};p&&!t&&(null===(r=e.opts)||void 0===r?void 0:r.deepMerge)&&(f=a({...p,...c},{...u})),s=p?p[this.synced_field]<f[this.synced_field]?"updated":"unchanged":"inserted",this.setItem(f,h);let m={idObj:c,delta:u,oldItem:p,newItem:f,status:s,from_server:t};return t||l.push({initial:p,current:{...f}}),m.delta&&!(0,i.isEmpty)(m.delta)&&o.push(m),!0}))).catch((e=>{console.error("SyncedTable failed upsert: ",e)})),null===(n=this.notifyWal)||void 0===n||n.addData(o.map((e=>({initial:e.oldItem,current:e.newItem})))),!t&&l.length&&(null===(r=this.wal)||void 0===r||r.addData(l))},this.setItems=e=>{if(this.storageType===o.localStorage){if(!s)throw"Cannot access window object. Choose another storage method (array OR object)";window.localStorage.setItem(this.name,JSON.stringify(e))}else this.storageType===o.array?this.items=e:this.itemsObj=e.reduce(((e,t)=>({...e,[this.getIdStr(t)]:{...t}})),{})},this.getItems=()=>{let e=[];if(this.storageType===o.localStorage){if(!s)throw"Cannot access window object. Choose another storage method (array OR object)";let t=window.localStorage.getItem(this.name);if(t)try{e=JSON.parse(t)}catch(e){console.error(e)}}else e=this.storageType===o.array?this.items.map((e=>({...e}))):Object.values({...this.itemsObj});if(!this.id_fields||!this.synced_field)throw"id_fields AND/OR synced_field missing";{const t=[this.synced_field,...this.id_fields.sort()];e=e.filter((e=>!this.filter||!(0,i.getKeys)(this.filter).find((t=>e[t]!==this.filter[t])))).sort(((e,n)=>t.map((t=>e[t]<n[t]?-1:e[t]>n[t]?1:0)).find((e=>e))))}return e.map((e=>({...e})))},this.getBatch=({from_synced:e,to_synced:t,offset:n,limit:i}={offset:0,limit:void 0})=>{let r=this.getItems().map((e=>({...e}))).filter((n=>(!Number.isFinite(e)||+n[this.synced_field]>=+e)&&(!Number.isFinite(t)||+n[this.synced_field]<=+t)));return(n||i)&&(r=r.splice(null!=n?n:0,i||r.length)),r},this.name=e,this.filter=n,this.select=d,this.onChange=r,!o[h])throw"Invalid storage type. Expecting one of: "+Object.keys(o).join(", ");if(s||h!==o.localStorage||(console.warn("Could not set storageType to localStorage: window object missing\nStorage changed to object"),h="object"),this.storageType=h,this.patchText=p,this.patchJSON=f,!c)throw"db missing";this.db=c;const{id_fields:g,synced_field:y,throttle:v=100,batch_size:b=50}=c[this.name]._syncInfo;if(!g||!y)throw"id_fields/synced_field missing";this.id_fields=g,this.synced_field=y,this.batch_size=b,this.throttle=v,this.skipFirstTrigger=u,this.multiSubscriptions=[],this.singleSubscriptions=[],this.onError=m||function(e){console.error("Sync internal error: ",e)};const w={id_fields:g,synced_field:y,throttle:v};c[this.name]._sync(n,{select:d},{onSyncRequest:e=>{let t={c_lr:void 0,c_fr:void 0,c_count:0},n=this.getBatch(e);return n.length&&(t={c_fr:this.getRowSyncObj(n[0]),c_lr:this.getRowSyncObj(n[n.length-1]),c_count:n.length}),t},onPullRequest:async e=>this.getBatch(e),onUpdates:async e=>{var t;if("err"in e&&e.err)null===(t=this.onError)||void 0===t||t.call(this,e.err);else if("isSynced"in e&&e.isSynced&&!this.isSynced){this.isSynced=e.isSynced;let t=this.getItems().map((e=>({...e})));this.setItems([]);const n=t.map((e=>({idObj:this.getIdObj(e),delta:{...e}})));await this.upsert(n,!0)}else if("data"in e){let t=e.data.map((e=>({idObj:this.getIdObj(e),delta:e})));await this.upsert(t,!0)}else console.error("Unexpected onUpdates");return!0}}).then((e=>{function t(){return"Data may be lost. Are you sure?"}this.dbSync=e,this.wal=new i.WAL({...w,batch_size:b,onSendStart:()=>{s&&(window.onbeforeunload=t)},onSend:async(e,t)=>(await this.updatePatches(t)).length?this.dbSync.syncData(e):[],onSendEnd:()=>{s&&(window.onbeforeunload=null)}}),this.notifyWal=new i.WAL({...w,batch_size:1/0,throttle:5,onSend:async(e,t)=>{this._notifySubscribers(t.map((e=>{var t;return{delta:this.getDelta(null!==(t=e.initial)&&void 0!==t?t:{},e.current),idObj:this.getIdObj(e.current),newItem:e.current}})))}}),l()})),c[this.name].getColumns&&c[this.name].getColumns().then((e=>{this.columns=e})),this.onChange&&!this.skipFirstTrigger&&setTimeout(this.onChange,0),(0,t.debug)(this)}set multiSubscriptions(e){(0,t.debug)(e,this._multiSubscriptions),this._multiSubscriptions=e.slice(0)}get multiSubscriptions(){return this._multiSubscriptions}set singleSubscriptions(e){(0,t.debug)(e,this._singleSubscriptions),this._singleSubscriptions=e.slice(0)}get singleSubscriptions(){return this._singleSubscriptions}static create(e){return new Promise(((t,n)=>{try{const n=new SyncedTable({...e,onReady:()=>{setTimeout((()=>{t(n)}),0)}})}catch(e){n(e)}}))}sync(e,t=!0){const n={$unsync:()=>this.unsubscribe(e),getItems:()=>this.getItems(),$upsert:e=>{if(e){const t=e=>({idObj:this.getIdObj(e),delta:e});Array.isArray(e)?this.upsert(e.map((e=>t(e)))):this.upsert([t(e)])}}},i={_onChange:e,handlesOnData:t,handles:n,notify:(n,i)=>{let r=[...n],s=[...i];return t&&(r=r.map(((n,i)=>{const r=(n,i)=>({...n,...this.makeSingleSyncHandles(i,e),$get:()=>r(this.getItem(i).data,i),$find:e=>r(this.getItem(e).data,e),$update:(e,t)=>this.upsert([{idObj:i,delta:e,opts:t}]).then((e=>!0)),$delete:async()=>this.delete(i),$cloneMultiSync:e=>this.sync(e,t)}),s=this.getIdObj(n);return r(n,s)}))),e(r,s)}};return this.multiSubscriptions.push(i),this.skipFirstTrigger||setTimeout((()=>{let e=this.getItems();i.notify(e,e)}),0),Object.freeze({...n})}makeSingleSyncHandles(e,n){if(!e||!n)throw"syncOne(idObj, onChange) -> MISSING idObj or onChange";const i={$get:()=>this.getItem(e).data,$find:e=>this.getItem(e).data,$unsync:()=>this.unsubscribe(n),$delete:()=>this.delete(e),$update:(n,i)=>{this.singleSubscriptions.length||this.multiSubscriptions.length||(console.warn("No sync listeners"),(0,t.debug)("nosync",this._singleSubscriptions,this._multiSubscriptions)),this.upsert([{idObj:e,delta:n,opts:i}])},$cloneSync:t=>this.syncOne(e,t),$cloneMultiSync:e=>this.sync(e,!0)};return i}syncOne(e,t,n=!0){const i=this.makeSingleSyncHandles(e,t),r={_onChange:t,idObj:e,handlesOnData:n,handles:i,notify:(e,r)=>{let s={...e};return n&&(s.$get=i.$get,s.$find=i.$find,s.$update=i.$update,s.$delete=i.$delete,s.$unsync=i.$unsync,s.$cloneSync=i.$cloneSync),t(s,r)}};return this.singleSubscriptions.push(r),setTimeout((()=>{let e=i.$get();e&&r.notify(e,e)}),0),Object.freeze({...i})}getIdStr(e){return this.id_fields.sort().map((t=>`${e[t]||""}`)).join(".")}getIdObj(e){let t={};return this.id_fields.sort().map((n=>{t[n]=e[n]})),t}getRowSyncObj(e){let t={};return[this.synced_field,...this.id_fields].sort().map((n=>{t[n]=e[n]})),t}matchesFilter(e){return Boolean(e&&(!this.filter||(0,i.isEmpty)(this.filter)||!Object.keys(this.filter).find((t=>this.filter[t]!==e[t]))))}matchesIdObj(e,t){return Boolean(e&&t&&!this.id_fields.sort().find((n=>e[n]!==t[n])))}getDelta(e,t){return(0,i.isEmpty)(e)?{...t}:Object.keys({...e,...t}).filter((e=>!this.id_fields.includes(e))).reduce(((n,i)=>{let r={};if(i in t&&t[i]!==e[i]){let n={[i]:t[i]};t[i]&&e[i]&&"object"==typeof e[i]?JSON.stringify(t[i])!==JSON.stringify(e[i])&&(r=n):r=n}return{...n,...r}}),{})}deleteAll(){this.getItems().map((e=>this.delete(e)))}get tableHandler(){const e=this.db[this.name];if(e.update&&e.updateBatch)return e}getItem(e){let t;if(this.storageType===o.localStorage){t=this.getItems().find((t=>this.matchesIdObj(t,e)))}else this.storageType===o.array?t=this.items.find((t=>this.matchesIdObj(t,e))):(this.itemsObj=this.itemsObj||{},t={...this.itemsObj}[this.getIdStr(e)]);return{data:t?{...t}:t,index:-1}}setItem(e,t,n=!1,i=!1){if(this.storageType===o.localStorage){let r=this.getItems();i?r=r.filter((t=>!this.matchesIdObj(t,e))):void 0!==t&&r[t]?r[t]=n?{...e}:{...r[t],...e}:r.push(e),s&&window.localStorage.setItem(this.name,JSON.stringify(r))}else if(this.storageType===o.array)i?this.items=this.items.filter((t=>!this.matchesIdObj(t,e))):void 0===t||this.items[t]?void 0!==t&&(this.items[t]=n?{...e}:{...this.items[t],...e}):this.items.push(e);else if(this.itemsObj=this.itemsObj||{},i)delete this.itemsObj[this.getIdStr(e)];else{let t=this.itemsObj[this.getIdStr(e)]||{};this.itemsObj[this.getIdStr(e)]=n?{...e}:{...t,...e}}}}function a(e,t){let n=Object.assign({},e);return(0,i.isObject)(e)&&(0,i.isObject)(t)&&Object.keys(t).forEach((r=>{(0,i.isObject)(t[r])?r in e?n[r]=a(e[r],t[r]):Object.assign(n,{[r]:t[r]}):Object.assign(n,{[r]:t[r]})})),n}t.SyncedTable=SyncedTable,t.default=a},9139:(e,t,n)=>{"use strict";const i=n(2330),r=n(3215);function s(e){return(0,i.prostgles)(e,r.SyncedTable)}s.SyncedTable=r.SyncedTable,e.exports=s},2330:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.prostgles=t.debug=void 0;const i=n(2040),r="DEBUG_SYNCEDTABLE",s="undefined"!=typeof window;t.debug=function(...e){s&&window[r]&&window[r](...e)};t.prostgles=function(e,n){const{socket:r,onReady:s,onDisconnect:o,onReconnect:a,onSchemaChange:l=!0}=e;if((0,t.debug)("prostgles",{initOpts:e}),l){let e;"function"==typeof l&&(e=l),r.removeAllListeners(i.CHANNELS.SCHEMA_CHANGED),e&&r.on(i.CHANNELS.SCHEMA_CHANGED,e)}const c=i.CHANNELS._preffix;let u,d={},h={},p={},f=!1,m={},g=!1;function y(e,n){return(0,t.debug)("_unsubscribe",{channelName:e,handler:n}),new Promise(((t,i)=>{d[e]?(d[e].handlers=d[e].handlers.filter((e=>e!==n)),d[e].handlers.length||(r.emit(e+"unsubscribe",{},((e,t)=>{e&&console.error(e)})),r.removeListener(e,d[e].onCall),delete d[e]),t(!0)):t(!0)}))}function v({tableName:e,command:t,param1:n,param2:i},s){return new Promise(((o,a)=>{r.emit(c,{tableName:e,command:t,param1:n,param2:i},((e,t)=>{if(e)console.error(e),a(e);else if(t){const{id_fields:e,synced_field:n,channelName:i}=t;r.emit(i,{onSyncRequest:s({})},(e=>{console.log(e)})),o({id_fields:e,synced_field:n,channelName:i})}}))}))}function b({tableName:e,command:t,param1:n,param2:i}){return new Promise(((s,o)=>{r.emit(c,{tableName:e,command:t,param1:n,param2:i},((e,t)=>{e?(console.error(e),o(e)):t&&s(t.channelName)}))}))}const w=new FunctionQueuer((async function({tableName:e,command:n,param1:i,param2:s},o){const{onPullRequest:a,onSyncRequest:l,onUpdates:c}=o;function u(e){return Object.freeze({unsync:function(){!function(e,n){(0,t.debug)("_unsync",{channelName:e,triggers:n}),new Promise(((t,i)=>{p[e]&&(p[e].triggers=p[e].triggers.filter((e=>e.onPullRequest!==n.onPullRequest&&e.onSyncRequest!==n.onSyncRequest&&e.onUpdates!==n.onUpdates)),p[e].triggers.length||(r.emit(e+"unsync",{},((e,n)=>{e?i(e):t(n)})),r.removeListener(e,p[e].onCall),delete p[e]))}))}(e,o)},syncData:function(t,n,i){r.emit(e,{onSyncRequest:{...l({}),...{data:t}||{},...{deleted:n}||{}}},i?e=>{i(e)}:null)}})}const d=Object.keys(p).find((t=>{let r=p[t];return r.tableName===e&&r.command===n&&JSON.stringify(r.param1||{})===JSON.stringify(i||{})&&JSON.stringify(r.param2||{})===JSON.stringify(s||{})}));if(d)return p[d].triggers.push(o),u(d);{const t=await v({tableName:e,command:n,param1:i,param2:s},l),{channelName:a,synced_field:c,id_fields:d}=t;function h(t,n){t&&p[a]&&p[a].triggers.map((({onUpdates:i,onSyncRequest:r,onPullRequest:s})=>{t.data?Promise.resolve(i(t)).then((()=>{n&&n({ok:!0})})).catch((t=>{n?n({err:t}):console.error(e+" onUpdates error",t)})):t.onSyncRequest?Promise.resolve(r(t.onSyncRequest)).then((e=>n({onSyncRequest:e}))).catch((t=>{n?n({err:t}):console.error(e+" onSyncRequest error",t)})):t.onPullRequest?Promise.resolve(s(t.onPullRequest)).then((e=>{n({data:e})})).catch((t=>{n?n({err:t}):console.error(e+" onPullRequest error",t)})):console.log("unexpected response")}))}return p[a]={tableName:e,command:n,param1:i,param2:s,triggers:[o],syncInfo:t,onCall:h},r.on(a,h),u(a)}})),x=new FunctionQueuer(E);async function _(e,t,n,i){return x.run([e,t,n,i])}async function E(e,{tableName:t,command:n,param1:i,param2:s},o,a){function l(n){let r={unsubscribe:function(){return y(n,o)},filter:{...i}};return e[t].update&&(r={...r,update:function(n,r){return e[t].update(i,n,r)}}),e[t].delete&&(r={...r,delete:function(n){return e[t].delete(i,n)}}),Object.freeze(r)}f=!0;const c=Object.keys(d).find((e=>{let r=d[e];return r.tableName===t&&r.command===n&&JSON.stringify(r.param1||{})===JSON.stringify(i||{})&&JSON.stringify(r.param2||{})===JSON.stringify(s||{})}));if(c)return d[c].handlers.push(o),setTimeout((()=>{o&&(null==d?void 0:d[c].lastData)&&o(null==d?void 0:d[c].lastData)}),10),f=!1,l(c);const u=await b({tableName:t,command:n,param1:i,param2:s});let h=function(e,t){d[u]?e.data?(d[u].lastData=e.data,d[u].handlers.map((t=>{t(e.data)}))):e.err?d[u].errorHandlers.map((t=>{t(e.err)})):console.error("INTERNAL ERROR: Unexpected data format from subscription: ",e):console.warn("Orphaned subscription: ",u)},p=a||function(e){console.error(`Uncaught error within running subscription \n ${u}`,e)};return r.on(u,h),d[u]={lastData:void 0,tableName:t,command:n,param1:i,param2:s,onCall:h,handlers:[o],errorHandlers:[p],destroy:()=>{d[u]&&(Object.values(d[u]).map((e=>{e&&e.handlers&&e.handlers.map((e=>y(u,e)))})),delete d[u])}},f=!1,l(u)}return new Promise(((e,l)=>{o&&r.on("disconnect",o),r.on(i.CHANNELS.SCHEMA,(({schema:o,methods:f,tableSchema:y,auth:x,rawSQL:E,joinTables:S=[],err:C})=>{if(C)throw l(C),C;(0,t.debug)("destroySyncs",{subscriptions:d,syncedTables:h}),Object.values(d).map((e=>e.destroy())),d={},p={},Object.values(h).map((e=>{e&&e.destroy&&e.destroy()})),h={},g&&a&&a(r),g=!0;let T=JSON.parse(JSON.stringify(o)),A=JSON.parse(JSON.stringify(f)),k={},N={};if(x){if(x.pathGuard){const e=e=>{var t,n;(null==e?void 0:e.shouldReload)&&"undefined"!=typeof window&&(null===(n=null===(t=null===window||void 0===window?void 0:window.location)||void 0===t?void 0:t.reload)||void 0===n||n.call(t))};r.emit(i.CHANNELS.AUTHGUARD,JSON.stringify(window.location),((t,n)=>{e(n)})),r.removeAllListeners(i.CHANNELS.AUTHGUARD),r.on(i.CHANNELS.AUTHGUARD,(t=>{e(t)}))}N={...x},[i.CHANNELS.LOGIN,i.CHANNELS.LOGOUT,i.CHANNELS.REGISTER].map((e=>{x[e]&&(N[e]=function(t){return new Promise(((n,i)=>{r.emit(c+e,t,((e,t)=>{e?i(e):n(t)}))}))})}))}A.map((e=>{k[e]=function(...t){return new Promise(((n,s)=>{r.emit(i.CHANNELS.METHOD,{method:e,params:t},((e,t)=>{e?s(e):n(t)}))}))}})),k=Object.freeze(k),E&&(T.sql=function(e,t,n){return new Promise(((s,o)=>{r.emit(i.CHANNELS.SQL,{query:e,params:t,options:n},((e,t)=>{if(e)o(e);else if(n&&"noticeSubscription"===n.returnType&&t&&Object.keys(t).sort().join()===["socketChannel","socketUnsubChannel"].sort().join()&&!Object.values(t).find((e=>"string"!=typeof e))){const e=t,n=t=>(((e,t)=>{u=u||{config:t,listeners:[]},u.listeners.length||(r.removeAllListeners(t.socketChannel),r.on(t.socketChannel,(e=>{u&&u.listeners&&u.listeners.length?u.listeners.map((t=>{t(e)})):r.emit(t.socketUnsubChannel,{})}))),u.listeners.push(e)})(t,e),{...e,removeListener:()=>(e=>{u&&(u.listeners=u.listeners.filter((t=>t!==e)),!u.listeners.length&&u.config&&u.config.socketUnsubChannel&&r&&r.emit(u.config.socketUnsubChannel,{}))})(t)}),i={...e,addListener:n};s(i)}else if(n&&n.returnType&&"statement"===n.returnType||!t||Object.keys(t).sort().join()!==["socketChannel","socketUnsubChannel","notifChannel"].sort().join()||Object.values(t).find((e=>"string"!=typeof e)))s(t);else{const e=e=>(((e,t)=>{m=m||{},m[t.notifChannel]?m[t.notifChannel].listeners.push(e):(m[t.notifChannel]={config:t,listeners:[e]},r.removeAllListeners(t.socketChannel),r.on(t.socketChannel,(e=>{m[t.notifChannel]&&m[t.notifChannel].listeners&&m[t.notifChannel].listeners.length?m[t.notifChannel].listeners.map((t=>{t(e)})):r.emit(m[t.notifChannel].config.socketUnsubChannel,{})})))})(e,t),{...t,removeListener:()=>((e,t)=>{m&&m[t.notifChannel]&&(m[t.notifChannel].listeners=m[t.notifChannel].listeners.filter((t=>t!==e)),!m[t.notifChannel].listeners.length&&m[t.notifChannel].config&&m[t.notifChannel].config.socketUnsubChannel&&r&&(r.emit(m[t.notifChannel].config.socketUnsubChannel,{}),delete m[t.notifChannel]))})(e,t)}),n={...t,addListener:e};s(n)}}))}))});const M=e=>"[object Object]"===Object.prototype.toString.call(e),P=(e,t,n,i)=>{if(!M(e)||!M(t)||"function"!=typeof n||i&&"function"!=typeof i)throw"Expecting: ( basicFilter<object>, options<object>, onChange<function> , onError?<function>) but got something else"},L=["subscribe","subscribeOne"];Object.keys(T).forEach((e=>{Object.keys(T[e]).sort(((e,t)=>L.includes(e)-L.includes(t))).forEach((t=>{if(["find","findOne"].includes(t)&&(T[e].getJoinedTables=function(){return(S||[]).filter((t=>Array.isArray(t)&&t.includes(e))).flat().filter((t=>t!==e))}),"sync"===t){if(T[e]._syncInfo={...T[e][t]},n){T[e].getSync=(t,i={})=>n.create({name:e,filter:t,db:T,...i});const t=async(t={},i={},r)=>{const s=`${e}.${JSON.stringify(t)}.${JSON.stringify(i)}`;return h[s]||(h[s]=await n.create({...i,name:e,filter:t,db:T,onError:r})),h[s]};T[e].sync=async(e,n={handlesOnData:!0,select:"*"},i,r)=>{P(e,n,i,r);const s=await t(e,n,r);return await s.sync(i,n.handlesOnData)},T[e].syncOne=async(e,n={handlesOnData:!0},i,r)=>{P(e,n,i,r);const s=await t(e,n,r);return await s.syncOne(e,i,n.handlesOnData)}}T[e]._sync=function(n,i,r){return async function(e,t){return w.run([e,t])}({tableName:e,command:t,param1:n,param2:i},r)}}else if(L.includes(t)){T[e][t]=function(n,i,r,s){return P(n,i,r,s),_(T,{tableName:e,command:t,param1:n,param2:i},r,s)};const n="subscribeOne";t!==n&&L.includes(n)||(T[e][n]=function(n,i,r,s){P(n,i,r,s);return _(T,{tableName:e,command:t,param1:n,param2:i},(e=>{r(e[0])}),s)})}else T[e][t]=function(n,i,s){return new Promise(((o,a)=>{r.emit(c,{tableName:e,command:t,param1:n,param2:i,param3:s},((e,t)=>{e?a(e):o(t)}))}))}}))})),d&&Object.keys(d).length&&Object.keys(d).map((async e=>{try{let t=d[e];await b(t),r.on(e,t.onCall)}catch(e){console.error("There was an issue reconnecting old subscriptions",e)}})),p&&Object.keys(p).length&&Object.keys(p).filter((e=>p[e].triggers&&p[e].triggers.length)).map((async e=>{try{let t=p[e];await v(t,t.triggers[0].onSyncRequest),r.on(e,t.onCall)}catch(e){console.error("There was an issue reconnecting olf subscriptions",e)}})),S.flat().map((e=>{function t(t=!0,n,i,r){return{[t?"$leftJoin":"$innerJoin"]:e,filter:n,select:i,...r}}T.innerJoin=T.innerJoin||{},T.leftJoin=T.leftJoin||{},T.innerJoinOne=T.innerJoinOne||{},T.leftJoinOne=T.leftJoinOne||{},T.leftJoin[e]=(e,n,i={})=>t(!0,e,n,i),T.innerJoin[e]=(e,n,i={})=>t(!1,e,n,i),T.leftJoinOne[e]=(e,n,i={})=>t(!0,e,n,{...i,limit:1}),T.innerJoinOne[e]=(e,n,i={})=>t(!1,e,n,{...i,limit:1})})),(async()=>{try{await s(T,k,y,N)}catch(e){console.error("Prostgles: Error within onReady: \n",e),l(e)}e(T)})()}))}))};class FunctionQueuer{constructor(e){this.queue=[],this.isRunning=!1,this.func=e}async run(e){const t=new Promise(((t,n)=>{const i={arguments:e,onResult:t};this.queue.push(i)})),n=async()=>{if(this.isRunning)return;this.isRunning=!0;const e=this.queue.shift();if(e){const t=await this.func(...e.arguments);e.onResult(t)}this.isRunning=!1,this.queue.length&&n()};return n(),t}}},2040:function(e){var t;this||window,t=()=>(()=>{"use strict";var e={444:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EXISTS_KEYS=t.GeomFilter_Funcs=t.GeomFilterKeys=t.ArrayFilterOperands=t.TextFilter_FullTextSearchFilterKeys=t.TextFilterFTSKeys=t.TextFilterKeys=t.CompareInFilterKeys=t.CompareFilterKeys=void 0,t.CompareFilterKeys=["=","$eq","<>",">",">=","<=","$eq","$ne","$gt","$gte","$lte"],t.CompareInFilterKeys=["$in","$nin"],t.TextFilterKeys=["$ilike","$like"],t.TextFilterFTSKeys=["@@","@>","<@","$contains","$containedBy"],t.TextFilter_FullTextSearchFilterKeys=["to_tsquery","plainto_tsquery","phraseto_tsquery","websearch_to_tsquery"],t.ArrayFilterOperands=[...t.TextFilterFTSKeys,"&&","$overlaps"],t.GeomFilterKeys=["~","~=","@","|&>","|>>",">>","=","<<|","<<","&>","&<|","&<","&&&","&&"];const n=["ST_MakeEnvelope","ST_MakePolygon"];t.GeomFilter_Funcs=n.concat(n.map((e=>e.toLowerCase()))),t.EXISTS_KEYS=["$exists","$notExists","$existsJoined","$notExistsJoined"]},590:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.getKeys=t.isObject=t.isDefined=t.get=t.WAL=t.unpatchText=t.stableStringify=t.isEmpty=t.getTextPatch=t.asName=t.RULE_METHODS=t.CHANNELS=t.TS_PG_Types=t._PG_postgis=t._PG_date=t._PG_bool=t._PG_json=t._PG_numbers=t._PG_strings=void 0,t._PG_strings=["bpchar","char","varchar","text","citext","uuid","bytea","inet","time","timetz","interval","name"],t._PG_numbers=["int2","int4","int8","float4","float8","numeric","money","oid"],t._PG_json=["json","jsonb"],t._PG_bool=["bool"],t._PG_date=["date","timestamp","timestamptz"],t._PG_postgis=["geometry","geography"],t.TS_PG_Types={string:t._PG_strings,number:t._PG_numbers,boolean:t._PG_bool,Date:t._PG_date,"Array<number>":t._PG_numbers.map((e=>`_${e}`)),"Array<boolean>":t._PG_bool.map((e=>`_${e}`)),"Array<string>":t._PG_strings.map((e=>`_${e}`)),"Array<Object>":t._PG_json.map((e=>`_${e}`)),"Array<Date>":t._PG_date.map((e=>`_${e}`)),any:[]};const s="_psqlWS_.";t.CHANNELS={SCHEMA_CHANGED:s+"schema-changed",SCHEMA:s+"schema",DEFAULT:s,SQL:"_psqlWS_.sql",METHOD:"_psqlWS_.method",NOTICE_EV:"_psqlWS_.notice",LISTEN_EV:"_psqlWS_.listen",REGISTER:"_psqlWS_.register",LOGIN:"_psqlWS_.login",LOGOUT:"_psqlWS_.logout",AUTHGUARD:"_psqlWS_.authguard",_preffix:s},t.RULE_METHODS={getColumns:["getColumns"],getInfo:["getInfo"],insert:["insert","upsert"],update:["update","upsert","updateBatch"],select:["findOne","find","count","size"],delete:["delete","remove"],sync:["sync","unsync"],subscribe:["unsubscribe","subscribe","subscribeOne"]};var o=n(128);Object.defineProperty(t,"asName",{enumerable:!0,get:function(){return o.asName}}),Object.defineProperty(t,"getTextPatch",{enumerable:!0,get:function(){return o.getTextPatch}}),Object.defineProperty(t,"isEmpty",{enumerable:!0,get:function(){return o.isEmpty}}),Object.defineProperty(t,"stableStringify",{enumerable:!0,get:function(){return o.stableStringify}}),Object.defineProperty(t,"unpatchText",{enumerable:!0,get:function(){return o.unpatchText}}),Object.defineProperty(t,"WAL",{enumerable:!0,get:function(){return o.WAL}}),Object.defineProperty(t,"get",{enumerable:!0,get:function(){return o.get}}),Object.defineProperty(t,"isDefined",{enumerable:!0,get:function(){return o.isDefined}}),Object.defineProperty(t,"isObject",{enumerable:!0,get:function(){return o.isObject}}),Object.defineProperty(t,"getKeys",{enumerable:!0,get:function(){return o.getKeys}}),r(n(444),t)},899:(e,t)=>{function n(e,t){var n=e[0],i=e[1],l=e[2],c=e[3];n=r(n,i,l,c,t[0],7,-680876936),c=r(c,n,i,l,t[1],12,-389564586),l=r(l,c,n,i,t[2],17,606105819),i=r(i,l,c,n,t[3],22,-1044525330),n=r(n,i,l,c,t[4],7,-176418897),c=r(c,n,i,l,t[5],12,1200080426),l=r(l,c,n,i,t[6],17,-1473231341),i=r(i,l,c,n,t[7],22,-45705983),n=r(n,i,l,c,t[8],7,1770035416),c=r(c,n,i,l,t[9],12,-1958414417),l=r(l,c,n,i,t[10],17,-42063),i=r(i,l,c,n,t[11],22,-1990404162),n=r(n,i,l,c,t[12],7,1804603682),c=r(c,n,i,l,t[13],12,-40341101),l=r(l,c,n,i,t[14],17,-1502002290),n=s(n,i=r(i,l,c,n,t[15],22,1236535329),l,c,t[1],5,-165796510),c=s(c,n,i,l,t[6],9,-1069501632),l=s(l,c,n,i,t[11],14,643717713),i=s(i,l,c,n,t[0],20,-373897302),n=s(n,i,l,c,t[5],5,-701558691),c=s(c,n,i,l,t[10],9,38016083),l=s(l,c,n,i,t[15],14,-660478335),i=s(i,l,c,n,t[4],20,-405537848),n=s(n,i,l,c,t[9],5,568446438),c=s(c,n,i,l,t[14],9,-1019803690),l=s(l,c,n,i,t[3],14,-187363961),i=s(i,l,c,n,t[8],20,1163531501),n=s(n,i,l,c,t[13],5,-1444681467),c=s(c,n,i,l,t[2],9,-51403784),l=s(l,c,n,i,t[7],14,1735328473),n=o(n,i=s(i,l,c,n,t[12],20,-1926607734),l,c,t[5],4,-378558),c=o(c,n,i,l,t[8],11,-2022574463),l=o(l,c,n,i,t[11],16,1839030562),i=o(i,l,c,n,t[14],23,-35309556),n=o(n,i,l,c,t[1],4,-1530992060),c=o(c,n,i,l,t[4],11,1272893353),l=o(l,c,n,i,t[7],16,-155497632),i=o(i,l,c,n,t[10],23,-1094730640),n=o(n,i,l,c,t[13],4,681279174),c=o(c,n,i,l,t[0],11,-358537222),l=o(l,c,n,i,t[3],16,-722521979),i=o(i,l,c,n,t[6],23,76029189),n=o(n,i,l,c,t[9],4,-640364487),c=o(c,n,i,l,t[12],11,-421815835),l=o(l,c,n,i,t[15],16,530742520),n=a(n,i=o(i,l,c,n,t[2],23,-995338651),l,c,t[0],6,-198630844),c=a(c,n,i,l,t[7],10,1126891415),l=a(l,c,n,i,t[14],15,-1416354905),i=a(i,l,c,n,t[5],21,-57434055),n=a(n,i,l,c,t[12],6,1700485571),c=a(c,n,i,l,t[3],10,-1894986606),l=a(l,c,n,i,t[10],15,-1051523),i=a(i,l,c,n,t[1],21,-2054922799),n=a(n,i,l,c,t[8],6,1873313359),c=a(c,n,i,l,t[15],10,-30611744),l=a(l,c,n,i,t[6],15,-1560198380),i=a(i,l,c,n,t[13],21,1309151649),n=a(n,i,l,c,t[4],6,-145523070),c=a(c,n,i,l,t[11],10,-1120210379),l=a(l,c,n,i,t[2],15,718787259),i=a(i,l,c,n,t[9],21,-343485551),e[0]=h(n,e[0]),e[1]=h(i,e[1]),e[2]=h(l,e[2]),e[3]=h(c,e[3])}function i(e,t,n,i,r,s){return t=h(h(t,e),h(i,s)),h(t<<r|t>>>32-r,n)}function r(e,t,n,r,s,o,a){return i(t&n|~t&r,e,t,s,o,a)}function s(e,t,n,r,s,o,a){return i(t&r|n&~r,e,t,s,o,a)}function o(e,t,n,r,s,o,a){return i(t^n^r,e,t,s,o,a)}function a(e,t,n,r,s,o,a){return i(n^(t|~r),e,t,s,o,a)}function l(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}Object.defineProperty(t,"__esModule",{value:!0}),t.md5=t.md5cycle=void 0,t.md5cycle=n;var c="0123456789abcdef".split("");function u(e){for(var t="",n=0;n<4;n++)t+=c[e>>8*n+4&15]+c[e>>8*n&15];return t}function d(e){return function(e){for(var t=0;t<e.length;t++)e[t]=u(e[t]);return e.join("")}(function(e){var t,i=e.length,r=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)n(r,l(e.substring(t-64,t)));e=e.substring(t-64);var s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)s[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(s[t>>2]|=128<<(t%4<<3),t>55)for(n(r,s),t=0;t<16;t++)s[t]=0;return s[14]=8*i,n(r,s),r}(e))}function h(e,t){return e+t&4294967295}t.md5=d,d("hello")},128:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getKeys=t.isDefined=t.isObject=t.get=t.isEmpty=t.WAL=t.unpatchText=t.getTextPatch=t.stableStringify=t.asName=void 0;const i=n(899);function r(e){for(var t in e)return!1;return!0}t.asName=function(e){if(null==e||!e.toString||!e.toString())throw"Expecting a non empty string";return`"${e.toString().replace(/"/g,'""')}"`},t.stableStringify=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n,i="boolean"==typeof t.cycles&&t.cycles,r=t.cmp&&(n=t.cmp,function(e){return function(t,i){var r={key:t,value:e[t]},s={key:i,value:e[i]};return n(r,s)}}),s=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var n,o;if(Array.isArray(t)){for(o="[",n=0;n<t.length;n++)n&&(o+=","),o+=e(t[n])||"null";return o+"]"}if(null===t)return"null";if(-1!==s.indexOf(t)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=s.push(t)-1,l=Object.keys(t).sort(r&&r(t));for(o="",n=0;n<l.length;n++){var c=l[n],u=e(t[c]);u&&(o&&(o+=","),o+=JSON.stringify(c)+":"+u)}return s.splice(a,1),"{"+o+"}"}}(e)},t.getTextPatch=function(e,t){if(!(e&&t&&e.trim().length&&t.trim().length))return t;if(e===t)return{from:0,to:0,text:"",md5:(0,i.md5)(t)};function n(n=1){let i=n<1?-1:0,r=!1;for(;!r&&Math.abs(i)<=t.length;){const s=n<1?[i]:[0,i];e.slice(...s)!==t.slice(...s)?r=!0:i+=1*Math.sign(n)}return i}let r=n()-1,s=e.length+n(-1)+1,o=t.length+n(-1)+1;return{from:r,to:s,text:t.slice(r,o),md5:(0,i.md5)(t)}},t.unpatchText=function(e,t){if(!t||"string"==typeof t)return t;const{from:n,to:r,text:s,md5:o}=t;if(null===s||null===e)return s;let a=e.slice(0,n)+s+e.slice(r);if(o&&(0,i.md5)(a)!==o)throw"Patch text error: Could not match md5 hash: (original/result) \n"+e+"\n"+a;return a},t.WAL=class{constructor(e){if(this.changed={},this.sending={},this.sentHistory={},this.callbacks=[],this.sort=(e,t)=>{const{orderBy:n}=this.options;return n&&e&&t&&n.map((n=>{if(!(n.fieldName in e)||!(n.fieldName in t))throw"Replication error: \n   some orderBy fields missing from data";let i=n.asc?e[n.fieldName]:t[n.fieldName],r=n.asc?t[n.fieldName]:e[n.fieldName],s=+i-+r,o=i<r?-1:i==r?0:1;return"number"===n.tsDataType&&Number.isFinite(s)?s:o})).find((e=>e))||0},this.isInHistory=e=>{if(!e)throw"Provide item";const t=e[this.options.synced_field];if(!Number.isFinite(+t))throw"Provided item Synced field value is missing/invalid ";const n=this.sentHistory[this.getIdStr(e)],i=n?.[this.options.synced_field];if(n){if(!Number.isFinite(+i))throw"Provided historic item Synced field value is missing/invalid";if(+i==+t)return!0}return!1},this.addData=e=>{r(this.changed)&&this.options.onSendStart&&this.options.onSendStart(),e.map((e=>{var t;const{initial:n,current:i}={...e};if(!i)throw"Expecting { current: object, initial?: object }";const r=this.getIdStr(i);this.changed??(this.changed={}),(t=this.changed)[r]??(t[r]={initial:n,current:i}),this.changed[r].current={...this.changed[r].current,...i}})),this.sendItems()},this.isOnSending=!1,this.isSendingTimeout=void 0,this.willDeleteHistory=void 0,this.sendItems=async()=>{const{DEBUG_MODE:e,onSend:t,onSendEnd:n,batch_size:i,throttle:s,historyAgeSeconds:o=2}=this.options;if(this.isSendingTimeout||this.sending&&!r(this.sending))return;if(!this.changed||r(this.changed))return;let a,l=[],c=[],u={};Object.keys(this.changed).sort(((e,t)=>this.sort(this.changed[e].current,this.changed[t].current))).slice(0,i).map((e=>{let t={...this.changed[e]};this.sending[e]={...t},c.push({...t}),u[e]={...t.current},delete this.changed[e]})),l=c.map((e=>e.current)),e&&console.log(this.options.id," SENDING lr->",l[l.length-1]),this.isSendingTimeout||(this.isSendingTimeout=setTimeout((()=>{this.isSendingTimeout=void 0,r(this.changed)||this.sendItems()}),s)),this.isOnSending=!0;try{await t(l,c),o&&(this.sentHistory={...this.sentHistory,...u},this.willDeleteHistory||(this.willDeleteHistory=setTimeout((()=>{this.willDeleteHistory=void 0,this.sentHistory={}}),1e3*o)))}catch(e){a=e,console.error("WAL onSend failed:",e,l,c)}if(this.isOnSending=!1,this.callbacks.length){const e=Object.keys(this.sending);this.callbacks.forEach(((t,n)=>{t.idStrs=t.idStrs.filter((t=>e.includes(t))),t.idStrs.length||t.cb(a)})),this.callbacks=this.callbacks.filter((e=>e.idStrs.length))}this.sending={},e&&console.log(this.options.id," SENT lr->",l[l.length-1]),r(this.changed)?n&&n(l,c,a):this.sendItems()},this.options={...e},!this.options.orderBy){const{synced_field:t,id_fields:n}=e;this.options.orderBy=[t,...n.sort()].map((e=>({fieldName:e,tsDataType:e===t?"number":"string",asc:!0})))}}isSending(){const e=this.isOnSending||!(r(this.sending)&&r(this.changed));return this.options.DEBUG_MODE&&console.log(this.options.id," CHECKING isSending ->",e),e}getIdStr(e){return this.options.id_fields.sort().map((t=>`${e[t]||""}`)).join(".")}getIdObj(e){let t={};return this.options.id_fields.sort().map((n=>{t[n]=e[n]})),t}getDeltaObj(e){let t={};return Object.keys(e).map((n=>{this.options.id_fields.includes(n)||(t[n]=e[n])})),t}},t.isEmpty=r,t.get=function(e,t){let n=t,i=e;return e?("string"==typeof n&&(n=n.split(".")),n.reduce(((e,t)=>e&&e[t]?e[t]:void 0),i)):e},t.isObject=function(e){return Boolean(e&&"object"==typeof e&&!Array.isArray(e))},t.isDefined=function(e){return null!=e},t.getKeys=function(e){return Object.keys(e)}}},t={};return function n(i){var r=t[i];if(void 0!==r)return r.exports;var s=t[i]={exports:{}};return e[i].call(s.exports,s,s.exports,n),s.exports}(590)})(),e.exports=t()},3577:(e,t,n)=>{"use strict";var i=n(7378),r=n(2525),s=n(1102);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!i)throw Error(o(227));function a(e,t,n,i,r,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(e){this.onError(e)}}var l=!1,c=null,u=!1,d=null,h={onError:function(e){l=!0,c=e}};function p(e,t,n,i,r,s,o,u,d){l=!1,c=null,a.apply(h,arguments)}var f=null,m=null,g=null;function y(e,t,n){var i=e.type||"unknown-event";e.currentTarget=g(n),function(e,t,n,i,r,s,a,h,f){if(p.apply(this,arguments),l){if(!l)throw Error(o(198));var m=c;l=!1,c=null,u||(u=!0,d=m)}}(i,t,void 0,e),e.currentTarget=null}var v=null,b={};function w(){if(v)for(var e in b){var t=b[e],n=v.indexOf(e);if(!(-1<n))throw Error(o(96,e));if(!_[n]){if(!t.extractEvents)throw Error(o(97,e));for(var i in _[n]=t,n=t.eventTypes){var r=void 0,s=n[i],a=t,l=i;if(E.hasOwnProperty(l))throw Error(o(99,l));E[l]=s;var c=s.phasedRegistrationNames;if(c){for(r in c)c.hasOwnProperty(r)&&x(c[r],a,l);r=!0}else s.registrationName?(x(s.registrationName,a,l),r=!0):r=!1;if(!r)throw Error(o(98,i,e))}}}}function x(e,t,n){if(S[e])throw Error(o(100,e));S[e]=t,C[e]=t.eventTypes[n].dependencies}var _=[],E={},S={},C={};function T(e){var t,n=!1;for(t in e)if(e.hasOwnProperty(t)){var i=e[t];if(!b.hasOwnProperty(t)||b[t]!==i){if(b[t])throw Error(o(102,t));b[t]=i,n=!0}}n&&w()}var A=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),k=null,N=null,M=null;function P(e){if(e=m(e)){if("function"!=typeof k)throw Error(o(280));var t=e.stateNode;t&&(t=f(t),k(e.stateNode,e.type,t))}}function L(e){N?M?M.push(e):M=[e]:N=e}function O(){if(N){var e=N,t=M;if(M=N=null,P(e),t)for(e=0;e<t.length;e++)P(t[e])}}function R(e,t){return e(t)}function I(e,t,n,i,r){return e(t,n,i,r)}function D(){}var F=R,B=!1,z=!1;function j(){null===N&&null===M||(D(),O())}function V(e,t,n){if(z)return e(t,n);z=!0;try{return F(e,t,n)}finally{z=!1,j()}}var U=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,H=Object.prototype.hasOwnProperty,$={},q={};function W(e,t,n,i,r,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=s}var G={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){G[e]=new W(e,0,!1,e,null,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];G[t]=new W(t,1,!1,e[1],null,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){G[e]=new W(e,2,!1,e.toLowerCase(),null,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){G[e]=new W(e,2,!1,e,null,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){G[e]=new W(e,3,!1,e.toLowerCase(),null,!1)})),["checked","multiple","muted","selected"].forEach((function(e){G[e]=new W(e,3,!0,e,null,!1)})),["capture","download"].forEach((function(e){G[e]=new W(e,4,!1,e,null,!1)})),["cols","rows","size","span"].forEach((function(e){G[e]=new W(e,6,!1,e,null,!1)})),["rowSpan","start"].forEach((function(e){G[e]=new W(e,5,!1,e.toLowerCase(),null,!1)}));var Y=/[\-:]([a-z])/g;function X(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(Y,X);G[t]=new W(t,1,!1,e,null,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(Y,X);G[t]=new W(t,1,!1,e,"http://www.w3.org/1999/xlink",!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(Y,X);G[t]=new W(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1)})),["tabIndex","crossOrigin"].forEach((function(e){G[e]=new W(e,1,!1,e.toLowerCase(),null,!1)})),G.xlinkHref=new W("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach((function(e){G[e]=new W(e,1,!1,e.toLowerCase(),null,!0)}));var K=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function Z(e,t,n,i){var r=G.hasOwnProperty(t)?G[t]:null;(null!==r?0===r.type:!i&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,n,i){if(null==t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!H.call(q,e)||!H.call($,e)&&(U.test(e)?q[e]=!0:($[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}K.hasOwnProperty("ReactCurrentDispatcher")||(K.ReactCurrentDispatcher={current:null}),K.hasOwnProperty("ReactCurrentBatchConfig")||(K.ReactCurrentBatchConfig={suspense:null});var J=/^(.*)[\\\/]/,Q="function"==typeof Symbol&&Symbol.for,ee=Q?Symbol.for("react.element"):60103,te=Q?Symbol.for("react.portal"):60106,ne=Q?Symbol.for("react.fragment"):60107,ie=Q?Symbol.for("react.strict_mode"):60108,re=Q?Symbol.for("react.profiler"):60114,se=Q?Symbol.for("react.provider"):60109,oe=Q?Symbol.for("react.context"):60110,ae=Q?Symbol.for("react.concurrent_mode"):60111,le=Q?Symbol.for("react.forward_ref"):60112,ce=Q?Symbol.for("react.suspense"):60113,ue=Q?Symbol.for("react.suspense_list"):60120,de=Q?Symbol.for("react.memo"):60115,he=Q?Symbol.for("react.lazy"):60116,pe=Q?Symbol.for("react.block"):60121,fe="function"==typeof Symbol&&Symbol.iterator;function me(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=fe&&e[fe]||e["@@iterator"])?e:null}function ge(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case ne:return"Fragment";case te:return"Portal";case re:return"Profiler";case ie:return"StrictMode";case ce:return"Suspense";case ue:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case oe:return"Context.Consumer";case se:return"Context.Provider";case le:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case de:return ge(e.type);case pe:return ge(e.render);case he:if(e=1===e._status?e._result:null)return ge(e)}return null}function ye(e){var t="";do{e:switch(e.tag){case 3:case 4:case 6:case 7:case 10:case 9:var n="";break e;default:var i=e._debugOwner,r=e._debugSource,s=ge(e.type);n=null,i&&(n=ge(i.type)),i=s,s="",r?s=" (at "+r.fileName.replace(J,"")+":"+r.lineNumber+")":n&&(s=" (created by "+n+")"),n="\n    in "+(i||"Unknown")+s}t+=n,e=e.return}while(e);return t}function ve(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function be(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function we(e){e._valueTracker||(e._valueTracker=function(e){var t=be(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var r=n.get,s=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function xe(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=be(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function _e(e,t){var n=t.checked;return r({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Ee(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=ve(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Se(e,t){null!=(t=t.checked)&&Z(e,"checked",t,!1)}function Ce(e,t){Se(e,t);var n=ve(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?Ae(e,t.type,n):t.hasOwnProperty("defaultValue")&&Ae(e,t.type,ve(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Te(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function Ae(e,t,n){"number"===t&&e.ownerDocument.activeElement===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function ke(e,t){return e=r({children:void 0},t),(t=function(e){var t="";return i.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function Ne(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+ve(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function Me(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return r({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Pe(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:ve(n)}}function Le(e,t){var n=ve(t.value),i=ve(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function Oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var Re="http://www.w3.org/1999/xhtml",Ie="http://www.w3.org/2000/svg";function De(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Fe(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?De(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var Be,ze,je=(ze=function(e,t){if(e.namespaceURI!==Ie||"innerHTML"in e)e.innerHTML=t;else{for((Be=Be||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Be.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction((function(){return ze(e,t)}))}:ze);function Ve(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}function Ue(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var He={animationend:Ue("Animation","AnimationEnd"),animationiteration:Ue("Animation","AnimationIteration"),animationstart:Ue("Animation","AnimationStart"),transitionend:Ue("Transition","TransitionEnd")},$e={},qe={};function We(e){if($e[e])return $e[e];if(!He[e])return e;var t,n=He[e];for(t in n)if(n.hasOwnProperty(t)&&t in qe)return $e[e]=n[t];return e}A&&(qe=document.createElement("div").style,"AnimationEvent"in window||(delete He.animationend.animation,delete He.animationiteration.animation,delete He.animationstart.animation),"TransitionEvent"in window||delete He.transitionend.transition);var Ge=We("animationend"),Ye=We("animationiteration"),Xe=We("animationstart"),Ke=We("transitionend"),Ze="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Je=new("function"==typeof WeakMap?WeakMap:Map);function Qe(e){var t=Je.get(e);return void 0===t&&(t=new Map,Je.set(e,t)),t}function et(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!=(1026&(t=e).effectTag)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function tt(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function nt(e){if(et(e)!==e)throw Error(o(188))}function it(e){if(e=function(e){var t=e.alternate;if(!t){if(null===(t=et(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var s=r.alternate;if(null===s){if(null!==(i=r.return)){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return nt(r),e;if(s===i)return nt(r),t;s=s.sibling}throw Error(o(188))}if(n.return!==i.return)n=r,i=s;else{for(var a=!1,l=r.child;l;){if(l===n){a=!0,n=r,i=s;break}if(l===i){a=!0,i=r,n=s;break}l=l.sibling}if(!a){for(l=s.child;l;){if(l===n){a=!0,n=s,i=r;break}if(l===i){a=!0,i=s,n=r;break}l=l.sibling}if(!a)throw Error(o(189))}}if(n.alternate!==i)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e),!e)return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function rt(e,t){if(null==t)throw Error(o(30));return null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function st(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)}var ot=null;function at(e){if(e){var t=e._dispatchListeners,n=e._dispatchInstances;if(Array.isArray(t))for(var i=0;i<t.length&&!e.isPropagationStopped();i++)y(e,t[i],n[i]);else t&&y(e,t,n);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}function lt(e){if(null!==e&&(ot=rt(ot,e)),e=ot,ot=null,e){if(st(e,at),ot)throw Error(o(95));if(u)throw e=d,u=!1,d=null,e}}function ct(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}function ut(e){if(!A)return!1;var t=(e="on"+e)in document;return t||((t=document.createElement("div")).setAttribute(e,"return;"),t="function"==typeof t[e]),t}var dt=[];function ht(e){e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,10>dt.length&&dt.push(e)}function pt(e,t,n,i){if(dt.length){var r=dt.pop();return r.topLevelType=e,r.eventSystemFlags=i,r.nativeEvent=t,r.targetInst=n,r}return{topLevelType:e,eventSystemFlags:i,nativeEvent:t,targetInst:n,ancestors:[]}}function ft(e){var t=e.targetInst,n=t;do{if(!n){e.ancestors.push(n);break}var i=n;if(3===i.tag)i=i.stateNode.containerInfo;else{for(;i.return;)i=i.return;i=3!==i.tag?null:i.stateNode.containerInfo}if(!i)break;5!==(t=n.tag)&&6!==t||e.ancestors.push(n),n=Pn(i)}while(n);for(n=0;n<e.ancestors.length;n++){t=e.ancestors[n];var r=ct(e.nativeEvent);i=e.topLevelType;var s=e.nativeEvent,o=e.eventSystemFlags;0===n&&(o|=64);for(var a=null,l=0;l<_.length;l++){var c=_[l];c&&(c=c.extractEvents(i,t,s,r,o))&&(a=rt(a,c))}lt(a)}}function mt(e,t,n){if(!n.has(e)){switch(e){case"scroll":Xt(t,"scroll",!0);break;case"focus":case"blur":Xt(t,"focus",!0),Xt(t,"blur",!0),n.set("blur",null),n.set("focus",null);break;case"cancel":case"close":ut(e)&&Xt(t,e,!0);break;case"invalid":case"submit":case"reset":break;default:-1===Ze.indexOf(e)&&Yt(e,t)}n.set(e,null)}}var gt,yt,vt,bt=!1,wt=[],xt=null,_t=null,Et=null,St=new Map,Ct=new Map,Tt=[],At="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),kt="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function Nt(e,t,n,i,r){return{blockedOn:e,topLevelType:t,eventSystemFlags:32|n,nativeEvent:r,container:i}}function Mt(e,t){switch(e){case"focus":case"blur":xt=null;break;case"dragenter":case"dragleave":_t=null;break;case"mouseover":case"mouseout":Et=null;break;case"pointerover":case"pointerout":St.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ct.delete(t.pointerId)}}function Pt(e,t,n,i,r,s){return null===e||e.nativeEvent!==s?(e=Nt(t,n,i,r,s),null!==t&&(null!==(t=Ln(t))&&yt(t)),e):(e.eventSystemFlags|=i,e)}function Lt(e){var t=Pn(e.target);if(null!==t){var n=et(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=tt(n)))return e.blockedOn=t,void s.unstable_runWithPriority(e.priority,(function(){vt(n)}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ot(e){if(null!==e.blockedOn)return!1;var t=Qt(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);if(null!==t){var n=Ln(t);return null!==n&&yt(n),e.blockedOn=t,!1}return!0}function Rt(e,t,n){Ot(e)&&n.delete(t)}function It(){for(bt=!1;0<wt.length;){var e=wt[0];if(null!==e.blockedOn){null!==(e=Ln(e.blockedOn))&&gt(e);break}var t=Qt(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);null!==t?e.blockedOn=t:wt.shift()}null!==xt&&Ot(xt)&&(xt=null),null!==_t&&Ot(_t)&&(_t=null),null!==Et&&Ot(Et)&&(Et=null),St.forEach(Rt),Ct.forEach(Rt)}function Dt(e,t){e.blockedOn===t&&(e.blockedOn=null,bt||(bt=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,It)))}function Ft(e){function t(t){return Dt(t,e)}if(0<wt.length){Dt(wt[0],e);for(var n=1;n<wt.length;n++){var i=wt[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==xt&&Dt(xt,e),null!==_t&&Dt(_t,e),null!==Et&&Dt(Et,e),St.forEach(t),Ct.forEach(t),n=0;n<Tt.length;n++)(i=Tt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<Tt.length&&null===(n=Tt[0]).blockedOn;)Lt(n),null===n.blockedOn&&Tt.shift()}var Bt={},zt=new Map,jt=new Map,Vt=["abort","abort",Ge,"animationEnd",Ye,"animationIteration",Xe,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Ke,"transitionEnd","waiting","waiting"];function Ut(e,t){for(var n=0;n<e.length;n+=2){var i=e[n],r=e[n+1],s="on"+(r[0].toUpperCase()+r.slice(1));s={phasedRegistrationNames:{bubbled:s,captured:s+"Capture"},dependencies:[i],eventPriority:t},jt.set(i,t),zt.set(i,s),Bt[r]=s}}Ut("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Ut("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Ut(Vt,2);for(var Ht="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),$t=0;$t<Ht.length;$t++)jt.set(Ht[$t],0);var qt=s.unstable_UserBlockingPriority,Wt=s.unstable_runWithPriority,Gt=!0;function Yt(e,t){Xt(t,e,!1)}function Xt(e,t,n){var i=jt.get(t);switch(void 0===i?2:i){case 0:i=Kt.bind(null,t,1,e);break;case 1:i=Zt.bind(null,t,1,e);break;default:i=Jt.bind(null,t,1,e)}n?e.addEventListener(t,i,!0):e.addEventListener(t,i,!1)}function Kt(e,t,n,i){B||D();var r=Jt,s=B;B=!0;try{I(r,e,t,n,i)}finally{(B=s)||j()}}function Zt(e,t,n,i){Wt(qt,Jt.bind(null,e,t,n,i))}function Jt(e,t,n,i){if(Gt)if(0<wt.length&&-1<At.indexOf(e))e=Nt(null,e,t,n,i),wt.push(e);else{var r=Qt(e,t,n,i);if(null===r)Mt(e,i);else if(-1<At.indexOf(e))e=Nt(r,e,t,n,i),wt.push(e);else if(!function(e,t,n,i,r){switch(t){case"focus":return xt=Pt(xt,e,t,n,i,r),!0;case"dragenter":return _t=Pt(_t,e,t,n,i,r),!0;case"mouseover":return Et=Pt(Et,e,t,n,i,r),!0;case"pointerover":var s=r.pointerId;return St.set(s,Pt(St.get(s)||null,e,t,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,Ct.set(s,Pt(Ct.get(s)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i)){Mt(e,i),e=pt(e,i,null,t);try{V(ft,e)}finally{ht(e)}}}}function Qt(e,t,n,i){if(null!==(n=Pn(n=ct(i)))){var r=et(n);if(null===r)n=null;else{var s=r.tag;if(13===s){if(null!==(n=tt(r)))return n;n=null}else if(3===s){if(r.stateNode.hydrate)return 3===r.tag?r.stateNode.containerInfo:null;n=null}else r!==n&&(n=null)}}e=pt(e,i,n,t);try{V(ft,e)}finally{ht(e)}return null}var en={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},tn=["Webkit","ms","Moz","O"];function nn(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||en.hasOwnProperty(e)&&en[e]?(""+t).trim():t+"px"}function rn(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=nn(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(en).forEach((function(e){tn.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),en[t]=en[e]}))}));var sn=r({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function on(e,t){if(t){if(sn[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e,""));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(o(62,""))}}function an(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ln=Re;function cn(e,t){var n=Qe(e=9===e.nodeType||11===e.nodeType?e:e.ownerDocument);t=C[t];for(var i=0;i<t.length;i++)mt(t[i],e,n)}function un(){}function dn(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function hn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function pn(e,t){var n,i=hn(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=hn(i)}}function fn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?fn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function mn(){for(var e=window,t=dn();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=dn((e=t.contentWindow).document)}return t}function gn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var yn="$?",vn="$!",bn=null,wn=null;function xn(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function _n(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var En="function"==typeof setTimeout?setTimeout:void 0,Sn="function"==typeof clearTimeout?clearTimeout:void 0;function Cn(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function Tn(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||n===vn||n===yn){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var An=Math.random().toString(36).slice(2),kn="__reactInternalInstance$"+An,Nn="__reactEventHandlers$"+An,Mn="__reactContainere$"+An;function Pn(e){var t=e[kn];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Mn]||n[kn]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=Tn(e);null!==e;){if(n=e[kn])return n;e=Tn(e)}return t}n=(e=n).parentNode}return null}function Ln(e){return!(e=e[kn]||e[Mn])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function On(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function Rn(e){return e[Nn]||null}function In(e){do{e=e.return}while(e&&5!==e.tag);return e||null}function Dn(e,t){var n=e.stateNode;if(!n)return null;var i=f(n);if(!i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(o(231,t,typeof n));return n}function Fn(e,t,n){(t=Dn(e,n.dispatchConfig.phasedRegistrationNames[t]))&&(n._dispatchListeners=rt(n._dispatchListeners,t),n._dispatchInstances=rt(n._dispatchInstances,e))}function Bn(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,n=[];t;)n.push(t),t=In(t);for(t=n.length;0<t--;)Fn(n[t],"captured",e);for(t=0;t<n.length;t++)Fn(n[t],"bubbled",e)}}function zn(e,t,n){e&&n&&n.dispatchConfig.registrationName&&(t=Dn(e,n.dispatchConfig.registrationName))&&(n._dispatchListeners=rt(n._dispatchListeners,t),n._dispatchInstances=rt(n._dispatchInstances,e))}function jn(e){e&&e.dispatchConfig.registrationName&&zn(e._targetInst,null,e)}function Vn(e){st(e,Bn)}var Un=null,Hn=null,$n=null;function qn(){if($n)return $n;var e,t,n=Hn,i=n.length,r="value"in Un?Un.value:Un.textContent,s=r.length;for(e=0;e<i&&n[e]===r[e];e++);var o=i-e;for(t=1;t<=o&&n[i-t]===r[s-t];t++);return $n=r.slice(e,1<t?1-t:void 0)}function Wn(){return!0}function Gn(){return!1}function Yn(e,t,n,i){for(var r in this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=n,e=this.constructor.Interface)e.hasOwnProperty(r)&&((t=e[r])?this[r]=t(n):"target"===r?this.target=i:this[r]=n[r]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?Wn:Gn,this.isPropagationStopped=Gn,this}function Xn(e,t,n,i){if(this.eventPool.length){var r=this.eventPool.pop();return this.call(r,e,t,n,i),r}return new this(e,t,n,i)}function Kn(e){if(!(e instanceof this))throw Error(o(279));e.destructor(),10>this.eventPool.length&&this.eventPool.push(e)}function Zn(e){e.eventPool=[],e.getPooled=Xn,e.release=Kn}r(Yn.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Wn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Wn)},persist:function(){this.isPersistent=Wn},isPersistent:Gn,destructor:function(){var e,t=this.constructor.Interface;for(e in t)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=Gn,this._dispatchInstances=this._dispatchListeners=null}}),Yn.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},Yn.extend=function(e){function t(){}function n(){return i.apply(this,arguments)}var i=this;t.prototype=i.prototype;var s=new t;return r(s,n.prototype),n.prototype=s,n.prototype.constructor=n,n.Interface=r({},i.Interface,e),n.extend=i.extend,Zn(n),n},Zn(Yn);var Jn=Yn.extend({data:null}),Qn=Yn.extend({data:null}),ei=[9,13,27,32],ti=A&&"CompositionEvent"in window,ni=null;A&&"documentMode"in document&&(ni=document.documentMode);var ii=A&&"TextEvent"in window&&!ni,ri=A&&(!ti||ni&&8<ni&&11>=ni),si=String.fromCharCode(32),oi={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},ai=!1;function li(e,t){switch(e){case"keyup":return-1!==ei.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function ci(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var ui=!1;var di={eventTypes:oi,extractEvents:function(e,t,n,i){var r;if(ti)e:{switch(e){case"compositionstart":var s=oi.compositionStart;break e;case"compositionend":s=oi.compositionEnd;break e;case"compositionupdate":s=oi.compositionUpdate;break e}s=void 0}else ui?li(e,n)&&(s=oi.compositionEnd):"keydown"===e&&229===n.keyCode&&(s=oi.compositionStart);return s?(ri&&"ko"!==n.locale&&(ui||s!==oi.compositionStart?s===oi.compositionEnd&&ui&&(r=qn()):(Hn="value"in(Un=i)?Un.value:Un.textContent,ui=!0)),s=Jn.getPooled(s,t,n,i),r?s.data=r:null!==(r=ci(n))&&(s.data=r),Vn(s),r=s):r=null,(e=ii?function(e,t){switch(e){case"compositionend":return ci(t);case"keypress":return 32!==t.which?null:(ai=!0,si);case"textInput":return(e=t.data)===si&&ai?null:e;default:return null}}(e,n):function(e,t){if(ui)return"compositionend"===e||!ti&&li(e,t)?(e=qn(),$n=Hn=Un=null,ui=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return ri&&"ko"!==t.locale?null:t.data}}(e,n))?((t=Qn.getPooled(oi.beforeInput,t,n,i)).data=e,Vn(t)):t=null,null===r?t:null===t?r:[r,t]}},hi={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!hi[e.type]:"textarea"===t}var fi={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function mi(e,t,n){return(e=Yn.getPooled(fi.change,e,t,n)).type="change",L(n),Vn(e),e}var gi=null,yi=null;function vi(e){lt(e)}function bi(e){if(xe(On(e)))return e}function wi(e,t){if("change"===e)return t}var xi=!1;function _i(){gi&&(gi.detachEvent("onpropertychange",Ei),yi=gi=null)}function Ei(e){if("value"===e.propertyName&&bi(yi))if(e=mi(yi,e,ct(e)),B)lt(e);else{B=!0;try{R(vi,e)}finally{B=!1,j()}}}function Si(e,t,n){"focus"===e?(_i(),yi=n,(gi=t).attachEvent("onpropertychange",Ei)):"blur"===e&&_i()}function Ci(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return bi(yi)}function Ti(e,t){if("click"===e)return bi(t)}function Ai(e,t){if("input"===e||"change"===e)return bi(t)}A&&(xi=ut("input")&&(!document.documentMode||9<document.documentMode));var ki={eventTypes:fi,_isInputEventSupported:xi,extractEvents:function(e,t,n,i){var r=t?On(t):window,s=r.nodeName&&r.nodeName.toLowerCase();if("select"===s||"input"===s&&"file"===r.type)var o=wi;else if(pi(r))if(xi)o=Ai;else{o=Ci;var a=Si}else(s=r.nodeName)&&"input"===s.toLowerCase()&&("checkbox"===r.type||"radio"===r.type)&&(o=Ti);if(o&&(o=o(e,t)))return mi(o,n,i);a&&a(e,r,t),"blur"===e&&(e=r._wrapperState)&&e.controlled&&"number"===r.type&&Ae(r,"number",r.value)}},Ni=Yn.extend({view:null,detail:null}),Mi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pi(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Mi[e])&&!!t[e]}function Li(){return Pi}var Oi=0,Ri=0,Ii=!1,Di=!1,Fi=Ni.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Li,button:null,buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function(e){if("movementX"in e)return e.movementX;var t=Oi;return Oi=e.screenX,Ii?"mousemove"===e.type?e.screenX-t:0:(Ii=!0,0)},movementY:function(e){if("movementY"in e)return e.movementY;var t=Ri;return Ri=e.screenY,Di?"mousemove"===e.type?e.screenY-t:0:(Di=!0,0)}}),Bi=Fi.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),zi={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},ji={eventTypes:zi,extractEvents:function(e,t,n,i,r){var s="mouseover"===e||"pointerover"===e,o="mouseout"===e||"pointerout"===e;if(s&&0==(32&r)&&(n.relatedTarget||n.fromElement)||!o&&!s)return null;(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,o)?(o=t,null!==(t=(t=n.relatedTarget||n.toElement)?Pn(t):null)&&(t!==et(t)||5!==t.tag&&6!==t.tag)&&(t=null)):o=null;if(o===t)return null;if("mouseout"===e||"mouseover"===e)var a=Fi,l=zi.mouseLeave,c=zi.mouseEnter,u="mouse";else"pointerout"!==e&&"pointerover"!==e||(a=Bi,l=zi.pointerLeave,c=zi.pointerEnter,u="pointer");if(e=null==o?s:On(o),s=null==t?s:On(t),(l=a.getPooled(l,o,n,i)).type=u+"leave",l.target=e,l.relatedTarget=s,(n=a.getPooled(c,t,n,i)).type=u+"enter",n.target=s,n.relatedTarget=e,u=t,(i=o)&&u)e:{for(c=u,o=0,e=a=i;e;e=In(e))o++;for(e=0,t=c;t;t=In(t))e++;for(;0<o-e;)a=In(a),o--;for(;0<e-o;)c=In(c),e--;for(;o--;){if(a===c||a===c.alternate)break e;a=In(a),c=In(c)}a=null}else a=null;for(c=a,a=[];i&&i!==c&&(null===(o=i.alternate)||o!==c);)a.push(i),i=In(i);for(i=[];u&&u!==c&&(null===(o=u.alternate)||o!==c);)i.push(u),u=In(u);for(u=0;u<a.length;u++)zn(a[u],"bubbled",l);for(u=i.length;0<u--;)zn(i[u],"captured",n);return 0==(64&r)?[l]:[l,n]}};var Vi="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},Ui=Object.prototype.hasOwnProperty;function Hi(e,t){if(Vi(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++)if(!Ui.call(t,n[i])||!Vi(e[n[i]],t[n[i]]))return!1;return!0}var $i=A&&"documentMode"in document&&11>=document.documentMode,qi={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},Wi=null,Gi=null,Yi=null,Xi=!1;function Ki(e,t){var n=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;return Xi||null==Wi||Wi!==dn(n)?null:("selectionStart"in(n=Wi)&&gn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},Yi&&Hi(Yi,n)?null:(Yi=n,(e=Yn.getPooled(qi.select,Gi,e,t)).type="select",e.target=Wi,Vn(e),e))}var Zi={eventTypes:qi,extractEvents:function(e,t,n,i,r,s){if(!(s=!(r=s||(i.window===i?i.document:9===i.nodeType?i:i.ownerDocument)))){e:{r=Qe(r),s=C.onSelect;for(var o=0;o<s.length;o++)if(!r.has(s[o])){r=!1;break e}r=!0}s=!r}if(s)return null;switch(r=t?On(t):window,e){case"focus":(pi(r)||"true"===r.contentEditable)&&(Wi=r,Gi=t,Yi=null);break;case"blur":Yi=Gi=Wi=null;break;case"mousedown":Xi=!0;break;case"contextmenu":case"mouseup":case"dragend":return Xi=!1,Ki(n,i);case"selectionchange":if($i)break;case"keydown":case"keyup":return Ki(n,i)}return null}},Ji=Yn.extend({animationName:null,elapsedTime:null,pseudoElement:null}),Qi=Yn.extend({clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),er=Ni.extend({relatedTarget:null});function tr(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}var nr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ir={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rr=Ni.extend({key:function(e){if(e.key){var t=nr[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tr(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?ir[e.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Li,charCode:function(e){return"keypress"===e.type?tr(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tr(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),sr=Fi.extend({dataTransfer:null}),or=Ni.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Li}),ar=Yn.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),lr=Fi.extend({deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),cr={eventTypes:Bt,extractEvents:function(e,t,n,i){var r=zt.get(e);if(!r)return null;switch(e){case"keypress":if(0===tr(n))return null;case"keydown":case"keyup":e=rr;break;case"blur":case"focus":e=er;break;case"click":if(2===n.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":e=Fi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":e=sr;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":e=or;break;case Ge:case Ye:case Xe:e=Ji;break;case Ke:e=ar;break;case"scroll":e=Ni;break;case"wheel":e=lr;break;case"copy":case"cut":case"paste":e=Qi;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":e=Bi;break;default:e=Yn}return Vn(t=e.getPooled(r,t,n,i)),t}};if(v)throw Error(o(101));v=Array.prototype.slice.call("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),w(),f=Rn,m=Ln,g=On,T({SimpleEventPlugin:cr,EnterLeaveEventPlugin:ji,ChangeEventPlugin:ki,SelectEventPlugin:Zi,BeforeInputEventPlugin:di});var ur=[],dr=-1;function hr(e){0>dr||(e.current=ur[dr],ur[dr]=null,dr--)}function pr(e,t){dr++,ur[dr]=e.current,e.current=t}var fr={},mr={current:fr},gr={current:!1},yr=fr;function vr(e,t){var n=e.type.contextTypes;if(!n)return fr;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,s={};for(r in n)s[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function br(e){return null!=(e=e.childContextTypes)}function wr(){hr(gr),hr(mr)}function xr(e,t,n){if(mr.current!==fr)throw Error(o(168));pr(mr,t),pr(gr,n)}function _r(e,t,n){var i=e.stateNode;if(e=t.childContextTypes,"function"!=typeof i.getChildContext)return n;for(var s in i=i.getChildContext())if(!(s in e))throw Error(o(108,ge(t)||"Unknown",s));return r({},n,{},i)}function Er(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||fr,yr=mr.current,pr(mr,e),pr(gr,gr.current),!0}function Sr(e,t,n){var i=e.stateNode;if(!i)throw Error(o(169));n?(e=_r(e,t,yr),i.__reactInternalMemoizedMergedChildContext=e,hr(gr),hr(mr),pr(mr,e)):hr(gr),pr(gr,n)}var Cr=s.unstable_runWithPriority,Tr=s.unstable_scheduleCallback,Ar=s.unstable_cancelCallback,kr=s.unstable_requestPaint,Nr=s.unstable_now,Mr=s.unstable_getCurrentPriorityLevel,Pr=s.unstable_ImmediatePriority,Lr=s.unstable_UserBlockingPriority,Or=s.unstable_NormalPriority,Rr=s.unstable_LowPriority,Ir=s.unstable_IdlePriority,Dr={},Fr=s.unstable_shouldYield,Br=void 0!==kr?kr:function(){},zr=null,jr=null,Vr=!1,Ur=Nr(),Hr=1e4>Ur?Nr:function(){return Nr()-Ur};function $r(){switch(Mr()){case Pr:return 99;case Lr:return 98;case Or:return 97;case Rr:return 96;case Ir:return 95;default:throw Error(o(332))}}function qr(e){switch(e){case 99:return Pr;case 98:return Lr;case 97:return Or;case 96:return Rr;case 95:return Ir;default:throw Error(o(332))}}function Wr(e,t){return e=qr(e),Cr(e,t)}function Gr(e,t,n){return e=qr(e),Tr(e,t,n)}function Yr(e){return null===zr?(zr=[e],jr=Tr(Pr,Kr)):zr.push(e),Dr}function Xr(){if(null!==jr){var e=jr;jr=null,Ar(e)}Kr()}function Kr(){if(!Vr&&null!==zr){Vr=!0;var e=0;try{var t=zr;Wr(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),zr=null}catch(t){throw null!==zr&&(zr=zr.slice(e+1)),Tr(Pr,Xr),t}finally{Vr=!1}}}function Zr(e,t,n){return 1073741821-(1+((1073741821-e+t/10)/(n/=10)|0))*n}function Jr(e,t){if(e&&e.defaultProps)for(var n in t=r({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}var Qr={current:null},es=null,ts=null,ns=null;function is(){ns=ts=es=null}function rs(e){var t=Qr.current;hr(Qr),e.type._context._currentValue=t}function ss(e,t){for(;null!==e;){var n=e.alternate;if(e.childExpirationTime<t)e.childExpirationTime=t,null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t);else{if(!(null!==n&&n.childExpirationTime<t))break;n.childExpirationTime=t}e=e.return}}function os(e,t){es=e,ns=ts=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(e.expirationTime>=t&&(Ro=!0),e.firstContext=null)}function as(e,t){if(ns!==e&&!1!==t&&0!==t)if("number"==typeof t&&1073741823!==t||(ns=e,t=1073741823),t={context:e,observedBits:t,next:null},null===ts){if(null===es)throw Error(o(308));ts=t,es.dependencies={expirationTime:0,firstContext:t,responders:null}}else ts=ts.next=t;return e._currentValue}var ls=!1;function cs(e){e.updateQueue={baseState:e.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function us(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,baseQueue:e.baseQueue,shared:e.shared,effects:e.effects})}function ds(e,t){return(e={expirationTime:e,suspenseConfig:t,tag:0,payload:null,callback:null,next:null}).next=e}function hs(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function ps(e,t){var n=e.alternate;null!==n&&us(n,e),null===(n=(e=e.updateQueue).baseQueue)?(e.baseQueue=t.next=t,t.next=t):(t.next=n.next,n.next=t)}function fs(e,t,n,i){var s=e.updateQueue;ls=!1;var o=s.baseQueue,a=s.shared.pending;if(null!==a){if(null!==o){var l=o.next;o.next=a.next,a.next=l}o=a,s.shared.pending=null,null!==(l=e.alternate)&&(null!==(l=l.updateQueue)&&(l.baseQueue=a))}if(null!==o){l=o.next;var c=s.baseState,u=0,d=null,h=null,p=null;if(null!==l)for(var f=l;;){if((a=f.expirationTime)<i){var m={expirationTime:f.expirationTime,suspenseConfig:f.suspenseConfig,tag:f.tag,payload:f.payload,callback:f.callback,next:null};null===p?(h=p=m,d=c):p=p.next=m,a>u&&(u=a)}else{null!==p&&(p=p.next={expirationTime:1073741823,suspenseConfig:f.suspenseConfig,tag:f.tag,payload:f.payload,callback:f.callback,next:null}),pl(a,f.suspenseConfig);e:{var g=e,y=f;switch(a=t,m=n,y.tag){case 1:if("function"==typeof(g=y.payload)){c=g.call(m,c,a);break e}c=g;break e;case 3:g.effectTag=-4097&g.effectTag|64;case 0:if(null==(a="function"==typeof(g=y.payload)?g.call(m,c,a):g))break e;c=r({},c,a);break e;case 2:ls=!0}}null!==f.callback&&(e.effectTag|=32,null===(a=s.effects)?s.effects=[f]:a.push(f))}if(null===(f=f.next)||f===l){if(null===(a=s.shared.pending))break;f=o.next=a.next,a.next=l,s.baseQueue=o=a,s.shared.pending=null}}null===p?d=c:p.next=h,s.baseState=d,s.baseQueue=p,fl(u),e.expirationTime=u,e.memoizedState=c}}function ms(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=r,r=n,"function"!=typeof i)throw Error(o(191,i));i.call(r)}}}var gs=K.ReactCurrentBatchConfig,ys=(new i.Component).refs;function vs(e,t,n,i){n=null==(n=n(i,t=e.memoizedState))?t:r({},t,n),e.memoizedState=n,0===e.expirationTime&&(e.updateQueue.baseState=n)}var bs={isMounted:function(e){return!!(e=e._reactInternalFiber)&&et(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternalFiber;var i=el(),r=gs.suspense;(r=ds(i=tl(i,e,r),r)).payload=t,null!=n&&(r.callback=n),hs(e,r),nl(e,i)},enqueueReplaceState:function(e,t,n){e=e._reactInternalFiber;var i=el(),r=gs.suspense;(r=ds(i=tl(i,e,r),r)).tag=1,r.payload=t,null!=n&&(r.callback=n),hs(e,r),nl(e,i)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var n=el(),i=gs.suspense;(i=ds(n=tl(n,e,i),i)).tag=2,null!=t&&(i.callback=t),hs(e,i),nl(e,n)}};function ws(e,t,n,i,r,s,o){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,s,o):!t.prototype||!t.prototype.isPureReactComponent||(!Hi(n,i)||!Hi(r,s))}function xs(e,t,n){var i=!1,r=fr,s=t.contextType;return"object"==typeof s&&null!==s?s=as(s):(r=br(t)?yr:mr.current,s=(i=null!=(i=t.contextTypes))?vr(e,r):fr),t=new t(n,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=bs,e.stateNode=t,t._reactInternalFiber=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=s),t}function _s(e,t,n,i){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&bs.enqueueReplaceState(t,t.state,null)}function Es(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs=ys,cs(e);var s=t.contextType;"object"==typeof s&&null!==s?r.context=as(s):(s=br(t)?yr:mr.current,r.context=vr(e,s)),fs(e,n,r,i),r.state=e.memoizedState,"function"==typeof(s=t.getDerivedStateFromProps)&&(vs(e,t,s,n),r.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof r.getSnapshotBeforeUpdate||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||(t=r.state,"function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&bs.enqueueReplaceState(r,r.state,null),fs(e,n,r,i),r.state=e.memoizedState),"function"==typeof r.componentDidMount&&(e.effectTag|=4)}var Ss=Array.isArray;function Cs(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var i=n.stateNode}if(!i)throw Error(o(147,e));var r=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===r?t.ref:(t=function(e){var t=i.refs;t===ys&&(t=i.refs={}),null===e?delete t[r]:t[r]=e},t._stringRef=r,t)}if("string"!=typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function Ts(e,t){if("textarea"!==e.type)throw Error(o(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t,""))}function As(e){function t(t,n){if(e){var i=t.lastEffect;null!==i?(i.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.effectTag=8}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Rl(e,t)).index=0,e.sibling=null,e}function s(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.effectTag=2,n):i:(t.effectTag=2,n):n}function a(t){return e&&null===t.alternate&&(t.effectTag=2),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=Fl(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function c(e,t,n,i){return null!==t&&t.elementType===n.type?((i=r(t,n.props)).ref=Cs(e,t,n),i.return=e,i):((i=Il(n.type,n.key,n.props,null,e.mode,i)).ref=Cs(e,t,n),i.return=e,i)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Bl(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function d(e,t,n,i,s){return null===t||7!==t.tag?((t=Dl(n,e.mode,i,s)).return=e,t):((t=r(t,n)).return=e,t)}function h(e,t,n){if("string"==typeof t||"number"==typeof t)return(t=Fl(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case ee:return(n=Il(t.type,t.key,t.props,null,e.mode,n)).ref=Cs(e,null,t),n.return=e,n;case te:return(t=Bl(t,e.mode,n)).return=e,t}if(Ss(t)||me(t))return(t=Dl(t,e.mode,n,null)).return=e,t;Ts(e,t)}return null}function p(e,t,n,i){var r=null!==t?t.key:null;if("string"==typeof n||"number"==typeof n)return null!==r?null:l(e,t,""+n,i);if("object"==typeof n&&null!==n){switch(n.$$typeof){case ee:return n.key===r?n.type===ne?d(e,t,n.props.children,i,r):c(e,t,n,i):null;case te:return n.key===r?u(e,t,n,i):null}if(Ss(n)||me(n))return null!==r?null:d(e,t,n,i,null);Ts(e,n)}return null}function f(e,t,n,i,r){if("string"==typeof i||"number"==typeof i)return l(t,e=e.get(n)||null,""+i,r);if("object"==typeof i&&null!==i){switch(i.$$typeof){case ee:return e=e.get(null===i.key?n:i.key)||null,i.type===ne?d(t,e,i.props.children,r,i.key):c(t,e,i,r);case te:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r)}if(Ss(i)||me(i))return d(t,e=e.get(n)||null,i,r,null);Ts(t,i)}return null}function m(r,o,a,l){for(var c=null,u=null,d=o,m=o=0,g=null;null!==d&&m<a.length;m++){d.index>m?(g=d,d=null):g=d.sibling;var y=p(r,d,a[m],l);if(null===y){null===d&&(d=g);break}e&&d&&null===y.alternate&&t(r,d),o=s(y,o,m),null===u?c=y:u.sibling=y,u=y,d=g}if(m===a.length)return n(r,d),c;if(null===d){for(;m<a.length;m++)null!==(d=h(r,a[m],l))&&(o=s(d,o,m),null===u?c=d:u.sibling=d,u=d);return c}for(d=i(r,d);m<a.length;m++)null!==(g=f(d,r,m,a[m],l))&&(e&&null!==g.alternate&&d.delete(null===g.key?m:g.key),o=s(g,o,m),null===u?c=g:u.sibling=g,u=g);return e&&d.forEach((function(e){return t(r,e)})),c}function g(r,a,l,c){var u=me(l);if("function"!=typeof u)throw Error(o(150));if(null==(l=u.call(l)))throw Error(o(151));for(var d=u=null,m=a,g=a=0,y=null,v=l.next();null!==m&&!v.done;g++,v=l.next()){m.index>g?(y=m,m=null):y=m.sibling;var b=p(r,m,v.value,c);if(null===b){null===m&&(m=y);break}e&&m&&null===b.alternate&&t(r,m),a=s(b,a,g),null===d?u=b:d.sibling=b,d=b,m=y}if(v.done)return n(r,m),u;if(null===m){for(;!v.done;g++,v=l.next())null!==(v=h(r,v.value,c))&&(a=s(v,a,g),null===d?u=v:d.sibling=v,d=v);return u}for(m=i(r,m);!v.done;g++,v=l.next())null!==(v=f(m,r,g,v.value,c))&&(e&&null!==v.alternate&&m.delete(null===v.key?g:v.key),a=s(v,a,g),null===d?u=v:d.sibling=v,d=v);return e&&m.forEach((function(e){return t(r,e)})),u}return function(e,i,s,l){var c="object"==typeof s&&null!==s&&s.type===ne&&null===s.key;c&&(s=s.props.children);var u="object"==typeof s&&null!==s;if(u)switch(s.$$typeof){case ee:e:{for(u=s.key,c=i;null!==c;){if(c.key===u){if(7===c.tag){if(s.type===ne){n(e,c.sibling),(i=r(c,s.props.children)).return=e,e=i;break e}}else if(c.elementType===s.type){n(e,c.sibling),(i=r(c,s.props)).ref=Cs(e,c,s),i.return=e,e=i;break e}n(e,c);break}t(e,c),c=c.sibling}s.type===ne?((i=Dl(s.props.children,e.mode,l,s.key)).return=e,e=i):((l=Il(s.type,s.key,s.props,null,e.mode,l)).ref=Cs(e,i,s),l.return=e,e=l)}return a(e);case te:e:{for(c=s.key;null!==i;){if(i.key===c){if(4===i.tag&&i.stateNode.containerInfo===s.containerInfo&&i.stateNode.implementation===s.implementation){n(e,i.sibling),(i=r(i,s.children||[])).return=e,e=i;break e}n(e,i);break}t(e,i),i=i.sibling}(i=Bl(s,e.mode,l)).return=e,e=i}return a(e)}if("string"==typeof s||"number"==typeof s)return s=""+s,null!==i&&6===i.tag?(n(e,i.sibling),(i=r(i,s)).return=e,e=i):(n(e,i),(i=Fl(s,e.mode,l)).return=e,e=i),a(e);if(Ss(s))return m(e,i,s,l);if(me(s))return g(e,i,s,l);if(u&&Ts(e,s),void 0===s&&!c)switch(e.tag){case 1:case 0:throw e=e.type,Error(o(152,e.displayName||e.name||"Component"))}return n(e,i)}}var ks=As(!0),Ns=As(!1),Ms={},Ps={current:Ms},Ls={current:Ms},Os={current:Ms};function Rs(e){if(e===Ms)throw Error(o(174));return e}function Is(e,t){switch(pr(Os,t),pr(Ls,e),pr(Ps,Ms),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Fe(null,"");break;default:t=Fe(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}hr(Ps),pr(Ps,t)}function Ds(){hr(Ps),hr(Ls),hr(Os)}function Fs(e){Rs(Os.current);var t=Rs(Ps.current),n=Fe(t,e.type);t!==n&&(pr(Ls,e),pr(Ps,n))}function Bs(e){Ls.current===e&&(hr(Ps),hr(Ls))}var zs={current:0};function js(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||n.data===yn||n.data===vn))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(64&t.effectTag))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function Vs(e,t){return{responder:e,props:t}}var Us=K.ReactCurrentDispatcher,Hs=K.ReactCurrentBatchConfig,$s=0,qs=null,Ws=null,Gs=null,Ys=!1;function Xs(){throw Error(o(321))}function Ks(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Vi(e[n],t[n]))return!1;return!0}function Zs(e,t,n,i,r,s){if($s=s,qs=t,t.memoizedState=null,t.updateQueue=null,t.expirationTime=0,Us.current=null===e||null===e.memoizedState?xo:_o,e=n(i,r),t.expirationTime===$s){s=0;do{if(t.expirationTime=0,!(25>s))throw Error(o(301));s+=1,Gs=Ws=null,t.updateQueue=null,Us.current=Eo,e=n(i,r)}while(t.expirationTime===$s)}if(Us.current=wo,t=null!==Ws&&null!==Ws.next,$s=0,Gs=Ws=qs=null,Ys=!1,t)throw Error(o(300));return e}function Js(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Gs?qs.memoizedState=Gs=e:Gs=Gs.next=e,Gs}function Qs(){if(null===Ws){var e=qs.alternate;e=null!==e?e.memoizedState:null}else e=Ws.next;var t=null===Gs?qs.memoizedState:Gs.next;if(null!==t)Gs=t,Ws=e;else{if(null===e)throw Error(o(310));e={memoizedState:(Ws=e).memoizedState,baseState:Ws.baseState,baseQueue:Ws.baseQueue,queue:Ws.queue,next:null},null===Gs?qs.memoizedState=Gs=e:Gs=Gs.next=e}return Gs}function eo(e,t){return"function"==typeof t?t(e):t}function to(e){var t=Qs(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=Ws,r=i.baseQueue,s=n.pending;if(null!==s){if(null!==r){var a=r.next;r.next=s.next,s.next=a}i.baseQueue=r=s,n.pending=null}if(null!==r){r=r.next,i=i.baseState;var l=a=s=null,c=r;do{var u=c.expirationTime;if(u<$s){var d={expirationTime:c.expirationTime,suspenseConfig:c.suspenseConfig,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null};null===l?(a=l=d,s=i):l=l.next=d,u>qs.expirationTime&&(qs.expirationTime=u,fl(u))}else null!==l&&(l=l.next={expirationTime:1073741823,suspenseConfig:c.suspenseConfig,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null}),pl(u,c.suspenseConfig),i=c.eagerReducer===e?c.eagerState:e(i,c.action);c=c.next}while(null!==c&&c!==r);null===l?s=i:l.next=a,Vi(i,t.memoizedState)||(Ro=!0),t.memoizedState=i,t.baseState=s,t.baseQueue=l,n.lastRenderedState=i}return[t.memoizedState,n.dispatch]}function no(e){var t=Qs(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,s=t.memoizedState;if(null!==r){n.pending=null;var a=r=r.next;do{s=e(s,a.action),a=a.next}while(a!==r);Vi(s,t.memoizedState)||(Ro=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,i]}function io(e){var t=Js();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:eo,lastRenderedState:e}).dispatch=bo.bind(null,qs,e),[t.memoizedState,e]}function ro(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=qs.updateQueue)?(t={lastEffect:null},qs.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function so(){return Qs().memoizedState}function oo(e,t,n,i){var r=Js();qs.effectTag|=e,r.memoizedState=ro(1|t,n,void 0,void 0===i?null:i)}function ao(e,t,n,i){var r=Qs();i=void 0===i?null:i;var s=void 0;if(null!==Ws){var o=Ws.memoizedState;if(s=o.destroy,null!==i&&Ks(i,o.deps))return void ro(t,n,s,i)}qs.effectTag|=e,r.memoizedState=ro(1|t,n,s,i)}function lo(e,t){return oo(516,4,e,t)}function co(e,t){return ao(516,4,e,t)}function uo(e,t){return ao(4,2,e,t)}function ho(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function po(e,t,n){return n=null!=n?n.concat([e]):null,ao(4,2,ho.bind(null,t,e),n)}function fo(){}function mo(e,t){return Js().memoizedState=[e,void 0===t?null:t],e}function go(e,t){var n=Qs();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Ks(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function yo(e,t){var n=Qs();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Ks(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function vo(e,t,n){var i=$r();Wr(98>i?98:i,(function(){e(!0)})),Wr(97<i?97:i,(function(){var i=Hs.suspense;Hs.suspense=void 0===t?null:t;try{e(!1),n()}finally{Hs.suspense=i}}))}function bo(e,t,n){var i=el(),r=gs.suspense;r={expirationTime:i=tl(i,e,r),suspenseConfig:r,action:n,eagerReducer:null,eagerState:null,next:null};var s=t.pending;if(null===s?r.next=r:(r.next=s.next,s.next=r),t.pending=r,s=e.alternate,e===qs||null!==s&&s===qs)Ys=!0,r.expirationTime=$s,qs.expirationTime=$s;else{if(0===e.expirationTime&&(null===s||0===s.expirationTime)&&null!==(s=t.lastRenderedReducer))try{var o=t.lastRenderedState,a=s(o,n);if(r.eagerReducer=s,r.eagerState=a,Vi(a,o))return}catch(e){}nl(e,i)}}var wo={readContext:as,useCallback:Xs,useContext:Xs,useEffect:Xs,useImperativeHandle:Xs,useLayoutEffect:Xs,useMemo:Xs,useReducer:Xs,useRef:Xs,useState:Xs,useDebugValue:Xs,useResponder:Xs,useDeferredValue:Xs,useTransition:Xs},xo={readContext:as,useCallback:mo,useContext:as,useEffect:lo,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,oo(4,2,ho.bind(null,t,e),n)},useLayoutEffect:function(e,t){return oo(4,2,e,t)},useMemo:function(e,t){var n=Js();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=Js();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e=(e=i.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=bo.bind(null,qs,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},Js().memoizedState=e},useState:io,useDebugValue:fo,useResponder:Vs,useDeferredValue:function(e,t){var n=io(e),i=n[0],r=n[1];return lo((function(){var n=Hs.suspense;Hs.suspense=void 0===t?null:t;try{r(e)}finally{Hs.suspense=n}}),[e,t]),i},useTransition:function(e){var t=io(!1),n=t[0];return t=t[1],[mo(vo.bind(null,t,e),[t,e]),n]}},_o={readContext:as,useCallback:go,useContext:as,useEffect:co,useImperativeHandle:po,useLayoutEffect:uo,useMemo:yo,useReducer:to,useRef:so,useState:function(){return to(eo)},useDebugValue:fo,useResponder:Vs,useDeferredValue:function(e,t){var n=to(eo),i=n[0],r=n[1];return co((function(){var n=Hs.suspense;Hs.suspense=void 0===t?null:t;try{r(e)}finally{Hs.suspense=n}}),[e,t]),i},useTransition:function(e){var t=to(eo),n=t[0];return t=t[1],[go(vo.bind(null,t,e),[t,e]),n]}},Eo={readContext:as,useCallback:go,useContext:as,useEffect:co,useImperativeHandle:po,useLayoutEffect:uo,useMemo:yo,useReducer:no,useRef:so,useState:function(){return no(eo)},useDebugValue:fo,useResponder:Vs,useDeferredValue:function(e,t){var n=no(eo),i=n[0],r=n[1];return co((function(){var n=Hs.suspense;Hs.suspense=void 0===t?null:t;try{r(e)}finally{Hs.suspense=n}}),[e,t]),i},useTransition:function(e){var t=no(eo),n=t[0];return t=t[1],[go(vo.bind(null,t,e),[t,e]),n]}},So=null,Co=null,To=!1;function Ao(e,t){var n=Ll(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function ko(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);default:return!1}}function No(e){if(To){var t=Co;if(t){var n=t;if(!ko(e,t)){if(!(t=Cn(n.nextSibling))||!ko(e,t))return e.effectTag=-1025&e.effectTag|2,To=!1,void(So=e);Ao(So,n)}So=e,Co=Cn(t.firstChild)}else e.effectTag=-1025&e.effectTag|2,To=!1,So=e}}function Mo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;So=e}function Po(e){if(e!==So)return!1;if(!To)return Mo(e),To=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!_n(t,e.memoizedProps))for(t=Co;t;)Ao(e,t),t=Cn(t.nextSibling);if(Mo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){Co=Cn(e.nextSibling);break e}t--}else"$"!==n&&n!==vn&&n!==yn||t++}e=e.nextSibling}Co=null}}else Co=So?Cn(e.stateNode.nextSibling):null;return!0}function Lo(){Co=So=null,To=!1}var Oo=K.ReactCurrentOwner,Ro=!1;function Io(e,t,n,i){t.child=null===e?Ns(t,null,n,i):ks(t,e.child,n,i)}function Do(e,t,n,i,r){n=n.render;var s=t.ref;return os(t,r),i=Zs(e,t,n,i,s,r),null===e||Ro?(t.effectTag|=1,Io(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=r&&(e.expirationTime=0),Jo(e,t,r))}function Fo(e,t,n,i,r,s){if(null===e){var o=n.type;return"function"!=typeof o||Ol(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Il(n.type,null,i,null,t.mode,s)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Bo(e,t,o,i,r,s))}return o=e.child,r<s&&(r=o.memoizedProps,(n=null!==(n=n.compare)?n:Hi)(r,i)&&e.ref===t.ref)?Jo(e,t,s):(t.effectTag|=1,(e=Rl(o,i)).ref=t.ref,e.return=t,t.child=e)}function Bo(e,t,n,i,r,s){return null!==e&&Hi(e.memoizedProps,i)&&e.ref===t.ref&&(Ro=!1,r<s)?(t.expirationTime=e.expirationTime,Jo(e,t,s)):jo(e,t,n,i,s)}function zo(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.effectTag|=128)}function jo(e,t,n,i,r){var s=br(n)?yr:mr.current;return s=vr(t,s),os(t,r),n=Zs(e,t,n,i,s,r),null===e||Ro?(t.effectTag|=1,Io(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=r&&(e.expirationTime=0),Jo(e,t,r))}function Vo(e,t,n,i,r){if(br(n)){var s=!0;Er(t)}else s=!1;if(os(t,r),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),xs(t,n,i),Es(t,n,i,r),i=!0;else if(null===e){var o=t.stateNode,a=t.memoizedProps;o.props=a;var l=o.context,c=n.contextType;"object"==typeof c&&null!==c?c=as(c):c=vr(t,c=br(n)?yr:mr.current);var u=n.getDerivedStateFromProps,d="function"==typeof u||"function"==typeof o.getSnapshotBeforeUpdate;d||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(a!==i||l!==c)&&_s(t,o,i,c),ls=!1;var h=t.memoizedState;o.state=h,fs(t,i,o,r),l=t.memoizedState,a!==i||h!==l||gr.current||ls?("function"==typeof u&&(vs(t,n,u,i),l=t.memoizedState),(a=ls||ws(t,n,a,i,h,l,c))?(d||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||("function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"==typeof o.componentDidMount&&(t.effectTag|=4)):("function"==typeof o.componentDidMount&&(t.effectTag|=4),t.memoizedProps=i,t.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):("function"==typeof o.componentDidMount&&(t.effectTag|=4),i=!1)}else o=t.stateNode,us(e,t),a=t.memoizedProps,o.props=t.type===t.elementType?a:Jr(t.type,a),l=o.context,"object"==typeof(c=n.contextType)&&null!==c?c=as(c):c=vr(t,c=br(n)?yr:mr.current),(d="function"==typeof(u=n.getDerivedStateFromProps)||"function"==typeof o.getSnapshotBeforeUpdate)||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(a!==i||l!==c)&&_s(t,o,i,c),ls=!1,l=t.memoizedState,o.state=l,fs(t,i,o,r),h=t.memoizedState,a!==i||l!==h||gr.current||ls?("function"==typeof u&&(vs(t,n,u,i),h=t.memoizedState),(u=ls||ws(t,n,a,i,l,h,c))?(d||"function"!=typeof o.UNSAFE_componentWillUpdate&&"function"!=typeof o.componentWillUpdate||("function"==typeof o.componentWillUpdate&&o.componentWillUpdate(i,h,c),"function"==typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,h,c)),"function"==typeof o.componentDidUpdate&&(t.effectTag|=4),"function"==typeof o.getSnapshotBeforeUpdate&&(t.effectTag|=256)):("function"!=typeof o.componentDidUpdate||a===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=4),"function"!=typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=256),t.memoizedProps=i,t.memoizedState=h),o.props=i,o.state=h,o.context=c,i=u):("function"!=typeof o.componentDidUpdate||a===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=4),"function"!=typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=256),i=!1);return Uo(e,t,n,i,s,r)}function Uo(e,t,n,i,r,s){zo(e,t);var o=0!=(64&t.effectTag);if(!i&&!o)return r&&Sr(t,n,!1),Jo(e,t,s);i=t.stateNode,Oo.current=t;var a=o&&"function"!=typeof n.getDerivedStateFromError?null:i.render();return t.effectTag|=1,null!==e&&o?(t.child=ks(t,e.child,null,s),t.child=ks(t,null,a,s)):Io(e,t,a,s),t.memoizedState=i.state,r&&Sr(t,n,!0),t.child}function Ho(e){var t=e.stateNode;t.pendingContext?xr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&xr(0,t.context,!1),Is(e,t.containerInfo)}var $o,qo,Wo,Go={dehydrated:null,retryTime:0};function Yo(e,t,n){var i,r=t.mode,s=t.pendingProps,o=zs.current,a=!1;if((i=0!=(64&t.effectTag))||(i=0!=(2&o)&&(null===e||null!==e.memoizedState)),i?(a=!0,t.effectTag&=-65):null!==e&&null===e.memoizedState||void 0===s.fallback||!0===s.unstable_avoidThisFallback||(o|=1),pr(zs,1&o),null===e){if(void 0!==s.fallback&&No(t),a){if(a=s.fallback,(s=Dl(null,r,0,null)).return=t,0==(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,s.child=e;null!==e;)e.return=s,e=e.sibling;return(n=Dl(a,r,n,null)).return=t,s.sibling=n,t.memoizedState=Go,t.child=s,n}return r=s.children,t.memoizedState=null,t.child=Ns(t,null,r,n)}if(null!==e.memoizedState){if(r=(e=e.child).sibling,a){if(s=s.fallback,(n=Rl(e,e.pendingProps)).return=t,0==(2&t.mode)&&(a=null!==t.memoizedState?t.child.child:t.child)!==e.child)for(n.child=a;null!==a;)a.return=n,a=a.sibling;return(r=Rl(r,s)).return=t,n.sibling=r,n.childExpirationTime=0,t.memoizedState=Go,t.child=n,r}return n=ks(t,e.child,s.children,n),t.memoizedState=null,t.child=n}if(e=e.child,a){if(a=s.fallback,(s=Dl(null,r,0,null)).return=t,s.child=e,null!==e&&(e.return=s),0==(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,s.child=e;null!==e;)e.return=s,e=e.sibling;return(n=Dl(a,r,n,null)).return=t,s.sibling=n,n.effectTag|=2,s.childExpirationTime=0,t.memoizedState=Go,t.child=s,n}return t.memoizedState=null,t.child=ks(t,e,s.children,n)}function Xo(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t),ss(e.return,t)}function Ko(e,t,n,i,r,s){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailExpiration:0,tailMode:r,lastEffect:s}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailExpiration=0,o.tailMode=r,o.lastEffect=s)}function Zo(e,t,n){var i=t.pendingProps,r=i.revealOrder,s=i.tail;if(Io(e,t,i.children,n),0!=(2&(i=zs.current)))i=1&i|2,t.effectTag|=64;else{if(null!==e&&0!=(64&e.effectTag))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Xo(e,n);else if(19===e.tag)Xo(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(pr(zs,i),0==(2&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===js(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Ko(t,!1,r,n,s,t.lastEffect);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===js(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Ko(t,!0,n,null,s,t.lastEffect);break;case"together":Ko(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function Jo(e,t,n){null!==e&&(t.dependencies=e.dependencies);var i=t.expirationTime;if(0!==i&&fl(i),t.childExpirationTime<n)return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Rl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Rl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Qo(e,t){switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function ea(e,t,n){var i=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:case 17:return br(t.type)&&wr(),null;case 3:return Ds(),hr(gr),hr(mr),(n=t.stateNode).pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||!Po(t)||(t.effectTag|=4),null;case 5:Bs(t),n=Rs(Os.current);var s=t.type;if(null!==e&&null!=t.stateNode)qo(e,t,s,i,n),e.ref!==t.ref&&(t.effectTag|=128);else{if(!i){if(null===t.stateNode)throw Error(o(166));return null}if(e=Rs(Ps.current),Po(t)){i=t.stateNode,s=t.type;var a=t.memoizedProps;switch(i[kn]=t,i[Nn]=a,s){case"iframe":case"object":case"embed":Yt("load",i);break;case"video":case"audio":for(e=0;e<Ze.length;e++)Yt(Ze[e],i);break;case"source":Yt("error",i);break;case"img":case"image":case"link":Yt("error",i),Yt("load",i);break;case"form":Yt("reset",i),Yt("submit",i);break;case"details":Yt("toggle",i);break;case"input":Ee(i,a),Yt("invalid",i),cn(n,"onChange");break;case"select":i._wrapperState={wasMultiple:!!a.multiple},Yt("invalid",i),cn(n,"onChange");break;case"textarea":Pe(i,a),Yt("invalid",i),cn(n,"onChange")}for(var l in on(s,a),e=null,a)if(a.hasOwnProperty(l)){var c=a[l];"children"===l?"string"==typeof c?i.textContent!==c&&(e=["children",c]):"number"==typeof c&&i.textContent!==""+c&&(e=["children",""+c]):S.hasOwnProperty(l)&&null!=c&&cn(n,l)}switch(s){case"input":we(i),Te(i,a,!0);break;case"textarea":we(i),Oe(i);break;case"select":case"option":break;default:"function"==typeof a.onClick&&(i.onclick=un)}n=e,t.updateQueue=n,null!==n&&(t.effectTag|=4)}else{switch(l=9===n.nodeType?n:n.ownerDocument,e===ln&&(e=De(s)),e===ln?"script"===s?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof i.is?e=l.createElement(s,{is:i.is}):(e=l.createElement(s),"select"===s&&(l=e,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):e=l.createElementNS(e,s),e[kn]=t,e[Nn]=i,$o(e,t),t.stateNode=e,l=an(s,i),s){case"iframe":case"object":case"embed":Yt("load",e),c=i;break;case"video":case"audio":for(c=0;c<Ze.length;c++)Yt(Ze[c],e);c=i;break;case"source":Yt("error",e),c=i;break;case"img":case"image":case"link":Yt("error",e),Yt("load",e),c=i;break;case"form":Yt("reset",e),Yt("submit",e),c=i;break;case"details":Yt("toggle",e),c=i;break;case"input":Ee(e,i),c=_e(e,i),Yt("invalid",e),cn(n,"onChange");break;case"option":c=ke(e,i);break;case"select":e._wrapperState={wasMultiple:!!i.multiple},c=r({},i,{value:void 0}),Yt("invalid",e),cn(n,"onChange");break;case"textarea":Pe(e,i),c=Me(e,i),Yt("invalid",e),cn(n,"onChange");break;default:c=i}on(s,c);var u=c;for(a in u)if(u.hasOwnProperty(a)){var d=u[a];"style"===a?rn(e,d):"dangerouslySetInnerHTML"===a?null!=(d=d?d.__html:void 0)&&je(e,d):"children"===a?"string"==typeof d?("textarea"!==s||""!==d)&&Ve(e,d):"number"==typeof d&&Ve(e,""+d):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(S.hasOwnProperty(a)?null!=d&&cn(n,a):null!=d&&Z(e,a,d,l))}switch(s){case"input":we(e),Te(e,i,!1);break;case"textarea":we(e),Oe(e);break;case"option":null!=i.value&&e.setAttribute("value",""+ve(i.value));break;case"select":e.multiple=!!i.multiple,null!=(n=i.value)?Ne(e,!!i.multiple,n,!1):null!=i.defaultValue&&Ne(e,!!i.multiple,i.defaultValue,!0);break;default:"function"==typeof c.onClick&&(e.onclick=un)}xn(s,i)&&(t.effectTag|=4)}null!==t.ref&&(t.effectTag|=128)}return null;case 6:if(e&&null!=t.stateNode)Wo(0,t,e.memoizedProps,i);else{if("string"!=typeof i&&null===t.stateNode)throw Error(o(166));n=Rs(Os.current),Rs(Ps.current),Po(t)?(n=t.stateNode,i=t.memoizedProps,n[kn]=t,n.nodeValue!==i&&(t.effectTag|=4)):((n=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[kn]=t,t.stateNode=n)}return null;case 13:return hr(zs),i=t.memoizedState,0!=(64&t.effectTag)?(t.expirationTime=n,t):(n=null!==i,i=!1,null===e?void 0!==t.memoizedProps.fallback&&Po(t):(i=null!==(s=e.memoizedState),n||null===s||null!==(s=e.child.sibling)&&(null!==(a=t.firstEffect)?(t.firstEffect=s,s.nextEffect=a):(t.firstEffect=t.lastEffect=s,s.nextEffect=null),s.effectTag=8)),n&&!i&&0!=(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!=(1&zs.current)?Ia===ka&&(Ia=Na):(Ia!==ka&&Ia!==Na||(Ia=Ma),0!==ja&&null!==La&&(Vl(La,Ra),Ul(La,ja)))),(n||i)&&(t.effectTag|=4),null);case 4:return Ds(),null;case 10:return rs(t),null;case 19:if(hr(zs),null===(i=t.memoizedState))return null;if(s=0!=(64&t.effectTag),null===(a=i.rendering)){if(s)Qo(i,!1);else if(Ia!==ka||null!==e&&0!=(64&e.effectTag))for(a=t.child;null!==a;){if(null!==(e=js(a))){for(t.effectTag|=64,Qo(i,!1),null!==(s=e.updateQueue)&&(t.updateQueue=s,t.effectTag|=4),null===i.lastEffect&&(t.firstEffect=null),t.lastEffect=i.lastEffect,i=t.child;null!==i;)a=n,(s=i).effectTag&=2,s.nextEffect=null,s.firstEffect=null,s.lastEffect=null,null===(e=s.alternate)?(s.childExpirationTime=0,s.expirationTime=a,s.child=null,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null):(s.childExpirationTime=e.childExpirationTime,s.expirationTime=e.expirationTime,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,a=e.dependencies,s.dependencies=null===a?null:{expirationTime:a.expirationTime,firstContext:a.firstContext,responders:a.responders}),i=i.sibling;return pr(zs,1&zs.current|2),t.child}a=a.sibling}}else{if(!s)if(null!==(e=js(a))){if(t.effectTag|=64,s=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.effectTag|=4),Qo(i,!0),null===i.tail&&"hidden"===i.tailMode&&!a.alternate)return null!==(t=t.lastEffect=i.lastEffect)&&(t.nextEffect=null),null}else 2*Hr()-i.renderingStartTime>i.tailExpiration&&1<n&&(t.effectTag|=64,s=!0,Qo(i,!1),t.expirationTime=t.childExpirationTime=n-1);i.isBackwards?(a.sibling=t.child,t.child=a):(null!==(n=i.last)?n.sibling=a:t.child=a,i.last=a)}return null!==i.tail?(0===i.tailExpiration&&(i.tailExpiration=Hr()+500),n=i.tail,i.rendering=n,i.tail=n.sibling,i.lastEffect=t.lastEffect,i.renderingStartTime=Hr(),n.sibling=null,t=zs.current,pr(zs,s?1&t|2:1&t),n):null}throw Error(o(156,t.tag))}function ta(e){switch(e.tag){case 1:br(e.type)&&wr();var t=e.effectTag;return 4096&t?(e.effectTag=-4097&t|64,e):null;case 3:if(Ds(),hr(gr),hr(mr),0!=(64&(t=e.effectTag)))throw Error(o(285));return e.effectTag=-4097&t|64,e;case 5:return Bs(e),null;case 13:return hr(zs),4096&(t=e.effectTag)?(e.effectTag=-4097&t|64,e):null;case 19:return hr(zs),null;case 4:return Ds(),null;case 10:return rs(e),null;default:return null}}function na(e,t){return{value:e,source:t,stack:ye(t)}}$o=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},qo=function(e,t,n,i,s){var o=e.memoizedProps;if(o!==i){var a,l,c=t.stateNode;switch(Rs(Ps.current),e=null,n){case"input":o=_e(c,o),i=_e(c,i),e=[];break;case"option":o=ke(c,o),i=ke(c,i),e=[];break;case"select":o=r({},o,{value:void 0}),i=r({},i,{value:void 0}),e=[];break;case"textarea":o=Me(c,o),i=Me(c,i),e=[];break;default:"function"!=typeof o.onClick&&"function"==typeof i.onClick&&(c.onclick=un)}for(a in on(n,i),n=null,o)if(!i.hasOwnProperty(a)&&o.hasOwnProperty(a)&&null!=o[a])if("style"===a)for(l in c=o[a])c.hasOwnProperty(l)&&(n||(n={}),n[l]="");else"dangerouslySetInnerHTML"!==a&&"children"!==a&&"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(S.hasOwnProperty(a)?e||(e=[]):(e=e||[]).push(a,null));for(a in i){var u=i[a];if(c=null!=o?o[a]:void 0,i.hasOwnProperty(a)&&u!==c&&(null!=u||null!=c))if("style"===a)if(c){for(l in c)!c.hasOwnProperty(l)||u&&u.hasOwnProperty(l)||(n||(n={}),n[l]="");for(l in u)u.hasOwnProperty(l)&&c[l]!==u[l]&&(n||(n={}),n[l]=u[l])}else n||(e||(e=[]),e.push(a,n)),n=u;else"dangerouslySetInnerHTML"===a?(u=u?u.__html:void 0,c=c?c.__html:void 0,null!=u&&c!==u&&(e=e||[]).push(a,u)):"children"===a?c===u||"string"!=typeof u&&"number"!=typeof u||(e=e||[]).push(a,""+u):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&(S.hasOwnProperty(a)?(null!=u&&cn(s,a),e||c===u||(e=[])):(e=e||[]).push(a,u))}n&&(e=e||[]).push("style",n),s=e,(t.updateQueue=s)&&(t.effectTag|=4)}},Wo=function(e,t,n,i){n!==i&&(t.effectTag|=4)};var ia="function"==typeof WeakSet?WeakSet:Set;function ra(e,t){var n=t.source,i=t.stack;null===i&&null!==n&&(i=ye(n)),null!==n&&ge(n.type),t=t.value,null!==e&&1===e.tag&&ge(e.type);try{console.error(t)}catch(e){setTimeout((function(){throw e}))}}function sa(e){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){Tl(e,t)}else t.current=null}function oa(e,t){switch(t.tag){case 0:case 11:case 15:case 22:case 3:case 5:case 6:case 4:case 17:return;case 1:if(256&t.effectTag&&null!==e){var n=e.memoizedProps,i=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:Jr(t.type,n),i),e.__reactInternalSnapshotBeforeUpdate=t}return}throw Error(o(163))}function aa(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.destroy;n.destroy=void 0,void 0!==i&&i()}n=n.next}while(n!==t)}}function la(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function ca(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:return void la(3,n);case 1:if(e=n.stateNode,4&n.effectTag)if(null===t)e.componentDidMount();else{var i=n.elementType===n.type?t.memoizedProps:Jr(n.type,t.memoizedProps);e.componentDidUpdate(i,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate)}return void(null!==(t=n.updateQueue)&&ms(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:case 1:e=n.child.stateNode}ms(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.effectTag&&xn(n.type,n.memoizedProps)&&e.focus());case 6:case 4:case 12:case 19:case 17:case 20:case 21:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&Ft(n)))))}throw Error(o(163))}function ua(e,t,n){switch("function"==typeof Ml&&Ml(t),t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var i=e.next;Wr(97<n?97:n,(function(){var e=i;do{var n=e.destroy;if(void 0!==n){var r=t;try{n()}catch(e){Tl(r,e)}}e=e.next}while(e!==i)}))}break;case 1:sa(t),"function"==typeof(n=t.stateNode).componentWillUnmount&&function(e,t){try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(t){Tl(e,t)}}(t,n);break;case 5:sa(t);break;case 4:ga(e,t,n)}}function da(e){var t=e.alternate;e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.alternate=null,e.firstEffect=null,e.lastEffect=null,e.pendingProps=null,e.memoizedProps=null,e.stateNode=null,null!==t&&da(t)}function ha(e){return 5===e.tag||3===e.tag||4===e.tag}function pa(e){e:{for(var t=e.return;null!==t;){if(ha(t)){var n=t;break e}t=t.return}throw Error(o(160))}switch(t=n.stateNode,n.tag){case 5:var i=!1;break;case 3:case 4:t=t.containerInfo,i=!0;break;default:throw Error(o(161))}16&n.effectTag&&(Ve(t,""),n.effectTag&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||ha(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.effectTag)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.effectTag)){n=n.stateNode;break e}}i?fa(e,n,t):ma(e,n,t)}function fa(e,t,n){var i=e.tag,r=5===i||6===i;if(r)e=r?e.stateNode:e.stateNode.instance,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=un));else if(4!==i&&null!==(e=e.child))for(fa(e,t,n),e=e.sibling;null!==e;)fa(e,t,n),e=e.sibling}function ma(e,t,n){var i=e.tag,r=5===i||6===i;if(r)e=r?e.stateNode:e.stateNode.instance,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(ma(e,t,n),e=e.sibling;null!==e;)ma(e,t,n),e=e.sibling}function ga(e,t,n){for(var i,r,s=t,a=!1;;){if(!a){a=s.return;e:for(;;){if(null===a)throw Error(o(160));switch(i=a.stateNode,a.tag){case 5:r=!1;break e;case 3:case 4:i=i.containerInfo,r=!0;break e}a=a.return}a=!0}if(5===s.tag||6===s.tag){e:for(var l=e,c=s,u=n,d=c;;)if(ua(l,d,u),null!==d.child&&4!==d.tag)d.child.return=d,d=d.child;else{if(d===c)break e;for(;null===d.sibling;){if(null===d.return||d.return===c)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}r?(l=i,c=s.stateNode,8===l.nodeType?l.parentNode.removeChild(c):l.removeChild(c)):i.removeChild(s.stateNode)}else if(4===s.tag){if(null!==s.child){i=s.stateNode.containerInfo,r=!0,s.child.return=s,s=s.child;continue}}else if(ua(e,s,n),null!==s.child){s.child.return=s,s=s.child;continue}if(s===t)break;for(;null===s.sibling;){if(null===s.return||s.return===t)return;4===(s=s.return).tag&&(a=!1)}s.sibling.return=s.return,s=s.sibling}}function ya(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:return void aa(3,t);case 1:case 12:case 17:return;case 5:var n=t.stateNode;if(null!=n){var i=t.memoizedProps,r=null!==e?e.memoizedProps:i;e=t.type;var s=t.updateQueue;if(t.updateQueue=null,null!==s){for(n[Nn]=i,"input"===e&&"radio"===i.type&&null!=i.name&&Se(n,i),an(e,r),t=an(e,i),r=0;r<s.length;r+=2){var a=s[r],l=s[r+1];"style"===a?rn(n,l):"dangerouslySetInnerHTML"===a?je(n,l):"children"===a?Ve(n,l):Z(n,a,l,t)}switch(e){case"input":Ce(n,i);break;case"textarea":Le(n,i);break;case"select":t=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!i.multiple,null!=(e=i.value)?Ne(n,!!i.multiple,e,!1):t!==!!i.multiple&&(null!=i.defaultValue?Ne(n,!!i.multiple,i.defaultValue,!0):Ne(n,!!i.multiple,i.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(o(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((t=t.stateNode).hydrate&&(t.hydrate=!1,Ft(t.containerInfo)));case 13:if(n=t,null===t.memoizedState?i=!1:(i=!0,n=t.child,Ua=Hr()),null!==n)e:for(e=n;;){if(5===e.tag)s=e.stateNode,i?"function"==typeof(s=s.style).setProperty?s.setProperty("display","none","important"):s.display="none":(s=e.stateNode,r=null!=(r=e.memoizedProps.style)&&r.hasOwnProperty("display")?r.display:null,s.style.display=nn("display",r));else if(6===e.tag)e.stateNode.nodeValue=i?"":e.memoizedProps;else{if(13===e.tag&&null!==e.memoizedState&&null===e.memoizedState.dehydrated){(s=e.child.sibling).return=e,e=s;continue}if(null!==e.child){e.child.return=e,e=e.child;continue}}if(e===n)break;for(;null===e.sibling;){if(null===e.return||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}return void va(t);case 19:return void va(t)}throw Error(o(163))}function va(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new ia),t.forEach((function(t){var i=kl.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}var ba="function"==typeof WeakMap?WeakMap:Map;function wa(e,t,n){(n=ds(n,null)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){$a||($a=!0,qa=i),ra(e,t)},n}function xa(e,t,n){(n=ds(n,null)).tag=3;var i=e.type.getDerivedStateFromError;if("function"==typeof i){var r=t.value;n.payload=function(){return ra(e,t),i(r)}}var s=e.stateNode;return null!==s&&"function"==typeof s.componentDidCatch&&(n.callback=function(){"function"!=typeof i&&(null===Wa?Wa=new Set([this]):Wa.add(this),ra(e,t));var n=t.stack;this.componentDidCatch(t.value,{componentStack:null!==n?n:""})}),n}var _a,Ea=Math.ceil,Sa=K.ReactCurrentDispatcher,Ca=K.ReactCurrentOwner,Ta=16,Aa=32,ka=0,Na=3,Ma=4,Pa=0,La=null,Oa=null,Ra=0,Ia=ka,Da=null,Fa=1073741823,Ba=1073741823,za=null,ja=0,Va=!1,Ua=0,Ha=null,$a=!1,qa=null,Wa=null,Ga=!1,Ya=null,Xa=90,Ka=null,Za=0,Ja=null,Qa=0;function el(){return 0!=(48&Pa)?1073741821-(Hr()/10|0):0!==Qa?Qa:Qa=1073741821-(Hr()/10|0)}function tl(e,t,n){if(0==(2&(t=t.mode)))return 1073741823;var i=$r();if(0==(4&t))return 99===i?1073741823:1073741822;if(0!=(Pa&Ta))return Ra;if(null!==n)e=Zr(e,0|n.timeoutMs||5e3,250);else switch(i){case 99:e=1073741823;break;case 98:e=Zr(e,150,100);break;case 97:case 96:e=Zr(e,5e3,250);break;case 95:e=2;break;default:throw Error(o(326))}return null!==La&&e===Ra&&--e,e}function nl(e,t){if(50<Za)throw Za=0,Ja=null,Error(o(185));if(null!==(e=il(e,t))){var n=$r();1073741823===t?0!=(8&Pa)&&0==(48&Pa)?al(e):(sl(e),0===Pa&&Xr()):sl(e),0==(4&Pa)||98!==n&&99!==n||(null===Ka?Ka=new Map([[e,t]]):(void 0===(n=Ka.get(e))||n>t)&&Ka.set(e,t))}}function il(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t);var i=e.return,r=null;if(null===i&&3===e.tag)r=e.stateNode;else for(;null!==i;){if(n=i.alternate,i.childExpirationTime<t&&(i.childExpirationTime=t),null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t),null===i.return&&3===i.tag){r=i.stateNode;break}i=i.return}return null!==r&&(La===r&&(fl(t),Ia===Ma&&Vl(r,Ra)),Ul(r,t)),r}function rl(e){var t=e.lastExpiredTime;if(0!==t)return t;if(!jl(e,t=e.firstPendingTime))return t;var n=e.lastPingedTime;return 2>=(e=n>(e=e.nextKnownPendingLevel)?n:e)&&t!==e?0:e}function sl(e){if(0!==e.lastExpiredTime)e.callbackExpirationTime=1073741823,e.callbackPriority=99,e.callbackNode=Yr(al.bind(null,e));else{var t=rl(e),n=e.callbackNode;if(0===t)null!==n&&(e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90);else{var i=el();if(1073741823===t?i=99:1===t||2===t?i=95:i=0>=(i=10*(1073741821-t)-10*(1073741821-i))?99:250>=i?98:5250>=i?97:95,null!==n){var r=e.callbackPriority;if(e.callbackExpirationTime===t&&r>=i)return;n!==Dr&&Ar(n)}e.callbackExpirationTime=t,e.callbackPriority=i,t=1073741823===t?Yr(al.bind(null,e)):Gr(i,ol.bind(null,e),{timeout:10*(1073741821-t)-Hr()}),e.callbackNode=t}}}function ol(e,t){if(Qa=0,t)return Hl(e,t=el()),sl(e),null;var n=rl(e);if(0!==n){if(t=e.callbackNode,0!=(48&Pa))throw Error(o(327));if(El(),e===La&&n===Ra||ul(e,n),null!==Oa){var i=Pa;Pa|=Ta;for(var r=hl();;)try{gl();break}catch(t){dl(e,t)}if(is(),Pa=i,Sa.current=r,1===Ia)throw t=Da,ul(e,n),Vl(e,n),sl(e),t;if(null===Oa)switch(r=e.finishedWork=e.current.alternate,e.finishedExpirationTime=n,i=Ia,La=null,i){case ka:case 1:throw Error(o(345));case 2:Hl(e,2<n?2:n);break;case Na:if(Vl(e,n),n===(i=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=bl(r)),1073741823===Fa&&10<(r=Ua+500-Hr())){if(Va){var s=e.lastPingedTime;if(0===s||s>=n){e.lastPingedTime=n,ul(e,n);break}}if(0!==(s=rl(e))&&s!==n)break;if(0!==i&&i!==n){e.lastPingedTime=i;break}e.timeoutHandle=En(wl.bind(null,e),r);break}wl(e);break;case Ma:if(Vl(e,n),n===(i=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=bl(r)),Va&&(0===(r=e.lastPingedTime)||r>=n)){e.lastPingedTime=n,ul(e,n);break}if(0!==(r=rl(e))&&r!==n)break;if(0!==i&&i!==n){e.lastPingedTime=i;break}if(1073741823!==Ba?i=10*(1073741821-Ba)-Hr():1073741823===Fa?i=0:(i=10*(1073741821-Fa)-5e3,0>(i=(r=Hr())-i)&&(i=0),(n=10*(1073741821-n)-r)<(i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Ea(i/1960))-i)&&(i=n)),10<i){e.timeoutHandle=En(wl.bind(null,e),i);break}wl(e);break;case 5:if(1073741823!==Fa&&null!==za){s=Fa;var a=za;if(0>=(i=0|a.busyMinDurationMs)?i=0:(r=0|a.busyDelayMs,i=(s=Hr()-(10*(1073741821-s)-(0|a.timeoutMs||5e3)))<=r?0:r+i-s),10<i){Vl(e,n),e.timeoutHandle=En(wl.bind(null,e),i);break}}wl(e);break;default:throw Error(o(329))}if(sl(e),e.callbackNode===t)return ol.bind(null,e)}}return null}function al(e){var t=e.lastExpiredTime;if(t=0!==t?t:1073741823,0!=(48&Pa))throw Error(o(327));if(El(),e===La&&t===Ra||ul(e,t),null!==Oa){var n=Pa;Pa|=Ta;for(var i=hl();;)try{ml();break}catch(t){dl(e,t)}if(is(),Pa=n,Sa.current=i,1===Ia)throw n=Da,ul(e,t),Vl(e,t),sl(e),n;if(null!==Oa)throw Error(o(261));e.finishedWork=e.current.alternate,e.finishedExpirationTime=t,La=null,wl(e),sl(e)}return null}function ll(e,t){var n=Pa;Pa|=1;try{return e(t)}finally{0===(Pa=n)&&Xr()}}function cl(e,t){var n=Pa;Pa&=-2,Pa|=8;try{return e(t)}finally{0===(Pa=n)&&Xr()}}function ul(e,t){e.finishedWork=null,e.finishedExpirationTime=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,Sn(n)),null!==Oa)for(n=Oa.return;null!==n;){var i=n;switch(i.tag){case 1:null!=(i=i.type.childContextTypes)&&wr();break;case 3:Ds(),hr(gr),hr(mr);break;case 5:Bs(i);break;case 4:Ds();break;case 13:case 19:hr(zs);break;case 10:rs(i)}n=n.return}La=e,Oa=Rl(e.current,null),Ra=t,Ia=ka,Da=null,Ba=Fa=1073741823,za=null,ja=0,Va=!1}function dl(e,t){for(;;){try{if(is(),Us.current=wo,Ys)for(var n=qs.memoizedState;null!==n;){var i=n.queue;null!==i&&(i.pending=null),n=n.next}if($s=0,Gs=Ws=qs=null,Ys=!1,null===Oa||null===Oa.return)return Ia=1,Da=t,Oa=null;e:{var r=e,s=Oa.return,o=Oa,a=t;if(t=Ra,o.effectTag|=2048,o.firstEffect=o.lastEffect=null,null!==a&&"object"==typeof a&&"function"==typeof a.then){var l=a;if(0==(2&o.mode)){var c=o.alternate;c?(o.updateQueue=c.updateQueue,o.memoizedState=c.memoizedState,o.expirationTime=c.expirationTime):(o.updateQueue=null,o.memoizedState=null)}var u=0!=(1&zs.current),d=s;do{var h;if(h=13===d.tag){var p=d.memoizedState;if(null!==p)h=null!==p.dehydrated;else{var f=d.memoizedProps;h=void 0!==f.fallback&&(!0!==f.unstable_avoidThisFallback||!u)}}if(h){var m=d.updateQueue;if(null===m){var g=new Set;g.add(l),d.updateQueue=g}else m.add(l);if(0==(2&d.mode)){if(d.effectTag|=64,o.effectTag&=-2981,1===o.tag)if(null===o.alternate)o.tag=17;else{var y=ds(1073741823,null);y.tag=2,hs(o,y)}o.expirationTime=1073741823;break e}a=void 0,o=t;var v=r.pingCache;if(null===v?(v=r.pingCache=new ba,a=new Set,v.set(l,a)):void 0===(a=v.get(l))&&(a=new Set,v.set(l,a)),!a.has(o)){a.add(o);var b=Al.bind(null,r,l,o);l.then(b,b)}d.effectTag|=4096,d.expirationTime=t;break e}d=d.return}while(null!==d);a=Error((ge(o.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+ye(o))}5!==Ia&&(Ia=2),a=na(a,o),d=s;do{switch(d.tag){case 3:l=a,d.effectTag|=4096,d.expirationTime=t,ps(d,wa(d,l,t));break e;case 1:l=a;var w=d.type,x=d.stateNode;if(0==(64&d.effectTag)&&("function"==typeof w.getDerivedStateFromError||null!==x&&"function"==typeof x.componentDidCatch&&(null===Wa||!Wa.has(x)))){d.effectTag|=4096,d.expirationTime=t,ps(d,xa(d,l,t));break e}}d=d.return}while(null!==d)}Oa=vl(Oa)}catch(e){t=e;continue}break}}function hl(){var e=Sa.current;return Sa.current=wo,null===e?wo:e}function pl(e,t){e<Fa&&2<e&&(Fa=e),null!==t&&e<Ba&&2<e&&(Ba=e,za=t)}function fl(e){e>ja&&(ja=e)}function ml(){for(;null!==Oa;)Oa=yl(Oa)}function gl(){for(;null!==Oa&&!Fr();)Oa=yl(Oa)}function yl(e){var t=_a(e.alternate,e,Ra);return e.memoizedProps=e.pendingProps,null===t&&(t=vl(e)),Ca.current=null,t}function vl(e){Oa=e;do{var t=Oa.alternate;if(e=Oa.return,0==(2048&Oa.effectTag)){if(t=ea(t,Oa,Ra),1===Ra||1!==Oa.childExpirationTime){for(var n=0,i=Oa.child;null!==i;){var r=i.expirationTime,s=i.childExpirationTime;r>n&&(n=r),s>n&&(n=s),i=i.sibling}Oa.childExpirationTime=n}if(null!==t)return t;null!==e&&0==(2048&e.effectTag)&&(null===e.firstEffect&&(e.firstEffect=Oa.firstEffect),null!==Oa.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=Oa.firstEffect),e.lastEffect=Oa.lastEffect),1<Oa.effectTag&&(null!==e.lastEffect?e.lastEffect.nextEffect=Oa:e.firstEffect=Oa,e.lastEffect=Oa))}else{if(null!==(t=ta(Oa)))return t.effectTag&=2047,t;null!==e&&(e.firstEffect=e.lastEffect=null,e.effectTag|=2048)}if(null!==(t=Oa.sibling))return t;Oa=e}while(null!==Oa);return Ia===ka&&(Ia=5),null}function bl(e){var t=e.expirationTime;return t>(e=e.childExpirationTime)?t:e}function wl(e){var t=$r();return Wr(99,xl.bind(null,e,t)),null}function xl(e,t){do{El()}while(null!==Ya);if(0!=(48&Pa))throw Error(o(327));var n=e.finishedWork,i=e.finishedExpirationTime;if(null===n)return null;if(e.finishedWork=null,e.finishedExpirationTime=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90,e.nextKnownPendingLevel=0;var r=bl(n);if(e.firstPendingTime=r,i<=e.lastSuspendedTime?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:i<=e.firstSuspendedTime&&(e.firstSuspendedTime=i-1),i<=e.lastPingedTime&&(e.lastPingedTime=0),i<=e.lastExpiredTime&&(e.lastExpiredTime=0),e===La&&(Oa=La=null,Ra=0),1<n.effectTag?null!==n.lastEffect?(n.lastEffect.nextEffect=n,r=n.firstEffect):r=n:r=n.firstEffect,null!==r){var s=Pa;Pa|=Aa,Ca.current=null,bn=Gt;var a=mn();if(gn(a)){if("selectionStart"in a)var l={start:a.selectionStart,end:a.selectionEnd};else e:{var c=(l=(l=a.ownerDocument)&&l.defaultView||window).getSelection&&l.getSelection();if(c&&0!==c.rangeCount){l=c.anchorNode;var u=c.anchorOffset,d=c.focusNode;c=c.focusOffset;try{l.nodeType,d.nodeType}catch(e){l=null;break e}var h=0,p=-1,f=-1,m=0,g=0,y=a,v=null;t:for(;;){for(var b;y!==l||0!==u&&3!==y.nodeType||(p=h+u),y!==d||0!==c&&3!==y.nodeType||(f=h+c),3===y.nodeType&&(h+=y.nodeValue.length),null!==(b=y.firstChild);)v=y,y=b;for(;;){if(y===a)break t;if(v===l&&++m===u&&(p=h),v===d&&++g===c&&(f=h),null!==(b=y.nextSibling))break;v=(y=v).parentNode}y=b}l=-1===p||-1===f?null:{start:p,end:f}}else l=null}l=l||{start:0,end:0}}else l=null;wn={activeElementDetached:null,focusedElem:a,selectionRange:l},Gt=!1,Ha=r;do{try{_l()}catch(e){if(null===Ha)throw Error(o(330));Tl(Ha,e),Ha=Ha.nextEffect}}while(null!==Ha);Ha=r;do{try{for(a=e,l=t;null!==Ha;){var w=Ha.effectTag;if(16&w&&Ve(Ha.stateNode,""),128&w){var x=Ha.alternate;if(null!==x){var _=x.ref;null!==_&&("function"==typeof _?_(null):_.current=null)}}switch(1038&w){case 2:pa(Ha),Ha.effectTag&=-3;break;case 6:pa(Ha),Ha.effectTag&=-3,ya(Ha.alternate,Ha);break;case 1024:Ha.effectTag&=-1025;break;case 1028:Ha.effectTag&=-1025,ya(Ha.alternate,Ha);break;case 4:ya(Ha.alternate,Ha);break;case 8:ga(a,u=Ha,l),da(u)}Ha=Ha.nextEffect}}catch(e){if(null===Ha)throw Error(o(330));Tl(Ha,e),Ha=Ha.nextEffect}}while(null!==Ha);if(_=wn,x=mn(),w=_.focusedElem,l=_.selectionRange,x!==w&&w&&w.ownerDocument&&fn(w.ownerDocument.documentElement,w)){null!==l&&gn(w)&&(x=l.start,void 0===(_=l.end)&&(_=x),"selectionStart"in w?(w.selectionStart=x,w.selectionEnd=Math.min(_,w.value.length)):(_=(x=w.ownerDocument||document)&&x.defaultView||window).getSelection&&(_=_.getSelection(),u=w.textContent.length,a=Math.min(l.start,u),l=void 0===l.end?a:Math.min(l.end,u),!_.extend&&a>l&&(u=l,l=a,a=u),u=pn(w,a),d=pn(w,l),u&&d&&(1!==_.rangeCount||_.anchorNode!==u.node||_.anchorOffset!==u.offset||_.focusNode!==d.node||_.focusOffset!==d.offset)&&((x=x.createRange()).setStart(u.node,u.offset),_.removeAllRanges(),a>l?(_.addRange(x),_.extend(d.node,d.offset)):(x.setEnd(d.node,d.offset),_.addRange(x))))),x=[];for(_=w;_=_.parentNode;)1===_.nodeType&&x.push({element:_,left:_.scrollLeft,top:_.scrollTop});for("function"==typeof w.focus&&w.focus(),w=0;w<x.length;w++)(_=x[w]).element.scrollLeft=_.left,_.element.scrollTop=_.top}Gt=!!bn,wn=bn=null,e.current=n,Ha=r;do{try{for(w=e;null!==Ha;){var E=Ha.effectTag;if(36&E&&ca(w,Ha.alternate,Ha),128&E){x=void 0;var S=Ha.ref;if(null!==S){var C=Ha.stateNode;Ha.tag,x=C,"function"==typeof S?S(x):S.current=x}}Ha=Ha.nextEffect}}catch(e){if(null===Ha)throw Error(o(330));Tl(Ha,e),Ha=Ha.nextEffect}}while(null!==Ha);Ha=null,Br(),Pa=s}else e.current=n;if(Ga)Ga=!1,Ya=e,Xa=t;else for(Ha=r;null!==Ha;)t=Ha.nextEffect,Ha.nextEffect=null,Ha=t;if(0===(t=e.firstPendingTime)&&(Wa=null),1073741823===t?e===Ja?Za++:(Za=0,Ja=e):Za=0,"function"==typeof Nl&&Nl(n.stateNode,i),sl(e),$a)throw $a=!1,e=qa,qa=null,e;return 0!=(8&Pa)||Xr(),null}function _l(){for(;null!==Ha;){var e=Ha.effectTag;0!=(256&e)&&oa(Ha.alternate,Ha),0==(512&e)||Ga||(Ga=!0,Gr(97,(function(){return El(),null}))),Ha=Ha.nextEffect}}function El(){if(90!==Xa){var e=97<Xa?97:Xa;return Xa=90,Wr(e,Sl)}}function Sl(){if(null===Ya)return!1;var e=Ya;if(Ya=null,0!=(48&Pa))throw Error(o(331));var t=Pa;for(Pa|=Aa,e=e.current.firstEffect;null!==e;){try{var n=e;if(0!=(512&n.effectTag))switch(n.tag){case 0:case 11:case 15:case 22:aa(5,n),la(5,n)}}catch(t){if(null===e)throw Error(o(330));Tl(e,t)}n=e.nextEffect,e.nextEffect=null,e=n}return Pa=t,Xr(),!0}function Cl(e,t,n){hs(e,t=wa(e,t=na(n,t),1073741823)),null!==(e=il(e,1073741823))&&sl(e)}function Tl(e,t){if(3===e.tag)Cl(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){Cl(n,e,t);break}if(1===n.tag){var i=n.stateNode;if("function"==typeof n.type.getDerivedStateFromError||"function"==typeof i.componentDidCatch&&(null===Wa||!Wa.has(i))){hs(n,e=xa(n,e=na(t,e),1073741823)),null!==(n=il(n,1073741823))&&sl(n);break}}n=n.return}}function Al(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),La===e&&Ra===n?Ia===Ma||Ia===Na&&1073741823===Fa&&Hr()-Ua<500?ul(e,Ra):Va=!0:jl(e,n)&&(0!==(t=e.lastPingedTime)&&t<n||(e.lastPingedTime=n,sl(e)))}function kl(e,t){var n=e.stateNode;null!==n&&n.delete(t),0===(t=0)&&(t=tl(t=el(),e,null)),null!==(e=il(e,t))&&sl(e)}_a=function(e,t,n){var i=t.expirationTime;if(null!==e){var r=t.pendingProps;if(e.memoizedProps!==r||gr.current)Ro=!0;else{if(i<n){switch(Ro=!1,t.tag){case 3:Ho(t),Lo();break;case 5:if(Fs(t),4&t.mode&&1!==n&&r.hidden)return t.expirationTime=t.childExpirationTime=1,null;break;case 1:br(t.type)&&Er(t);break;case 4:Is(t,t.stateNode.containerInfo);break;case 10:i=t.memoizedProps.value,r=t.type._context,pr(Qr,r._currentValue),r._currentValue=i;break;case 13:if(null!==t.memoizedState)return 0!==(i=t.child.childExpirationTime)&&i>=n?Yo(e,t,n):(pr(zs,1&zs.current),null!==(t=Jo(e,t,n))?t.sibling:null);pr(zs,1&zs.current);break;case 19:if(i=t.childExpirationTime>=n,0!=(64&e.effectTag)){if(i)return Zo(e,t,n);t.effectTag|=64}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null),pr(zs,zs.current),!i)return null}return Jo(e,t,n)}Ro=!1}}else Ro=!1;switch(t.expirationTime=0,t.tag){case 2:if(i=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,r=vr(t,mr.current),os(t,n),r=Zs(null,t,i,e,r,n),t.effectTag|=1,"object"==typeof r&&null!==r&&"function"==typeof r.render&&void 0===r.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,br(i)){var s=!0;Er(t)}else s=!1;t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,cs(t);var a=i.getDerivedStateFromProps;"function"==typeof a&&vs(t,i,a,e),r.updater=bs,t.stateNode=r,r._reactInternalFiber=t,Es(t,i,e,n),t=Uo(null,t,i,!0,s,n)}else t.tag=0,Io(null,t,r,n),t=t.child;return t;case 16:e:{if(r=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,function(e){if(-1===e._status){e._status=0;var t=e._ctor;t=t(),e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}}(r),1!==r._status)throw r._result;switch(r=r._result,t.type=r,s=t.tag=function(e){if("function"==typeof e)return Ol(e)?1:0;if(null!=e){if((e=e.$$typeof)===le)return 11;if(e===de)return 14}return 2}(r),e=Jr(r,e),s){case 0:t=jo(null,t,r,e,n);break e;case 1:t=Vo(null,t,r,e,n);break e;case 11:t=Do(null,t,r,e,n);break e;case 14:t=Fo(null,t,r,Jr(r.type,e),i,n);break e}throw Error(o(306,r,""))}return t;case 0:return i=t.type,r=t.pendingProps,jo(e,t,i,r=t.elementType===i?r:Jr(i,r),n);case 1:return i=t.type,r=t.pendingProps,Vo(e,t,i,r=t.elementType===i?r:Jr(i,r),n);case 3:if(Ho(t),i=t.updateQueue,null===e||null===i)throw Error(o(282));if(i=t.pendingProps,r=null!==(r=t.memoizedState)?r.element:null,us(e,t),fs(t,i,null,n),(i=t.memoizedState.element)===r)Lo(),t=Jo(e,t,n);else{if((r=t.stateNode.hydrate)&&(Co=Cn(t.stateNode.containerInfo.firstChild),So=t,r=To=!0),r)for(n=Ns(t,null,i,n),t.child=n;n;)n.effectTag=-3&n.effectTag|1024,n=n.sibling;else Io(e,t,i,n),Lo();t=t.child}return t;case 5:return Fs(t),null===e&&No(t),i=t.type,r=t.pendingProps,s=null!==e?e.memoizedProps:null,a=r.children,_n(i,r)?a=null:null!==s&&_n(i,s)&&(t.effectTag|=16),zo(e,t),4&t.mode&&1!==n&&r.hidden?(t.expirationTime=t.childExpirationTime=1,t=null):(Io(e,t,a,n),t=t.child),t;case 6:return null===e&&No(t),null;case 13:return Yo(e,t,n);case 4:return Is(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=ks(t,null,i,n):Io(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,Do(e,t,i,r=t.elementType===i?r:Jr(i,r),n);case 7:return Io(e,t,t.pendingProps,n),t.child;case 8:case 12:return Io(e,t,t.pendingProps.children,n),t.child;case 10:e:{i=t.type._context,r=t.pendingProps,a=t.memoizedProps,s=r.value;var l=t.type._context;if(pr(Qr,l._currentValue),l._currentValue=s,null!==a)if(l=a.value,0===(s=Vi(l,s)?0:0|("function"==typeof i._calculateChangedBits?i._calculateChangedBits(l,s):1073741823))){if(a.children===r.children&&!gr.current){t=Jo(e,t,n);break e}}else for(null!==(l=t.child)&&(l.return=t);null!==l;){var c=l.dependencies;if(null!==c){a=l.child;for(var u=c.firstContext;null!==u;){if(u.context===i&&0!=(u.observedBits&s)){1===l.tag&&((u=ds(n,null)).tag=2,hs(l,u)),l.expirationTime<n&&(l.expirationTime=n),null!==(u=l.alternate)&&u.expirationTime<n&&(u.expirationTime=n),ss(l.return,n),c.expirationTime<n&&(c.expirationTime=n);break}u=u.next}}else a=10===l.tag&&l.type===t.type?null:l.child;if(null!==a)a.return=l;else for(a=l;null!==a;){if(a===t){a=null;break}if(null!==(l=a.sibling)){l.return=a.return,a=l;break}a=a.return}l=a}Io(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=(s=t.pendingProps).children,os(t,n),i=i(r=as(r,s.unstable_observedBits)),t.effectTag|=1,Io(e,t,i,n),t.child;case 14:return s=Jr(r=t.type,t.pendingProps),Fo(e,t,r,s=Jr(r.type,s),i,n);case 15:return Bo(e,t,t.type,t.pendingProps,i,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:Jr(i,r),null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),t.tag=1,br(i)?(e=!0,Er(t)):e=!1,os(t,n),xs(t,i,r),Es(t,i,r,n),Uo(null,t,i,!0,e,n);case 19:return Zo(e,t,n)}throw Error(o(156,t.tag))};var Nl=null,Ml=null;function Pl(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function Ll(e,t,n,i){return new Pl(e,t,n,i)}function Ol(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Rl(e,t){var n=e.alternate;return null===n?((n=Ll(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.effectTag=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childExpirationTime=e.childExpirationTime,n.expirationTime=e.expirationTime,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{expirationTime:t.expirationTime,firstContext:t.firstContext,responders:t.responders},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Il(e,t,n,i,r,s){var a=2;if(i=e,"function"==typeof e)Ol(e)&&(a=1);else if("string"==typeof e)a=5;else e:switch(e){case ne:return Dl(n.children,r,s,t);case ae:a=8,r|=7;break;case ie:a=8,r|=1;break;case re:return(e=Ll(12,n,t,8|r)).elementType=re,e.type=re,e.expirationTime=s,e;case ce:return(e=Ll(13,n,t,r)).type=ce,e.elementType=ce,e.expirationTime=s,e;case ue:return(e=Ll(19,n,t,r)).elementType=ue,e.expirationTime=s,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case se:a=10;break e;case oe:a=9;break e;case le:a=11;break e;case de:a=14;break e;case he:a=16,i=null;break e;case pe:a=22;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Ll(a,n,t,r)).elementType=e,t.type=i,t.expirationTime=s,t}function Dl(e,t,n,i){return(e=Ll(7,e,i,t)).expirationTime=n,e}function Fl(e,t,n){return(e=Ll(6,e,null,t)).expirationTime=n,e}function Bl(e,t,n){return(t=Ll(4,null!==e.children?e.children:[],e.key,t)).expirationTime=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function zl(e,t,n){this.tag=t,this.current=null,this.containerInfo=e,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function jl(e,t){var n=e.firstSuspendedTime;return e=e.lastSuspendedTime,0!==n&&n>=t&&e<=t}function Vl(e,t){var n=e.firstSuspendedTime,i=e.lastSuspendedTime;n<t&&(e.firstSuspendedTime=t),(i>t||0===n)&&(e.lastSuspendedTime=t),t<=e.lastPingedTime&&(e.lastPingedTime=0),t<=e.lastExpiredTime&&(e.lastExpiredTime=0)}function Ul(e,t){t>e.firstPendingTime&&(e.firstPendingTime=t);var n=e.firstSuspendedTime;0!==n&&(t>=n?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:t>=e.lastSuspendedTime&&(e.lastSuspendedTime=t+1),t>e.nextKnownPendingLevel&&(e.nextKnownPendingLevel=t))}function Hl(e,t){var n=e.lastExpiredTime;(0===n||n>t)&&(e.lastExpiredTime=t)}function $l(e,t,n,i){var r=t.current,s=el(),a=gs.suspense;s=tl(s,r,a);e:if(n){t:{if(et(n=n._reactInternalFiber)!==n||1!==n.tag)throw Error(o(170));var l=n;do{switch(l.tag){case 3:l=l.stateNode.context;break t;case 1:if(br(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break t}}l=l.return}while(null!==l);throw Error(o(171))}if(1===n.tag){var c=n.type;if(br(c)){n=_r(n,c,l);break e}}n=l}else n=fr;return null===t.context?t.context=n:t.pendingContext=n,(t=ds(s,a)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),hs(r,t),nl(r,s),s}function ql(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wl(e,t){null!==(e=e.memoizedState)&&null!==e.dehydrated&&e.retryTime<t&&(e.retryTime=t)}function Gl(e,t){Wl(e,t),(e=e.alternate)&&Wl(e,t)}function Yl(e,t,n){var i=new zl(e,t,n=null!=n&&!0===n.hydrate),r=Ll(3,null,null,2===t?7:1===t?3:0);i.current=r,r.stateNode=i,cs(r),e[Mn]=i.current,n&&0!==t&&function(e,t){var n=Qe(t);At.forEach((function(e){mt(e,t,n)})),kt.forEach((function(e){mt(e,t,n)}))}(0,9===e.nodeType?e:e.ownerDocument),this._internalRoot=i}function Xl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Kl(e,t,n,i,r){var s=n._reactRootContainer;if(s){var o=s._internalRoot;if("function"==typeof r){var a=r;r=function(){var e=ql(o);a.call(e)}}$l(t,o,e,r)}else{if(s=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new Yl(e,0,t?{hydrate:!0}:void 0)}(n,i),o=s._internalRoot,"function"==typeof r){var l=r;r=function(){var e=ql(o);l.call(e)}}cl((function(){$l(t,o,e,r)}))}return ql(o)}function Zl(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:te,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}function Jl(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Xl(t))throw Error(o(200));return Zl(e,t,null,n)}Yl.prototype.render=function(e){$l(e,this._internalRoot,null,null)},Yl.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;$l(null,e,null,(function(){t[Mn]=null}))},gt=function(e){if(13===e.tag){var t=Zr(el(),150,100);nl(e,t),Gl(e,t)}},yt=function(e){13===e.tag&&(nl(e,3),Gl(e,3))},vt=function(e){if(13===e.tag){var t=el();nl(e,t=tl(t,e,null)),Gl(e,t)}},k=function(e,t,n){switch(t){case"input":if(Ce(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=Rn(i);if(!r)throw Error(o(90));xe(i),Ce(i,r)}}}break;case"textarea":Le(e,n);break;case"select":null!=(t=n.value)&&Ne(e,!!n.multiple,t,!1)}},R=ll,I=function(e,t,n,i,r){var s=Pa;Pa|=4;try{return Wr(98,e.bind(null,t,n,i,r))}finally{0===(Pa=s)&&Xr()}},D=function(){0==(49&Pa)&&(function(){if(null!==Ka){var e=Ka;Ka=null,e.forEach((function(e,t){Hl(t,e),sl(t)})),Xr()}}(),El())},F=function(e,t){var n=Pa;Pa|=2;try{return e(t)}finally{0===(Pa=n)&&Xr()}};var Ql={Events:[Ln,On,Rn,T,E,Vn,function(e){st(e,jn)},L,O,Jt,lt,El,{current:!1}]};!function(e){var t=e.findFiberByHostInstance;(function(e){if("undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var n=t.inject(e);Nl=function(e){try{t.onCommitFiberRoot(n,e,void 0,64==(64&e.current.effectTag))}catch(e){}},Ml=function(e){try{t.onCommitFiberUnmount(n,e)}catch(e){}}}catch(e){}})(r({},e,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:K.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=it(e))?null:e.stateNode},findFiberByHostInstance:function(e){return t?t(e):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))}({findFiberByHostInstance:Pn,bundleType:0,version:"16.14.0",rendererPackageName:"react-dom"}),t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ql,t.createPortal=Jl,t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternalFiber;if(void 0===t){if("function"==typeof e.render)throw Error(o(188));throw Error(o(268,Object.keys(e)))}return e=null===(e=it(t))?null:e.stateNode},t.flushSync=function(e,t){if(0!=(48&Pa))throw Error(o(187));var n=Pa;Pa|=1;try{return Wr(99,e.bind(null,t))}finally{Pa=n,Xr()}},t.hydrate=function(e,t,n){if(!Xl(t))throw Error(o(200));return Kl(null,e,t,!0,n)},t.render=function(e,t,n){if(!Xl(t))throw Error(o(200));return Kl(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Xl(e))throw Error(o(40));return!!e._reactRootContainer&&(cl((function(){Kl(null,null,e,!1,(function(){e._reactRootContainer=null,e[Mn]=null}))})),!0)},t.unstable_batchedUpdates=ll,t.unstable_createPortal=function(e,t){return Jl(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Xl(n))throw Error(o(200));if(null==e||void 0===e._reactInternalFiber)throw Error(o(38));return Kl(e,t,n,!1,i)},t.version="16.14.0"},1542:(e,t,n)=>{"use strict";!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(3577)},8702:(e,t)=>{"use strict";var n="function"==typeof Symbol&&Symbol.for,i=n?Symbol.for("react.element"):60103,r=n?Symbol.for("react.portal"):60106,s=n?Symbol.for("react.fragment"):60107,o=n?Symbol.for("react.strict_mode"):60108,a=n?Symbol.for("react.profiler"):60114,l=n?Symbol.for("react.provider"):60109,c=n?Symbol.for("react.context"):60110,u=n?Symbol.for("react.async_mode"):60111,d=n?Symbol.for("react.concurrent_mode"):60111,h=n?Symbol.for("react.forward_ref"):60112,p=n?Symbol.for("react.suspense"):60113,f=n?Symbol.for("react.suspense_list"):60120,m=n?Symbol.for("react.memo"):60115,g=n?Symbol.for("react.lazy"):60116,y=n?Symbol.for("react.block"):60121,v=n?Symbol.for("react.fundamental"):60117,b=n?Symbol.for("react.responder"):60118,w=n?Symbol.for("react.scope"):60119;function x(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case i:switch(e=e.type){case u:case d:case s:case a:case o:case p:return e;default:switch(e=e&&e.$$typeof){case c:case h:case g:case m:case l:return e;default:return t}}case r:return t}}}function _(e){return x(e)===d}t.AsyncMode=u,t.ConcurrentMode=d,t.ContextConsumer=c,t.ContextProvider=l,t.Element=i,t.ForwardRef=h,t.Fragment=s,t.Lazy=g,t.Memo=m,t.Portal=r,t.Profiler=a,t.StrictMode=o,t.Suspense=p,t.isAsyncMode=function(e){return _(e)||x(e)===u},t.isConcurrentMode=_,t.isContextConsumer=function(e){return x(e)===c},t.isContextProvider=function(e){return x(e)===l},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===i},t.isForwardRef=function(e){return x(e)===h},t.isFragment=function(e){return x(e)===s},t.isLazy=function(e){return x(e)===g},t.isMemo=function(e){return x(e)===m},t.isPortal=function(e){return x(e)===r},t.isProfiler=function(e){return x(e)===a},t.isStrictMode=function(e){return x(e)===o},t.isSuspense=function(e){return x(e)===p},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===s||e===d||e===a||e===o||e===p||e===f||"object"==typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===m||e.$$typeof===l||e.$$typeof===c||e.$$typeof===h||e.$$typeof===v||e.$$typeof===b||e.$$typeof===w||e.$$typeof===y)},t.typeOf=x},9185:(e,t,n)=>{"use strict";e.exports=n(8702)},1535:(e,t,n)=>{"use strict";var i=n(2525),r="function"==typeof Symbol&&Symbol.for,s=r?Symbol.for("react.element"):60103,o=r?Symbol.for("react.portal"):60106,a=r?Symbol.for("react.fragment"):60107,l=r?Symbol.for("react.strict_mode"):60108,c=r?Symbol.for("react.profiler"):60114,u=r?Symbol.for("react.provider"):60109,d=r?Symbol.for("react.context"):60110,h=r?Symbol.for("react.forward_ref"):60112,p=r?Symbol.for("react.suspense"):60113,f=r?Symbol.for("react.memo"):60115,m=r?Symbol.for("react.lazy"):60116,g="function"==typeof Symbol&&Symbol.iterator;function y(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b={};function w(e,t,n){this.props=e,this.context=t,this.refs=b,this.updater=n||v}function x(){}function _(e,t,n){this.props=e,this.context=t,this.refs=b,this.updater=n||v}w.prototype.isReactComponent={},w.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(y(85));this.updater.enqueueSetState(this,e,t,"setState")},w.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},x.prototype=w.prototype;var E=_.prototype=new x;E.constructor=_,i(E,w.prototype),E.isPureReactComponent=!0;var S={current:null},C=Object.prototype.hasOwnProperty,T={key:!0,ref:!0,__self:!0,__source:!0};function A(e,t,n){var i,r={},o=null,a=null;if(null!=t)for(i in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(o=""+t.key),t)C.call(t,i)&&!T.hasOwnProperty(i)&&(r[i]=t[i]);var l=arguments.length-2;if(1===l)r.children=n;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];r.children=c}if(e&&e.defaultProps)for(i in l=e.defaultProps)void 0===r[i]&&(r[i]=l[i]);return{$$typeof:s,type:e,key:o,ref:a,props:r,_owner:S.current}}function k(e){return"object"==typeof e&&null!==e&&e.$$typeof===s}var N=/\/+/g,M=[];function P(e,t,n,i){if(M.length){var r=M.pop();return r.result=e,r.keyPrefix=t,r.func=n,r.context=i,r.count=0,r}return{result:e,keyPrefix:t,func:n,context:i,count:0}}function L(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>M.length&&M.push(e)}function O(e,t,n,i){var r=typeof e;"undefined"!==r&&"boolean"!==r||(e=null);var a=!1;if(null===e)a=!0;else switch(r){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case s:case o:a=!0}}if(a)return n(i,e,""===t?"."+I(e,0):t),1;if(a=0,t=""===t?".":t+":",Array.isArray(e))for(var l=0;l<e.length;l++){var c=t+I(r=e[l],l);a+=O(r,c,n,i)}else if(null===e||"object"!=typeof e?c=null:c="function"==typeof(c=g&&e[g]||e["@@iterator"])?c:null,"function"==typeof c)for(e=c.call(e),l=0;!(r=e.next()).done;)a+=O(r=r.value,c=t+I(r,l++),n,i);else if("object"===r)throw n=""+e,Error(y(31,"[object Object]"===n?"object with keys {"+Object.keys(e).join(", ")+"}":n,""));return a}function R(e,t,n){return null==e?0:O(e,"",t,n)}function I(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,(function(e){return t[e]}))}(e.key):t.toString(36)}function D(e,t){e.func.call(e.context,t,e.count++)}function F(e,t,n){var i=e.result,r=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?B(e,i,n,(function(e){return e})):null!=e&&(k(e)&&(e=function(e,t){return{$$typeof:s,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,r+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(N,"$&/")+"/")+n)),i.push(e))}function B(e,t,n,i,r){var s="";null!=n&&(s=(""+n).replace(N,"$&/")+"/"),R(e,F,t=P(t,s,i,r)),L(t)}var z={current:null};function j(){var e=z.current;if(null===e)throw Error(y(321));return e}var V={ReactCurrentDispatcher:z,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:S,IsSomeRendererActing:{current:!1},assign:i};t.Children={map:function(e,t,n){if(null==e)return e;var i=[];return B(e,i,null,t,n),i},forEach:function(e,t,n){if(null==e)return e;R(e,D,t=P(null,null,t,n)),L(t)},count:function(e){return R(e,(function(){return null}),null)},toArray:function(e){var t=[];return B(e,t,null,(function(e){return e})),t},only:function(e){if(!k(e))throw Error(y(143));return e}},t.Component=w,t.Fragment=a,t.Profiler=c,t.PureComponent=_,t.StrictMode=l,t.Suspense=p,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=V,t.cloneElement=function(e,t,n){if(null==e)throw Error(y(267,e));var r=i({},e.props),o=e.key,a=e.ref,l=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,l=S.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)C.call(t,u)&&!T.hasOwnProperty(u)&&(r[u]=void 0===t[u]&&void 0!==c?c[u]:t[u])}var u=arguments.length-2;if(1===u)r.children=n;else if(1<u){c=Array(u);for(var d=0;d<u;d++)c[d]=arguments[d+2];r.children=c}return{$$typeof:s,type:e.type,key:o,ref:a,props:r,_owner:l}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:d,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:u,_context:e},e.Consumer=e},t.createElement=A,t.createFactory=function(e){var t=A.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:h,render:e}},t.isValidElement=k,t.lazy=function(e){return{$$typeof:m,_ctor:e,_status:-1,_result:null}},t.memo=function(e,t){return{$$typeof:f,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return j().useCallback(e,t)},t.useContext=function(e,t){return j().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return j().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return j().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return j().useLayoutEffect(e,t)},t.useMemo=function(e,t){return j().useMemo(e,t)},t.useReducer=function(e,t,n){return j().useReducer(e,t,n)},t.useRef=function(e){return j().useRef(e)},t.useState=function(e){return j().useState(e)},t.version="16.14.0"},7378:(e,t,n)=>{"use strict";e.exports=n(1535)},4926:(e,t,n)=>{const i=n(2904),r=n(8281),{isPlainObject:s}=n(1288),o=n(1857),a=n(8523),{parse:l}=n(1722),c=["img","audio","video","picture","svg","object","map","iframe","embed"],u=["script","style"];function d(e,t){e&&Object.keys(e).forEach((function(n){t(e[n],n)}))}function h(e,t){return{}.hasOwnProperty.call(e,t)}function p(e,t){const n=[];return d(e,(function(e){t(e)&&n.push(e)})),n}e.exports=m;const f=/^[^\0\t\n\f\r /<=>]+$/;function m(e,t,n){if(null==e)return"";let y="",v="";function b(e,t){const n=this;this.tag=e,this.attribs=t||{},this.tagPosition=y.length,this.text="",this.mediaChildren=[],this.updateParentNodeText=function(){if(N.length){N[N.length-1].text+=n.text}},this.updateParentNodeMediaChildren=function(){if(N.length&&c.includes(this.tag)){N[N.length-1].mediaChildren.push(this.tag)}}}(t=Object.assign({},m.defaults,t)).parser=Object.assign({},g,t.parser),u.forEach((function(e){t.allowedTags&&t.allowedTags.indexOf(e)>-1&&!t.allowVulnerableTags&&console.warn(`\n\n⚠️ Your \`allowedTags\` option includes, \`${e}\`, which is inherently\nvulnerable to XSS attacks. Please remove it from \`allowedTags\`.\nOr, to disable this warning, add the \`allowVulnerableTags\` option\nand ensure you are accounting for this risk.\n\n`)}));const w=t.nonTextTags||["script","style","textarea","option"];let x,_;t.allowedAttributes&&(x={},_={},d(t.allowedAttributes,(function(e,t){x[t]=[];const n=[];e.forEach((function(e){"string"==typeof e&&e.indexOf("*")>=0?n.push(r(e).replace(/\\\*/g,".*")):x[t].push(e)})),n.length&&(_[t]=new RegExp("^("+n.join("|")+")$"))})));const E={},S={},C={};d(t.allowedClasses,(function(e,t){x&&(h(x,t)||(x[t]=[]),x[t].push("class")),E[t]=[],C[t]=[];const n=[];e.forEach((function(e){"string"==typeof e&&e.indexOf("*")>=0?n.push(r(e).replace(/\\\*/g,".*")):e instanceof RegExp?C[t].push(e):E[t].push(e)})),n.length&&(S[t]=new RegExp("^("+n.join("|")+")$"))}));const T={};let A,k,N,M,P,L,O;d(t.transformTags,(function(e,t){let n;"function"==typeof e?n=e:"string"==typeof e&&(n=m.simpleTransform(e)),"*"===t?A=n:T[t]=n}));let R=!1;D();const I=new i.Parser({onopentag:function(e,n){if(t.enforceHtmlBoundary&&"html"===e&&D(),L)return void O++;const i=new b(e,n);N.push(i);let r=!1;const c=!!i.text;let u;if(h(T,e)&&(u=T[e](e,n),i.attribs=n=u.attribs,void 0!==u.text&&(i.innerText=u.text),e!==u.tagName&&(i.name=e=u.tagName,P[k]=u.tagName)),A&&(u=A(e,n),i.attribs=n=u.attribs,e!==u.tagName&&(i.name=e=u.tagName,P[k]=u.tagName)),(t.allowedTags&&-1===t.allowedTags.indexOf(e)||"recursiveEscape"===t.disallowedTagsMode&&!function(e){for(const t in e)if(h(e,t))return!1;return!0}(M)||null!=t.nestingLimit&&k>=t.nestingLimit)&&(r=!0,M[k]=!0,"discard"===t.disallowedTagsMode&&-1!==w.indexOf(e)&&(L=!0,O=1),M[k]=!0),k++,r){if("discard"===t.disallowedTagsMode)return;v=y,y=""}y+="<"+e,"script"===e&&(t.allowedScriptHostnames||t.allowedScriptDomains)&&(i.innerText=""),(!x||h(x,e)||x["*"])&&d(n,(function(n,r){if(!f.test(r))return void delete i.attribs[r];let c,u=!1;if(!x||h(x,e)&&-1!==x[e].indexOf(r)||x["*"]&&-1!==x["*"].indexOf(r)||h(_,e)&&_[e].test(r)||_["*"]&&_["*"].test(r))u=!0;else if(x&&x[e])for(const t of x[e])if(s(t)&&t.name&&t.name===r){u=!0;let e="";if(!0===t.multiple){const i=n.split(" ");for(const n of i)-1!==t.values.indexOf(n)&&(""===e?e=n:e+=" "+n)}else t.values.indexOf(n)>=0&&(e=n);n=e}if(u){if(-1!==t.allowedSchemesAppliedToAttributes.indexOf(r)&&B(e,n))return void delete i.attribs[r];if("script"===e&&"src"===r){let e=!0;try{const i=new URL(n);if(t.allowedScriptHostnames||t.allowedScriptDomains){const n=(t.allowedScriptHostnames||[]).find((function(e){return e===i.hostname})),r=(t.allowedScriptDomains||[]).find((function(e){return i.hostname===e||i.hostname.endsWith(`.${e}`)}));e=n||r}}catch(t){e=!1}if(!e)return void delete i.attribs[r]}if("iframe"===e&&"src"===r){let e=!0;try{if((n=n.replace(/^(\w+:)?\s*[\\/]\s*[\\/]/,"$1//")).startsWith("relative:"))throw new Error("relative: exploit attempt");let i="relative://relative-site";for(let e=0;e<100;e++)i+=`/${e}`;const r=new URL(n,i);if(r&&"relative-site"===r.hostname&&"relative:"===r.protocol)e=h(t,"allowIframeRelativeUrls")?t.allowIframeRelativeUrls:!t.allowedIframeHostnames&&!t.allowedIframeDomains;else if(t.allowedIframeHostnames||t.allowedIframeDomains){const n=(t.allowedIframeHostnames||[]).find((function(e){return e===r.hostname})),i=(t.allowedIframeDomains||[]).find((function(e){return r.hostname===e||r.hostname.endsWith(`.${e}`)}));e=n||i}}catch(t){e=!1}if(!e)return void delete i.attribs[r]}if("srcset"===r)try{if(c=a(n),c.forEach((function(e){B("srcset",e.url)&&(e.evil=!0)})),c=p(c,(function(e){return!e.evil})),!c.length)return void delete i.attribs[r];n=p(c,(function(e){return!e.evil})).map((function(e){if(!e.url)throw new Error("URL missing");return e.url+(e.w?` ${e.w}w`:"")+(e.h?` ${e.h}h`:"")+(e.d?` ${e.d}x`:"")})).join(", "),i.attribs[r]=n}catch(e){return void delete i.attribs[r]}if("class"===r){const t=E[e],s=E["*"],a=S[e],l=C[e],c=[a,S["*"]].concat(l).filter((function(e){return e}));if(!(n=z(n,t&&s?o(t,s):t||s,c)).length)return void delete i.attribs[r]}if("style"===r)try{const s=function(e,t){if(!t)return e;const n=e.nodes[0];let i;i=t[n.selector]&&t["*"]?o(t[n.selector],t["*"]):t[n.selector]||t["*"];i&&(e.nodes[0].nodes=n.nodes.reduce(function(e){return function(t,n){if(h(e,n.prop)){e[n.prop].some((function(e){return e.test(n.value)}))&&t.push(n)}return t}}(i),[]));return e}(l(e+" {"+n+"}"),t.allowedStyles);if(0===(n=function(e){return e.nodes[0].nodes.reduce((function(e,t){return e.push(`${t.prop}:${t.value}${t.important?" !important":""}`),e}),[]).join(";")}(s)).length)return void delete i.attribs[r]}catch(e){return void delete i.attribs[r]}y+=" "+r,n&&n.length&&(y+='="'+F(n,!0)+'"')}else delete i.attribs[r]})),-1!==t.selfClosing.indexOf(e)?y+=" />":(y+=">",!i.innerText||c||t.textFilter||(y+=F(i.innerText),R=!0)),r&&(y=v+F(y),v="")},ontext:function(e){if(L)return;const n=N[N.length-1];let i;if(n&&(i=n.tag,e=void 0!==n.innerText?n.innerText:e),"discard"!==t.disallowedTagsMode||"script"!==i&&"style"!==i){const n=F(e,!1);t.textFilter&&!R?y+=t.textFilter(n,i):R||(y+=n)}else y+=e;if(N.length){N[N.length-1].text+=e}},onclosetag:function(e){if(L){if(O--,O)return;L=!1}const n=N.pop();if(!n)return;L=!!t.enforceHtmlBoundary&&"html"===e,k--;const i=M[k];if(i){if(delete M[k],"discard"===t.disallowedTagsMode)return void n.updateParentNodeText();v=y,y=""}P[k]&&(e=P[k],delete P[k]),t.exclusiveFilter&&t.exclusiveFilter(n)?y=y.substr(0,n.tagPosition):(n.updateParentNodeMediaChildren(),n.updateParentNodeText(),-1===t.selfClosing.indexOf(e)?(y+="</"+e+">",i&&(y=v+F(y),v=""),R=!1):i&&(y=v,v=""))}},t.parser);return I.write(e),I.end(),y;function D(){y="",k=0,N=[],M={},P={},L=!1,O=0}function F(e,n){return"string"!=typeof e&&(e+=""),t.parser.decodeEntities&&(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),n&&(e=e.replace(/"/g,"&quot;"))),e=e.replace(/&(?![a-zA-Z0-9#]{1,20};)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),n&&(e=e.replace(/"/g,"&quot;")),e}function B(e,n){const i=(n=(n=n.replace(/[\x00-\x20]+/g,"")).replace(/<!--.*?-->/g,"")).match(/^([a-zA-Z][a-zA-Z0-9.\-+]*):/);if(!i)return!!n.match(/^[/\\]{2}/)&&!t.allowProtocolRelative;const r=i[1].toLowerCase();return h(t.allowedSchemesByTag,e)?-1===t.allowedSchemesByTag[e].indexOf(r):!t.allowedSchemes||-1===t.allowedSchemes.indexOf(r)}function z(e,t,n){return t?(e=e.split(/\s+/)).filter((function(e){return-1!==t.indexOf(e)||n.some((function(t){return t.test(e)}))})).join(" "):e}}const g={decodeEntities:!0};m.defaults={allowedTags:["address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","hgroup","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","main","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rb","rp","rt","rtc","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr"],disallowedTagsMode:"discard",allowedAttributes:{a:["href","name","target"],img:["src","srcset","alt","title","width","height","loading"]},selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto","tel"],allowedSchemesByTag:{},allowedSchemesAppliedToAttributes:["href","src","cite"],allowProtocolRelative:!0,enforceHtmlBoundary:!1},m.simpleTransform=function(e,t,n){return n=void 0===n||n,t=t||{},function(i,r){let s;if(n)for(s in t)r[s]=t[s];else r=t;return{tagName:e,attribs:r}}}},8281:e=>{"use strict";e.exports=e=>{if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}},1288:(e,t)=>{"use strict";function n(e){return"[object Object]"===Object.prototype.toString.call(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.isPlainObject=function(e){var t,i;return!1!==n(e)&&(void 0===(t=e.constructor)||!1!==n(i=t.prototype)&&!1!==i.hasOwnProperty("isPrototypeOf"))}},3323:(e,t)=>{"use strict";var n,i,r,s,o;if("undefined"==typeof window||"function"!=typeof MessageChannel){var a=null,l=null,c=function(){if(null!==a)try{var e=t.unstable_now();a(!0,e),a=null}catch(e){throw setTimeout(c,0),e}},u=Date.now();t.unstable_now=function(){return Date.now()-u},n=function(e){null!==a?setTimeout(n,0,e):(a=e,setTimeout(c,0))},i=function(e,t){l=setTimeout(e,t)},r=function(){clearTimeout(l)},s=function(){return!1},o=t.unstable_forceFrameRate=function(){}}else{var d=window.performance,h=window.Date,p=window.setTimeout,f=window.clearTimeout;if("undefined"!=typeof console){var m=window.cancelAnimationFrame;"function"!=typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!=typeof m&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")}if("object"==typeof d&&"function"==typeof d.now)t.unstable_now=function(){return d.now()};else{var g=h.now();t.unstable_now=function(){return h.now()-g}}var y=!1,v=null,b=-1,w=5,x=0;s=function(){return t.unstable_now()>=x},o=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):w=0<e?Math.floor(1e3/e):5};var _=new MessageChannel,E=_.port2;_.port1.onmessage=function(){if(null!==v){var e=t.unstable_now();x=e+w;try{v(!0,e)?E.postMessage(null):(y=!1,v=null)}catch(e){throw E.postMessage(null),e}}else y=!1},n=function(e){v=e,y||(y=!0,E.postMessage(null))},i=function(e,n){b=p((function(){e(t.unstable_now())}),n)},r=function(){f(b),b=-1}}function S(e,t){var n=e.length;e.push(t);e:for(;;){var i=n-1>>>1,r=e[i];if(!(void 0!==r&&0<A(r,t)))break e;e[i]=t,e[n]=r,n=i}}function C(e){return void 0===(e=e[0])?null:e}function T(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length;i<r;){var s=2*(i+1)-1,o=e[s],a=s+1,l=e[a];if(void 0!==o&&0>A(o,n))void 0!==l&&0>A(l,o)?(e[i]=l,e[a]=n,i=a):(e[i]=o,e[s]=n,i=s);else{if(!(void 0!==l&&0>A(l,n)))break e;e[i]=l,e[a]=n,i=a}}}return t}return null}function A(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var k=[],N=[],M=1,P=null,L=3,O=!1,R=!1,I=!1;function D(e){for(var t=C(N);null!==t;){if(null===t.callback)T(N);else{if(!(t.startTime<=e))break;T(N),t.sortIndex=t.expirationTime,S(k,t)}t=C(N)}}function F(e){if(I=!1,D(e),!R)if(null!==C(k))R=!0,n(B);else{var t=C(N);null!==t&&i(F,t.startTime-e)}}function B(e,n){R=!1,I&&(I=!1,r()),O=!0;var o=L;try{for(D(n),P=C(k);null!==P&&(!(P.expirationTime>n)||e&&!s());){var a=P.callback;if(null!==a){P.callback=null,L=P.priorityLevel;var l=a(P.expirationTime<=n);n=t.unstable_now(),"function"==typeof l?P.callback=l:P===C(k)&&T(k),D(n)}else T(k);P=C(k)}if(null!==P)var c=!0;else{var u=C(N);null!==u&&i(F,u.startTime-n),c=!1}return c}finally{P=null,L=o,O=!1}}function z(e){switch(e){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var j=o;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){R||O||(R=!0,n(B))},t.unstable_getCurrentPriorityLevel=function(){return L},t.unstable_getFirstCallbackNode=function(){return C(k)},t.unstable_next=function(e){switch(L){case 1:case 2:case 3:var t=3;break;default:t=L}var n=L;L=t;try{return e()}finally{L=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=j,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=L;L=e;try{return t()}finally{L=n}},t.unstable_scheduleCallback=function(e,s,o){var a=t.unstable_now();if("object"==typeof o&&null!==o){var l=o.delay;l="number"==typeof l&&0<l?a+l:a,o="number"==typeof o.timeout?o.timeout:z(e)}else o=z(e),l=a;return e={id:M++,callback:s,priorityLevel:e,startTime:l,expirationTime:o=l+o,sortIndex:-1},l>a?(e.sortIndex=l,S(N,e),null===C(k)&&e===C(N)&&(I?r():I=!0,i(F,l-a))):(e.sortIndex=o,S(k,e),R||O||(R=!0,n(B))),e},t.unstable_shouldYield=function(){var e=t.unstable_now();D(e);var n=C(k);return n!==P&&null!==P&&null!==n&&null!==n.callback&&n.startTime<=e&&n.expirationTime<P.expirationTime||s()},t.unstable_wrapCallback=function(e){var t=L;return function(){var n=L;L=t;try{return e.apply(this,arguments)}finally{L=n}}}},1102:(e,t,n)=>{"use strict";e.exports=n(3323)},2709:()=>{},2210:()=>{},5219:()=>{},9550:()=>{},4029:()=>{},1305:()=>{},6659:()=>{},8773:e=>{e.exports={nanoid:(e=21)=>{let t="",n=e;for(;n--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[64*Math.random()|0];return t},customAlphabet:(e,t=21)=>(n=t)=>{let i="",r=n;for(;r--;)i+=e[Math.random()*e.length|0];return i}}},8124:e=>{"use strict";e.exports=JSON.parse('{"0":65533,"128":8364,"130":8218,"131":402,"132":8222,"133":8230,"134":8224,"135":8225,"136":710,"137":8240,"138":352,"139":8249,"140":338,"142":381,"145":8216,"146":8217,"147":8220,"148":8221,"149":8226,"150":8211,"151":8212,"152":732,"153":8482,"154":353,"155":8250,"156":339,"158":382,"159":376}')},2834:e=>{"use strict";e.exports=JSON.parse('{"Aacute":"Á","aacute":"á","Abreve":"Ă","abreve":"ă","ac":"∾","acd":"∿","acE":"∾̳","Acirc":"Â","acirc":"â","acute":"´","Acy":"А","acy":"а","AElig":"Æ","aelig":"æ","af":"⁡","Afr":"𝔄","afr":"𝔞","Agrave":"À","agrave":"à","alefsym":"ℵ","aleph":"ℵ","Alpha":"Α","alpha":"α","Amacr":"Ā","amacr":"ā","amalg":"⨿","amp":"&","AMP":"&","andand":"⩕","And":"⩓","and":"∧","andd":"⩜","andslope":"⩘","andv":"⩚","ang":"∠","ange":"⦤","angle":"∠","angmsdaa":"⦨","angmsdab":"⦩","angmsdac":"⦪","angmsdad":"⦫","angmsdae":"⦬","angmsdaf":"⦭","angmsdag":"⦮","angmsdah":"⦯","angmsd":"∡","angrt":"∟","angrtvb":"⊾","angrtvbd":"⦝","angsph":"∢","angst":"Å","angzarr":"⍼","Aogon":"Ą","aogon":"ą","Aopf":"𝔸","aopf":"𝕒","apacir":"⩯","ap":"≈","apE":"⩰","ape":"≊","apid":"≋","apos":"\'","ApplyFunction":"⁡","approx":"≈","approxeq":"≊","Aring":"Å","aring":"å","Ascr":"𝒜","ascr":"𝒶","Assign":"≔","ast":"*","asymp":"≈","asympeq":"≍","Atilde":"Ã","atilde":"ã","Auml":"Ä","auml":"ä","awconint":"∳","awint":"⨑","backcong":"≌","backepsilon":"϶","backprime":"‵","backsim":"∽","backsimeq":"⋍","Backslash":"∖","Barv":"⫧","barvee":"⊽","barwed":"⌅","Barwed":"⌆","barwedge":"⌅","bbrk":"⎵","bbrktbrk":"⎶","bcong":"≌","Bcy":"Б","bcy":"б","bdquo":"„","becaus":"∵","because":"∵","Because":"∵","bemptyv":"⦰","bepsi":"϶","bernou":"ℬ","Bernoullis":"ℬ","Beta":"Β","beta":"β","beth":"ℶ","between":"≬","Bfr":"𝔅","bfr":"𝔟","bigcap":"⋂","bigcirc":"◯","bigcup":"⋃","bigodot":"⨀","bigoplus":"⨁","bigotimes":"⨂","bigsqcup":"⨆","bigstar":"★","bigtriangledown":"▽","bigtriangleup":"△","biguplus":"⨄","bigvee":"⋁","bigwedge":"⋀","bkarow":"⤍","blacklozenge":"⧫","blacksquare":"▪","blacktriangle":"▴","blacktriangledown":"▾","blacktriangleleft":"◂","blacktriangleright":"▸","blank":"␣","blk12":"▒","blk14":"░","blk34":"▓","block":"█","bne":"=⃥","bnequiv":"≡⃥","bNot":"⫭","bnot":"⌐","Bopf":"𝔹","bopf":"𝕓","bot":"⊥","bottom":"⊥","bowtie":"⋈","boxbox":"⧉","boxdl":"┐","boxdL":"╕","boxDl":"╖","boxDL":"╗","boxdr":"┌","boxdR":"╒","boxDr":"╓","boxDR":"╔","boxh":"─","boxH":"═","boxhd":"┬","boxHd":"╤","boxhD":"╥","boxHD":"╦","boxhu":"┴","boxHu":"╧","boxhU":"╨","boxHU":"╩","boxminus":"⊟","boxplus":"⊞","boxtimes":"⊠","boxul":"┘","boxuL":"╛","boxUl":"╜","boxUL":"╝","boxur":"└","boxuR":"╘","boxUr":"╙","boxUR":"╚","boxv":"│","boxV":"║","boxvh":"┼","boxvH":"╪","boxVh":"╫","boxVH":"╬","boxvl":"┤","boxvL":"╡","boxVl":"╢","boxVL":"╣","boxvr":"├","boxvR":"╞","boxVr":"╟","boxVR":"╠","bprime":"‵","breve":"˘","Breve":"˘","brvbar":"¦","bscr":"𝒷","Bscr":"ℬ","bsemi":"⁏","bsim":"∽","bsime":"⋍","bsolb":"⧅","bsol":"\\\\","bsolhsub":"⟈","bull":"•","bullet":"•","bump":"≎","bumpE":"⪮","bumpe":"≏","Bumpeq":"≎","bumpeq":"≏","Cacute":"Ć","cacute":"ć","capand":"⩄","capbrcup":"⩉","capcap":"⩋","cap":"∩","Cap":"⋒","capcup":"⩇","capdot":"⩀","CapitalDifferentialD":"ⅅ","caps":"∩︀","caret":"⁁","caron":"ˇ","Cayleys":"ℭ","ccaps":"⩍","Ccaron":"Č","ccaron":"č","Ccedil":"Ç","ccedil":"ç","Ccirc":"Ĉ","ccirc":"ĉ","Cconint":"∰","ccups":"⩌","ccupssm":"⩐","Cdot":"Ċ","cdot":"ċ","cedil":"¸","Cedilla":"¸","cemptyv":"⦲","cent":"¢","centerdot":"·","CenterDot":"·","cfr":"𝔠","Cfr":"ℭ","CHcy":"Ч","chcy":"ч","check":"✓","checkmark":"✓","Chi":"Χ","chi":"χ","circ":"ˆ","circeq":"≗","circlearrowleft":"↺","circlearrowright":"↻","circledast":"⊛","circledcirc":"⊚","circleddash":"⊝","CircleDot":"⊙","circledR":"®","circledS":"Ⓢ","CircleMinus":"⊖","CirclePlus":"⊕","CircleTimes":"⊗","cir":"○","cirE":"⧃","cire":"≗","cirfnint":"⨐","cirmid":"⫯","cirscir":"⧂","ClockwiseContourIntegral":"∲","CloseCurlyDoubleQuote":"”","CloseCurlyQuote":"’","clubs":"♣","clubsuit":"♣","colon":":","Colon":"∷","Colone":"⩴","colone":"≔","coloneq":"≔","comma":",","commat":"@","comp":"∁","compfn":"∘","complement":"∁","complexes":"ℂ","cong":"≅","congdot":"⩭","Congruent":"≡","conint":"∮","Conint":"∯","ContourIntegral":"∮","copf":"𝕔","Copf":"ℂ","coprod":"∐","Coproduct":"∐","copy":"©","COPY":"©","copysr":"℗","CounterClockwiseContourIntegral":"∳","crarr":"↵","cross":"✗","Cross":"⨯","Cscr":"𝒞","cscr":"𝒸","csub":"⫏","csube":"⫑","csup":"⫐","csupe":"⫒","ctdot":"⋯","cudarrl":"⤸","cudarrr":"⤵","cuepr":"⋞","cuesc":"⋟","cularr":"↶","cularrp":"⤽","cupbrcap":"⩈","cupcap":"⩆","CupCap":"≍","cup":"∪","Cup":"⋓","cupcup":"⩊","cupdot":"⊍","cupor":"⩅","cups":"∪︀","curarr":"↷","curarrm":"⤼","curlyeqprec":"⋞","curlyeqsucc":"⋟","curlyvee":"⋎","curlywedge":"⋏","curren":"¤","curvearrowleft":"↶","curvearrowright":"↷","cuvee":"⋎","cuwed":"⋏","cwconint":"∲","cwint":"∱","cylcty":"⌭","dagger":"†","Dagger":"‡","daleth":"ℸ","darr":"↓","Darr":"↡","dArr":"⇓","dash":"‐","Dashv":"⫤","dashv":"⊣","dbkarow":"⤏","dblac":"˝","Dcaron":"Ď","dcaron":"ď","Dcy":"Д","dcy":"д","ddagger":"‡","ddarr":"⇊","DD":"ⅅ","dd":"ⅆ","DDotrahd":"⤑","ddotseq":"⩷","deg":"°","Del":"∇","Delta":"Δ","delta":"δ","demptyv":"⦱","dfisht":"⥿","Dfr":"𝔇","dfr":"𝔡","dHar":"⥥","dharl":"⇃","dharr":"⇂","DiacriticalAcute":"´","DiacriticalDot":"˙","DiacriticalDoubleAcute":"˝","DiacriticalGrave":"`","DiacriticalTilde":"˜","diam":"⋄","diamond":"⋄","Diamond":"⋄","diamondsuit":"♦","diams":"♦","die":"¨","DifferentialD":"ⅆ","digamma":"ϝ","disin":"⋲","div":"÷","divide":"÷","divideontimes":"⋇","divonx":"⋇","DJcy":"Ђ","djcy":"ђ","dlcorn":"⌞","dlcrop":"⌍","dollar":"$","Dopf":"𝔻","dopf":"𝕕","Dot":"¨","dot":"˙","DotDot":"⃜","doteq":"≐","doteqdot":"≑","DotEqual":"≐","dotminus":"∸","dotplus":"∔","dotsquare":"⊡","doublebarwedge":"⌆","DoubleContourIntegral":"∯","DoubleDot":"¨","DoubleDownArrow":"⇓","DoubleLeftArrow":"⇐","DoubleLeftRightArrow":"⇔","DoubleLeftTee":"⫤","DoubleLongLeftArrow":"⟸","DoubleLongLeftRightArrow":"⟺","DoubleLongRightArrow":"⟹","DoubleRightArrow":"⇒","DoubleRightTee":"⊨","DoubleUpArrow":"⇑","DoubleUpDownArrow":"⇕","DoubleVerticalBar":"∥","DownArrowBar":"⤓","downarrow":"↓","DownArrow":"↓","Downarrow":"⇓","DownArrowUpArrow":"⇵","DownBreve":"̑","downdownarrows":"⇊","downharpoonleft":"⇃","downharpoonright":"⇂","DownLeftRightVector":"⥐","DownLeftTeeVector":"⥞","DownLeftVectorBar":"⥖","DownLeftVector":"↽","DownRightTeeVector":"⥟","DownRightVectorBar":"⥗","DownRightVector":"⇁","DownTeeArrow":"↧","DownTee":"⊤","drbkarow":"⤐","drcorn":"⌟","drcrop":"⌌","Dscr":"𝒟","dscr":"𝒹","DScy":"Ѕ","dscy":"ѕ","dsol":"⧶","Dstrok":"Đ","dstrok":"đ","dtdot":"⋱","dtri":"▿","dtrif":"▾","duarr":"⇵","duhar":"⥯","dwangle":"⦦","DZcy":"Џ","dzcy":"џ","dzigrarr":"⟿","Eacute":"É","eacute":"é","easter":"⩮","Ecaron":"Ě","ecaron":"ě","Ecirc":"Ê","ecirc":"ê","ecir":"≖","ecolon":"≕","Ecy":"Э","ecy":"э","eDDot":"⩷","Edot":"Ė","edot":"ė","eDot":"≑","ee":"ⅇ","efDot":"≒","Efr":"𝔈","efr":"𝔢","eg":"⪚","Egrave":"È","egrave":"è","egs":"⪖","egsdot":"⪘","el":"⪙","Element":"∈","elinters":"⏧","ell":"ℓ","els":"⪕","elsdot":"⪗","Emacr":"Ē","emacr":"ē","empty":"∅","emptyset":"∅","EmptySmallSquare":"◻","emptyv":"∅","EmptyVerySmallSquare":"▫","emsp13":" ","emsp14":" ","emsp":" ","ENG":"Ŋ","eng":"ŋ","ensp":" ","Eogon":"Ę","eogon":"ę","Eopf":"𝔼","eopf":"𝕖","epar":"⋕","eparsl":"⧣","eplus":"⩱","epsi":"ε","Epsilon":"Ε","epsilon":"ε","epsiv":"ϵ","eqcirc":"≖","eqcolon":"≕","eqsim":"≂","eqslantgtr":"⪖","eqslantless":"⪕","Equal":"⩵","equals":"=","EqualTilde":"≂","equest":"≟","Equilibrium":"⇌","equiv":"≡","equivDD":"⩸","eqvparsl":"⧥","erarr":"⥱","erDot":"≓","escr":"ℯ","Escr":"ℰ","esdot":"≐","Esim":"⩳","esim":"≂","Eta":"Η","eta":"η","ETH":"Ð","eth":"ð","Euml":"Ë","euml":"ë","euro":"€","excl":"!","exist":"∃","Exists":"∃","expectation":"ℰ","exponentiale":"ⅇ","ExponentialE":"ⅇ","fallingdotseq":"≒","Fcy":"Ф","fcy":"ф","female":"♀","ffilig":"ﬃ","fflig":"ﬀ","ffllig":"ﬄ","Ffr":"𝔉","ffr":"𝔣","filig":"ﬁ","FilledSmallSquare":"◼","FilledVerySmallSquare":"▪","fjlig":"fj","flat":"♭","fllig":"ﬂ","fltns":"▱","fnof":"ƒ","Fopf":"𝔽","fopf":"𝕗","forall":"∀","ForAll":"∀","fork":"⋔","forkv":"⫙","Fouriertrf":"ℱ","fpartint":"⨍","frac12":"½","frac13":"⅓","frac14":"¼","frac15":"⅕","frac16":"⅙","frac18":"⅛","frac23":"⅔","frac25":"⅖","frac34":"¾","frac35":"⅗","frac38":"⅜","frac45":"⅘","frac56":"⅚","frac58":"⅝","frac78":"⅞","frasl":"⁄","frown":"⌢","fscr":"𝒻","Fscr":"ℱ","gacute":"ǵ","Gamma":"Γ","gamma":"γ","Gammad":"Ϝ","gammad":"ϝ","gap":"⪆","Gbreve":"Ğ","gbreve":"ğ","Gcedil":"Ģ","Gcirc":"Ĝ","gcirc":"ĝ","Gcy":"Г","gcy":"г","Gdot":"Ġ","gdot":"ġ","ge":"≥","gE":"≧","gEl":"⪌","gel":"⋛","geq":"≥","geqq":"≧","geqslant":"⩾","gescc":"⪩","ges":"⩾","gesdot":"⪀","gesdoto":"⪂","gesdotol":"⪄","gesl":"⋛︀","gesles":"⪔","Gfr":"𝔊","gfr":"𝔤","gg":"≫","Gg":"⋙","ggg":"⋙","gimel":"ℷ","GJcy":"Ѓ","gjcy":"ѓ","gla":"⪥","gl":"≷","glE":"⪒","glj":"⪤","gnap":"⪊","gnapprox":"⪊","gne":"⪈","gnE":"≩","gneq":"⪈","gneqq":"≩","gnsim":"⋧","Gopf":"𝔾","gopf":"𝕘","grave":"`","GreaterEqual":"≥","GreaterEqualLess":"⋛","GreaterFullEqual":"≧","GreaterGreater":"⪢","GreaterLess":"≷","GreaterSlantEqual":"⩾","GreaterTilde":"≳","Gscr":"𝒢","gscr":"ℊ","gsim":"≳","gsime":"⪎","gsiml":"⪐","gtcc":"⪧","gtcir":"⩺","gt":">","GT":">","Gt":"≫","gtdot":"⋗","gtlPar":"⦕","gtquest":"⩼","gtrapprox":"⪆","gtrarr":"⥸","gtrdot":"⋗","gtreqless":"⋛","gtreqqless":"⪌","gtrless":"≷","gtrsim":"≳","gvertneqq":"≩︀","gvnE":"≩︀","Hacek":"ˇ","hairsp":" ","half":"½","hamilt":"ℋ","HARDcy":"Ъ","hardcy":"ъ","harrcir":"⥈","harr":"↔","hArr":"⇔","harrw":"↭","Hat":"^","hbar":"ℏ","Hcirc":"Ĥ","hcirc":"ĥ","hearts":"♥","heartsuit":"♥","hellip":"…","hercon":"⊹","hfr":"𝔥","Hfr":"ℌ","HilbertSpace":"ℋ","hksearow":"⤥","hkswarow":"⤦","hoarr":"⇿","homtht":"∻","hookleftarrow":"↩","hookrightarrow":"↪","hopf":"𝕙","Hopf":"ℍ","horbar":"―","HorizontalLine":"─","hscr":"𝒽","Hscr":"ℋ","hslash":"ℏ","Hstrok":"Ħ","hstrok":"ħ","HumpDownHump":"≎","HumpEqual":"≏","hybull":"⁃","hyphen":"‐","Iacute":"Í","iacute":"í","ic":"⁣","Icirc":"Î","icirc":"î","Icy":"И","icy":"и","Idot":"İ","IEcy":"Е","iecy":"е","iexcl":"¡","iff":"⇔","ifr":"𝔦","Ifr":"ℑ","Igrave":"Ì","igrave":"ì","ii":"ⅈ","iiiint":"⨌","iiint":"∭","iinfin":"⧜","iiota":"℩","IJlig":"Ĳ","ijlig":"ĳ","Imacr":"Ī","imacr":"ī","image":"ℑ","ImaginaryI":"ⅈ","imagline":"ℐ","imagpart":"ℑ","imath":"ı","Im":"ℑ","imof":"⊷","imped":"Ƶ","Implies":"⇒","incare":"℅","in":"∈","infin":"∞","infintie":"⧝","inodot":"ı","intcal":"⊺","int":"∫","Int":"∬","integers":"ℤ","Integral":"∫","intercal":"⊺","Intersection":"⋂","intlarhk":"⨗","intprod":"⨼","InvisibleComma":"⁣","InvisibleTimes":"⁢","IOcy":"Ё","iocy":"ё","Iogon":"Į","iogon":"į","Iopf":"𝕀","iopf":"𝕚","Iota":"Ι","iota":"ι","iprod":"⨼","iquest":"¿","iscr":"𝒾","Iscr":"ℐ","isin":"∈","isindot":"⋵","isinE":"⋹","isins":"⋴","isinsv":"⋳","isinv":"∈","it":"⁢","Itilde":"Ĩ","itilde":"ĩ","Iukcy":"І","iukcy":"і","Iuml":"Ï","iuml":"ï","Jcirc":"Ĵ","jcirc":"ĵ","Jcy":"Й","jcy":"й","Jfr":"𝔍","jfr":"𝔧","jmath":"ȷ","Jopf":"𝕁","jopf":"𝕛","Jscr":"𝒥","jscr":"𝒿","Jsercy":"Ј","jsercy":"ј","Jukcy":"Є","jukcy":"є","Kappa":"Κ","kappa":"κ","kappav":"ϰ","Kcedil":"Ķ","kcedil":"ķ","Kcy":"К","kcy":"к","Kfr":"𝔎","kfr":"𝔨","kgreen":"ĸ","KHcy":"Х","khcy":"х","KJcy":"Ќ","kjcy":"ќ","Kopf":"𝕂","kopf":"𝕜","Kscr":"𝒦","kscr":"𝓀","lAarr":"⇚","Lacute":"Ĺ","lacute":"ĺ","laemptyv":"⦴","lagran":"ℒ","Lambda":"Λ","lambda":"λ","lang":"⟨","Lang":"⟪","langd":"⦑","langle":"⟨","lap":"⪅","Laplacetrf":"ℒ","laquo":"«","larrb":"⇤","larrbfs":"⤟","larr":"←","Larr":"↞","lArr":"⇐","larrfs":"⤝","larrhk":"↩","larrlp":"↫","larrpl":"⤹","larrsim":"⥳","larrtl":"↢","latail":"⤙","lAtail":"⤛","lat":"⪫","late":"⪭","lates":"⪭︀","lbarr":"⤌","lBarr":"⤎","lbbrk":"❲","lbrace":"{","lbrack":"[","lbrke":"⦋","lbrksld":"⦏","lbrkslu":"⦍","Lcaron":"Ľ","lcaron":"ľ","Lcedil":"Ļ","lcedil":"ļ","lceil":"⌈","lcub":"{","Lcy":"Л","lcy":"л","ldca":"⤶","ldquo":"“","ldquor":"„","ldrdhar":"⥧","ldrushar":"⥋","ldsh":"↲","le":"≤","lE":"≦","LeftAngleBracket":"⟨","LeftArrowBar":"⇤","leftarrow":"←","LeftArrow":"←","Leftarrow":"⇐","LeftArrowRightArrow":"⇆","leftarrowtail":"↢","LeftCeiling":"⌈","LeftDoubleBracket":"⟦","LeftDownTeeVector":"⥡","LeftDownVectorBar":"⥙","LeftDownVector":"⇃","LeftFloor":"⌊","leftharpoondown":"↽","leftharpoonup":"↼","leftleftarrows":"⇇","leftrightarrow":"↔","LeftRightArrow":"↔","Leftrightarrow":"⇔","leftrightarrows":"⇆","leftrightharpoons":"⇋","leftrightsquigarrow":"↭","LeftRightVector":"⥎","LeftTeeArrow":"↤","LeftTee":"⊣","LeftTeeVector":"⥚","leftthreetimes":"⋋","LeftTriangleBar":"⧏","LeftTriangle":"⊲","LeftTriangleEqual":"⊴","LeftUpDownVector":"⥑","LeftUpTeeVector":"⥠","LeftUpVectorBar":"⥘","LeftUpVector":"↿","LeftVectorBar":"⥒","LeftVector":"↼","lEg":"⪋","leg":"⋚","leq":"≤","leqq":"≦","leqslant":"⩽","lescc":"⪨","les":"⩽","lesdot":"⩿","lesdoto":"⪁","lesdotor":"⪃","lesg":"⋚︀","lesges":"⪓","lessapprox":"⪅","lessdot":"⋖","lesseqgtr":"⋚","lesseqqgtr":"⪋","LessEqualGreater":"⋚","LessFullEqual":"≦","LessGreater":"≶","lessgtr":"≶","LessLess":"⪡","lesssim":"≲","LessSlantEqual":"⩽","LessTilde":"≲","lfisht":"⥼","lfloor":"⌊","Lfr":"𝔏","lfr":"𝔩","lg":"≶","lgE":"⪑","lHar":"⥢","lhard":"↽","lharu":"↼","lharul":"⥪","lhblk":"▄","LJcy":"Љ","ljcy":"љ","llarr":"⇇","ll":"≪","Ll":"⋘","llcorner":"⌞","Lleftarrow":"⇚","llhard":"⥫","lltri":"◺","Lmidot":"Ŀ","lmidot":"ŀ","lmoustache":"⎰","lmoust":"⎰","lnap":"⪉","lnapprox":"⪉","lne":"⪇","lnE":"≨","lneq":"⪇","lneqq":"≨","lnsim":"⋦","loang":"⟬","loarr":"⇽","lobrk":"⟦","longleftarrow":"⟵","LongLeftArrow":"⟵","Longleftarrow":"⟸","longleftrightarrow":"⟷","LongLeftRightArrow":"⟷","Longleftrightarrow":"⟺","longmapsto":"⟼","longrightarrow":"⟶","LongRightArrow":"⟶","Longrightarrow":"⟹","looparrowleft":"↫","looparrowright":"↬","lopar":"⦅","Lopf":"𝕃","lopf":"𝕝","loplus":"⨭","lotimes":"⨴","lowast":"∗","lowbar":"_","LowerLeftArrow":"↙","LowerRightArrow":"↘","loz":"◊","lozenge":"◊","lozf":"⧫","lpar":"(","lparlt":"⦓","lrarr":"⇆","lrcorner":"⌟","lrhar":"⇋","lrhard":"⥭","lrm":"‎","lrtri":"⊿","lsaquo":"‹","lscr":"𝓁","Lscr":"ℒ","lsh":"↰","Lsh":"↰","lsim":"≲","lsime":"⪍","lsimg":"⪏","lsqb":"[","lsquo":"‘","lsquor":"‚","Lstrok":"Ł","lstrok":"ł","ltcc":"⪦","ltcir":"⩹","lt":"<","LT":"<","Lt":"≪","ltdot":"⋖","lthree":"⋋","ltimes":"⋉","ltlarr":"⥶","ltquest":"⩻","ltri":"◃","ltrie":"⊴","ltrif":"◂","ltrPar":"⦖","lurdshar":"⥊","luruhar":"⥦","lvertneqq":"≨︀","lvnE":"≨︀","macr":"¯","male":"♂","malt":"✠","maltese":"✠","Map":"⤅","map":"↦","mapsto":"↦","mapstodown":"↧","mapstoleft":"↤","mapstoup":"↥","marker":"▮","mcomma":"⨩","Mcy":"М","mcy":"м","mdash":"—","mDDot":"∺","measuredangle":"∡","MediumSpace":" ","Mellintrf":"ℳ","Mfr":"𝔐","mfr":"𝔪","mho":"℧","micro":"µ","midast":"*","midcir":"⫰","mid":"∣","middot":"·","minusb":"⊟","minus":"−","minusd":"∸","minusdu":"⨪","MinusPlus":"∓","mlcp":"⫛","mldr":"…","mnplus":"∓","models":"⊧","Mopf":"𝕄","mopf":"𝕞","mp":"∓","mscr":"𝓂","Mscr":"ℳ","mstpos":"∾","Mu":"Μ","mu":"μ","multimap":"⊸","mumap":"⊸","nabla":"∇","Nacute":"Ń","nacute":"ń","nang":"∠⃒","nap":"≉","napE":"⩰̸","napid":"≋̸","napos":"ŉ","napprox":"≉","natural":"♮","naturals":"ℕ","natur":"♮","nbsp":" ","nbump":"≎̸","nbumpe":"≏̸","ncap":"⩃","Ncaron":"Ň","ncaron":"ň","Ncedil":"Ņ","ncedil":"ņ","ncong":"≇","ncongdot":"⩭̸","ncup":"⩂","Ncy":"Н","ncy":"н","ndash":"–","nearhk":"⤤","nearr":"↗","neArr":"⇗","nearrow":"↗","ne":"≠","nedot":"≐̸","NegativeMediumSpace":"​","NegativeThickSpace":"​","NegativeThinSpace":"​","NegativeVeryThinSpace":"​","nequiv":"≢","nesear":"⤨","nesim":"≂̸","NestedGreaterGreater":"≫","NestedLessLess":"≪","NewLine":"\\n","nexist":"∄","nexists":"∄","Nfr":"𝔑","nfr":"𝔫","ngE":"≧̸","nge":"≱","ngeq":"≱","ngeqq":"≧̸","ngeqslant":"⩾̸","nges":"⩾̸","nGg":"⋙̸","ngsim":"≵","nGt":"≫⃒","ngt":"≯","ngtr":"≯","nGtv":"≫̸","nharr":"↮","nhArr":"⇎","nhpar":"⫲","ni":"∋","nis":"⋼","nisd":"⋺","niv":"∋","NJcy":"Њ","njcy":"њ","nlarr":"↚","nlArr":"⇍","nldr":"‥","nlE":"≦̸","nle":"≰","nleftarrow":"↚","nLeftarrow":"⇍","nleftrightarrow":"↮","nLeftrightarrow":"⇎","nleq":"≰","nleqq":"≦̸","nleqslant":"⩽̸","nles":"⩽̸","nless":"≮","nLl":"⋘̸","nlsim":"≴","nLt":"≪⃒","nlt":"≮","nltri":"⋪","nltrie":"⋬","nLtv":"≪̸","nmid":"∤","NoBreak":"⁠","NonBreakingSpace":" ","nopf":"𝕟","Nopf":"ℕ","Not":"⫬","not":"¬","NotCongruent":"≢","NotCupCap":"≭","NotDoubleVerticalBar":"∦","NotElement":"∉","NotEqual":"≠","NotEqualTilde":"≂̸","NotExists":"∄","NotGreater":"≯","NotGreaterEqual":"≱","NotGreaterFullEqual":"≧̸","NotGreaterGreater":"≫̸","NotGreaterLess":"≹","NotGreaterSlantEqual":"⩾̸","NotGreaterTilde":"≵","NotHumpDownHump":"≎̸","NotHumpEqual":"≏̸","notin":"∉","notindot":"⋵̸","notinE":"⋹̸","notinva":"∉","notinvb":"⋷","notinvc":"⋶","NotLeftTriangleBar":"⧏̸","NotLeftTriangle":"⋪","NotLeftTriangleEqual":"⋬","NotLess":"≮","NotLessEqual":"≰","NotLessGreater":"≸","NotLessLess":"≪̸","NotLessSlantEqual":"⩽̸","NotLessTilde":"≴","NotNestedGreaterGreater":"⪢̸","NotNestedLessLess":"⪡̸","notni":"∌","notniva":"∌","notnivb":"⋾","notnivc":"⋽","NotPrecedes":"⊀","NotPrecedesEqual":"⪯̸","NotPrecedesSlantEqual":"⋠","NotReverseElement":"∌","NotRightTriangleBar":"⧐̸","NotRightTriangle":"⋫","NotRightTriangleEqual":"⋭","NotSquareSubset":"⊏̸","NotSquareSubsetEqual":"⋢","NotSquareSuperset":"⊐̸","NotSquareSupersetEqual":"⋣","NotSubset":"⊂⃒","NotSubsetEqual":"⊈","NotSucceeds":"⊁","NotSucceedsEqual":"⪰̸","NotSucceedsSlantEqual":"⋡","NotSucceedsTilde":"≿̸","NotSuperset":"⊃⃒","NotSupersetEqual":"⊉","NotTilde":"≁","NotTildeEqual":"≄","NotTildeFullEqual":"≇","NotTildeTilde":"≉","NotVerticalBar":"∤","nparallel":"∦","npar":"∦","nparsl":"⫽⃥","npart":"∂̸","npolint":"⨔","npr":"⊀","nprcue":"⋠","nprec":"⊀","npreceq":"⪯̸","npre":"⪯̸","nrarrc":"⤳̸","nrarr":"↛","nrArr":"⇏","nrarrw":"↝̸","nrightarrow":"↛","nRightarrow":"⇏","nrtri":"⋫","nrtrie":"⋭","nsc":"⊁","nsccue":"⋡","nsce":"⪰̸","Nscr":"𝒩","nscr":"𝓃","nshortmid":"∤","nshortparallel":"∦","nsim":"≁","nsime":"≄","nsimeq":"≄","nsmid":"∤","nspar":"∦","nsqsube":"⋢","nsqsupe":"⋣","nsub":"⊄","nsubE":"⫅̸","nsube":"⊈","nsubset":"⊂⃒","nsubseteq":"⊈","nsubseteqq":"⫅̸","nsucc":"⊁","nsucceq":"⪰̸","nsup":"⊅","nsupE":"⫆̸","nsupe":"⊉","nsupset":"⊃⃒","nsupseteq":"⊉","nsupseteqq":"⫆̸","ntgl":"≹","Ntilde":"Ñ","ntilde":"ñ","ntlg":"≸","ntriangleleft":"⋪","ntrianglelefteq":"⋬","ntriangleright":"⋫","ntrianglerighteq":"⋭","Nu":"Ν","nu":"ν","num":"#","numero":"№","numsp":" ","nvap":"≍⃒","nvdash":"⊬","nvDash":"⊭","nVdash":"⊮","nVDash":"⊯","nvge":"≥⃒","nvgt":">⃒","nvHarr":"⤄","nvinfin":"⧞","nvlArr":"⤂","nvle":"≤⃒","nvlt":"<⃒","nvltrie":"⊴⃒","nvrArr":"⤃","nvrtrie":"⊵⃒","nvsim":"∼⃒","nwarhk":"⤣","nwarr":"↖","nwArr":"⇖","nwarrow":"↖","nwnear":"⤧","Oacute":"Ó","oacute":"ó","oast":"⊛","Ocirc":"Ô","ocirc":"ô","ocir":"⊚","Ocy":"О","ocy":"о","odash":"⊝","Odblac":"Ő","odblac":"ő","odiv":"⨸","odot":"⊙","odsold":"⦼","OElig":"Œ","oelig":"œ","ofcir":"⦿","Ofr":"𝔒","ofr":"𝔬","ogon":"˛","Ograve":"Ò","ograve":"ò","ogt":"⧁","ohbar":"⦵","ohm":"Ω","oint":"∮","olarr":"↺","olcir":"⦾","olcross":"⦻","oline":"‾","olt":"⧀","Omacr":"Ō","omacr":"ō","Omega":"Ω","omega":"ω","Omicron":"Ο","omicron":"ο","omid":"⦶","ominus":"⊖","Oopf":"𝕆","oopf":"𝕠","opar":"⦷","OpenCurlyDoubleQuote":"“","OpenCurlyQuote":"‘","operp":"⦹","oplus":"⊕","orarr":"↻","Or":"⩔","or":"∨","ord":"⩝","order":"ℴ","orderof":"ℴ","ordf":"ª","ordm":"º","origof":"⊶","oror":"⩖","orslope":"⩗","orv":"⩛","oS":"Ⓢ","Oscr":"𝒪","oscr":"ℴ","Oslash":"Ø","oslash":"ø","osol":"⊘","Otilde":"Õ","otilde":"õ","otimesas":"⨶","Otimes":"⨷","otimes":"⊗","Ouml":"Ö","ouml":"ö","ovbar":"⌽","OverBar":"‾","OverBrace":"⏞","OverBracket":"⎴","OverParenthesis":"⏜","para":"¶","parallel":"∥","par":"∥","parsim":"⫳","parsl":"⫽","part":"∂","PartialD":"∂","Pcy":"П","pcy":"п","percnt":"%","period":".","permil":"‰","perp":"⊥","pertenk":"‱","Pfr":"𝔓","pfr":"𝔭","Phi":"Φ","phi":"φ","phiv":"ϕ","phmmat":"ℳ","phone":"☎","Pi":"Π","pi":"π","pitchfork":"⋔","piv":"ϖ","planck":"ℏ","planckh":"ℎ","plankv":"ℏ","plusacir":"⨣","plusb":"⊞","pluscir":"⨢","plus":"+","plusdo":"∔","plusdu":"⨥","pluse":"⩲","PlusMinus":"±","plusmn":"±","plussim":"⨦","plustwo":"⨧","pm":"±","Poincareplane":"ℌ","pointint":"⨕","popf":"𝕡","Popf":"ℙ","pound":"£","prap":"⪷","Pr":"⪻","pr":"≺","prcue":"≼","precapprox":"⪷","prec":"≺","preccurlyeq":"≼","Precedes":"≺","PrecedesEqual":"⪯","PrecedesSlantEqual":"≼","PrecedesTilde":"≾","preceq":"⪯","precnapprox":"⪹","precneqq":"⪵","precnsim":"⋨","pre":"⪯","prE":"⪳","precsim":"≾","prime":"′","Prime":"″","primes":"ℙ","prnap":"⪹","prnE":"⪵","prnsim":"⋨","prod":"∏","Product":"∏","profalar":"⌮","profline":"⌒","profsurf":"⌓","prop":"∝","Proportional":"∝","Proportion":"∷","propto":"∝","prsim":"≾","prurel":"⊰","Pscr":"𝒫","pscr":"𝓅","Psi":"Ψ","psi":"ψ","puncsp":" ","Qfr":"𝔔","qfr":"𝔮","qint":"⨌","qopf":"𝕢","Qopf":"ℚ","qprime":"⁗","Qscr":"𝒬","qscr":"𝓆","quaternions":"ℍ","quatint":"⨖","quest":"?","questeq":"≟","quot":"\\"","QUOT":"\\"","rAarr":"⇛","race":"∽̱","Racute":"Ŕ","racute":"ŕ","radic":"√","raemptyv":"⦳","rang":"⟩","Rang":"⟫","rangd":"⦒","range":"⦥","rangle":"⟩","raquo":"»","rarrap":"⥵","rarrb":"⇥","rarrbfs":"⤠","rarrc":"⤳","rarr":"→","Rarr":"↠","rArr":"⇒","rarrfs":"⤞","rarrhk":"↪","rarrlp":"↬","rarrpl":"⥅","rarrsim":"⥴","Rarrtl":"⤖","rarrtl":"↣","rarrw":"↝","ratail":"⤚","rAtail":"⤜","ratio":"∶","rationals":"ℚ","rbarr":"⤍","rBarr":"⤏","RBarr":"⤐","rbbrk":"❳","rbrace":"}","rbrack":"]","rbrke":"⦌","rbrksld":"⦎","rbrkslu":"⦐","Rcaron":"Ř","rcaron":"ř","Rcedil":"Ŗ","rcedil":"ŗ","rceil":"⌉","rcub":"}","Rcy":"Р","rcy":"р","rdca":"⤷","rdldhar":"⥩","rdquo":"”","rdquor":"”","rdsh":"↳","real":"ℜ","realine":"ℛ","realpart":"ℜ","reals":"ℝ","Re":"ℜ","rect":"▭","reg":"®","REG":"®","ReverseElement":"∋","ReverseEquilibrium":"⇋","ReverseUpEquilibrium":"⥯","rfisht":"⥽","rfloor":"⌋","rfr":"𝔯","Rfr":"ℜ","rHar":"⥤","rhard":"⇁","rharu":"⇀","rharul":"⥬","Rho":"Ρ","rho":"ρ","rhov":"ϱ","RightAngleBracket":"⟩","RightArrowBar":"⇥","rightarrow":"→","RightArrow":"→","Rightarrow":"⇒","RightArrowLeftArrow":"⇄","rightarrowtail":"↣","RightCeiling":"⌉","RightDoubleBracket":"⟧","RightDownTeeVector":"⥝","RightDownVectorBar":"⥕","RightDownVector":"⇂","RightFloor":"⌋","rightharpoondown":"⇁","rightharpoonup":"⇀","rightleftarrows":"⇄","rightleftharpoons":"⇌","rightrightarrows":"⇉","rightsquigarrow":"↝","RightTeeArrow":"↦","RightTee":"⊢","RightTeeVector":"⥛","rightthreetimes":"⋌","RightTriangleBar":"⧐","RightTriangle":"⊳","RightTriangleEqual":"⊵","RightUpDownVector":"⥏","RightUpTeeVector":"⥜","RightUpVectorBar":"⥔","RightUpVector":"↾","RightVectorBar":"⥓","RightVector":"⇀","ring":"˚","risingdotseq":"≓","rlarr":"⇄","rlhar":"⇌","rlm":"‏","rmoustache":"⎱","rmoust":"⎱","rnmid":"⫮","roang":"⟭","roarr":"⇾","robrk":"⟧","ropar":"⦆","ropf":"𝕣","Ropf":"ℝ","roplus":"⨮","rotimes":"⨵","RoundImplies":"⥰","rpar":")","rpargt":"⦔","rppolint":"⨒","rrarr":"⇉","Rrightarrow":"⇛","rsaquo":"›","rscr":"𝓇","Rscr":"ℛ","rsh":"↱","Rsh":"↱","rsqb":"]","rsquo":"’","rsquor":"’","rthree":"⋌","rtimes":"⋊","rtri":"▹","rtrie":"⊵","rtrif":"▸","rtriltri":"⧎","RuleDelayed":"⧴","ruluhar":"⥨","rx":"℞","Sacute":"Ś","sacute":"ś","sbquo":"‚","scap":"⪸","Scaron":"Š","scaron":"š","Sc":"⪼","sc":"≻","sccue":"≽","sce":"⪰","scE":"⪴","Scedil":"Ş","scedil":"ş","Scirc":"Ŝ","scirc":"ŝ","scnap":"⪺","scnE":"⪶","scnsim":"⋩","scpolint":"⨓","scsim":"≿","Scy":"С","scy":"с","sdotb":"⊡","sdot":"⋅","sdote":"⩦","searhk":"⤥","searr":"↘","seArr":"⇘","searrow":"↘","sect":"§","semi":";","seswar":"⤩","setminus":"∖","setmn":"∖","sext":"✶","Sfr":"𝔖","sfr":"𝔰","sfrown":"⌢","sharp":"♯","SHCHcy":"Щ","shchcy":"щ","SHcy":"Ш","shcy":"ш","ShortDownArrow":"↓","ShortLeftArrow":"←","shortmid":"∣","shortparallel":"∥","ShortRightArrow":"→","ShortUpArrow":"↑","shy":"­","Sigma":"Σ","sigma":"σ","sigmaf":"ς","sigmav":"ς","sim":"∼","simdot":"⩪","sime":"≃","simeq":"≃","simg":"⪞","simgE":"⪠","siml":"⪝","simlE":"⪟","simne":"≆","simplus":"⨤","simrarr":"⥲","slarr":"←","SmallCircle":"∘","smallsetminus":"∖","smashp":"⨳","smeparsl":"⧤","smid":"∣","smile":"⌣","smt":"⪪","smte":"⪬","smtes":"⪬︀","SOFTcy":"Ь","softcy":"ь","solbar":"⌿","solb":"⧄","sol":"/","Sopf":"𝕊","sopf":"𝕤","spades":"♠","spadesuit":"♠","spar":"∥","sqcap":"⊓","sqcaps":"⊓︀","sqcup":"⊔","sqcups":"⊔︀","Sqrt":"√","sqsub":"⊏","sqsube":"⊑","sqsubset":"⊏","sqsubseteq":"⊑","sqsup":"⊐","sqsupe":"⊒","sqsupset":"⊐","sqsupseteq":"⊒","square":"□","Square":"□","SquareIntersection":"⊓","SquareSubset":"⊏","SquareSubsetEqual":"⊑","SquareSuperset":"⊐","SquareSupersetEqual":"⊒","SquareUnion":"⊔","squarf":"▪","squ":"□","squf":"▪","srarr":"→","Sscr":"𝒮","sscr":"𝓈","ssetmn":"∖","ssmile":"⌣","sstarf":"⋆","Star":"⋆","star":"☆","starf":"★","straightepsilon":"ϵ","straightphi":"ϕ","strns":"¯","sub":"⊂","Sub":"⋐","subdot":"⪽","subE":"⫅","sube":"⊆","subedot":"⫃","submult":"⫁","subnE":"⫋","subne":"⊊","subplus":"⪿","subrarr":"⥹","subset":"⊂","Subset":"⋐","subseteq":"⊆","subseteqq":"⫅","SubsetEqual":"⊆","subsetneq":"⊊","subsetneqq":"⫋","subsim":"⫇","subsub":"⫕","subsup":"⫓","succapprox":"⪸","succ":"≻","succcurlyeq":"≽","Succeeds":"≻","SucceedsEqual":"⪰","SucceedsSlantEqual":"≽","SucceedsTilde":"≿","succeq":"⪰","succnapprox":"⪺","succneqq":"⪶","succnsim":"⋩","succsim":"≿","SuchThat":"∋","sum":"∑","Sum":"∑","sung":"♪","sup1":"¹","sup2":"²","sup3":"³","sup":"⊃","Sup":"⋑","supdot":"⪾","supdsub":"⫘","supE":"⫆","supe":"⊇","supedot":"⫄","Superset":"⊃","SupersetEqual":"⊇","suphsol":"⟉","suphsub":"⫗","suplarr":"⥻","supmult":"⫂","supnE":"⫌","supne":"⊋","supplus":"⫀","supset":"⊃","Supset":"⋑","supseteq":"⊇","supseteqq":"⫆","supsetneq":"⊋","supsetneqq":"⫌","supsim":"⫈","supsub":"⫔","supsup":"⫖","swarhk":"⤦","swarr":"↙","swArr":"⇙","swarrow":"↙","swnwar":"⤪","szlig":"ß","Tab":"\\t","target":"⌖","Tau":"Τ","tau":"τ","tbrk":"⎴","Tcaron":"Ť","tcaron":"ť","Tcedil":"Ţ","tcedil":"ţ","Tcy":"Т","tcy":"т","tdot":"⃛","telrec":"⌕","Tfr":"𝔗","tfr":"𝔱","there4":"∴","therefore":"∴","Therefore":"∴","Theta":"Θ","theta":"θ","thetasym":"ϑ","thetav":"ϑ","thickapprox":"≈","thicksim":"∼","ThickSpace":"  ","ThinSpace":" ","thinsp":" ","thkap":"≈","thksim":"∼","THORN":"Þ","thorn":"þ","tilde":"˜","Tilde":"∼","TildeEqual":"≃","TildeFullEqual":"≅","TildeTilde":"≈","timesbar":"⨱","timesb":"⊠","times":"×","timesd":"⨰","tint":"∭","toea":"⤨","topbot":"⌶","topcir":"⫱","top":"⊤","Topf":"𝕋","topf":"𝕥","topfork":"⫚","tosa":"⤩","tprime":"‴","trade":"™","TRADE":"™","triangle":"▵","triangledown":"▿","triangleleft":"◃","trianglelefteq":"⊴","triangleq":"≜","triangleright":"▹","trianglerighteq":"⊵","tridot":"◬","trie":"≜","triminus":"⨺","TripleDot":"⃛","triplus":"⨹","trisb":"⧍","tritime":"⨻","trpezium":"⏢","Tscr":"𝒯","tscr":"𝓉","TScy":"Ц","tscy":"ц","TSHcy":"Ћ","tshcy":"ћ","Tstrok":"Ŧ","tstrok":"ŧ","twixt":"≬","twoheadleftarrow":"↞","twoheadrightarrow":"↠","Uacute":"Ú","uacute":"ú","uarr":"↑","Uarr":"↟","uArr":"⇑","Uarrocir":"⥉","Ubrcy":"Ў","ubrcy":"ў","Ubreve":"Ŭ","ubreve":"ŭ","Ucirc":"Û","ucirc":"û","Ucy":"У","ucy":"у","udarr":"⇅","Udblac":"Ű","udblac":"ű","udhar":"⥮","ufisht":"⥾","Ufr":"𝔘","ufr":"𝔲","Ugrave":"Ù","ugrave":"ù","uHar":"⥣","uharl":"↿","uharr":"↾","uhblk":"▀","ulcorn":"⌜","ulcorner":"⌜","ulcrop":"⌏","ultri":"◸","Umacr":"Ū","umacr":"ū","uml":"¨","UnderBar":"_","UnderBrace":"⏟","UnderBracket":"⎵","UnderParenthesis":"⏝","Union":"⋃","UnionPlus":"⊎","Uogon":"Ų","uogon":"ų","Uopf":"𝕌","uopf":"𝕦","UpArrowBar":"⤒","uparrow":"↑","UpArrow":"↑","Uparrow":"⇑","UpArrowDownArrow":"⇅","updownarrow":"↕","UpDownArrow":"↕","Updownarrow":"⇕","UpEquilibrium":"⥮","upharpoonleft":"↿","upharpoonright":"↾","uplus":"⊎","UpperLeftArrow":"↖","UpperRightArrow":"↗","upsi":"υ","Upsi":"ϒ","upsih":"ϒ","Upsilon":"Υ","upsilon":"υ","UpTeeArrow":"↥","UpTee":"⊥","upuparrows":"⇈","urcorn":"⌝","urcorner":"⌝","urcrop":"⌎","Uring":"Ů","uring":"ů","urtri":"◹","Uscr":"𝒰","uscr":"𝓊","utdot":"⋰","Utilde":"Ũ","utilde":"ũ","utri":"▵","utrif":"▴","uuarr":"⇈","Uuml":"Ü","uuml":"ü","uwangle":"⦧","vangrt":"⦜","varepsilon":"ϵ","varkappa":"ϰ","varnothing":"∅","varphi":"ϕ","varpi":"ϖ","varpropto":"∝","varr":"↕","vArr":"⇕","varrho":"ϱ","varsigma":"ς","varsubsetneq":"⊊︀","varsubsetneqq":"⫋︀","varsupsetneq":"⊋︀","varsupsetneqq":"⫌︀","vartheta":"ϑ","vartriangleleft":"⊲","vartriangleright":"⊳","vBar":"⫨","Vbar":"⫫","vBarv":"⫩","Vcy":"В","vcy":"в","vdash":"⊢","vDash":"⊨","Vdash":"⊩","VDash":"⊫","Vdashl":"⫦","veebar":"⊻","vee":"∨","Vee":"⋁","veeeq":"≚","vellip":"⋮","verbar":"|","Verbar":"‖","vert":"|","Vert":"‖","VerticalBar":"∣","VerticalLine":"|","VerticalSeparator":"❘","VerticalTilde":"≀","VeryThinSpace":" ","Vfr":"𝔙","vfr":"𝔳","vltri":"⊲","vnsub":"⊂⃒","vnsup":"⊃⃒","Vopf":"𝕍","vopf":"𝕧","vprop":"∝","vrtri":"⊳","Vscr":"𝒱","vscr":"𝓋","vsubnE":"⫋︀","vsubne":"⊊︀","vsupnE":"⫌︀","vsupne":"⊋︀","Vvdash":"⊪","vzigzag":"⦚","Wcirc":"Ŵ","wcirc":"ŵ","wedbar":"⩟","wedge":"∧","Wedge":"⋀","wedgeq":"≙","weierp":"℘","Wfr":"𝔚","wfr":"𝔴","Wopf":"𝕎","wopf":"𝕨","wp":"℘","wr":"≀","wreath":"≀","Wscr":"𝒲","wscr":"𝓌","xcap":"⋂","xcirc":"◯","xcup":"⋃","xdtri":"▽","Xfr":"𝔛","xfr":"𝔵","xharr":"⟷","xhArr":"⟺","Xi":"Ξ","xi":"ξ","xlarr":"⟵","xlArr":"⟸","xmap":"⟼","xnis":"⋻","xodot":"⨀","Xopf":"𝕏","xopf":"𝕩","xoplus":"⨁","xotime":"⨂","xrarr":"⟶","xrArr":"⟹","Xscr":"𝒳","xscr":"𝓍","xsqcup":"⨆","xuplus":"⨄","xutri":"△","xvee":"⋁","xwedge":"⋀","Yacute":"Ý","yacute":"ý","YAcy":"Я","yacy":"я","Ycirc":"Ŷ","ycirc":"ŷ","Ycy":"Ы","ycy":"ы","yen":"¥","Yfr":"𝔜","yfr":"𝔶","YIcy":"Ї","yicy":"ї","Yopf":"𝕐","yopf":"𝕪","Yscr":"𝒴","yscr":"𝓎","YUcy":"Ю","yucy":"ю","yuml":"ÿ","Yuml":"Ÿ","Zacute":"Ź","zacute":"ź","Zcaron":"Ž","zcaron":"ž","Zcy":"З","zcy":"з","Zdot":"Ż","zdot":"ż","zeetrf":"ℨ","ZeroWidthSpace":"​","Zeta":"Ζ","zeta":"ζ","zfr":"𝔷","Zfr":"ℨ","ZHcy":"Ж","zhcy":"ж","zigrarr":"⇝","zopf":"𝕫","Zopf":"ℤ","Zscr":"𝒵","zscr":"𝓏","zwj":"‍","zwnj":"‌"}')},2061:e=>{"use strict";e.exports=JSON.parse('{"Aacute":"Á","aacute":"á","Acirc":"Â","acirc":"â","acute":"´","AElig":"Æ","aelig":"æ","Agrave":"À","agrave":"à","amp":"&","AMP":"&","Aring":"Å","aring":"å","Atilde":"Ã","atilde":"ã","Auml":"Ä","auml":"ä","brvbar":"¦","Ccedil":"Ç","ccedil":"ç","cedil":"¸","cent":"¢","copy":"©","COPY":"©","curren":"¤","deg":"°","divide":"÷","Eacute":"É","eacute":"é","Ecirc":"Ê","ecirc":"ê","Egrave":"È","egrave":"è","ETH":"Ð","eth":"ð","Euml":"Ë","euml":"ë","frac12":"½","frac14":"¼","frac34":"¾","gt":">","GT":">","Iacute":"Í","iacute":"í","Icirc":"Î","icirc":"î","iexcl":"¡","Igrave":"Ì","igrave":"ì","iquest":"¿","Iuml":"Ï","iuml":"ï","laquo":"«","lt":"<","LT":"<","macr":"¯","micro":"µ","middot":"·","nbsp":" ","not":"¬","Ntilde":"Ñ","ntilde":"ñ","Oacute":"Ó","oacute":"ó","Ocirc":"Ô","ocirc":"ô","Ograve":"Ò","ograve":"ò","ordf":"ª","ordm":"º","Oslash":"Ø","oslash":"ø","Otilde":"Õ","otilde":"õ","Ouml":"Ö","ouml":"ö","para":"¶","plusmn":"±","pound":"£","quot":"\\"","QUOT":"\\"","raquo":"»","reg":"®","REG":"®","sect":"§","shy":"­","sup1":"¹","sup2":"²","sup3":"³","szlig":"ß","THORN":"Þ","thorn":"þ","times":"×","Uacute":"Ú","uacute":"ú","Ucirc":"Û","ucirc":"û","Ugrave":"Ù","ugrave":"ù","uml":"¨","Uuml":"Ü","uuml":"ü","Yacute":"Ý","yacute":"ý","yen":"¥","yuml":"ÿ"}')},5529:e=>{"use strict";e.exports=JSON.parse('{"amp":"&","apos":"\'","gt":">","lt":"<","quot":"\\""}')}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var s=t[i]={exports:{}};return e[i].call(s.exports,s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{"use strict";n.r(i);var e={};n.r(e),n.d(e,{Decoder:()=>Decoder,Encoder:()=>Encoder,PacketType:()=>xA,protocol:()=>wA});var t=n(7378),r=n(1542);function s(e,t){return s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s(e,t)}function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,s(e,t)}var a=n(3615),l=n.n(a);function c(){return c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},c.apply(this,arguments)}function u(e){return"/"===e.charAt(0)}function d(e,t){for(var n=t,i=n+1,r=e.length;i<r;n+=1,i+=1)e[n]=e[i];e.pop()}const h=function(e,t){void 0===t&&(t="");var n,i=e&&e.split("/")||[],r=t&&t.split("/")||[],s=e&&u(e),o=t&&u(t),a=s||o;if(e&&u(e)?r=i:i.length&&(r.pop(),r=r.concat(i)),!r.length)return"/";if(r.length){var l=r[r.length-1];n="."===l||".."===l||""===l}else n=!1;for(var c=0,h=r.length;h>=0;h--){var p=r[h];"."===p?d(r,h):".."===p?(d(r,h),c++):c&&(d(r,h),c--)}if(!a)for(;c--;c)r.unshift("..");!a||""===r[0]||r[0]&&u(r[0])||r.unshift("");var f=r.join("/");return n&&"/"!==f.substr(-1)&&(f+="/"),f};var p="Invariant failed";const f=function(e,t){if(!e)throw new Error(p)};function m(e){return"/"===e.charAt(0)?e:"/"+e}function g(e){return"/"===e.charAt(0)?e.substr(1):e}function y(e,t){return function(e,t){return 0===e.toLowerCase().indexOf(t.toLowerCase())&&-1!=="/?#".indexOf(e.charAt(t.length))}(e,t)?e.substr(t.length):e}function v(e){return"/"===e.charAt(e.length-1)?e.slice(0,-1):e}function b(e){var t=e.pathname,n=e.search,i=e.hash,r=t||"/";return n&&"?"!==n&&(r+="?"===n.charAt(0)?n:"?"+n),i&&"#"!==i&&(r+="#"===i.charAt(0)?i:"#"+i),r}function w(e,t,n,i){var r;"string"==typeof e?(r=function(e){var t=e||"/",n="",i="",r=t.indexOf("#");-1!==r&&(i=t.substr(r),t=t.substr(0,r));var s=t.indexOf("?");return-1!==s&&(n=t.substr(s),t=t.substr(0,s)),{pathname:t,search:"?"===n?"":n,hash:"#"===i?"":i}}(e),r.state=t):(void 0===(r=c({},e)).pathname&&(r.pathname=""),r.search?"?"!==r.search.charAt(0)&&(r.search="?"+r.search):r.search="",r.hash?"#"!==r.hash.charAt(0)&&(r.hash="#"+r.hash):r.hash="",void 0!==t&&void 0===r.state&&(r.state=t));try{r.pathname=decodeURI(r.pathname)}catch(e){throw e instanceof URIError?new URIError('Pathname "'+r.pathname+'" could not be decoded. This is likely caused by an invalid percent-encoding.'):e}return n&&(r.key=n),i?r.pathname?"/"!==r.pathname.charAt(0)&&(r.pathname=h(r.pathname,i.pathname)):r.pathname=i.pathname:r.pathname||(r.pathname="/"),r}function x(){var e=null;var t=[];return{setPrompt:function(t){return e=t,function(){e===t&&(e=null)}},confirmTransitionTo:function(t,n,i,r){if(null!=e){var s="function"==typeof e?e(t,n):e;"string"==typeof s?"function"==typeof i?i(s,r):r(!0):r(!1!==s)}else r(!0)},appendListener:function(e){var n=!0;function i(){n&&e.apply(void 0,arguments)}return t.push(i),function(){n=!1,t=t.filter((function(e){return e!==i}))}},notifyListeners:function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];t.forEach((function(e){return e.apply(void 0,n)}))}}}var _=!("undefined"==typeof window||!window.document||!window.document.createElement);function E(e,t){t(window.confirm(e))}var S="popstate",C="hashchange";function T(){try{return window.history.state||{}}catch(e){return{}}}function A(e){void 0===e&&(e={}),_||f(!1);var t,n=window.history,i=(-1===(t=window.navigator.userAgent).indexOf("Android 2.")&&-1===t.indexOf("Android 4.0")||-1===t.indexOf("Mobile Safari")||-1!==t.indexOf("Chrome")||-1!==t.indexOf("Windows Phone"))&&window.history&&"pushState"in window.history,r=!(-1===window.navigator.userAgent.indexOf("Trident")),s=e,o=s.forceRefresh,a=void 0!==o&&o,l=s.getUserConfirmation,u=void 0===l?E:l,d=s.keyLength,h=void 0===d?6:d,p=e.basename?v(m(e.basename)):"";function g(e){var t=e||{},n=t.key,i=t.state,r=window.location,s=r.pathname+r.search+r.hash;return p&&(s=y(s,p)),w(s,i,n)}function A(){return Math.random().toString(36).substr(2,h)}var k=x();function N(e){c(V,e),V.length=n.length,k.notifyListeners(V.location,V.action)}function M(e){(function(e){return void 0===e.state&&-1===navigator.userAgent.indexOf("CriOS")})(e)||O(g(e.state))}function P(){O(g(T()))}var L=!1;function O(e){if(L)L=!1,N();else{k.confirmTransitionTo(e,"POP",u,(function(t){t?N({action:"POP",location:e}):function(e){var t=V.location,n=I.indexOf(t.key);-1===n&&(n=0);var i=I.indexOf(e.key);-1===i&&(i=0);var r=n-i;r&&(L=!0,F(r))}(e)}))}}var R=g(T()),I=[R.key];function D(e){return p+b(e)}function F(e){n.go(e)}var B=0;function z(e){1===(B+=e)&&1===e?(window.addEventListener(S,M),r&&window.addEventListener(C,P)):0===B&&(window.removeEventListener(S,M),r&&window.removeEventListener(C,P))}var j=!1;var V={length:n.length,action:"POP",location:R,createHref:D,push:function(e,t){var r="PUSH",s=w(e,t,A(),V.location);k.confirmTransitionTo(s,r,u,(function(e){if(e){var t=D(s),o=s.key,l=s.state;if(i)if(n.pushState({key:o,state:l},null,t),a)window.location.href=t;else{var c=I.indexOf(V.location.key),u=I.slice(0,c+1);u.push(s.key),I=u,N({action:r,location:s})}else window.location.href=t}}))},replace:function(e,t){var r="REPLACE",s=w(e,t,A(),V.location);k.confirmTransitionTo(s,r,u,(function(e){if(e){var t=D(s),o=s.key,l=s.state;if(i)if(n.replaceState({key:o,state:l},null,t),a)window.location.replace(t);else{var c=I.indexOf(V.location.key);-1!==c&&(I[c]=s.key),N({action:r,location:s})}else window.location.replace(t)}}))},go:F,goBack:function(){F(-1)},goForward:function(){F(1)},block:function(e){void 0===e&&(e=!1);var t=k.setPrompt(e);return j||(z(1),j=!0),function(){return j&&(j=!1,z(-1)),t()}},listen:function(e){var t=k.appendListener(e);return z(1),function(){z(-1),t()}}};return V}var k="hashchange",N={hashbang:{encodePath:function(e){return"!"===e.charAt(0)?e:"!/"+g(e)},decodePath:function(e){return"!"===e.charAt(0)?e.substr(1):e}},noslash:{encodePath:g,decodePath:m},slash:{encodePath:m,decodePath:m}};function M(e){var t=e.indexOf("#");return-1===t?e:e.slice(0,t)}function P(){var e=window.location.href,t=e.indexOf("#");return-1===t?"":e.substring(t+1)}function L(e){window.location.replace(M(window.location.href)+"#"+e)}function O(e){void 0===e&&{},_||f(!1);var t=window.history,n=(window.navigator.userAgent.indexOf("Firefox"),e),i=n.getUserConfirmation,r=void 0===i?E:i,s=n.hashType,o=void 0===s?"slash":s,a=e.basename?v(m(e.basename)):"",l=N[o],u=l.encodePath,d=l.decodePath;function h(){var e=d(P());return a&&y(e,a),w(e)}var p=x();function g(e){c(j,e),j.length=t.length,p.notifyListeners(j.location,j.action)}var S=!1,C=null;function T(){var e=P(),t=u(e);if(e!==t)L(t);else{var n=h(),i=j.location;if(!S&&function(e,t){return e.pathname===t.pathname&&e.search===t.search&&e.hash===t.hash}(i,n))return;if(C===b(n))return;null,function(e){if(S)!1,g();else{var t="POP";p.confirmTransitionTo(e,t,r,(function(n){n?g({action:t,location:e}):function(e){var t=j.location,n=I.lastIndexOf(b(t));-1===n&&0;var i=I.lastIndexOf(b(e));-1===i&&0;var r=n-i;r&&(!0,D(r))}(e)}))}}(n)}}var A=P(),O=u(A);A!==O&&L(O);var R=h(),I=[b(R)];function D(e){t.go(e)}var F=0;function B(e){1===(F+=e)&&1===e?window.addEventListener(k,T):0===F&&window.removeEventListener(k,T)}var z=!1;var j={length:t.length,action:"POP",location:R,createHref:function(e){var t=document.querySelector("base"),n="";return t&&t.getAttribute("href")&&M(window.location.href),n+"#"+u(a+b(e))},push:function(e,t){var n="PUSH",i=w(e,void 0,void 0,j.location);p.confirmTransitionTo(i,n,r,(function(e){if(e){var t=b(i),r=u(a+t);if(P()!==r){t,function(e){window.location.hash=e}(r);var s=I.lastIndexOf(b(j.location)),o=I.slice(0,s+1);o.push(t),o,g({action:n,location:i})}else g()}}))},replace:function(e,t){var n="REPLACE",i=w(e,void 0,void 0,j.location);p.confirmTransitionTo(i,n,r,(function(e){if(e){var t=b(i),r=u(a+t);P()!==r&&(t,L(r));var s=I.indexOf(b(j.location));-1!==s&&(I[s]=t),g({action:n,location:i})}}))},go:D,goBack:function(){D(-1)},goForward:function(){D(1)},block:function(e){void 0===e&&!1;var t=p.setPrompt(e);return z||(B(1),!0),function(){return z&&(!1,B(-1)),t()}},listen:function(e){var t=p.appendListener(e);return B(1),function(){B(-1),t()}}};return j}function R(e,t,n){return Math.min(Math.max(e,t),n)}function I(e){void 0===e&&{};var t=e,n=t.getUserConfirmation,i=t.initialEntries,r=void 0===i?["/"]:i,s=t.initialIndex,o=void 0===s?0:s,a=t.keyLength,l=void 0===a?6:a,u=x();function d(e){c(y,e),y.length=y.entries.length,u.notifyListeners(y.location,y.action)}function h(){return Math.random().toString(36).substr(2,l)}var p=R(o,0,r.length-1),f=r.map((function(e){return w(e,void 0,"string"==typeof e?h():e.key||h())})),m=b;function g(e){var t=R(y.index+e,0,y.entries.length-1),i=y.entries[t];u.confirmTransitionTo(i,"POP",n,(function(e){e?d({action:"POP",location:i,index:t}):d()}))}var y={length:f.length,action:"POP",location:f[p],index:p,entries:f,createHref:m,push:function(e,t){var i="PUSH",r=w(e,t,h(),y.location);u.confirmTransitionTo(r,i,n,(function(e){if(e){var t=y.index+1,n=y.entries.slice(0);n.length>t?n.splice(t,n.length-t,r):n.push(r),d({action:i,location:r,index:t,entries:n})}}))},replace:function(e,t){var i="REPLACE",r=w(e,t,h(),y.location);u.confirmTransitionTo(r,i,n,(function(e){e&&(y.entries[y.index]=r,d({action:i,location:r}))}))},go:g,goBack:function(){g(-1)},goForward:function(){g(1)},canGo:function(e){var t=y.index+e;return t>=0&&t<y.entries.length},block:function(e){return void 0===e&&!1,u.setPrompt(e)},listen:function(e){return u.appendListener(e)}};return y}var D=1073741823,F="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:{};function B(e){var t=[];return{on:function(e){t.push(e)},off:function(e){t=t.filter((function(t){return t!==e}))},get:function(){return e},set:function(n,i){e=n,t.forEach((function(t){return t(e,i)}))}}}var z=t.createContext||function(e,n){var i,r,s="__create-react-context-"+function(){var e="__global_unique_id__";return F[e]=(F[e]||0)+1}()+"__",a=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).emitter=B(t.props.value),t}o(t,e);var i=t.prototype;return i.getChildContext=function(){var e;return(e={})[s]=this.emitter,e},i.componentWillReceiveProps=function(e){if(this.props.value!==e.value){var t,i=this.props.value,r=e.value;!function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}(i,r)?(t="function"==typeof n?n(i,r):D,0!==(t|=0)&&this.emitter.set(e.value,t)):t=0}},i.render=function(){return this.props.children},t}(t.Component);a.childContextTypes=((i={})[s]=l().object.isRequired,i);var c=function(t){function n(){var e;return(e=t.apply(this,arguments)||this).state={value:e.getValue()},e.onUpdate=function(t,n){0!=((0|e.observedBits)&n)&&e.setState({value:e.getValue()})},e}o(n,t);var i=n.prototype;return i.componentWillReceiveProps=function(e){var t=e.observedBits;this.observedBits=null==t?D:t},i.componentDidMount=function(){this.context[s]&&this.context[s].on(this.onUpdate);var e=this.props.observedBits;this.observedBits=null==e?D:e},i.componentWillUnmount=function(){this.context[s]&&this.context[s].off(this.onUpdate)},i.getValue=function(){return this.context[s]?this.context[s].get():e},i.render=function(){return function(e){return Array.isArray(e)?e[0]:e}(this.props.children)(this.state.value)},n}(t.Component);return c.contextTypes=((r={})[s]=l().object,r),{Provider:a,Consumer:c}};const j=z;var V=n(405),U=n.n(V);n(9185);function H(e,t){if(null==e)return{};var n,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}var $=n(5839),q=n.n($),W=function(e){var t=j();return t.displayName=e,t},G=W("Router-History"),Y=function(e){var t=j();return t.displayName=e,t},X=Y("Router"),K=function(e){function n(t){var n;return(n=e.call(this,t)||this).state={location:t.history.location},n._isMounted=!1,n._pendingLocation=null,t.staticContext||(n.unlisten=t.history.listen((function(e){n._isMounted?n.setState({location:e}):n._pendingLocation=e}))),n}o(n,e),n.computeRootMatch=function(e){return{path:"/",url:"/",params:{},isExact:"/"===e}};var i=n.prototype;return i.componentDidMount=function(){this._isMounted=!0,this._pendingLocation&&this.setState({location:this._pendingLocation})},i.componentWillUnmount=function(){this.unlisten&&this.unlisten()},i.render=function(){return t.createElement(X.Provider,{value:{history:this.props.history,location:this.state.location,match:n.computeRootMatch(this.state.location.pathname),staticContext:this.props.staticContext}},t.createElement(G.Provider,{children:this.props.children||null,value:this.props.history}))},n}(t.Component);t.Component;t.Component;var Z={},J=0;function Q(e,t){void 0===t&&(t={}),("string"==typeof t||Array.isArray(t))&&(t={path:t});var n=t,i=n.path,r=n.exact,s=void 0!==r&&r,o=n.strict,a=void 0!==o&&o,l=n.sensitive,c=void 0!==l&&l;return[].concat(i).reduce((function(t,n){if(!n&&""!==n)return null;if(t)return t;var i=function(e,t){var n=""+t.end+t.strict+t.sensitive,i=Z[n]||(Z[n]={});if(i[e])return i[e];var r=[],s={regexp:U()(e,r,t),keys:r};return J<1e4&&(i[e]=s,J++),s}(n,{end:s,strict:a,sensitive:c}),r=i.regexp,o=i.keys,l=r.exec(e);if(!l)return null;var u=l[0],d=l.slice(1),h=e===u;return s&&!h?null:{path:n,url:"/"===n&&""===u?"/":u,isExact:h,params:o.reduce((function(e,t,n){return e[t.name]=d[n],e}),{})}}),null)}var ee=function(e){function n(){return e.apply(this,arguments)||this}return o(n,e),n.prototype.render=function(){var e=this;return t.createElement(X.Consumer,null,(function(n){n||f(!1);var i=e.props.location||n.location,r=c({},n,{location:i,match:e.props.computedMatch?e.props.computedMatch:e.props.path?Q(i.pathname,e.props):n.match}),s=e.props,o=s.children,a=s.component,l=s.render;return Array.isArray(o)&&0===o.length&&(o=null),t.createElement(X.Provider,{value:r},r.match?o?"function"==typeof o?o(r):o:a?t.createElement(a,r):l?l(r):null:"function"==typeof o?o(r):null)}))},n}(t.Component);function te(e){return"/"===e.charAt(0)?e:"/"+e}function ne(e,t){if(!e)return t;var n=te(e);return 0!==t.pathname.indexOf(n)?t:c({},t,{pathname:t.pathname.substr(n.length)})}function ie(e){return"string"==typeof e?e:b(e)}function re(e){return function(){f(!1)}}function se(){}t.Component;var oe=function(e){function n(){return e.apply(this,arguments)||this}return o(n,e),n.prototype.render=function(){var e=this;return t.createElement(X.Consumer,null,(function(n){n||f(!1);var i,r,s=e.props.location||n.location;return t.Children.forEach(e.props.children,(function(e){if(null==r&&t.isValidElement(e)){i=e;var o=e.props.path||e.props.from;r=o?Q(s.pathname,c({},e.props,{path:o})):n.match}})),r?t.cloneElement(i,{location:s,computedMatch:r}):null}))},n}(t.Component);function ae(e){var n="withRouter("+(e.displayName||e.name)+")",i=function(n){var i=n.wrappedComponentRef,r=H(n,["wrappedComponentRef"]);return t.createElement(X.Consumer,null,(function(n){return n||f(!1),t.createElement(e,c({},r,n,{ref:i}))}))};return i.displayName=n,i.WrappedComponent=e,q()(i,e)}t.useContext;var le=function(e){function n(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).history=A(t.props),t}return o(n,e),n.prototype.render=function(){return t.createElement(K,{history:this.history,children:this.props.children})},n}(t.Component);t.Component;var ce=function(e,t){return"function"==typeof e?e(t):e},ue=function(e,t){return"string"==typeof e?w(e,null,null,t):e},de=function(e){return e},he=t.forwardRef;void 0===he&&(he=de);var pe=he((function(e,n){var i=e.innerRef,r=e.navigate,s=e.onClick,o=H(e,["innerRef","navigate","onClick"]),a=o.target,l=c({},o,{onClick:function(e){try{s&&s(e)}catch(t){throw e.preventDefault(),t}e.defaultPrevented||0!==e.button||a&&"_self"!==a||function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)||(e.preventDefault(),r())}});return l.ref=de!==he&&n||i,t.createElement("a",l)}));var fe=he((function(e,n){var i=e.component,r=void 0===i?pe:i,s=e.replace,o=e.to,a=e.innerRef,l=H(e,["component","replace","to","innerRef"]);return t.createElement(X.Consumer,null,(function(e){e||f(!1);var i=e.history,u=ue(ce(o,e.location),e.location),d=u?i.createHref(u):"",h=c({},l,{href:d,navigate:function(){var t=ce(o,e.location);(s?i.replace:i.push)(t)}});return de!==he?h.ref=n||a:h.innerRef=a,t.createElement(r,h)}))})),me=function(e){return e},ge=t.forwardRef;void 0===ge&&(ge=me);var ye=ge((function(e,n){var i=e["aria-current"],r=void 0===i?"page":i,s=e.activeClassName,o=void 0===s?"active":s,a=e.activeStyle,l=e.className,u=e.exact,d=e.isActive,h=e.location,p=e.sensitive,m=e.strict,g=e.style,y=e.to,v=e.innerRef,b=H(e,["aria-current","activeClassName","activeStyle","className","exact","isActive","location","sensitive","strict","style","to","innerRef"]);return t.createElement(X.Consumer,null,(function(e){e||f(!1);var i=h||e.location,s=ue(ce(y,i),i),w=s.pathname,x=w&&w.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1"),_=x?Q(i.pathname,{path:x,exact:u,sensitive:p,strict:m}):null,E=!!(d?d(_,i):_),S=E?function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((function(e){return e})).join(" ")}(l,o):l,C=E?c({},g,{},a):g,T=c({"aria-current":E&&r||null,className:S,style:C,to:s},b);return me!==ge?T.ref=n||v:T.innerRef=v,t.createElement(fe,T)}))}));const ve=function(){return t.createElement("div",{className:"bg-white ta-center p-2 f-1 flex-col"},t.createElement("div",{className:"p-1"},"404 page not found"),t.createElement(ye,{to:"/"},"Home"))};var be="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z",we="M11,15H13V17H11V15M11,7H13V13H11V7M12,2C6.47,2 2,6.5 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20Z",xe="M12,2L1,21H23M12,6L19.53,19H4.47M11,10V14H13V10M11,16V18H13V16",_e="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z",Ee="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1M17,12H12V17H17V12Z",Se="M22 5V7H19V10H17V7H14V5H17V2H19V5H22M19 19H5V5H11V3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V13H19V19M15 13V17H17V13H15M11 17H13V9H11V17M9 17V11H7V17H9Z",Ce="M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z",Te="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z",Ae="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z",ke="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z",Ne="M6 12.45V9.64C7.47 10.47 9.61 11 12 11S16.53 10.47 18 9.64V12.03C18.17 12 18.33 12 18.5 12C19 12 19.5 12.07 20 12.18V7C20 4.79 16.42 3 12 3S4 4.79 4 7V17C4 19.21 7.59 21 12 21C12.17 21 12.33 21 12.5 21C12.24 20.37 12.09 19.7 12.03 19L12 19C8.13 19 6 17.5 6 17V14.77C7.61 15.55 9.72 16 12 16C12.17 16 12.34 16 12.5 16C12.85 15.18 13.34 14.46 13.95 13.86C13.32 13.95 12.67 14 12 14C9.58 14 7.3 13.4 6 12.45M12 5C15.87 5 18 6.5 18 7S15.87 9 12 9 6 7.5 6 7 8.13 5 12 5M18 18.5L19.77 16.73C19.32 16.28 18.69 16 18 16C16.62 16 15.5 17.12 15.5 18.5S16.62 21 18 21C18.82 21 19.54 20.61 20 20H21.71C21.12 21.47 19.68 22.5 18 22.5C15.79 22.5 14 20.71 14 18.5S15.79 14.5 18 14.5C19.11 14.5 20.11 14.95 20.83 15.67L22 14.5V18.5H18Z",Me="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z",Pe="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z",Le="M11.83,9L15,12.16C15,12.11 15,12.05 15,12A3,3 0 0,0 12,9C11.94,9 11.89,9 11.83,9M7.53,9.8L9.08,11.35C9.03,11.56 9,11.77 9,12A3,3 0 0,0 12,15C12.22,15 12.44,14.97 12.65,14.92L14.2,16.47C13.53,16.8 12.79,17 12,17A5,5 0 0,1 7,12C7,11.21 7.2,10.47 7.53,9.8M2,4.27L4.28,6.55L4.73,7C3.08,8.3 1.78,10 1,12C2.73,16.39 7,19.5 12,19.5C13.55,19.5 15.03,19.2 16.38,18.66L16.81,19.08L19.73,22L21,20.73L3.27,3M12,7A5,5 0 0,1 17,12C17,12.64 16.87,13.26 16.64,13.82L19.57,16.75C21.07,15.5 22.27,13.86 23,12C21.27,7.61 17,4.5 12,4.5C10.6,4.5 9.26,4.75 8,5.2L10.17,7.35C10.74,7.13 11.35,7 12,7Z",Oe="M14,2L20,8V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V4A2,2 0 0,1 6,2H14M18,20V9H13V4H6V20H18M12,12L16,16H13.5V19H10.5V16H8L12,12Z",Re="M14,12V19.88C14.04,20.18 13.94,20.5 13.71,20.71C13.32,21.1 12.69,21.1 12.3,20.71L10.29,18.7C10.06,18.47 9.96,18.16 10,17.87V12H9.97L4.21,4.62C3.87,4.19 3.95,3.56 4.38,3.22C4.57,3.08 4.78,3 5,3V3H19V3C19.22,3 19.43,3.08 19.62,3.22C20.05,3.56 20.13,4.19 19.79,4.62L14.03,12H14Z",Ie="M18.5,4L19.66,8.35L18.7,8.61C18.25,7.74 17.79,6.87 17.26,6.43C16.73,6 16.11,6 15.5,6H13V16.5C13,17 13,17.5 13.33,17.75C13.67,18 14.33,18 15,18V19H9V18C9.67,18 10.33,18 10.67,17.75C11,17.5 11,17 11,16.5V6H8.5C7.89,6 7.27,6 6.74,6.43C6.21,6.87 5.75,7.74 5.3,8.61L4.34,8.35L5.5,4H18.5Z",De="M15.6,5.29C14.5,5.19 13.53,6 13.43,7.11L13.18,10H16V12H13L12.56,17.07C12.37,19.27 10.43,20.9 8.23,20.7C6.92,20.59 5.82,19.86 5.17,18.83L6.67,17.33C6.91,18.07 7.57,18.64 8.4,18.71C9.5,18.81 10.47,18 10.57,16.89L11,12H8V10H11.17L11.44,6.93C11.63,4.73 13.57,3.1 15.77,3.3C17.08,3.41 18.18,4.14 18.83,5.17L17.33,6.67C17.09,5.93 16.43,5.36 15.6,5.29Z",Fe="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M19,19H15V21H19A2,2 0 0,0 21,19V15H19M19,3H15V5H19V9H21V5A2,2 0 0,0 19,3M5,5H9V3H5A2,2 0 0,0 3,5V9H5M5,15H3V19A2,2 0 0,0 5,21H9V19H5V15Z",Be="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z",ze="M15,19L9,16.89V5L15,7.11M20.5,3C20.44,3 20.39,3 20.34,3L15,5.1L9,3L3.36,4.9C3.15,4.97 3,5.15 3,5.38V20.5A0.5,0.5 0 0,0 3.5,21C3.55,21 3.61,21 3.66,20.97L9,18.9L15,21L20.64,19.1C20.85,19 21,18.85 21,18.62V3.5A0.5,0.5 0 0,0 20.5,3Z",je="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z",Ve="M14.06,9L15,9.94L5.92,19H5V18.08L14.06,9M17.66,3C17.41,3 17.15,3.1 16.96,3.29L15.13,5.12L18.88,8.87L20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18.17,3.09 17.92,3 17.66,3M14.06,6.19L3,17.25V21H6.75L17.81,9.94L14.06,6.19Z",Ue="M8,5.14V19.14L19,12.14L8,5.14Z",He="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z",$e="M13.8 22H5C3.3 22 2 20.7 2 19V18H13.1C13 18.3 13 18.7 13 19C13 20.1 13.3 21.1 13.8 22M13.8 16H5V5C5 3.3 6.3 2 8 2H19C20.7 2 22 3.3 22 5V6H20V5C20 4.4 19.6 4 19 4S18 4.4 18 5V13.1C16.2 13.4 14.7 14.5 13.8 16M8 8H15V6H8V8M8 12H14V10H8V12M17 16V22L22 19L17 16Z",qe="M15.5,14L20.5,19L19,20.5L14,15.5V14.71L13.73,14.43C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.43,13.73L14.71,14H15.5M9.5,4.5L8.95,4.53C8.71,5.05 8.34,5.93 8.07,7H10.93C10.66,5.93 10.29,5.05 10.05,4.53C9.87,4.5 9.69,4.5 9.5,4.5M13.83,7C13.24,5.97 12.29,5.17 11.15,4.78C11.39,5.31 11.7,6.08 11.93,7H13.83M5.17,7H7.07C7.3,6.08 7.61,5.31 7.85,4.78C6.71,5.17 5.76,5.97 5.17,7M4.5,9.5C4.5,10 4.58,10.53 4.73,11H6.87L6.75,9.5L6.87,8H4.73C4.58,8.47 4.5,9 4.5,9.5M14.27,11C14.42,10.53 14.5,10 14.5,9.5C14.5,9 14.42,8.47 14.27,8H12.13C12.21,8.5 12.25,9 12.25,9.5C12.25,10 12.21,10.5 12.13,11H14.27M7.87,8L7.75,9.5L7.87,11H11.13C11.21,10.5 11.25,10 11.25,9.5C11.25,9 11.21,8.5 11.13,8H7.87M9.5,14.5C9.68,14.5 9.86,14.5 10.03,14.47C10.28,13.95 10.66,13.07 10.93,12H8.07C8.34,13.07 8.72,13.95 8.97,14.47L9.5,14.5M13.83,12H11.93C11.7,12.92 11.39,13.69 11.15,14.22C12.29,13.83 13.24,13.03 13.83,12M5.17,12C5.76,13.03 6.71,13.83 7.85,14.22C7.61,13.69 7.3,12.92 7.07,12H5.17Z",We="M3 11H15V13H3M3 18V16H21V18M3 6H9V8H3Z",Ge="M3,13H15V11H3M3,6V8H21V6M3,18H9V16H3V18Z",Ye="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4M9,9V15H15V9",Xe="M5,4H19A2,2 0 0,1 21,6V18A2,2 0 0,1 19,20H5A2,2 0 0,1 3,18V6A2,2 0 0,1 5,4M5,8V12H11V8H5M13,8V12H19V8H13M5,14V18H11V14H5M13,14V18H19V14H13Z",Ke="M21.7,13.35L20.7,14.35L18.65,12.3L19.65,11.3C19.86,11.08 20.21,11.08 20.42,11.3L21.7,12.58C21.92,12.79 21.92,13.14 21.7,13.35M12,18.94L18.07,12.88L20.12,14.93L14.06,21H12V18.94M4,2H18A2,2 0 0,1 20,4V8.17L16.17,12H12V16.17L10.17,18H4A2,2 0 0,1 2,16V4A2,2 0 0,1 4,2M4,6V10H10V6H4M12,6V10H18V6H12M4,12V16H10V12H4Z",Ze="M16.59,5.41L15.17,4L12,7.17L8.83,4L7.41,5.41L12,10M7.41,18.59L8.83,20L12,16.83L15.17,20L16.58,18.59L12,14L7.41,18.59Z",Je="M12,18.17L8.83,15L7.42,16.41L12,21L16.59,16.41L15.17,15M12,5.83L15.17,9L16.58,7.59L12,3L7.41,7.59L8.83,9L12,5.83Z",Qe="M4 5V18H21V5H4M14 7V16H11V7H14M6 7H9V16H6V7M19 16H16V7H19V16Z",et=n(9823),tt=n.n(et);class RTComp extends t.Component{constructor(){super(...arguments),this.mounted=!1,this.state={},this.d={},this.componentDidUpdate=async(e,t)=>{let n,i;Object.keys({...e,...this.props}).map((t=>{e[t]!==this.props[t]&&(n={...n,[t]:this.props[t]})})),Object.keys({...t,...this.state}).map((e=>{t[e]!==this.state[e]&&(i={...i,[e]:this.state[e]})}));try{(i||n)&&await this.setDeltaPS(n,i),await this.onUpdated(e,t)}catch(e){console.error("onUpdated error",e)}},this.setDeltaPS=(e,t)=>{this._onDelta(e,t,void 0)},this._onDelta=async(e,t,n)=>{try{await this.onDelta(e,t,n);const i={...e,...t,...n};await this.onDeltaCombined(i,Object.keys(i))}catch(e){throw e}}}async componentDidMount(){this.mounted=!0;try{await this.onMount()}catch(e){console.error("onMount error",e)}try{this.setDeltaPS({...this.props},{...this.state})}catch(e){console.error("setDeltaPS error",e)}}onMount(){}componentWillUnmount(){this.mounted=!1,this.onUnmount()}onUnmount(){}onUpdated(e,t){}setData(e,t){this.d={...this.d,...e};try{this._onDelta(void 0,void 0,t||e)}catch(e){console.error("onDelta error",e)}}onDelta(e,t,n){}onDeltaCombined(e,t){}setState(e,t){if(this.mounted)return super.setState(e,t)}}class Loading extends RTComp{constructor(){super(...arguments),this.state={ready:!1},this.mounted=!1,this.onDeltaCombined=(e,t)=>{t.includes("show")}}onMount(){if(this.mounted=!0,"show"in this.props)return;const{delay:e=500}=this.props;setTimeout((()=>{this.mounted&&this.setState({ready:!0})}),e)}render(){const{style:e={},className:n="",variant:i,sizePx:r=30,message:s}=this.props,{show:o=this.state.ready}=this.props,a=r+"px";let l=s?t.createElement("div",null,s):null;const c={opacity:o?1:1e-4};return"top-bar"===i?t.createElement("div",{style:{position:"absolute",zIndex:2,top:0,left:0,right:0,width:"100%",height:"6px",...e,...c},className:"top-bar-loader "+n}):"cover"===i?t.createElement(t.Fragment,null,t.createElement("div",{style:{position:"absolute",cursor:"wait",zIndex:2,inset:0,width:"100%",height:"100%",...e,...c,background:"rgb(255 255 255 / 73%)"},className:"cover-loader "+n})):t.createElement("div",{style:{...e,width:a,height:a,opacity:o?1:0},className:"spinner-loader ws-nowrap flex-row gap-1 ai-center "+n},t.createElement("svg",{className:"spinner",width:a,height:a,viewBox:"0 0 66 66",xmlns:"http://www.w3.org/2000/svg"},t.createElement("circle",{className:"path",fill:"none",strokeWidth:"6",strokeLinecap:"round",cx:"33",cy:"33",r:"30"})),l)}}const nt=["iconPath","children","disabledInfo","title","onClick","loading","color","fadeIn","_ref","ref","style","size","exactClassName","onClickMessage"];class Btn extends RTComp{constructor(){super(...arguments),this.state={show:!0},this.clickMessage=e=>{"err"in e?this.setState({clickMessage:{type:"err",msg:e.err}}):"ok"in e?this.setState({clickMessage:{type:"ok",msg:e.ok}}):"loading"in e&&this.setState({clickMessage:{type:"loading",msg:""}}),setTimeout((()=>{this.mounted&&this.setState({clickMessage:void 0})}),2e3)}}render(){var e,n;const{iconPath:i,className:r="",style:s={},disabledInfo:o,title:a,fadeIn:l,exactClassName:c,variant:u,onClickMessage:d}=this.props,{show:h,clickMessage:p}=this.state;let f={};const m="err"===(null==p?void 0:p.type)?"warn":this.props.color,g="loading"===(null==p?void 0:p.type)||null!==(e=this.props.loading)&&void 0!==e&&e,y=null!==(n=null==p?void 0:p.msg)&&void 0!==n?n:this.props.children,v=o||g;let b=c||"",{size:w}=this.props;c||(b=" f-0 flex-row ai-center bg-active-hover "+((r+"").includes("bg-")?"":"  bg-transparent ")+("href"in this.props?" button-css ":"  "),!w&&window.isMobileDevice&&(w="small"),y?("outline"===u&&(f={border:"1px solid",borderColor:"currentcolor"},"small"===w&&(f.padding="6px 8px")),"large"===w&&(f.padding="12px 16px")):(f={padding:"8px"},"outline"===u&&(f={padding:"0.5em",border:"1px solid",borderColor:"currentcolor"}),"small"===w&&(f.padding="4px")),b+=` ${"filled"===u?"bg":"text"}${"danger"===m?"-red-600":"warn"===m?"-yellow-500":"action"===m?"-blue-500":"inherit"===m?"-inherit":"transparent"===m?"-transparent":"white"===m?"-white":"-gray-500"} `,m&&"filled"===u&&(b+="text-white ")),b+=(l?" fade-in ":"")+(i&&!y?"  ":"rounded")+(v?" disabled ":" ")+r;const x=t.createElement(t.Fragment,null,!i||g?null:t.createElement(tt(),{path:i,size:"micro"===w?.5:"small"===w?.75:1,className:y?"mr-p5":""}),g?t.createElement(Loading,{className:"mr-p5"}):null,t.createElement("div",{style:g?{opacity:.5}:{}},y));let _=this.props.onClick;d&&(_=e=>{d(e,this.clickMessage)});const E={...(S=this.props,C=nt,mT(S,dT(null!=S?S:[]).filter((e=>!C.includes(e))))),onClick:v||g?void 0:_,title:o||a,style:{...f,lineHeight:"1em",width:"fit-content",...s},onMouseDown:e=>e.preventDefault(),className:b,ref:this.props._ref};var S,C;return"href"in this.props&&this.props.href?t.createElement("a",{...E},x):t.createElement("button",{...E},x)}}class ClickCatch extends t.Component{render(){const{onClick:e,children:n,style:i}=this.props;return t.createElement("div",{style:{display:"block",position:"fixed",backgroundColor:"rgb(0 0 0 / .5)",zIndex:0,...i},className:"fixed noselect inset-0 w-full, h-full",ref:e=>{e&&(this.clickCatch=e)},onClick:t=>{t.target===this.clickCatch&&e(t)},onContextMenu:t=>(t.preventDefault(),t.target===this.clickCatch&&e(t),!1)},n)}}let it=document.getElementById("modal-root");it||(it=document.createElement("div"),it.setAttribute("id","modal-root"),document.body.appendChild(it));const rt={padding:0,top:0,right:0,bottom:0,width:"fit-content",maxHeight:"100%",borderRadius:0,maxWidth:"100vw"};class Popup extends RTComp{constructor(){super(...arguments),this.el=document.createElement("div"),this.state={loaded:!1,stateStyle:{opacity:0},collapsed:!1},this.checkFocus=e=>{var t,n,i,r;const{onClose:s,focusTrap:o=!0,onKeyDown:a}=this.props;if(a&&a(e),o&&"Tab"===e.key){const s=null!==(n=null===(t=this.el.querySelector(".popup-actual-content"))||void 0===t?void 0:t.querySelectorAll("a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]"))&&void 0!==n?n:[];e.shiftKey&&document.activeElement===s[0]&&(e.preventDefault(),s.length&&(null===(i=s[s.length-1])||void 0===i||i.focus())),e.shiftKey||document.activeElement!==s[s.length-1]&&this.el.contains(document.activeElement)||(e.preventDefault(),s.length&&(null===(r=s[0])||void 0===r||r.focus()))}"Escape"===e.key&&(null==s||s())},this.position={},this.checkPosition=()=>{var e;if(!this.mounted)return;const{anchorEl:t,anchorXY:n,positioning:i}=this.props,r=null===(e=this.ref)||void 0===e?void 0:e.getBoundingClientRect(),s={opacity:1,zIndex:4,position:"fixed"};if("as-is"!==i&&"right-panel"!==i){if(r){const e=window.innerWidth>900?10:0,o=window.innerWidth<r.width?0:e,a=window.innerHeight<r.height?0:e;let l,c=0,u=0,d=0,h=0;n?(c=n.x,u=n.y):t?(l=t.getBoundingClientRect(),c=l.x,u=l.y,h=l.height,d=l.width):(c=(window.innerWidth-r.width)/2,u=(window.innerHeight-r.height)/2,i&&"top-center"!==i&&console.warn("Popup positioning provided without an anchorEl or anchorXY"));let p,f=c,m=Math.max(0,l?l.x:n?n.x:c),g=Math.max(0,l?l.x+(Math.max(r.width,l.width)-Math.min(r.width,l.width))/2:n?n.x-r.width/2:c),y=u;if("top-center"===i?(y=50,f=.5*(window.document.body.offsetWidth-r.width)):"top-fill"===i?(y=u,f=m):"beneath-fill"===i?(y=u+h,f=g):"beneath-center"===i||"beneath-left"===i||"beneath-left-minfill"===i?(y=u+h,f=m):"beneath-right"===i?(y=u+h,f=c+d-r.width):"tooltip"===i?(y=u+a,f=c-o-r.width):"inside-top-center"!==i&&"above-center"!==i||(f=g,y=(null==l?void 0:l.y)||0,"above-center"===i&&(y=u-r.height)),f+r.width+o>window.innerWidth?(f=Math.max(o,window.innerWidth-r.width-o),p=0):f<0&&(f=o),y+r.height+a>window.innerHeight){if(y=Math.max(a,window.innerHeight-r.height-a),f===o&&y>a){const e=u-a-r.height;e>0&&(y=e)}}else y<0&&(y=a);if(this.position.x!==f||this.position.y!==y){if(this.position={x:f,y},!this.mounted||!this.el.isConnected)return;let e={stateStyle:{...s,...Number.isFinite(p)?{right:p}:{left:`${Math.round(f)}px`},top:`${Math.round(y)}px`}};(null==i?void 0:i.endsWith("-minfill"))&&(null==l?void 0:l.width)&&r.width<(null==l?void 0:l.width)?e.stateStyle.width=`${null==l?void 0:l.width}px`:(null==i?void 0:i.endsWith("-fill"))&&(e.stateStyle.width=`${d}px`),this.setState(e)}}}else this.setState({stateStyle:{...s,..."right-panel"===i?rt:{}}})}}onMount(){this.el.classList.add("w-fit","h-fit"),it&&it.appendChild(this.el),setTimeout((()=>{this.checkPosition()}),50),window.document.body.addEventListener("keydown",this.checkFocus),this.ref&&(this.rObserver=new ResizeObserver((()=>{this.checkPosition()})),this.rObserver.observe(this.ref))}onUnmount(){var e;if(it)try{it.removeChild(this.el)}catch(e){console.error(e)}window.document.body.removeEventListener("keydown",this.checkFocus),this.ref&&(null===(e=this.rObserver)||void 0===e||e.unobserve(this.ref))}onUpdated(){}render(){const{onClose:e=(()=>{}),positioning:n,title:i,content:s,children:o,footerButtons:a=[],clickCatchStyle:l={},rootStyle:c={},onClickClose:u,contentClassName:d="p-1",footer:h,contentStyle:p={},collapsible:f}=this.props,{stateStyle:m,collapsed:g=!1}=this.state,y=()=>{this.setState({collapsed:!g})},v=a.filter((e=>e));let b={};"tooltip"===n&&(b={pointerEvents:"none",touchAction:"none"});const w={maxWidth:"99vw",maxHeight:"100vh",outline:"none",zIndex:4,padding:0,borderRadius:".5em",...b,...m,...c},x=t.createElement(t.Fragment,null,e?t.createElement(ClickCatch,{style:{position:"fixed",zIndex:4,...l},className:"absolute inset-0 bg-gray-500 opacity-75 flex-col",onClick:()=>{e()}}):null,t.createElement("div",{className:"card m-auto bg-white flex-col shadow-xl transform transition-all ",ref:e=>{e&&(this.ref=e)},onClick:u&&e?()=>{e()}:void 0,style:{...w,boxSizing:"content-box"},role:"dialog","aria-modal":"true","aria-labelledby":"modal-headline"},t.createElement("div",{className:"w-full min-h-0 text-center flex-col f-1"},i&&e?t.createElement("div",{className:"flex-row ai-center"},f&&t.createElement(Btn,{className:"f-0",onClick:y,iconPath:g?Je:Ze,title:"Collapse/Expand changes"}),t.createElement("h4",{className:"f-1 text-lg pl-p5 noselect font-medium text-gray-900 o-hidden text-ellipsis ta-left m-0 ws-nowrap "+(f?" pl-0 pointer ":" "),id:"modal-headline",onClick:f?y:void 0,style:{...window.isMobileDevice?{margin:"8px",whiteSpace:"nowrap"}:{},...f?{paddingLeft:0}:{}},title:"string"==typeof i?i:void 0},i),t.createElement(Btn,{className:"f-0",iconPath:Ae,onClick:()=>e()})):null,!g&&t.createElement("div",{className:"flex-col f-1 min-h-0 popup-actual-content "+d,style:{borderRadius:".5em",...p}},s||o),h?t.createElement("div",{className:"popup-footer f-0 flex-row-wrap"},h):null),v.length?t.createElement("div",{className:"bg-gray-50 flex-row-wrap x-spacers-1 jc-around "+(window.isMobileDevice?" p-p5 ":"p-1 ")},v.map(((n,i)=>t.createElement(Btn,{key:i,...pT(n,void 0,["label","onClickClose","onClick"]),onClick:t=>{n.onClickClose&&e?e():n.onClick?n.onClick(t):console.error("Button is missing click handler")}},n.label)))):null));return r.createPortal(x,this.el)}}function st(e){const[n,i]=(0,t.useState)(),[r,s]=(0,t.useState)(),{render:o,children:a,content:l,style:c={},className:u="",onClickClose:d}=e,h=()=>i(null);let p=null;return n&&(p=t.createElement(Popup,{...e,...e,onClose:()=>{i(null)},onClickClose:null!=d?d:!Boolean(o),open:Boolean(n),content:o?o(h):l||a,anchorEl:r})),t.createElement("div",{ref:e=>{e&&s(e)},style:c,className:"h-fit w-fit "+u,onClick:e=>{(null==r?void 0:r.contains(e.nativeEvent.target))&&i(e.nativeEvent.target)}},e.button,p)}var ot=Math.sqrt(50),at=Math.sqrt(10),lt=Math.sqrt(2);function ct(e,t,n){var i=(t-e)/Math.max(0,n),r=Math.floor(Math.log(i)/Math.LN10),s=i/Math.pow(10,r);return r>=0?(s>=ot?10:s>=at?5:s>=lt?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(s>=ot?10:s>=at?5:s>=lt?2:1)}function ut(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function dt(e){let t=e,n=e;function i(e,t,i,r){for(null==i&&(i=0),null==r&&(r=e.length);i<r;){const s=i+r>>>1;n(e[s],t)<0?i=s+1:r=s}return i}return 1===e.length&&(t=(t,n)=>e(t)-n,n=function(e){return(t,n)=>ut(e(t),n)}(e)),{left:i,center:function(e,n,r,s){null==r&&(r=0),null==s&&(s=e.length);const o=i(e,n,r,s-1);return o>r&&t(e[o-1],n)>-t(e[o],n)?o-1:o},right:function(e,t,i,r){for(null==i&&(i=0),null==r&&(r=e.length);i<r;){const s=i+r>>>1;n(e[s],t)>0?r=s:i=s+1}return i}}}const ht=dt(ut),pt=ht.right,ft=(ht.left,dt((function(e){return null===e?NaN:+e})).center,pt);function mt(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function gt(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function yt(){}var vt=.7,bt=1/vt,wt="\\s*([+-]?\\d+)\\s*",xt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",_t="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Et=/^#([0-9a-f]{3,8})$/,St=new RegExp("^rgb\\("+[wt,wt,wt]+"\\)$"),Ct=new RegExp("^rgb\\("+[_t,_t,_t]+"\\)$"),Tt=new RegExp("^rgba\\("+[wt,wt,wt,xt]+"\\)$"),At=new RegExp("^rgba\\("+[_t,_t,_t,xt]+"\\)$"),kt=new RegExp("^hsl\\("+[xt,_t,_t]+"\\)$"),Nt=new RegExp("^hsla\\("+[xt,_t,_t,xt]+"\\)$"),Mt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Pt(){return this.rgb().formatHex()}function Lt(){return this.rgb().formatRgb()}function Ot(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Et.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?Rt(t):3===n?new Bt(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?It(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?It(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=St.exec(e))?new Bt(t[1],t[2],t[3],1):(t=Ct.exec(e))?new Bt(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Tt.exec(e))?It(t[1],t[2],t[3],t[4]):(t=At.exec(e))?It(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=kt.exec(e))?Ut(t[1],t[2]/100,t[3]/100,1):(t=Nt.exec(e))?Ut(t[1],t[2]/100,t[3]/100,t[4]):Mt.hasOwnProperty(e)?Rt(Mt[e]):"transparent"===e?new Bt(NaN,NaN,NaN,0):null}function Rt(e){return new Bt(e>>16&255,e>>8&255,255&e,1)}function It(e,t,n,i){return i<=0&&(e=t=n=NaN),new Bt(e,t,n,i)}function Dt(e){return e instanceof yt||(e=Ot(e)),e?new Bt((e=e.rgb()).r,e.g,e.b,e.opacity):new Bt}function Ft(e,t,n,i){return 1===arguments.length?Dt(e):new Bt(e,t,n,null==i?1:i)}function Bt(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}function zt(){return"#"+Vt(this.r)+Vt(this.g)+Vt(this.b)}function jt(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function Vt(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function Ut(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new $t(e,t,n,i)}function Ht(e){if(e instanceof $t)return new $t(e.h,e.s,e.l,e.opacity);if(e instanceof yt||(e=Ot(e)),!e)return new $t;if(e instanceof $t)return e;var t=(e=e.rgb()).r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),s=Math.max(t,n,i),o=NaN,a=s-r,l=(s+r)/2;return a?(o=t===s?(n-i)/a+6*(n<i):n===s?(i-t)/a+2:(t-n)/a+4,a/=l<.5?s+r:2-s-r,o*=60):a=l>0&&l<1?0:o,new $t(o,a,l,e.opacity)}function $t(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}function qt(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function Wt(e,t,n,i,r){var s=e*e,o=s*e;return((1-3*e+3*s-o)*t+(4-6*s+3*o)*n+(1+3*e+3*s-3*o)*i+o*r)/6}mt(yt,Ot,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Pt,formatHex:Pt,formatHsl:function(){return Ht(this).formatHsl()},formatRgb:Lt,toString:Lt}),mt(Bt,Ft,gt(yt,{brighter:function(e){return e=null==e?bt:Math.pow(bt,e),new Bt(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?vt:Math.pow(vt,e),new Bt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:zt,formatHex:zt,formatRgb:jt,toString:jt})),mt($t,(function(e,t,n,i){return 1===arguments.length?Ht(e):new $t(e,t,n,null==i?1:i)}),gt(yt,{brighter:function(e){return e=null==e?bt:Math.pow(bt,e),new $t(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?vt:Math.pow(vt,e),new $t(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new Bt(qt(e>=240?e-240:e+120,r,i),qt(e,r,i),qt(e<120?e+240:e-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));const Gt=e=>()=>e;function Yt(e,t){return function(n){return e+n*t}}function Xt(e){return 1==(e=+e)?Kt:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}(t,n,e):Gt(isNaN(t)?n:t)}}function Kt(e,t){var n=t-e;return n?Yt(e,n):Gt(isNaN(e)?t:e)}const Zt=function e(t){var n=Xt(t);function i(e,t){var i=n((e=Ft(e)).r,(t=Ft(t)).r),r=n(e.g,t.g),s=n(e.b,t.b),o=Kt(e.opacity,t.opacity);return function(t){return e.r=i(t),e.g=r(t),e.b=s(t),e.opacity=o(t),e+""}}return i.gamma=e,i}(1);function Jt(e){return function(t){var n,i,r=t.length,s=new Array(r),o=new Array(r),a=new Array(r);for(n=0;n<r;++n)i=Ft(t[n]),s[n]=i.r||0,o[n]=i.g||0,a[n]=i.b||0;return s=e(s),o=e(o),a=e(a),i.opacity=1,function(e){return i.r=s(e),i.g=o(e),i.b=a(e),i+""}}}Jt((function(e){var t=e.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),r=e[i],s=e[i+1],o=i>0?e[i-1]:2*r-s,a=i<t-1?e[i+2]:2*s-r;return Wt((n-i/t)*t,o,r,s,a)}})),Jt((function(e){var t=e.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*t),r=e[(i+t-1)%t],s=e[i%t],o=e[(i+1)%t],a=e[(i+2)%t];return Wt((n-i/t)*t,r,s,o,a)}}));function Qt(e,t){var n,i=t?t.length:0,r=e?Math.min(i,e.length):0,s=new Array(r),o=new Array(i);for(n=0;n<r;++n)s[n]=ln(e[n],t[n]);for(;n<i;++n)o[n]=t[n];return function(e){for(n=0;n<r;++n)o[n]=s[n](e);return o}}function en(e,t){var n=new Date;return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function tn(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function nn(e,t){var n,i={},r={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?i[n]=ln(e[n],t[n]):r[n]=t[n];return function(e){for(n in i)r[n]=i[n](e);return r}}var rn=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,sn=new RegExp(rn.source,"g");function on(e,t){var n,i,r,s=rn.lastIndex=sn.lastIndex=0,o=-1,a=[],l=[];for(e+="",t+="";(n=rn.exec(e))&&(i=sn.exec(t));)(r=i.index)>s&&(r=t.slice(s,r),a[o]?a[o]+=r:a[++o]=r),(n=n[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,l.push({i:o,x:tn(n,i)})),s=sn.lastIndex;return s<t.length&&(r=t.slice(s),a[o]?a[o]+=r:a[++o]=r),a.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,i=0;i<t;++i)a[(n=l[i]).i]=n.x(e);return a.join("")})}function an(e,t){t||(t=[]);var n,i=e?Math.min(t.length,e.length):0,r=t.slice();return function(s){for(n=0;n<i;++n)r[n]=e[n]*(1-s)+t[n]*s;return r}}function ln(e,t){var n,i=typeof t;return null==t||"boolean"===i?Gt(t):("number"===i?tn:"string"===i?(n=Ot(t))?(t=n,Zt):on:t instanceof Ot?Zt:t instanceof Date?en:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(t)?an:Array.isArray(t)?Qt:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?nn:tn)(e,t)}function cn(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function un(e){return+e}var dn=[0,1];function hn(e){return e}function pn(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(e){return function(){return e}}(isNaN(t)?NaN:.5)}function fn(e,t,n){var i=e[0],r=e[1],s=t[0],o=t[1];return r<i?(i=pn(r,i),s=n(o,s)):(i=pn(i,r),s=n(s,o)),function(e){return s(i(e))}}function mn(e,t,n){var i=Math.min(e.length,t.length)-1,r=new Array(i),s=new Array(i),o=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<i;)r[o]=pn(e[o],e[o+1]),s[o]=n(t[o],t[o+1]);return function(t){var n=ft(e,t,1,i)-1;return s[n](r[n](t))}}function gn(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function yn(){var e,t,n,i,r,s,o=dn,a=dn,l=ln,c=hn;function u(){var e=Math.min(o.length,a.length);return c!==hn&&(c=function(e,t){var n;return e>t&&(n=e,e=t,t=n),function(n){return Math.max(e,Math.min(t,n))}}(o[0],o[e-1])),i=e>2?mn:fn,r=s=null,d}function d(t){return null==t||isNaN(t=+t)?n:(r||(r=i(o.map(e),a,l)))(e(c(t)))}return d.invert=function(n){return c(t((s||(s=i(a,o.map(e),tn)))(n)))},d.domain=function(e){return arguments.length?(o=Array.from(e,un),u()):o.slice()},d.range=function(e){return arguments.length?(a=Array.from(e),u()):a.slice()},d.rangeRound=function(e){return a=Array.from(e),l=cn,u()},d.clamp=function(e){return arguments.length?(c=!!e||hn,u()):c!==hn},d.interpolate=function(e){return arguments.length?(l=e,u()):l},d.unknown=function(e){return arguments.length?(n=e,d):n},function(n,i){return e=n,t=i,u()}}function vn(){return yn()(hn,hn)}function bn(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}var wn,xn=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function _n(e){if(!(t=xn.exec(e)))throw new Error("invalid format: "+e);var t;return new En({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function En(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function Sn(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function Cn(e){return(e=Sn(Math.abs(e)))?e[1]:NaN}function Tn(e,t){var n=Sn(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}_n.prototype=En.prototype,En.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const An={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Tn(100*e,t),r:Tn,s:function(e,t){var n=Sn(e,t);if(!n)return e+"";var i=n[0],r=n[1],s=r-(wn=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+Sn(e,Math.max(0,t+s-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function kn(e){return e}var Nn,Mn,Pn,Ln=Array.prototype.map,On=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Rn(e){var t,n,i=void 0===e.grouping||void 0===e.thousands?kn:(t=Ln.call(e.grouping,Number),n=e.thousands+"",function(e,i){for(var r=e.length,s=[],o=0,a=t[0],l=0;r>0&&a>0&&(l+a+1>i&&(a=Math.max(1,i-l)),s.push(e.substring(r-=a,r+a)),!((l+=a+1)>i));)a=t[o=(o+1)%t.length];return s.reverse().join(n)}),r=void 0===e.currency?"":e.currency[0]+"",s=void 0===e.currency?"":e.currency[1]+"",o=void 0===e.decimal?".":e.decimal+"",a=void 0===e.numerals?kn:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(Ln.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"−":e.minus+"",u=void 0===e.nan?"NaN":e.nan+"";function d(e){var t=(e=_n(e)).fill,n=e.align,d=e.sign,h=e.symbol,p=e.zero,f=e.width,m=e.comma,g=e.precision,y=e.trim,v=e.type;"n"===v?(m=!0,v="g"):An[v]||(void 0===g&&(g=12),y=!0,v="g"),(p||"0"===t&&"="===n)&&(p=!0,t="0",n="=");var b="$"===h?r:"#"===h&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",w="$"===h?s:/[%p]/.test(v)?l:"",x=An[v],_=/[defgprs%]/.test(v);function E(e){var r,s,l,h=b,E=w;if("c"===v)E=x(e)+E,e="";else{var S=(e=+e)<0||1/e<0;if(e=isNaN(e)?u:x(Math.abs(e),g),y&&(e=function(e){e:for(var t,n=e.length,i=1,r=-1;i<n;++i)switch(e[i]){case".":r=t=i;break;case"0":0===r&&(r=i),t=i;break;default:if(!+e[i])break e;r>0&&(r=0)}return r>0?e.slice(0,r)+e.slice(t+1):e}(e)),S&&0==+e&&"+"!==d&&(S=!1),h=(S?"("===d?d:c:"-"===d||"("===d?"":d)+h,E=("s"===v?On[8+wn/3]:"")+E+(S&&"("===d?")":""),_)for(r=-1,s=e.length;++r<s;)if(48>(l=e.charCodeAt(r))||l>57){E=(46===l?o+e.slice(r+1):e.slice(r))+E,e=e.slice(0,r);break}}m&&!p&&(e=i(e,1/0));var C=h.length+e.length+E.length,T=C<f?new Array(f-C+1).join(t):"";switch(m&&p&&(e=i(T+e,T.length?f-E.length:1/0),T=""),n){case"<":e=h+e+E+T;break;case"=":e=h+T+e+E;break;case"^":e=T.slice(0,C=T.length>>1)+h+e+E+T.slice(C);break;default:e=T+h+e+E}return a(e)}return g=void 0===g?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),E.toString=function(){return e+""},E}return{format:d,formatPrefix:function(e,t){var n=d(((e=_n(e)).type="f",e)),i=3*Math.max(-8,Math.min(8,Math.floor(Cn(t)/3))),r=Math.pow(10,-i),s=On[8+i/3];return function(e){return n(r*e)+s}}}}function In(e,t,n,i){var r,s=function(e,t,n){var i=Math.abs(t-e)/Math.max(0,n),r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),s=i/r;return s>=ot?r*=10:s>=at?r*=5:s>=lt&&(r*=2),t<e?-r:r}(e,t,n);switch((i=_n(null==i?",f":i)).type){case"s":var o=Math.max(Math.abs(e),Math.abs(t));return null!=i.precision||isNaN(r=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Cn(t)/3)))-Cn(Math.abs(e)))}(s,o))||(i.precision=r),Pn(i,o);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(r=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Cn(t)-Cn(e))+1}(s,Math.max(Math.abs(e),Math.abs(t))))||(i.precision=r-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(r=function(e){return Math.max(0,-Cn(Math.abs(e)))}(s))||(i.precision=r-2*("%"===i.type))}return Mn(i)}function Dn(e){var t=e.domain;return e.ticks=function(e){var n=t();return function(e,t,n){var i,r,s,o,a=-1;if(n=+n,(e=+e)==(t=+t)&&n>0)return[e];if((i=t<e)&&(r=e,e=t,t=r),0===(o=ct(e,t,n))||!isFinite(o))return[];if(o>0){let n=Math.round(e/o),i=Math.round(t/o);for(n*o<e&&++n,i*o>t&&--i,s=new Array(r=i-n+1);++a<r;)s[a]=(n+a)*o}else{o=-o;let n=Math.round(e*o),i=Math.round(t*o);for(n/o<e&&++n,i/o>t&&--i,s=new Array(r=i-n+1);++a<r;)s[a]=(n+a)/o}return i&&s.reverse(),s}(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var i=t();return In(i[0],i[i.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var i,r,s=t(),o=0,a=s.length-1,l=s[o],c=s[a],u=10;for(c<l&&(r=l,l=c,c=r,r=o,o=a,a=r);u-- >0;){if((r=ct(l,c,n))===i)return s[o]=l,s[a]=c,t(s);if(r>0)l=Math.floor(l/r)*r,c=Math.ceil(c/r)*r;else{if(!(r<0))break;l=Math.ceil(l*r)/r,c=Math.floor(c*r)/r}i=r}return e},e}async function Fn(e){let t=[],n=await async function(e){return await e.sql("\n      SELECT -- COUNT(*)\n      c.oid,\n      relkind,\n      nspname as schema, \n      relname as name,\n      CASE WHEN current_schema() = nspname THEN format('%I', relname) ELSE format('%I.%I', nspname, relname) END as escaped_identifier,\n      json_agg((\n        SELECT x FROM (\n          SELECT column_name as name,\n          format('%I', column_name) as escaped_identifier,\n          data_type, \n          udt_name\n        ) as x\n      ) ORDER BY ordinal_position ) as cols \n      FROM pg_catalog.pg_class AS c\n      JOIN pg_catalog.pg_namespace AS ns\n        ON c.relnamespace = ns.oid\n      INNER JOIN information_schema.columns cols\n      ON (cols.table_schema, cols.table_name) IN ((nspname, relname))\n      WHERE relkind IN ('r', 'v', 'm' )\n      --AND relname ilike 'trigger%'\n      GROUP BY c.oid, relkind, nspname, relname\n    ",{},{returnType:"rows"})}(e);n.map((e=>{t.push({label:e.name,subLabel:`(${e.cols.map((e=>`${e.escaped_identifier} ${e.udt_name.toUpperCase()}`)).join(", ")})`,escapedIdentifier:e.escaped_identifier,schema:e.schema,insertText:e.escaped_identifier,detail:"(table)",documentation:`**${e.escaped_identifier}**  \n${e.cols.map((e=>`- ${e.name}     \`${e.udt_name}\``)).join("  \n")} `,type:"table",cols:e.cols}),t=t.concat(e.cols.map((t=>({label:t.name,detail:"(column) ",escapedParentName:e.escaped_identifier,schema:e.schema,parentName:e.name,parentOID:e.oid,insertText:t.escaped_identifier,documentation:`Type: \`${"ARRAY"===t.data_type?`${t.udt_name.slice(1)}[]`:t.udt_name}\`  \n Schema: \`${e.schema}\`  \n Table: \`${e.name}\`  `,type:"column"}))))}));const i=await async function(e){return await e.sql("SELECT *, format('%I', datname) as escaped_identifier FROM pg_catalog.pg_database ",{},{returnType:"rows"})}(e);t=t.concat(i.map((e=>({label:e.datname,escapedIdentifier:e.escaped_identifier,insertText:e.escaped_identifier,detail:"(database) ",documentation:" ",type:"database"}))));const r=await async function(e){return await e.sql("  SELECT *, format('%I', usename) as escaped_identifier FROM pg_catalog.pg_user",{},{returnType:"rows"})}(e);t=t.concat(r.map((e=>({label:e.usename,escapedIdentifier:e.escaped_identifier,insertText:e.escaped_identifier,detail:`(role)\n\n   usesuper: ${e.usesuper}\n   usecreatedb: ${e.usecreatedb}\n   usecreatedb: ${e.userepl}\n   usebypassrls: ${e.usebypassrls}`,documentation:" ",type:"role"}))));const s=await Bn({db:e,minArgs:0,limit:4e3,distinct:!0});t=t.concat(s.map((e=>({label:e.name,subLabel:e.func_signature,escapedIdentifier:e.escaped_identifier,insertText:e.escaped_identifier,detail:`(${e.is_aggregate?"agg ":""}function) \n${e.name}(${e.arg_list_str}) => ${e.restype}`,documentation:`Schema: \`${e.schema}\`  \n\n${(e.description||"").trim()}`,type:"function",definition:e.definition}))));const o=await async function(e,t){const n=Object.keys(e).filter((t=>e[t].getColumns));return await e.sql("select typname as name, typtype, typtype NOT IN ('p', 'd', 'c') AS for_cols from pg_type "+(n.length?"WHERE typname NOT IN ($1:csv) ":""),[n.concat(n.map((e=>"_"+e)))],{returnType:"rows"})}(e);t=t.concat(o.map((e=>({label:e.name,detail:"(data type)",documentation:e.name,properties:e,type:"dataType"}))));const a=await async function(e){return(await e.sql("select upper(word) as word from pg_get_keywords();",{},{returnType:"rows"})).map((e=>e.word)).concat(["RAISE","NOTICE","IF NOT EXISTS"])}(e);t=t.concat(a.map((e=>({label:e,detail:"(keyword)",documentation:e,type:"keyword"}))));const l=await async function(e){return await e.sql("SELECT *, installed_version IS NOT NULL as installed  FROM pg_available_extensions;",{},{returnType:"rows"})}(e);t=t.concat(l.map((e=>({label:e.name,detail:`(extension) \nv${e.default_version}  ${e.installed?"Installed":"Not installed"} `,documentation:e.comment,type:"extension"}))));const c=(await async function(e){return await e.sql("\n    SELECT schema_name as name \n    FROM information_schema.schemata\n  ",{},{returnType:"rows"})}(e)).map((({name:e})=>({label:e,detail:"(schema)",type:"schema"})));t=t.concat(c),t=t.map((e=>(!e.insertText&&["extension","function","table","column"].includes(e.type)&&(e.label[0].match(/[^a-z_]/g)||e.label.slice(1).match(/[^a-z_0-9]/g))&&(e.insertText=JSON.stringify(e.label)),e)));const u=await function(e){return e.sql("\n    SHOW ALL;\n\n    /*\n    SELECT name, setting, unit, short_desc, min_val, max_val, reset_val\n    ,format('%I', name) as escaped_identifier\n    FROM pg_catalog.pg_settings \n    order by name \n    */\n  ",{},{returnType:"rows"})}(e),d=u.map((e=>({label:`${e.name}   (${e.setting})`,detail:"(setting)",type:"setting",insertText:e.name,documentation:`**${e.description}**  \n${["setting","unit","min_val","max_val","reset_val"].map((t=>`- ${t}     \`${e[t]}\``)).join("  \n")} `})));return{suggestions:t,settingSuggestions:d}}async function Bn(e){let{db:t,name:n,minArgs:i=0,limit:r=10,distinct:s=!1,searchTerm:o}=e;if(o);else if(void 0===n)n="";else if(""===n)return[];let a=" LIMIT ${limit}",l="\n        SELECT *\n          , upper(name) || '(' || concat_ws(',', arg_list_str) || ')' || ' => ' || restype || E'\n' || description as func_signature\n          , CASE WHEN is_aggregate THEN 'Could not get aggregate function definition' ELSE pg_get_functiondef(oid) END as definition\n          , CASE WHEN schema IS NULL OR current_schema() = schema OR schema = 'pg_catalog' THEN format('%I', name) ELSE format('%I.%I', schema, name) END as escaped_identifier\n        FROM (\n          SELECT p.proname AS name\n                , pg_get_function_identity_arguments(p.oid) AS arg_list_str\n                , pg_catalog.pg_get_function_result(p.oid) as restype\n                , d.description\n                , n.nspname as schema\n                , pronargs as args_length\n                , prokind = 'a' as is_aggregate\n                , p.oid\n          FROM   pg_proc p\n          LEFT JOIN pg_description d ON d.objoid = p.oid\n          LEFT JOIN pg_catalog.pg_namespace n ON n.oid = p.pronamespace\n          WHERE TRUE\n           AND pronargs >= ${minArgs} \n           AND p.proname ilike ${name} \n        ) tt\n      ",c=`\n    SELECT DISTINCT ON (length(name::text), name) name, arg_list_str, description, args_length, is_aggregate, restype, schema, func_signature, definition, escaped_identifier\n    FROM (\n      SELECT * \n      FROM (\n        ${l}  \n      ) t\n      WHERE TRUE\n      ORDER BY arg_list_str ILIKE '%cstring%' OR arg_list_str = 'cstring'\n    ) t     \n    ORDER BY length(name::text), name, arg_list_str, description \n    ${a}\n  `;return await t.sql(s?c:"\n        SELECT *\n          , upper(name) || '(' || concat_ws(',', arg_list_str) || ')' || ' => ' || restype || E'\n' || description as func_signature\n          , CASE WHEN is_aggregate THEN 'Could not get aggregate function definition' ELSE pg_get_functiondef(oid) END as definition\n          , CASE WHEN schema IS NULL OR current_schema() = schema OR schema = 'pg_catalog' THEN format('%I', name) ELSE format('%I.%I', schema, name) END as escaped_identifier\n        FROM (\n          SELECT p.proname AS name\n                , pg_get_function_identity_arguments(p.oid) AS arg_list_str\n                , pg_catalog.pg_get_function_result(p.oid) as restype\n                , d.description\n                , n.nspname as schema\n                , pronargs as args_length\n                , prokind = 'a' as is_aggregate\n                , p.oid\n          FROM   pg_proc p\n          LEFT JOIN pg_description d ON d.objoid = p.oid\n          LEFT JOIN pg_catalog.pg_namespace n ON n.oid = p.pronamespace\n          WHERE TRUE\n           AND pronargs >= ${minArgs} \n           AND p.proname ilike ${name} \n        ) tt\n      \n LIMIT ${limit}",{name:n||"%",limit:r,minArgs:i}).then((e=>e.rows.map((e=>{const t=(e.arg_list_str?e.arg_list_str.split(","):[]).map(((e,t)=>({label:`arg${t}: `+e.trim(),data_type:e.trim()})));return e.arg_list_str=t.map((e=>e.label)).join(", "),{...e,args:t}}))))}Nn=Rn({thousands:",",grouping:[3],currency:["$",""]}),Mn=Nn.format,Pn=Nn.formatPrefix;let zn=["A","ABORT","ABS","ABSENT","ABSOLUTE","ACCESS","ACCORDING","ACTION","ADA","ADD","ADMIN","AFTER","AGGREGATE","ALL","ALLOCATE","ALSO","ALTER","ALWAYS","ANALYSE","ANALYZE","AND","ANY","ARE","ARRAY","ARRAY_AGG","ARRAY_MAX_CARDINALITY","AS","ASC","ASENSITIVE","ASSERTION","ASSIGNMENT","ASYMMETRIC","AT","ATOMIC","ATTRIBUTE","ATTRIBUTES","AUTHORIZATION","AVG","BACKWARD","BASE64","BEFORE","BEGIN","BEGIN_FRAME","BEGIN_PARTITION","BERNOULLI","BETWEEN","BIGINT","BINARY","BIT","BIT_LENGTH","BLOB","BLOCKED","BOM","BOOLEAN","BOTH","BREADTH","BY","C","CACHE","CALL","CALLED","CARDINALITY","CASCADE","CASCADED","CASE","CAST","CATALOG","CATALOG_NAME","CEIL","CEILING","CHAIN","CHAR","CHARACTER","CHARACTERISTICS","CHARACTERS","CHARACTER_LENGTH","CHARACTER_SET_CATALOG","CHARACTER_SET_NAME","CHARACTER_SET_SCHEMA","CHAR_LENGTH","CHECK","CHECKPOINT","CLASS","CLASS_ORIGIN","CLOB","CLOSE","CLUSTER","COALESCE","COBOL","COLLATE","COLLATION","COLLATION_CATALOG","COLLATION_NAME","COLLATION_SCHEMA","COLLECT","COLUMN","COLUMNS","COLUMN_NAME","COMMAND_FUNCTION","COMMAND_FUNCTION_CODE","COMMENT","COMMENTS","COMMIT","COMMITTED","CONCURRENTLY","CONDITION","CONDITION_NUMBER","CONFIGURATION","CONFLICT","CONNECT","CONNECTION","CONNECTION_NAME","CONSTRAINT","CONSTRAINTS","CONSTRAINT_CATALOG","CONSTRAINT_NAME","CONSTRAINT_SCHEMA","CONSTRUCTOR","CONTAINS","CONTENT","CONTINUE","CONTROL","CONVERSION","CONVERT","COPY","CORR","CORRESPONDING","COST","COUNT","COVAR_POP","COVAR_SAMP","CREATE","CROSS","CSV","CUBE","CUME_DIST","CURRENT","CURRENT_CATALOG","CURRENT_DATE","CURRENT_DEFAULT_TRANSFORM_GROUP","CURRENT_PATH","CURRENT_ROLE","CURRENT_ROW","CURRENT_SCHEMA","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_TRANSFORM_GROUP_FOR_TYPE","CURRENT_USER","CURSOR","CURSOR_NAME","CYCLE","DATA","DATABASE","DATALINK","DATE","DATETIME_INTERVAL_CODE","DATETIME_INTERVAL_PRECISION","DAY","DB","DEALLOCATE","DEC","DECIMAL","DECLARE","DEFAULT","DEFAULTS","DEFERRABLE","DEFERRED","DEFINED","DEFINER","DEGREE","DELETE","DELIMITER","DELIMITERS","DENSE_RANK","DEPTH","DEREF","DERIVED","DESC","DESCRIBE","DESCRIPTOR","DETERMINISTIC","DIAGNOSTICS","DICTIONARY","DISABLE","DISCARD","DISCONNECT","DISPATCH","DISTINCT","DLNEWCOPY","DLPREVIOUSCOPY","DLURLCOMPLETE","DLURLCOMPLETEONLY","DLURLCOMPLETEWRITE","DLURLPATH","DLURLPATHONLY","DLURLPATHWRITE","DLURLSCHEME","DLURLSERVER","DLVALUE","DO","DOCUMENT","DOMAIN","DOUBLE","DROP","DYNAMIC","DYNAMIC_FUNCTION","DYNAMIC_FUNCTION_CODE","EACH","ELEMENT","ELSE","EMPTY","ENABLE","ENCODING","ENCRYPTED","END","END-EXEC","END_FRAME","END_PARTITION","ENFORCED","ENUM","EQUALS","ESCAPE","EVENT","EVERY","EXCEPT","EXCEPTION","EXCLUDE","EXCLUDING","EXCLUSIVE","EXEC","EXECUTE","EXISTS","EXP","EXPLAIN","EXPRESSION","EXTENSION","EXTERNAL","EXTRACT","FALSE","FAMILY","FETCH","FILE","FILTER","FINAL","FIRST","FIRST_VALUE","FLAG","FLOAT","FLOOR","FOLLOWING","FOR","FORCE","FOREIGN","FORTRAN","FORWARD","FOUND","FRAME_ROW","FREE","FREEZE","FROM","FS","FULL","FUNCTION","FUNCTIONS","FUSION","G","GENERAL","GENERATED","GET","GLOBAL","GO","GOTO","GRANT","GRANTED","GREATEST","GROUP","GROUPING","GROUPS","HANDLER","HAVING","HEADER","HEX","HIERARCHY","HOLD","HOUR","ID","IDENTITY","IF","IGNORE","ILIKE","IMMEDIATE","IMMEDIATELY","IMMUTABLE","IMPLEMENTATION","IMPLICIT","IMPORT","IN","INCLUDING","INCREMENT","INDENT","INDEX","INDEXES","INDICATOR","INHERIT","INHERITS","INITIALLY","INLINE","INNER","INOUT","INPUT","INSENSITIVE","INSERT","INSTANCE","INSTANTIABLE","INSTEAD","INT","INTEGER","INTEGRITY","INTERSECT","INTERSECTION","INTERVAL","INTO","INVOKER","IS","ISNULL","ISOLATION","JOIN","K","KEY","KEY_MEMBER","KEY_TYPE","LABEL","LAG","LANGUAGE","LARGE","LAST","LAST_VALUE","LATERAL","LEAD","LEADING","LEAKPROOF","LEAST","LEFT","LENGTH","LEVEL","LIBRARY","LIKE","LIKE_REGEX","LIMIT","LINK","LISTEN","LN","LOAD","LOCAL","LOCALTIME","LOCALTIMESTAMP","LOCATION","LOCATOR","LOCK","LOCKED","LOGGED","LOWER","M","MAP","MAPPING","MATCH","MATCHED","MATERIALIZED","MAX","MAXVALUE","MAX_CARDINALITY","MEMBER","MERGE","MESSAGE_LENGTH","MESSAGE_OCTET_LENGTH","MESSAGE_TEXT","METHOD","MIN","MINUTE","MINVALUE","MOD","MODE","MODIFIES","MODULE","MONTH","MORE","MOVE","MULTISET","MUMPS","NAME","NAMES","NAMESPACE","NATIONAL","NATURAL","NCHAR","NCLOB","NESTING","NEW","NEXT","NFC","NFD","NFKC","NFKD","NIL","NO","NONE","NORMALIZE","NORMALIZED","NOT","NOTHING","NOTIFY","NOTNULL","NOWAIT","NTH_VALUE","NTILE","NULL","NULLABLE","NULLIF","NULLS","NUMBER","NUMERIC","OBJECT","OCCURRENCES_REGEX","OCTETS","OCTET_LENGTH","OF","OFF","OFFSET","OIDS","OLD","ON","ONLY","OPEN","OPERATOR","OPTION","OPTIONS","OR","ORDER","ORDERING","ORDINALITY","OTHERS","OUT","OUTER","OUTPUT","OVER","OVERLAPS","OVERLAY","OVERRIDING","OWNED","OWNER","P","PAD","PARAMETER","PARAMETER_MODE","PARAMETER_NAME","PARAMETER_ORDINAL_POSITION","PARAMETER_SPECIFIC_CATALOG","PARAMETER_SPECIFIC_NAME","PARAMETER_SPECIFIC_SCHEMA","PARSER","PARTIAL","PARTITION","PASCAL","PASSING","PASSTHROUGH","PASSWORD","PATH","PERCENT","PERCENTILE_CONT","PERCENTILE_DISC","PERCENT_RANK","PERIOD","PERMISSION","PLACING","PLANS","PLI","POLICY","PORTION","POSITION","POSITION_REGEX","POWER","PRECEDES","PRECEDING","PRECISION","PREPARE","PREPARED","PRESERVE","PRIMARY","PRIOR","PRIVILEGES","PROCEDURAL","PROCEDURE","PROGRAM","PUBLIC","QUOTE","RANGE","RANK","READ","READS","REAL","REASSIGN","RECHECK","RECOVERY","RECURSIVE","REF","REFERENCES","REFERENCING","REFRESH","REGR_AVGX","REGR_AVGY","REGR_COUNT","REGR_INTERCEPT","REGR_R2","REGR_SLOPE","REGR_SXX","REGR_SXY","REGR_SYY","REINDEX","RELATIVE","RELEASE","RENAME","REPEATABLE","REPLACE","REPLICA","REQUIRING","RESET","RESPECT","RESTART","RESTORE","RESTRICT","RESULT","RETURN","RETURNED_CARDINALITY","RETURNED_LENGTH","RETURNED_OCTET_LENGTH","RETURNED_SQLSTATE","RETURNING","RETURNS","REVOKE","RIGHT","ROLE","ROLLBACK","ROLLUP","ROUTINE","ROUTINE_CATALOG","ROUTINE_NAME","ROUTINE_SCHEMA","ROW","ROWS","ROW_COUNT","ROW_NUMBER","RULE","SAVEPOINT","SCALE","SCHEMA","SCHEMA_NAME","SCOPE","SCOPE_CATALOG","SCOPE_NAME","SCOPE_SCHEMA","SCROLL","SEARCH","SECOND","SECTION","SECURITY","SELECT","SELECTIVE","SELF","SENSITIVE","SEQUENCE","SEQUENCES","SERIALIZABLE","SERVER","SERVER_NAME","SESSION","SESSION_USER","SET","SETOF","SETS","SHARE","SHOW","SIMILAR","SIMPLE","SIZE","SKIP","SMALLINT","SNAPSHOT","SOME","SOURCE","SPACE","SPECIFIC","SPECIFICTYPE","SPECIFIC_NAME","SQL","SQLCODE","SQLERROR","SQLEXCEPTION","SQLSTATE","SQLWARNING","SQRT","STABLE","STANDALONE","START","STATE","STATEMENT","STATIC","STATISTICS","STDDEV_POP","STDDEV_SAMP","STDIN","STDOUT","STORAGE","STRICT","STRIP","STRUCTURE","STYLE","SUBCLASS_ORIGIN","SUBMULTISET","SUBSTRING","SUBSTRING_REGEX","SUCCEEDS","SUM","SYMMETRIC","SYSID","SYSTEM","SYSTEM_TIME","SYSTEM_USER","T","TABLE","TABLES","TABLESAMPLE","TABLESPACE","TABLE_NAME","TEMP","TEMPLATE","TEMPORARY","TEXT","THEN","TIES","TIME","TIMESTAMP","TIMEZONE_HOUR","TIMEZONE_MINUTE","TO","TOKEN","TOP_LEVEL_COUNT","TRAILING","TRANSACTION","TRANSACTIONS_COMMITTED","TRANSACTIONS_ROLLED_BACK","TRANSACTION_ACTIVE","TRANSFORM","TRANSFORMS","TRANSLATE","TRANSLATE_REGEX","TRANSLATION","TREAT","TRIGGER","TRIGGER_CATALOG","TRIGGER_NAME","TRIGGER_SCHEMA","TRIM","TRIM_ARRAY","TRUE","TRUNCATE","TRUSTED","TYPE","TYPES","UESCAPE","UNBOUNDED","UNCOMMITTED","UNDER","UNENCRYPTED","UNION","UNIQUE","UNKNOWN","UNLINK","UNLISTEN","UNLOGGED","UNNAMED","UNNEST","UNTIL","UNTYPED","UPDATE","UPPER","URI","USAGE","USER","USER_DEFINED_TYPE_CATALOG","USER_DEFINED_TYPE_CODE","USER_DEFINED_TYPE_NAME","USER_DEFINED_TYPE_SCHEMA","USING","VACUUM","VALID","VALIDATE","VALIDATOR","VALUE","VALUES","VALUE_OF","VARBINARY","VARCHAR","VARIADIC","VARYING","VAR_POP","VAR_SAMP","VERBOSE","VERSION","VERSIONING","VIEW","VIEWS","VOLATILE","WHEN","WHENEVER","WHERE","WHITESPACE","WIDTH_BUCKET","WINDOW","WITH","WITHIN","WITHOUT","WORK","WRAPPER","WRITE","XML","XMLAGG","XMLATTRIBUTES","XMLBINARY","XMLCAST","XMLCOMMENT","XMLCONCAT","XMLDECLARATION","XMLDOCUMENT","XMLELEMENT","XMLEXISTS","XMLFOREST","XMLITERATE","XMLNAMESPACES","XMLPARSE","XMLPI","XMLQUERY","XMLROOT","XMLSCHEMA","XMLSERIALIZE","XMLTABLE","XMLTEXT","XMLVALIDATE","YEAR","YES","ZONE","IF NOT EXISTS"];const jn=Array.from(new Set([...[{key:"SELECT",type:"column"},{key:"RETURNING",type:"column"},{key:"FROM",type:"table"},{key:"INTO",type:"table"},{key:"JOIN",type:"table"},{key:"ON",type:"column"},{key:"WHERE",type:"column"},{key:"ORDER BY",type:"column"},{key:"UPDATE",type:"table"},{key:"DELETE",type:"table"},{key:"TABLE",type:"table"}].map((e=>e.key)),...Un()]));zn=zn.sort(((e,t)=>+jn.includes(t)-+jn.includes(e)));const Vn=Un();function Un(){return["SELECT","FROM","INNER","JOIN","LEFT","CREATE","ALTER","TABLE","OFFSET","LIMIT","ORDER","ON","COLUMN","DROP","DELETE","UPDATE","INSERT","VALUES","WHERE","AND","OR","INTO","INDEX","USING","COMMENT","BEGIN","DO","WITH","SET","COPY","EXPLAIN","VACUUM","NOTIFY","LISTEN","RAISE","NOTICE","SHOW","GRANT","REVOKE","FOR"].map((e=>{let t,n=!1;return"SELECT"===e?(n=!0,t="Retrieves data from tables, functions or other objects   \n```sql\nSELECT * FROM users;\n\nSELECT version();\n\nSELECT  f1, f2, MAX(f12)\nFROM table_name \nWHERE f1 = 2 \nGROUP BY col2\nHAVING MAX(f12) < 10\nORDER BY f1 DESC\nLIMIT 1\nOFFSET 2\n```\n"):"SHOW"===e?(n=!0,t="Show the value of a run-time parameter. These variables can be set using the SET statement\n```sql\nSHOW datestyle\n\nSHOW ALL\n```\n"):"LISTEN"===e?(n=!0,t="Listen to NOTIFY notifications on a channel\n```sql\nLISTEN my_channel;\n\n/* To push a message */\nNOTIFY my_channel, 'hello';\n```\n"):"NOTIFY"===e?(n=!0,t="Send a notification to a channel\n```sql\nNOTIFY my_channel, 'hello';\n\n\n/* To listen to this channel */\nLISTEN my_channel;\n```\n"):"DELETE"===e?(n=!0,t="Delete data from a table    \n```sql\nDELETE FROM table_name;\n\nDELETE FROM users\nWHERE last_active < now() - interval'1 month'\nRETURNING *\n```\n"):"FOR"===e?(n=!0,t="Insert data into a table  \n```sql\n\nFOR temprow IN\n  SELECT * FROM mytable LIMIT 10\nLOOP\n  INSERT INTO ...\nEND LOOP;\n\n```\n"):"INSERT"===e?(n=!0,t="Insert data into a table  \n```sql\nINSERT INTO some_table \nDEFAULT VALUES;\n\nINSERT INTO users(age, name, added)\nVALUES(112, 'a', now())\nRETURNING *;\n\n```\n"):"UPDATE"===e?(n=!0,t="Updates data in a table\n```sql\nUPDATE users SET status = 'active';\n\nUPDATE books \nSET title = books || 'active'\nWHERE title NOT ILIKE 'title%';\n\n```\n"):"CREATE"===e?(n=!0,t="Create an object\n```sql\nCREATE TABLE users(\n  age INTEGER,  \n  name TEXT,  \n  type TEXT,  \n  added TIMESTAMP  \n);\n\nCREATE OR REPLACE VIEW admin_users AS \n  SELECT * FROM users WHERE type = 'admin';\n\nCREATE OR REPLACE FUNCTION log_message(VARIADIC args TEXT[]) RETURNS VOID AS $$     \nBEGIN\n\n  IF to_regclass('logs') IS NULL THEN\n    CREATE TABLE IF NOT EXISTS logs(m TEXT);\n  END IF;\n\n  INSERT INTO logs(m) \n  VALUES(concat_ws(' ', args));\n\nEND;\n$$ LANGUAGE plpgsql;\n\n```\n"):"DROP"===e?(n=!0,t="Drop an object  \n```sql\nDROP TABLE users;\n\nDROP TABLE IF EXISTS books;\n\nDROP VIEW admin_users;\n```\n"):"ORDER"===e?(n=!0,t="Sepcify how rows will be ordered\n```sql\n...\nORDER BY col_name, col_name DESC\n\nORDER BY col_name DESC NULLS FIRST\nORDER BY col_name ASC NULLS LAST\n\n```\n"):"RAISE"===e?(n=!0,t="Report messages and raise errors. Can only be used in PL/pgSQL\n```sql\nRAISE EXCEPTION 'something not right';\n\nRAISE NOTICE 'Calling cs_create_job(%)', v_job_id;\n```\n"):"COMMENT"===e?(n=!0,t="Adds a comment to an object\n```sql\nCOMMENT ON FUNCTION log_message \nIS 'Concat and insert arguments into logs table';\n```\n"):"BEGIN"===e?(n=!0,t="Initiates a transaction block where all statements will be executed in a single transaction until an explicit COMMIT or ROLLBACK is given\n```sql\nBEGIN;\nUPDATE orders SET price = 2;\nCOMMIT;\n\nBEGIN ISOLATION LEVEL SERIALIZABLE;\nUPDATE orders SET price = 2;\nCOMMIT;\n```\n"):"FROM"===e?(n=!0,t="Precedes a table or expression \n```sql\nSELECT ... FROM table_name;\n\nDELETE FROM table_name;\n\nSELECT * FROM (SELECT max(a), ... FROM ...)\n```\n"):"DO"===e?(n=!0,t="Execute an anonymous code block\n```sql\nDO $$ \n  DECLARE r regclass;\nBEGIN\n\n  r := to_regclass('my_table');\n  IF r IS NOT NULL THEN\n    UPDATE my_table SET last_check = NOW();\n  END IF;\n\nEND $$;\n```\n"):"FOR"===e?t="Iterate through data. Can only be executed within a function or code block\n```sql\nDO $$ \n  DECLARE usr RECORD;\nBEGIN\n\n  FOR usr IN SELECT * FROM users\n  LOOP\n  \n      DELETE FROM sessions \n      WHERE user_id = usr.id;\n  END LOOP;\n\nEND $$;\n```\n":"SET"===e?(n=!0,t="Change a run-time parameter. Run ` SHOW ALL ` to see all parameters\n```sql\nSET TIME ZONE 'Europe/London';\n\nSET search_path TO my_schema, public;\n\n```\n"):"ALTER"===e?(n=!0,t='Change an object\n```sql\nALTER TABLE users \nADD COLUMN deleted BOOLEAN;\n\nALTER DATABASE database_name \nSET datestyle TO "ISO, DMY";\n\n```\n'):"WITH"===e?(n=!0,t="Specifies a temporary named result set\n```sql\nWITH cte1 AS (SELECT * FROM orders)\n, cte2 AS (SELECT * FROM customers)\n\nSELECT *\nFROM\n  cte1 c1\n  INNER JOIN cte2 c2\n  ON ........\n\n```\n"):"SHOW"===e?(n=!0,t="Show the value of a run-time parameter\n```sql\nSHOW ALL;\n\n\n```\n"):"COPY"===e?(n=!0,t="Export or import data\n```sql\n-- Export to csv\nCOPY my_table TO '/tmp/my_table.csv' WITH (FORMAT CSV, HEADER);\n\n-- Import from csv (Must create table beforehand)\nCOPY zip_codes FROM '/path/to/ZIP_CODES.txt' DELIMITER ',' CSV HEADER;\n```\n"):"JOIN"===e?t="Combine two or more result sets into one\n```sql\nSELECT *\nFROM weather w\nINNER JOIN cities c\nON w.city = c.name;\n```\n":"EXPLAIN"===e?(n=!0,t="Get query plan of a query\n```sql\nEXPLAIN SELECT * FROM weather;\n\nEXPLAIN ANALYZE SELECT * FROM weather;\n```\n"):"VACUUM"===e?(n=!0,t="Garbage-collect and optionally analyze a database\n```sql\nVACUUM (VERBOSE, ANALYZE) my_database;\n```\n"):"GRANT"===e?(n=!0,t="The GRANT command has two basic variants: \n  1. one that grants privileges on a database object (table, column, view, sequence, database, foreign-data wrapper, foreign server, function, procedural language, schema, or tablespace),\n  2. one that grants membership in a role\n\n```sql\nGRANT INSERT, UPDATE ON films TO PUBLIC;\n```\n"):"REVOKE"===e&&(n=!0,t="The REVOKE command revokes previously granted privileges from one or more roles. The key word PUBLIC refers to the implicitly defined group of all roles.\n\n```sql\nREVOKE INSERT, UPDATE ON films TO PUBLIC;\n\n/* Revoke membership in role admins from user joe */\nREVOKE admins FROM joe;\n\n```\n"),{label:e,info:t,start_kwd:n}}))}class Checkbox extends t.Component{render(){let e={...this.props};const{id:n,className:i="",inputClassname:r="",label:s,checked:o,style:a={},onChange:l,readOnly:c,title:u,variant:d}=e,h=o?" text-blue-500 ":" text-gray-500 ",p=t.createElement("label",{className:r+" flex-row-wrap relative b b-gray-300 checkbox pointer ai-center jc-center w-fit w-fit h-fit "+("minimal"===d?" focusable-inset ":" focusable "),tabIndex:0,style:"minimal"===d?{background:"transparent",border:"unset",outline:"none !important"}:{padding:"3px",borderRadius:"3px",position:"relative"},onKeyDown:e=>{var t;"Enter"!==e.key&&" "!==e.key||null===(t=this.inptRef)||void 0===t||t.click()}},t.createElement("input",{id:n,ref:e=>{e&&(this.inptRef=e)},className:"hidden",type:"checkbox",checked:o,onChange:l?e=>{l(e,e.target.checked)}:void 0,readOnly:c}),t.createElement(tt(),{path:"M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z",size:"minimal"===d?1:.75,className:"minimal"===d?h:"text-blue-500",style:"minimal"===d?{}:{opacity:o?1:0}}));return t.createElement("label",{style:{...a,..."minimal"===d?{background:"transparent",outline:"none !important"}:{}},htmlFor:n,className:"flex-row-wrap ai-center pointer w-fit h-fit "+i,title:u},p,s?t.createElement("div",{className:"ml-1 noselect "+h+("minimal"===d?"ml-p25":"ml-p5")},s):null)}}const Hn=e=>["boolean","number"].includes(typeof e)?e.toString():e;class SearchList extends t.Component{constructor(){super(...arguments),this.state={searchTerm:"",searchItems:void 0,searchClosed:!0,searchingItems:!1,matchCase:!1},this.onClick=e=>{var t,n;const{variant:i,onSearchItems:r}=this.props,{searchClosed:s,dataSignature:o,term:a}=this.state;(null==i?void 0:i.startsWith("search"))&&this.refList&&e.target&&(s||this.refList.contains(e.target)||(null===(t=this.refInput)||void 0===t?void 0:t.contains(e.target))?s&&this.refInput&&this.refInput.contains(e.target)&&(a&&r&&o!==this.props.dataSignature?this.onSearchItems(a):this.setState({searchClosed:!1})):(this.setState({searchClosed:!0}),null===(n=this.cancelCurrentSearch)||void 0===n||n.call(this)))},this.focusInput=()=>{this.refInput&&this.refInput.focus()},this.onSetTerm=(e,t)=>{const{onSearch:n,onType:i}=this.props;this.focusedRowIndex=void 0,null==i||i(e,(t=>{e=t})),this.setState({searchTerm:e}),null==n||n(e,t),this.onSearchItems(e)},this.onSearchItems=async e=>{const{onSearchItems:t,searchEmpty:n,dataSignature:i}=this.props;if(t){if(this.searching){if(this.searching.term===e)return;clearTimeout(this.searching.timeout)}"string"!=typeof e||!n&&!e?this.setState({searchItems:[],searchingItems:!1}):(this.state.searchingItems||this.setState({searchingItems:!0}),this.searching={dataSignature:i,term:e,timeout:setTimeout((async()=>{var t,n,r,s;this.setState({searchingItems:!0});const o=null!==(n=null===(t=this.props.matchCase)||void 0===t?void 0:t.value)&&void 0!==n?n:this.state.matchCase;try{null===(s=(r=this.props).onSearchItems)||void 0===s||s.call(r,e,{matchCase:o},((t,n,r)=>{var s;this.cancelCurrentSearch=()=>{this.setState({searchingItems:!1,error:void 0}),r(),this.searching=void 0},e===(null===(s=this.searching)||void 0===s?void 0:s.term)?(this.setState({searchItems:t,searchClosed:!1,error:void 0,dataSignature:i,term:e}),n&&this.cancelCurrentSearch()):!this.searching&&this.state.searchingItems&&this.cancelCurrentSearch()}))}catch(e){this.setState({searchingItems:!1,error:e,searchClosed:!0})}}),400)})}}}componentDidMount(){const{autoFocus:e=!0,defaultSearch:t,defaultValue:n}=this.props;e&&setTimeout(this.focusInput,5);const i=Hn(n);"string"==typeof i&&i?this.setState({searchTerm:i}):"string"==typeof t&&t&&this.onSetTerm(t,{}),window.addEventListener("click",this.onClick)}componentWillUnmount(){window.removeEventListener("click",this.onClick)}componentDidUpdate(e,t){this.state.matchCase!==t.matchCase&&this.state.searchTerm&&this.onSetTerm(this.state.searchTerm)}render(){var e,n,i,r;const{className:s="",id:o,style:a={},items:l=[],placeholder:c="",onReorder:u,onSearch:d,onType:h,noSearch:p,onMultiToggle:f,onChange:m,inputEl:g,dontHighlight:y,variant:v,selectedKey:b,onSearchItems:w,rootStyle:x={},label:_,limit:E=30,onPressEnter:S,matchCase:C,searchStyle:T={},searchEmpty:A=!1}=this.props,{searchTerm:k,searchItems:N=[],searchingItems:M=!1,searchClosed:P,selectPopup:L,error:O}=this.state,R=!!f,I=null!==(e=null==C?void 0:C.value)&&void 0!==e?e:this.state.matchCase;let D=k;const F=e=>({...e,...SearchList.getMatch({matchCase:I,term:D,text:Hn(void 0!==e.label?e.label:e.key),key:e.key,subLabel:e.subLabel})}),B=w?N:y?l:d?l.map(F):l.map(F).filter(((e,t)=>e.rank!==1/0)).sort(((e,t)=>D?e.rank-t.rank||(e.label||"").length-(t.label||"").length:0)).slice(0,E),z=l.filter((e=>e.checked)),j=!(p||g),V=null==v?void 0:v.startsWith("search"),U=null==v?void 0:v.includes("no-shadow"),H="select"===v,$=!B.length&&!D||V&&P;let q=O?t.createElement(ErrorComponent,{error:O}):$?null:t.createElement("div",{className:"relative w-full f-1  min-h-0 min-w-0 no-scroll-bar "+(V?" o-visible ":" o-auto ")},V&&!!B.length&&t.createElement("div",{style:{position:"fixed",inset:0,zIndex:1,background:"#ebebeb38",backdropFilter:"blur(1px)"}}),t.createElement("ul",{className:"f-1 o-auto min-h-0 min-w-0 ul-search-list "+(V?" no-scroll-bar shadow ":""),role:"list",ref:e=>{e&&(this.refList=e)},style:{padding:0,...V?{position:"absolute",background:"white",zIndex:1,left:0,right:0,maxHeight:"400px"}:{}}},d&&!this.props.items?null:B.length?B.map(((e,n)=>{var i;const r=!e.onPress||e.disabledInfo?void 0:t=>{var n;e.onPress(t,this.state.searchTerm),V&&!P&&(null===(n=this.cancelCurrentSearch)||void 0===n||n.call(this),this.setState({searchClosed:!0}))};return t.createElement("li",{key:n,role:"listitem",title:null!==(i=e.disabledInfo)&&void 0!==i?i:e.title,style:{...e.rowStyle,...e.disabledInfo?{cursor:"not-allowed",opacity:.4,touchAction:"none"}:{}},tabIndex:0,draggable:Boolean(u),onDrag:u?e=>{const t=e.currentTarget,n=t.parentElement;if(t.style.display="none",!n)throw"Not possible";Array.from(n.children).map(((t,i)=>{const r=t.getBoundingClientRect();let s=e.clientY>r.y&&e.clientY<r.y+r.height;const o=s?"35px":"";o!==t.style.paddingTop&&(t.style.paddingTop=o),s&&(n._targetIdx=i)}));const i=n.getBoundingClientRect();e.clientY>i.y+i.height?n.scrollTop+=10:e.clientY<i.y&&(n.scrollTop-=10)}:void 0,onDragEnd:u?async e=>{const t=e.currentTarget,i=t.parentElement;let r=i._targetIdx,s=l.slice(0);var o,a,c;o=n,a=r,c=s.splice(o,1)[0],s.splice(a,0,c),await u(s),setTimeout((()=>{Array.from(i.children).map((e=>{e.style.paddingTop=""})),t.style.display="flex"}),1)}:void 0,className:"flex-row ai-start p-p5 pl-1 pointer min-w-0 "+(e.selected?" bg-gray-100 ":""),onClick:e=>null==r?void 0:r(e,this.state.searchTerm),onKeyUp:r?e=>{"Enter"===e.key&&r(e,this.state.searchTerm)}:void 0},e.content||t.createElement("div",{className:"flex-row ai-center f-1 "},e.contentLeft||null,t.createElement("div",{className:"flex-col ai-start f-1"},t.createElement("label",{className:"ws-pre mr-p5 f-1 flex-row pointer noselect min-w-0 w-full",style:e.style},e.node),e.contentBottom),e.contentRight||null,"boolean"==typeof e.checked?t.createElement(Checkbox,{id:o,className:"f-0 no-pointer-events",checked:e.checked,style:{marginRight:"12px"},onChange:()=>{}}):null))})):t.createElement("div",{className:"p-p5 text-gray-600 no-data"},null!==(r=null===(i=(n=this.props).onNoResultsContent)||void 0===i?void 0:i.call(n,D))&&void 0!==r?r:t.createElement("div",null,"No results"))));let W=t.createElement("div",{className:"search list-comp ta-left flex-col bg-white min-h-0 rounded "+s,ref:e=>{e&&(this.refRoot=e)},style:{...a,...V?{}:x},onKeyDown:e=>{var t,n,i,r;if(!this.refList)return;const s=this.refList.lastChild,o=this.refList.firstChild,a=document.activeElement,l=a.previousElementSibling,c=a.nextElementSibling,u=!this.refList.contains(a);if("a"===e.key&&e.ctrlKey&&!(null===(t=this.refInput)||void 0===t?void 0:t.contains(a)))return this.refInput&&(this.refInput.focus(),this.refInput.select()),void e.preventDefault();if("Enter"===e.key&&(null===(n=this.refInput)||void 0===n?void 0:n.contains(a))&&o&&(e.preventDefault(),S&&void 0===this.focusedRowIndex?S(D):o.click()),u||1!==e.key.length||e.shiftKey||e.ctrlKey||e.altKey)switch(e.key){case"ArrowUp":a===o||u?s&&s.focus():this.refList.childElementCount&&l&&l.focus(),e.preventDefault(),this.focusedRowIndex=(null===(i=null==a?void 0:a.parentElement)||void 0===i?void 0:i.children)?Array.from(a.parentElement.children).indexOf(a):-1;break;case"ArrowDown":a===s||u?o&&o.focus():this.refList.childElementCount&&c&&c.focus(),e.preventDefault(),this.focusedRowIndex=(null===(r=null==a?void 0:a.parentElement)||void 0===r?void 0:r.children)?Array.from(a.parentElement.children).indexOf(a):-1}else this.focusInput()}},_?t.createElement("div",{className:" noselect text-gray-500 "+(V?" pb-p25 ":" p-p75 pb-0 "),style:{}},_):null,t.createElement("div",{className:"f-0 min-h-0 min-w-0 flex-row jc-start relative "+(V||H?" ":"  ai-center  ")+(j||R?"":" hidden"),style:T},j?t.createElement("div",{className:"flex-row h-fit f-1 relative o-hidden relative rounded focus-border b b-gray-300 "+(V&&!U?" shadow ":" "),style:{...V?{zIndex:q?2:"unset"}:H?{margin:"8px",marginBottom:"2px"}:{margin:"8px"}},onClick:()=>{!q&&A&&this.onSetTerm(D||"",{})}},t.createElement($n,{ref:e=>{e&&(this.refInput=e)},type:"text",style:{...V&&!$?{borderBottomLeftRadius:0,borderBottomRightRadius:0,zIndex:3}:{},...this.props.inputStyle},placeholder:c,autoComplete:"off",className:"search-list-comp-input f-1 w-full ",title:D,value:D,onChange:e=>{let t=e.currentTarget.value;this.onSetTerm(t,e)}}),t.createElement("div",{className:"rounded f-0 ai-center jc-center flex-row bg-white ",style:{borderRadius:"3px",overflow:"hidden",margin:"1px"}},V&&M?t.createElement(Loading,{className:"noselect mr-p25",sizePx:24}):t.createElement(Btn,{title:"Match case",iconPath:"M20.06,18C20,17.83 19.91,17.54 19.86,17.11C19.19,17.81 18.38,18.16 17.45,18.16C16.62,18.16 15.93,17.92 15.4,17.45C14.87,17 14.6,16.39 14.6,15.66C14.6,14.78 14.93,14.1 15.6,13.61C16.27,13.12 17.21,12.88 18.43,12.88H19.83V12.24C19.83,11.75 19.68,11.36 19.38,11.07C19.08,10.78 18.63,10.64 18.05,10.64C17.53,10.64 17.1,10.76 16.75,11C16.4,11.25 16.23,11.54 16.23,11.89H14.77C14.77,11.46 14.92,11.05 15.22,10.65C15.5,10.25 15.93,9.94 16.44,9.71C16.95,9.5 17.5,9.36 18.13,9.36C19.11,9.36 19.87,9.6 20.42,10.09C20.97,10.58 21.26,11.25 21.28,12.11V16C21.28,16.8 21.38,17.42 21.58,17.88V18H20.06M17.66,16.88C18.11,16.88 18.54,16.77 18.95,16.56C19.35,16.35 19.65,16.07 19.83,15.73V14.16H18.7C16.93,14.16 16.04,14.63 16.04,15.57C16.04,16 16.19,16.3 16.5,16.53C16.8,16.76 17.18,16.88 17.66,16.88M5.46,13.71H9.53L7.5,8.29L5.46,13.71M6.64,6H8.36L13.07,18H11.14L10.17,15.43H4.82L3.86,18H1.93L6.64,6Z",color:I?"action":void 0,size:"small",onClick:()=>{C?C.onChange(!I):this.setState({matchCase:!I})}}))):R?t.createElement("div",{className:"pl-1 py-p5 noselect text-gray-500"},z.length||0," selected"):null,R?t.createElement(Checkbox,{id:o,style:{paddingLeft:"1em",paddingRight:"20px",marginLeft:"auto"},className:B.length?"":"hidden",checked:Boolean(z.length),onChange:e=>{const t=e.currentTarget.checked;if(f){const n=l.map((e=>{const n=B.find((t=>t.key===e.key));return{...e,checked:n?e.disabledInfo?e.checked:t:e.checked}}));f(n,e)}}}):null),q);return"select"===v?L?t.createElement(Popup,{open:!0,onClose:()=>{this.setState({selectPopup:!1})}},W):t.createElement(Btn,{onClick:()=>{this.setState({selectPopup:!0})}},b):W}}SearchList.getMatch=e=>{const n=e=>{const{term:n,text:i,key:r,isSublabel:s=!1,matchCase:o=!1}=e,a=s?{fontSize:"14px",marginTop:".25em"}:{fontSize:"18px"},l=` text-gray-${s?600:900} `;let c=0,u=i||"",d=s?u.split("\n").slice(0,3).join("\n"):u,h=t.createElement("span",{className:l+" text-ellipsis",style:a},d);if(n){const e=o?u:u.toLowerCase(),r=o?n:n.toLowerCase();let l=e.indexOf(r);if(c=l+1,l>-1){let e,c;if(s){const t=u.split("\n"),i=t.findIndex((e=>o?e.includes(n):e.toLowerCase().includes(n.toLowerCase())));u=t[i],l=o?u.indexOf(n):u.toLowerCase().indexOf(n.toLowerCase()),i>2&&(e=t.slice(i-2,i-1)),c=t.slice(i+1,i+2)}else u=u.split("\n").join(" ");h=t.createElement("div",{className:"flex-col  f-1",style:a,title:i},void 0!==e&&e.length>0&&t.createElement("span",{className:"f-0 text-gray-400 text-ellipsis"},e.join("\n")),t.createElement("div",{className:"flex-row f-1"},t.createElement("span",{className:"f-1 ta-right text-gray-600 text-ellipsis",style:{maxWidth:"fit-content"}},u.slice(0,l)),t.createElement("strong",{className:"f-0"},u.slice(l,l+r.length)),t.createElement("span",{className:"f-1 text-gray-600 text-ellipsis"},u.slice(l+r.length))),void 0!==c&&c.length>0&&t.createElement("span",{className:"f-0 text-gray-400 text-ellipsis"},c.join("\n")))}else c=1/0}return u||(""===r&&(h=t.createElement("i",null,"[Empty]")),null===r&&(h=t.createElement("i",null,"[NULL]"))),{rank:c,node:h}},{term:i,text:r,key:s,subLabel:o,matchCase:a}=e;let l=n({term:i,text:r,key:s,matchCase:a}),c=l;if(o){let e=n({term:i,text:o,key:o,isSublabel:!0,matchCase:a});c.node=t.createElement("div",{className:"flex-col f-1"},l.node,e.node);let r=Math.min(l.rank,e.rank+5);l.rank!==1/0&&e.rank!==1/0&&(r/=2),c.rank=r}return c};const $n=t.forwardRef(((e,n)=>{const{className:i="",style:r={}}=e;return t.createElement("input",{ref:t=>{t&&(n&&n(t),setTimeout((()=>{e.autoFocus&&document.activeElement!==t&&(t.focus(),t.select())}),40))},...pT(e,[],["className","style"]),style:r,className:"custom-input rounded "+i})}));class ButtonGroup extends t.Component{render(){const{onChange:e,className:n="",value:i,id:r="",style:s={},options:o=[],variant:a}=this.props,l=".375rem",c=(e,t=!1)=>{let n={borderTopLeftRadius:0,borderBottomLeftRadius:0,borderTopRightRadius:0,borderBottomRightRadius:0,fontWeight:500};return"dense"===a&&(n={...n,padding:"6px",fontSize:"14px"}),e?e<o.length-1?{...n,marginRight:"-1px"}:{...n,borderTopRightRadius:l,borderBottomRightRadius:l}:{...n,borderTopLeftRadius:l,borderBottomLeftRadius:l,marginRight:"-1px"}};return t.createElement("div",{style:{...s},className:"button-group flex-row  rounded-md w-fit "+n},o.map(((n,r)=>t.createElement("button",{key:n,style:{...c(r,i===n)},onClick:t=>e(n,t),type:"button",className:" relative f-0 font-medium b-action "+(i===n?" bg-action text-white  ":" text-action bg-white ")},n))))}}class Select extends RTComp{constructor(){super(...arguments),this.state={popupAnchor:null,defaultSearch:void 0},this.onDelta=(e,t,n)=>{const{onSearch:i}=this.props}}render(){var e;const{onChange:n,className:i="",title:r="",value:s,id:o="select-"+Date.now(),style:a={},required:l,label:c,variant:u="div",onSearch:d,multiSelect:h,labelAsValue:p,emptyLabel:f="Select...",asRow:m,iconPath:g,buttonClassName:y="",size:v,limit:b}=this.props,w=(e,t)=>{JSON.stringify(s)!==JSON.stringify(e)&&(null==n||n(e,t))},x=t.createElement(tt(),{path:"M7,10L12,15L17,10H7Z",size:1,style:{position:"absolute",right:".25em",top:".25em",color:"#cacaca",pointerEvents:"none",touchAction:"none"}});let _=[];_="options"in this.props?this.props.options.map((e=>({key:e,label:e,...h?{checked:Boolean(s&&s.includes(e))}:{}}))):this.props.fullOptions.map((e=>{var t,n;return{...e,label:null!==(t=e.label)&&void 0!==t?t:null===(n=e.key)||void 0===n?void 0:n.toString(),...h&&!("checked"in e)?{checked:Boolean(s&&s.includes(e.key))}:{}}})),_=_.map((e=>({...e,label:e.label||(null===e.label?"NULL":"")})));const E=_.map((({key:e})=>e)),S=c?{}:a,C=(e,t)=>{if(h){const n=_.filter((e=>e.checked)).map((e=>e.key));n.includes(e)?w(n.filter((t=>t!==e)),t):w([...n,e],t)}else w(e,t)};let T=null;if("pill"===u)T=t.createElement("div",{className:"flex-row rounded bg-gray-200 o-hidden b b-gray-300",style:S},_.map(((e,n)=>t.createElement(Btn,{key:n,color:"inherit",style:{borderRadius:0,color:"var(--gray-600)",...s===e.key?{color:"white",background:"rgb(0, 183, 255)"}:{}},onClick:t=>{C(e.key,t)}},e.label||e.key))));else if("div"===u||d||h){const{popupAnchor:n,defaultSearch:a}=this.state,l=()=>{this.setState({popupAnchor:null}),this.btnRef&&this.btnRef.focus()};let u="Select...";if(Array.isArray(s)){if(s.length){const e=s[0];u=(null===e?"NULL":e)+(s.length>1?" + "+(s.length-1):"")}}else u=(null===(e=_.find((e=>e.key===s)))||void 0===e?void 0:e.label)||s;const m=!(null==E?void 0:E.length)||1===(null==E?void 0:E.length)&&s===(null==E?void 0:E[0]);T=t.createElement(t.Fragment,null,t.createElement(Btn,{title:m?"No other option":r,_ref:e=>{e&&(this.btnRef=e)},style:{borderRadius:"6px",border:"none",color:"var(--gray-800)",position:"relative",padding:".5rem .75rem",width:c?"auto":"fit-content",minHeight:"32px",...S},size:v,color:"white",className:" f-0 select-button bg-gray-200 "+(m?" disabled ":" ")+(c?"  ":i)+" "+y,onKeyDown:m?void 0:e=>{if(1!==e.key.length||n){if(["ArrowUp","ArrowDown"].includes(e.key)){const t="ArrowUp"===e.key?-1:1;let n=E.indexOf(s)+t;n<0?n=E.length-1:n>E.length-1&&(n=0),w(E[n],e),e.preventDefault()}}else this.setState({popupAnchor:e.currentTarget,defaultSearch:e.key})},onClick:m?void 0:e=>{this.setState({popupAnchor:e.currentTarget})},iconPath:g},g?null:t.createElement(t.Fragment,null,t.createElement("div",{className:"pr-1 "+(s?"":" text-gray-600")},(p?SmartFormField.renderValue(void 0,u,!m):u)||f),x)),n?t.createElement(Popup,{open:!0,rootStyle:{padding:0},anchorEl:n,positioning:"beneath-left-minfill",clickCatchStyle:{opacity:0},onClose:l,contentClassName:"rounded"},t.createElement(SearchList,{id:o,placeholder:"Search...",defaultSearch:a,noSearch:!d&&E.length<15,onSearch:d,onMultiToggle:h?(e,t)=>{w(e.filter((e=>e.checked)).map((e=>e.key)),t)}:void 0,onChange:h?void 0:w,limit:b,items:_.map((({key:e,label:t,subLabel:n,checked:i})=>({key:e,label:t,subLabel:n,onPress:t=>{C(e,t),h||l()},selected:t===s,checked:i})))})):null)}else T=t.createElement("div",{className:"select-wrapper relative rounded-md "+(c?" f-1 ":i)},t.createElement("select",{id:o,title:r,style:{appearance:"none",paddingRight:"2em",background:"transparent",...S},value:s,required:l,onChange:w?e=>{w(e.target.value,e)}:void 0},_.map((({key:e,label:n},i)=>t.createElement("option",{key:i,value:e},n)))),x);return c?t.createElement("div",{className:" w-fit "+(m?" flex-row ai-center ":" flex-col ")+i,style:a},t.createElement("label",{htmlFor:o,className:"noselect f-0 text-gray-500 ta-left "+(m?" mr-p5 ":" mb-p5 ")},c),T):T}}const qn=[{label:"CREATE TABLE",info:"Create a table within the current database",sql:"/* DROP TABLE IF EXISTS my_new_table; */\n  CREATE TABLE /* IF NOT EXISTS */ my_new_table (\n\n    /* Auto incrementing key */\n    id  SERIAL PRIMARY KEY\n\n    username    TEXT NOT NULL,\n    first_name  TEXT NOT NULL,\n    last_name   TEXT NOT NULL,\n    created     TIMESTAMP DEFAULT NOW()\n\n);\n/* \nAlternatively, you can use a UUID PRIMARY KEY. This requires pgcrypto extension to be installed:\n  CREATE EXTENSION IF NOT EXISTS pgcrypto;\n\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid()\n\nTo reference a (unique) column from another table:\n  user_id UUID NOT NULL REFERENCES users(id), \n*/"},{label:"INSERT ROWS",info:"Add data to a table",sql:"INSERT INTO my_new_table (col1, col2, col3)\nVALUES \n  (1, 1, 1),\n  (2, 2, 2),\n  (3, 3, 3);\n\n/* From select */\nINSERT INTO my_new_table (col1, col2, col3)\nSELECT col1, col2, col3 \nFROM my_other_table\nWHERE col3 = 33;\n"},{label:"DELETE ROWS",info:"Delete data from a table",sql:"DELETE FROM my_new_table\nWHERE col3 = 33;\n\n/* To delete matching records in a child table where a foreign key relationship is in place */\nDELETE FROM my_new_table CASCADE\nWHERE col3 = 33;\n"},{label:"UPDATE ROWS",info:"Update data in a table",sql:"UPDATE my_new_table\nSET status = 'active'\nWHERE username = 'me'\n\n/* From select */\nUPDATE my_new_table\nSET customer = subquery.customer,\n  address = subquery.address\nFROM (\n  SELECT customer, address, row_id\n  FROM ...\n) AS subquery\nWHERE my_new_table.row_id = subquery.row_id;\n"},{label:"DROP TABLE",info:"Drop a table",sql:"DROP TABLE /* IF EXISTS */ my_new_table;"},{label:"RENAME A TABLE",info:"Rename a table. Change table name",sql:"ALTER TABLE my_table\nRENAME TO my_new_table;"},{label:"VACUUM A TABLE",info:"Vacuum a table. Reclaims storage occupied by dead tuples",sql:"VACUUM /* FULL */ my_table;"},{label:"COMMENT A TABLE",info:"Comment on a table ",sql:"COMMENT ON TABLE my_table IS 'My comment';"},{label:"ADD NEW COLUMN",info:"Add a new column to an existing table",sql:"ALTER TABLE my_table ADD COLUMN new_colname INTEGER;"},{label:"RENAME COLUMN",info:"Add a new column to an existing table",sql:"ALTER TABLE my_table RENAME COLUMN colname TO new_colname;"},{label:"CHANGE COLUMN DATA TYPE",info:"Change an existing column data type",sql:"ALTER TABLE my_table ALTER COLUMN colname TYPE TIMESTAMP;\n\n/* To apply a function during conversion */\nALTER TABLE my_table ALTER COLUMN colname TYPE TIMESTAMP USING to_timestamp(colname, 'yyyy-mm-dd');\n"},{label:"ADD FOREIGN KEY",info:"Add a FOREIGN KEY/REFERENCES constraint to an existing column from table",sql:"ALTER TABLE my_table\nADD FOREIGN KEY (table2_id) \nREFERENCES table2 ( id );"},{label:"ADD PRIMARY KEY",info:"Add a PRIMARY KEY constraint to an existing column from table",sql:"ALTER TABLE my_table\n  ADD PRIMARY KEY (colname) \n  "},{label:"DROP COLUMN",info:"Drops/Removes column from a table",sql:"ALTER TABLE my_table\nDROP COLUMN colname "},{label:"CREATE USER",info:"Creates a user",sql:"CREATE USER new_user WITH ENCRYPTED PASSWORD 'the_password';\n\n/* To allow user access to a database */\nGRANT ALL PRIVILEGES ON DATABASE my_db TO new_user;\n\n/* To grant full control to user */\nALTER USER new_user WITH SUPERUSER \n"},{label:"CREATE DATABASE",info:"Creates a database",sql:"CREATE DATABASE my_db OWNER my_user /* OWNER is optional */ ;"},{label:"DROP DATABASE",info:"Drops/removes a database",sql:"\nDROP DATABASE my_db;\n\n/* If cannot drop due to being in use then close all connections to it except this */\nSELECT pg_terminate_backend(pg_stat_activity.pid) FROM pg_stat_activity \nWHERE pg_stat_activity.datname = 'my_db' AND pid <> pg_backend_pid();\n"},{label:"CREATE EXTENSION",info:"Creates/enables/installs an extension",sql:"/*** Some extensions are included in the default installation ***/\n/* Provides cryptographic functions  */\nCREATE EXTENSION pgcrypto;\n\n/* Track statistics on the queries executed by a Postgres database */\nCREATE EXTENSION pg_stat_statements;\n\n/* Allows using a Foreign Data Wrapper to access tables on remote Postgres servers */\nCREATE EXTENSION postgres_fdw;\n\n/*** Other extensions need to be installed first ***/  \n/* Adds support for geographic and geometric data types and functions */  \nCREATE EXTENSION IF NOT EXISTS postgis;\n\n"},{label:"CREATE TRIGGER",info:"Create trigger on data change",sql:"CREATE OR REPLACE FUNCTION order_on_insert\n  RETURNS trigger AS\n$$\n\nBEGIN\n\n  INSERT INTO orders_audit (id, customer_id, product_id, added)\n  VALUES(NEW.id, NEW.customer_id, NEW.product_id, now());\n\n  RETURN NEW;\n\nEND;\n\n$$\nLANGUAGE 'plpgsql';\n\nCREATE TRIGGER order_on_insert_trigger\nAFTER INSERT\nON orders\nFOR EACH ROW\nEXECUTE PROCEDURE order_on_insert();"},{label:"CREATE EXTENSION",info:"Creates/enables/installs an extension",sql:"/*** Some extensions are included in the default installation ***/\n/* Provides cryptographic functions  */\nCREATE EXTENSION pgcrypto;\n\n/* Track statistics on the queries executed by a Postgres database */\nCREATE EXTENSION pg_stat_statements;\n\n/* Allows using a Foreign Data Wrapper to access tables on remote Postgres servers */\nCREATE EXTENSION postgres_fdw;\n\n/*** Other extensions need to be installed first ***/  \n/* Adds support for geographic and geometric data types and functions */  \nCREATE EXTENSION IF NOT EXISTS postgis;\n\n"},{label:"Clone database",info:"Create a copy/clone of an existing database",sql:"/* originaldb must be idle/not accessed by other users */\nCREATE DATABASE newdb WITH TEMPLATE originaldb OWNER dbuser;\n\n/* To make originaldb idle */\nSELECT pg_terminate_backend(pg_stat_activity.pid) FROM pg_stat_activity \nWHERE pg_stat_activity.datname = 'originaldb' AND pid <> pg_backend_pid();\n  "}],Wn=[{key:"views and queries",label:"Tables/Queries"},{key:"rows",label:"Data"},{key:"commands",label:"SQL Snippets"}];class SearchAll extends RTComp{constructor(e){var n;super(e),this.onDeltaCombined=async(e,t)=>{t.includes("searchType")&&e.searchType&&this.setState({sType:e.searchType}),t.includes("sType")&&e.sType&&this.searchTerm},this.searchRows=(e="")=>{const{sType:n,tablesToSearch:i,matchCase:r}=this.state,{db:s,tables:o}=this.props;this.searchTerm=e,this.searching&&clearTimeout(this.searching),this.searching=setTimeout((async()=>{var e;const r=this.searchTerm+"";if("rows"===n&&s.sql){this.setState({loading:!0}),this.setState({items:void 0});for(const n of i){let i="*";const a=null===(e=o.find((e=>e.name===n)))||void 0===e?void 0:e.columns;a&&(i=a.filter((e=>"geography"!==e.udt_name&&"geometry"!==e.udt_name&&(!/[a-z]/i.test(r)||"number"!==e.tsDataType))).map((e=>e.name)));const l=s[n];if(l.find&&this.mounted&&i.length&&r===this.searchTerm){const{matchCase:e}=this.state;this.setState({currentSearchedTable:n});const o={$term_highlight:[i,r,{edgeTruncate:30,matchCase:e,returnType:"object"}]},a={$term_highlight:[i,r,{matchCase:e,returnType:"boolean"}]},c=(await l.find(a,{select:{$rowhash:1,s:o},limit:3})).filter((e=>e.s)).map((e=>{const t=Object.keys(e.s)[0];return{$rowhash:e.$rowhash,table:n,colName:t,match:e.s[t].map(((e,n)=>n?e:`${t}: ${e}`))}}));if(r===this.searchTerm&&"rows"===this.searchType){const{onOpen:e,onClose:n}=this.props,i=c.map(((i,o)=>{var a;return{...i,key:i.$rowhash+o,label:i.table,content:t.createElement("div",{className:"f-1 flex-row ai-start",title:"Open table at row"},t.createElement("div",{className:"flex-col ai-start f-0 mr-p5 text-gray-500"},t.createElement(tt(),{path:(null===(a=null==s?void 0:s[i.table])||void 0===a?void 0:a.insert)?Ke:Xe,size:1.5})),t.createElement("div",{className:"flex-col ai-start f-1"},t.createElement("div",{className:"font-18"},i.table),t.createElement("div",{style:{fontSize:"16px",opacity:.7,textAlign:"left",width:"100%",marginTop:".25em"},className:this.searchType?"":"text-gray-400"},SearchAll.renderRow(i.match,o)))),onPress:()=>{let t=[];i.colName&&t.push({fieldName:i.colName,type:"$term_highlight",value:r}),e({table:i.table,filter:t}),n()}}}));i.length&&this.setState({items:[...this.state.items||[],...i]})}else this.setState({loading:!1})}}this.setState({loading:!1,items:this.state.items||[]}),this.searching=null}else console.error("Unexpected option")}),600)},this.state={searchTerm:"",sType:null!==(n=e.searchType)&&void 0!==n?n:"rows",matches:[],loading:!1,rows:[],cols:[],db_objects:[],tablesToSearch:[],allTablesToSearch:[],matchCase:!1,objTypesToSearch:["tables","queries"]}}onMount(){const{defaultTerm:e="",db:t}=this.props,n=Object.keys(t).filter((e=>t[e].find)),i=n.slice(0);this.setState({searchTerm:e,tablesToSearch:n,allTablesToSearch:i},(()=>{e&&this.searchRows(e)}))}getSearchListProps(){const{sType:e,objTypesToSearch:n}=this.state,{queries:i,onClose:r,suggestions:s}=this.props;this.searchType=e;let o,a,l=!1;return"views and queries"===e?o=s.slice(0).filter((e=>"table"===e.type&&"public"===e.schema&&n.includes("tables"))).map((e=>({key:e.label,label:e.escapedIdentifier,subLabel:e.subLabel,contentLeft:t.createElement("div",{className:"f-0"},t.createElement(tt(),{className:"text-gray-500 p-p25",size:1.5,path:"table"===e.type?Xe:"function"===e.type?De:"M12 3C6.5 3 2 6.6 2 11C2 13.1 3 15.1 4.8 16.5C4.8 17.1 4.4 18.7 2 21C2 21 5.5 21 8.5 18.5C9.6 18.8 10.8 19 12 19C17.5 19 22 15.4 22 11S17.5 3 12 3M13 15H11V13H13V15M14.8 10C14.5 10.4 14.1 10.6 13.7 10.8C13.4 11 13.3 11.1 13.2 11.3C13 11.5 13 11.7 13 12H11C11 11.5 11.1 11.2 11.3 10.9C11.5 10.7 11.9 10.4 12.4 10.1C12.7 10 12.9 9.8 13 9.6C13.1 9.4 13.2 9.1 13.2 8.9C13.2 8.6 13.1 8.4 12.9 8.2C12.7 8 12.4 7.9 12.1 7.9C11.8 7.9 11.6 8 11.4 8.1C11.2 8.2 11.1 8.4 11.1 8.7H9.1C9.2 8 9.5 7.4 10 7C10.5 6.6 11.2 6.5 12.1 6.5C13 6.5 13.8 6.7 14.3 7.1C14.8 7.5 15.1 8.1 15.1 8.8C15.2 9.2 15.1 9.6 14.8 10Z"})),onPress:()=>{this.props.onClose(),this.props.onOpenDBObject(e)}}))).concat(((null==n?void 0:n.includes("queries"))&&null!=i?i:[]).map((e=>({key:e.id,label:e.name,subLabel:e.sql||"",contentLeft:t.createElement("div",{className:"f-0"},t.createElement(tt(),{className:"text-gray-500 p-p25",size:1.5,path:$e})),onPress:(t,n)=>{var i;this.props.onClose();let r={};if(e.sql&&n&&e.sql.toLowerCase().includes(n.toLowerCase())){const t=e.sql.split("\n").map((e=>e.toLowerCase())),i=t.findIndex((e=>e.includes(n.toLowerCase()))),s={column:t[i].indexOf(n.toLowerCase())+1,lineNumber:i+1};r={options:{...e.options||{},cursorPosition:s}}}null===(i=e.$update)||void 0===i||i.call(e,{closed:!1,...r},{deepMerge:!0})}})))):"commands"===e?o=qn.map((e=>({...e,key:e.label,label:e.label,subLabel:e.info+"\n"+e.sql,contentLeft:t.createElement(tt(),{path:"M6 2C4.89 2 4 2.9 4 4V20C4 21.11 4.89 22 6 22H12V20H6V4H13V9H18V12H20V8L14 2M18 14C17.87 14 17.76 14.09 17.74 14.21L17.55 15.53C17.25 15.66 16.96 15.82 16.7 16L15.46 15.5C15.35 15.5 15.22 15.5 15.15 15.63L14.15 17.36C14.09 17.47 14.11 17.6 14.21 17.68L15.27 18.5C15.25 18.67 15.24 18.83 15.24 19C15.24 19.17 15.25 19.33 15.27 19.5L14.21 20.32C14.12 20.4 14.09 20.53 14.15 20.64L15.15 22.37C15.21 22.5 15.34 22.5 15.46 22.5L16.7 22C16.96 22.18 17.24 22.35 17.55 22.47L17.74 23.79C17.76 23.91 17.86 24 18 24H20C20.11 24 20.22 23.91 20.24 23.79L20.43 22.47C20.73 22.34 21 22.18 21.27 22L22.5 22.5C22.63 22.5 22.76 22.5 22.83 22.37L23.83 20.64C23.89 20.53 23.86 20.4 23.77 20.32L22.7 19.5C22.72 19.33 22.74 19.17 22.74 19C22.74 18.83 22.73 18.67 22.7 18.5L23.76 17.68C23.85 17.6 23.88 17.47 23.82 17.36L22.82 15.63C22.76 15.5 22.63 15.5 22.5 15.5L21.27 16C21 15.82 20.73 15.65 20.42 15.53L20.23 14.21C20.22 14.09 20.11 14 20 14M19 17.5C19.83 17.5 20.5 18.17 20.5 19C20.5 19.83 19.83 20.5 19 20.5C18.16 20.5 17.5 19.83 17.5 19C17.5 18.17 18.17 17.5 19 17.5Z",size:1.5,className:"mr-p5 text-gray-500"}),onPress:()=>{this.props.loadTable({type:"sql",name:e.label,sql:e.sql}),this.props.onClose()}}))):"rows"===e&&(a=this.searchRows,l=!0,o=this.state.items),{items:o,onSearch:a,onType:(t,n)=>{"commands"!==e&&">"===t&&(n(""),this.setState({sType:"commands",searchTerm:""}))},dontHighlight:l,placeholder:"Search..."}}render(){var e;const{loading:n=!1,sType:i,tablesToSearch:r,allTablesToSearch:s,currentSearchedTable:o,matchCase:a,objTypesToSearch:l}=this.state,{defaultTerm:c,onClose:u}=this.props,d=this.getSearchListProps(),h=window.innerWidth<600,p=h?0:"2em",f={marginTop:h?".5em":"68px",flex:"none"},m="f-0 "+(h?"":" px-1 "),g="commands"===i?null:"rows"!==i?t.createElement(Select,{label:"Tables/Queries",style:f,className:m,limit:1e3,options:["tables","queries"],value:l,multiSelect:!0,onChange:e=>this.setState({objTypesToSearch:e})}):t.createElement(Select,{label:"Tables",style:f,className:m,limit:1e3,options:s,value:r,multiSelect:!0,onChange:e=>this.setState({tablesToSearch:e})});let y=t.createElement(t.Fragment,null,t.createElement("div",{className:"flex-row aai-start w-full min-h-0",style:{width:"hh550px",maxWidth:"88vw",alignSelf:"center"}},!h&&g,t.createElement("div",{className:"flex-col min-w-0 min-h-0 f-1"},t.createElement(ButtonGroup,{variant:"dense",className:"o-auto",options:Wn.map((e=>e.label)),value:null===(e=Wn.find((e=>e.key===i)))||void 0===e?void 0:e.label,style:{marginRight:"40px",marginBottom:"1em"},onChange:e=>{var t;const n=null===(t=Wn.find((t=>t.label===e)))||void 0===t?void 0:t.key;n&&this.setState({sType:n})}}),h&&g,"commands"===i?null:n&&"rows"===i?t.createElement("div",{className:"flex-row f-0 min-h-0 ai-center h-fit "},t.createElement(Loading,{sizePx:18,className:"f-0 m-p5",show:n}),t.createElement("div",{className:"f-1 ta-left font-14"},`Searching ${o} (${r.indexOf(o)+1}/${r.length})`)):t.createElement("div",{style:{width:"34px",height:"34px"}}),t.createElement(SearchList,{matchCase:{value:a,onChange:e=>this.setState({matchCase:e})},id:"search-all-db",className:"f-1 min-w-0 flex-col ",searchStyle:{maxWidth:"500px"},defaultSearch:c,limit:1e3,...d}))));return t.createElement(Popup,{title:"Quick search",contentClassName:" p-1",contentStyle:{overflow:"unset",paddingTop:0},rootStyle:{minHeight:"50vh",top:p,right:p,left:p,maxHeight:"calc(100vh - 4em)"},open:!0,onClose:u,focusTrap:!0},y)}}SearchAll.renderRow=(e,n,i)=>e&&Array.isArray(e)?t.createElement("div",{key:n,className:"flex-row ws-pre f-1 "},e.map(((n,i)=>{if("string"==typeof n){const r=!e[2];let s=i?{flex:1}:{display:"flex",flex:r?void 0:1,justifyContent:r?"start":"end"};return 1===e.length&&(delete s.maxWidth,n=cT(n.split("\n").join(" "),25)),t.createElement("span",{key:i,style:{...s,maxWidth:"fit-content"},className:"fs-1 min-w-0 text-gray-600 text-ellipsis"+(i?" ta-left":" ")},n)}return Array.isArray(n)&&"string"==typeof n[0]?t.createElement("strong",{key:i,className:"f-0"},n[0]):(console.warn("Unexpected $term_highlight item",n),null)}))):null;var Gn=n(6381),Yn=n.n(Gn),Xn=n(2040);class MenuList extends t.Component{constructor(){super(...arguments),this.state={searchTerm:""}}render(){const{className:e="",variant:n="vertical",style:i={},items:r=[]}=this.props;return t.createElement("div",{className:" menu list-comp bg-white rounded "+("vertical"===n?" w-fit ":"")+e,style:{maxHeight:"99vh",padding:0,...i},onKeyDown:e=>{var t,n;if(!this.refList)return;const i=this.refList.lastChild,r=this.refList.firstChild,s=null===(t=document.activeElement)||void 0===t?void 0:t.previousElementSibling,o=null===(n=document.activeElement)||void 0===n?void 0:n.nextElementSibling;switch(e.key){case"ArrowUp":document.activeElement===r?i.focus():this.refList.childElementCount&&s.focus();break;case"ArrowDown":document.activeElement===i?r.focus():this.refList.childElementCount&&o.focus()}}},t.createElement("ul",{className:"f-1 o-auto min-h-0 min-w-0 "+("vertical"===n?"flex-col ":"flex-row "),role:"list",ref:e=>{e&&(this.refList=e)},style:{padding:0}},r.map(((e,n)=>t.createElement("li",{key:n,role:"listitem",tabIndex:0,title:e.disabledText,style:{...e.style||{},...e.disabledText?{cursor:"not-allowed",opacity:.5}:{}},className:"flex-row  p-p5  text-gray-900 "+(!e.disabledText&&e.onPress?" pointer ":" "),onClick:!e.onPress||e.disabledText?void 0:()=>{var t;null===(t=e.onPress)||void 0===t||t.call(e)},onKeyUp:!e.onPress||e.disabledText?void 0:t=>{var n;"Enter"===t.key&&(null===(n=e.onPress)||void 0===n||n.call(e))}},t.createElement("label",{className:"mr-p5 f-1 flex-row ai-center ",style:{cursor:"inherit"}},e.leftIconPath?t.createElement(tt(),{className:"mr-p5 text-gray-400",path:e.leftIconPath,size:1}):null,e.label," ",e.contentRight||null))))))}}class Tabs extends t.Component{constructor(){super(...arguments),this.state={activeKey:void 0}}render(){var e,n,i,r;const{className:s="",style:o={},variant:a="horizontal",contentClass:l="",onChange:c,compactMode:u}=this.props,d=this.props.items||{},{activeKey:h=(null!==(e=this.props.activeKey)&&void 0!==e?e:this.props.defaultActiveKey)}=this.state;let p=null;"string"==typeof h&&d[h]&&d[h].content&&(p=null===(n=d[h])||void 0===n?void 0:n.content);let f={borderColor:"transparent",borderRightStyle:"solid",borderRightWidth:"2px"},m="flex-row ";"horizontal"===a&&(m="flex-col ",f={borderColor:"transparent",borderBottomStyle:"solid",borderBottomWidth:"2px"}),u&&(f={borderColor:"transparent"});let g={...f,borderColor:"red",background:"#ffefef"},y=!1;return u&&h&&(m="flex-col ",y=!0),t.createElement("div",{className:m+" min-w-0 min-h-0 f-0 "+s,style:o},y?t.createElement("div",{className:"flex-row ai-center",style:{backgroundColor:"aliceblue"}},t.createElement(Btn,{iconPath:_e,onClick:()=>{this.setState({activeKey:void 0}),c&&c(void 0)}},h),void 0!==h&&(null===(i=null==d?void 0:d[h])||void 0===i?void 0:i.leftIconPath)&&t.createElement(tt(),{className:"text-gray-400 mr-1",path:null===(r=null==d?void 0:d[h])||void 0===r?void 0:r.leftIconPath,size:1})):t.createElement(MenuList,{className:"f-0 w-full noselect",variant:a,items:Object.keys(d).map((e=>{var t,n,i,r,s;return{label:(null===(t=d[e])||void 0===t?void 0:t.label)||e,leftIconPath:null===(n=d[e])||void 0===n?void 0:n.leftIconPath,disabledText:null===(i=d[e])||void 0===i?void 0:i.disabledText,style:{...e===h?g:f,...(null===(r=d[e])||void 0===r?void 0:r.style)||{}},onPress:(null===(s=d[e])||void 0===s?void 0:s.disabledText)?void 0:()=>{c&&c(e),this.setState({activeKey:e})}}}))}),p?t.createElement("div",{className:"f-1 "+l},p):null)}}class AddChartMenu extends t.Component{constructor(){super(...arguments),this.state={chartType:void 0}}static getChartCols(e){var t,n,i,r,s;let o=[],a="";if("sql"===e.type){const s=e;o=(null===(n=null===(t=s.options)||void 0===t?void 0:t.sqlResultCols)||void 0===n?void 0:n.map((e=>({...e,name:e.key}))))||[],a=null!==(r=null===(i=s.options)||void 0===i?void 0:i.lastSQL)&&void 0!==r?r:""}else{o=(null===(s=e.columns)||void 0===s?void 0:s.map((e=>{var t,n;return{...e,udt_name:(null===(t=e.info)||void 0===t?void 0:t.udt_name)||(null===(n=e.computedInfo)||void 0===n?void 0:n.udt_name)}})))||[]}const l=o.filter((e=>["geography","geometry"].includes(e.udt_name))),c=o.filter((e=>(e.udt_name||"").startsWith("timestamp")||"date"===e.udt_name));return{geoCols:l,dateCols:c,cols:o,sql:a}}render(){const{w:e,onAddChart:n}=this.props,{chartType:i}=this.state;if(!e)return null;const{geoCols:r,dateCols:s,cols:o,sql:a}=AddChartMenu.getChartCols(e),l=e.table_name,c=(t,i,r)=>{n({type:t,tableName:l,name:`${l||""} (${i})`,linkOpts:{[r]:i,sql:a,fromSelected:Boolean(e.selected_sql)}})},u=[{label:"Map",iconPath:ze,cols:r,onAdd:e=>{c("map",e,"geomColumn")}},{label:"Timechart",iconPath:"M16,11.78L20.24,4.45L21.97,5.45L16.74,14.5L10.23,10.75L5.46,19H22V21H2V3H4V17.54L9.5,8L16,11.78Z",cols:s,onAdd:e=>{c("timechart",e,"dateColumn")}}];let d={};return u.map((e=>{e.cols.length&&(d[e.label]={leftIconPath:e.iconPath,label:e.label,content:t.createElement(SearchList,{label:"Choose column",id:"chart-col",items:e.cols.map((t=>({key:t.name,label:t.name,subLabel:t.udt_name,onPress:()=>{e.onAdd(t.name)}})))})})})),t.createElement("div",{className:"flex-row ",style:{}},t.createElement(Tabs,{activeKey:i,variant:"vertical",onChange:e=>{this.setState({chartType:e});const t=u.find((t=>t.label===e));1===(null==t?void 0:t.cols.length)&&t.onAdd(t.cols[0].name)},contentClass:"p-1 flex-row ai-center",items:d}))}}function Kn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Zn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Jn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Zn(Object(n),!0).forEach((function(t){Kn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Zn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Qn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function ei(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ti(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ni(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ti(Object(n),!0).forEach((function(t){ei(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ti(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ii(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduceRight((function(e,t){return t(e)}),e)}}function ri(e){return function t(){for(var n=this,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return r.length>=e.length?e.apply(this,r):function(){for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];return t.apply(n,[].concat(r,i))}}}function si(e){return{}.toString.call(e).includes("Object")}function oi(e){return"function"==typeof e}var ai=ri((function(e,t){throw new Error(e[t]||e.default)}))({initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"}),li={changes:function(e,t){return si(t)||ai("changeType"),Object.keys(t).some((function(t){return!function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(e,t)}))&&ai("changeField"),t},selector:function(e){oi(e)||ai("selectorType")},handler:function(e){oi(e)||si(e)||ai("handlerType"),si(e)&&Object.values(e).some((function(e){return!oi(e)}))&&ai("handlersType")},initial:function(e){var t;e||ai("initialIsRequired"),si(e)||ai("initialType"),t=e,Object.keys(t).length||ai("initialContent")}};function ci(e,t){return oi(t)?t(e.current):t}function ui(e,t){return e.current=ni(ni({},e.current),t),t}function di(e,t,n){return oi(t)?t(e.current):Object.keys(n).forEach((function(n){var i;return null===(i=t[n])||void 0===i?void 0:i.call(t,e.current[n])})),n}var hi={create:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};li.initial(e),li.handler(t);var n={current:e},i=ri(di)(n,t),r=ri(ui)(n),s=ri(li.changes)(e),o=ri(ci)(n);function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e};return li.selector(e),e(n.current)}function l(e){ii(i,r,s,o)(e)}return[a,l]}};const pi=hi;const fi={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.28.1/min/vs"}};const mi=function(e){return function t(){for(var n=this,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return r.length>=e.length?e.apply(this,r):function(){for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];return t.apply(n,[].concat(r,i))}}};const gi=function(e){return{}.toString.call(e).includes("Object")};var yi={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:"Deprecation warning!\n    You are using deprecated way of configuration.\n\n    Instead of using\n      monaco.config({ urls: { monacoBase: '...' } })\n    use\n      monaco.config({ paths: { vs: '...' } })\n\n    For more please check the link https://github.com/suren-atoyan/monaco-loader#config\n  "},vi=mi((function(e,t){throw new Error(e[t]||e.default)}))(yi),bi={config:function(e){return e||vi("configIsRequired"),gi(e)||vi("configType"),e.urls?(console.warn(yi.deprecation),{paths:{vs:e.urls.monacoBase}}):e}};const wi=bi;const xi=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduceRight((function(e,t){return t(e)}),e)}};const _i=function e(t,n){return Object.keys(n).forEach((function(i){n[i]instanceof Object&&t[i]&&Object.assign(n[i],e(t[i],n[i]))})),Jn(Jn({},t),n)};var Ei={type:"cancelation",msg:"operation is manually canceled"};const Si=function(e){var t=!1,n=new Promise((function(n,i){e.then((function(e){return t?i(Ei):n(e)})),e.catch(i)}));return n.cancel=function(){return t=!0},n};var Ci=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,r=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Qn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Qn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(pi.create({config:fi,isInitialized:!1,resolve:null,reject:null,monaco:null}),2),Ti=Ci[0],Ai=Ci[1];function ki(e){return document.body.appendChild(e)}function Ni(e){var t,n,i=Ti((function(e){return{config:e.config,reject:e.reject}})),r=(t="".concat(i.config.paths.vs,"/loader.js"),n=document.createElement("script"),t&&(n.src=t),n);return r.onload=function(){return e()},r.onerror=i.reject,r}function Mi(){var e=Ti((function(e){return{config:e.config,resolve:e.resolve,reject:e.reject}})),t=window.require;t.config(e.config),t(["vs/editor/editor.main"],(function(t){Pi(t),e.resolve(t)}),(function(t){e.reject(t)}))}function Pi(e){Ti().monaco||Ai({monaco:e})}var Li=new Promise((function(e,t){return Ai({resolve:e,reject:t})})),Oi={config:function(e){Ai((function(t){return{config:_i(t.config,wi.config(e))}}))},init:function(){if(!Ti((function(e){return{isInitialized:e.isInitialized}})).isInitialized){if(window.monaco&&window.monaco.editor)return Pi(window.monaco),Si(Promise.resolve(window.monaco));xi(ki,Ni)(Mi),Ai({isInitialized:!0})}return Si(Li)},__getMonacoInstance:function(){return Ti((function(e){return e.monaco}))}};const Ri=Oi;function Ii(){return Ii=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Ii.apply(this,arguments)}const Di={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"};const Fi=function({content:e}){return t.createElement("div",{style:Di},e)},Bi={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}};function zi({width:e,height:n,isEditorReady:i,loading:r,_ref:s,className:o,wrapperProps:a}){return t.createElement("section",Ii({style:{...Bi.wrapper,width:e,height:n}},a),!i&&t.createElement(Fi,{content:r}),t.createElement("div",{ref:s,style:{...Bi.fullWidth,...!i&&Bi.hide},className:o}))}zi.propTypes={width:l().oneOfType([l().number,l().string]).isRequired,height:l().oneOfType([l().number,l().string]).isRequired,loading:l().oneOfType([l().element,l().string]).isRequired,isEditorReady:l().bool.isRequired,className:l().string,wrapperProps:l().object};const ji=zi;const Vi=(0,t.memo)(ji);const Ui=function(e){(0,t.useEffect)(e,[])};const Hi=function(e,n,i=!0){const r=(0,t.useRef)(!0);(0,t.useEffect)(r.current||!i?()=>{r.current=!1}:e,n)};function $i(){}function qi(e,t,n,i){return function(e,t){return e.editor.getModel(Wi(e,t))}(e,i)||function(e,t,n,i){return e.editor.createModel(t,n,i&&Wi(e,i))}(e,t,n,i)}function Wi(e,t){return e.Uri.parse(t)}function Gi({original:e,modified:n,language:i,originalLanguage:r,modifiedLanguage:s,originalModelPath:o,modifiedModelPath:a,keepCurrentOriginalModel:l,keepCurrentModifiedModel:c,theme:u,loading:d,options:h,height:p,width:f,className:m,wrapperProps:g,beforeMount:y,onMount:v}){const[b,w]=(0,t.useState)(!1),[x,_]=(0,t.useState)(!0),E=(0,t.useRef)(null),S=(0,t.useRef)(null),C=(0,t.useRef)(null),T=(0,t.useRef)(v),A=(0,t.useRef)(y);Ui((()=>{const e=Ri.init();return e.then((e=>(S.current=e)&&_(!1))).catch((e=>"cancelation"!==(null==e?void 0:e.type)&&console.error("Monaco initialization: error:",e))),()=>E.current?function(){const e=E.current.getModel();var t,n;l||null===(t=e.original)||void 0===t||t.dispose();c||null===(n=e.modified)||void 0===n||n.dispose();E.current.dispose()}():e.cancel()})),Hi((()=>{const e=E.current.getModifiedEditor();e.getOption(S.current.editor.EditorOption.readOnly)?e.setValue(n):n!==e.getValue()&&(e.executeEdits("",[{range:e.getModel().getFullModelRange(),text:n,forceMoveMarkers:!0}]),e.pushUndoStop())}),[n],b),Hi((()=>{E.current.getModel().original.setValue(e)}),[e],b),Hi((()=>{const{original:e,modified:t}=E.current.getModel();S.current.editor.setModelLanguage(e,r||i),S.current.editor.setModelLanguage(t,s||i)}),[i,r,s],b),Hi((()=>{S.current.editor.setTheme(u)}),[u],b),Hi((()=>{E.current.updateOptions(h)}),[h],b);const k=(0,t.useCallback)((()=>{A.current(S.current);const t=qi(S.current,e,r||i,o),l=qi(S.current,n,s||i,a);E.current.setModel({original:t,modified:l})}),[i,n,s,e,r,o,a]),N=(0,t.useCallback)((()=>{E.current=S.current.editor.createDiffEditor(C.current,{automaticLayout:!0,...h}),k(),S.current.editor.setTheme(u),w(!0)}),[h,u,k]);return(0,t.useEffect)((()=>{b&&T.current(E.current,S.current)}),[b]),(0,t.useEffect)((()=>{!x&&!b&&N()}),[x,b,N]),t.createElement(Vi,{width:f,height:p,isEditorReady:b,loading:d,_ref:C,className:m,wrapperProps:g})}Gi.propTypes={original:l().string,modified:l().string,language:l().string,originalLanguage:l().string,modifiedLanguage:l().string,originalModelPath:l().string,modifiedModelPath:l().string,keepCurrentOriginalModel:l().bool,keepCurrentModifiedModel:l().bool,theme:l().string,loading:l().oneOfType([l().element,l().string]),options:l().object,width:l().oneOfType([l().number,l().string]),height:l().oneOfType([l().number,l().string]),className:l().string,wrapperProps:l().object,beforeMount:l().func,onMount:l().func},Gi.defaultProps={theme:"light",loading:"Loading...",options:{},keepCurrentOriginalModel:!1,keepCurrentModifiedModel:!1,width:"100%",height:"100%",wrapperProps:{},beforeMount:$i,onMount:$i};const Yi=function(e){const n=(0,t.useRef)();return(0,t.useEffect)((()=>{n.current=e}),[e]),n.current},Xi=new Map;function Ki({defaultValue:e,defaultLanguage:n,defaultPath:i,value:r,language:s,path:o,theme:a,line:l,loading:c,options:u,overrideServices:d,saveViewState:h,keepCurrentModel:p,width:f,height:m,className:g,wrapperProps:y,beforeMount:v,onMount:b,onChange:w,onValidate:x}){const[_,E]=(0,t.useState)(!1),[S,C]=(0,t.useState)(!0),T=(0,t.useRef)(null),A=(0,t.useRef)(null),k=(0,t.useRef)(null),N=(0,t.useRef)(b),M=(0,t.useRef)(v),P=(0,t.useRef)(null),L=(0,t.useRef)(r),O=Yi(o);Ui((()=>{const e=Ri.init();return e.then((e=>(T.current=e)&&C(!1))).catch((e=>"cancelation"!==(null==e?void 0:e.type)&&console.error("Monaco initialization: error:",e))),()=>A.current?function(){var e,t;null===(e=P.current)||void 0===e||e.dispose(),p?h&&Xi.set(o,A.current.saveViewState()):null===(t=A.current.getModel())||void 0===t||t.dispose();A.current.dispose()}():e.cancel()})),Hi((()=>{const t=qi(T.current,e||r,n||s,o);t!==A.current.getModel()&&(h&&Xi.set(O,A.current.saveViewState()),A.current.setModel(t),h&&A.current.restoreViewState(Xi.get(o)))}),[o],_),Hi((()=>{A.current.updateOptions(u)}),[u],_),Hi((()=>{A.current.getOption(T.current.editor.EditorOption.readOnly)?A.current.setValue(r):r!==A.current.getValue()&&(A.current.executeEdits("",[{range:A.current.getModel().getFullModelRange(),text:r,forceMoveMarkers:!0}]),A.current.pushUndoStop())}),[r],_),Hi((()=>{T.current.editor.setModelLanguage(A.current.getModel(),s)}),[s],_),Hi((()=>{void 0!==l&&A.current.revealLine(l)}),[l],_),Hi((()=>{T.current.editor.setTheme(a)}),[a],_);const R=(0,t.useCallback)((()=>{M.current(T.current);const t=o||i,l=qi(T.current,r||e,n||s,t);A.current=T.current.editor.create(k.current,{model:l,automaticLayout:!0,...u},d),h&&A.current.restoreViewState(Xi.get(t)),T.current.editor.setTheme(a),E(!0)}),[e,n,i,r,s,o,u,d,h,a]);return(0,t.useEffect)((()=>{_&&N.current(A.current,T.current)}),[_]),(0,t.useEffect)((()=>{!S&&!_&&R()}),[S,_,R]),L.current=r,(0,t.useEffect)((()=>{var e,t;_&&w&&(null===(e=P.current)||void 0===e||e.dispose(),P.current=null===(t=A.current)||void 0===t?void 0:t.onDidChangeModelContent((e=>{const t=A.current.getValue();L.current!==t&&w(t,e)})))}),[_,w]),(0,t.useEffect)((()=>{if(_){const e=T.current.editor.onDidChangeMarkers((e=>{var t;const n=null===(t=A.current.getModel())||void 0===t?void 0:t.uri;if(n){if(e.find((e=>e.path===n.path))){const e=T.current.editor.getModelMarkers({resource:n});null==x||x(e)}}}));return()=>{null==e||e.dispose()}}}),[_,x]),t.createElement(Vi,{width:f,height:m,isEditorReady:_,loading:c,_ref:k,className:g,wrapperProps:y})}Ki.propTypes={defaultValue:l().string,defaultPath:l().string,defaultLanguage:l().string,value:l().string,language:l().string,path:l().string,theme:l().string,line:l().number,loading:l().oneOfType([l().element,l().string]),options:l().object,overrideServices:l().object,saveViewState:l().bool,keepCurrentModel:l().bool,width:l().oneOfType([l().number,l().string]),height:l().oneOfType([l().number,l().string]),className:l().string,wrapperProps:l().object,beforeMount:l().func,onMount:l().func,onChange:l().func,onValidate:l().func},Ki.defaultProps={theme:"light",loading:"Loading...",options:{},overrideServices:{},saveViewState:!0,keepCurrentModel:!1,width:"100%",height:"100%",wrapperProps:{},beforeMount:$i,onMount:$i,onValidate:$i};const Zi=Ki;const Ji=(0,t.memo)(Zi);let Qi;var er;Ri.config({paths:{vs:"/vs"}});const tr={storageService:{get(){},remove(e,t){},getBoolean:e=>"expandSuggestionDocs"===e,store(){},onWillSaveState(){},onDidChangeStorage(){}}};const nr="myCustomTheme";null===(er=null==Ri?void 0:Ri.init)||void 0===er||er.call(Ri).then((e=>{e.editor.defineTheme(nr,{base:"vs",inherit:!0,colors:{},rules:[{token:"string.sql",foreground:"#e200e2"},{token:"identifier",foreground:"#6c06ab"},{token:"complexIdentifiers",foreground:"#6c06ab"}]})})).catch((e=>console.error("An error occurred during initialization of Monaco: ",e)));const ir=e=>e.getModel().getValueInRange(e.getSelection());class SQLEditor extends t.Component{constructor(){super(...arguments),this.state={value:"",editorMounter:!1},this.getMonaco=async()=>(this._monaco||(this._monaco=await Ri.init()),this._monaco),this.loadedActions=!1,this.loadedSuggestions=!1,this.loadedFuncs=!1,this.onUpdate=async e=>{const{error:t,getFuncDef:n,value:i,sql:r}={...this.props},s=await this.getMonaco();i&&!this.curVal&&(this.curVal=i,this.setState({value:i})),this.editor&&!this.loadedActions&&(this.loadedActions=!0,this.editor.addAction({id:"googleSearch",label:"Search with Google",contextMenuGroupId:"navigation",run:e=>{window.open("https://www.google.com/search?q="+ir(e))}}),this.editor.addAction({id:"googleSearchPG",label:"Search with Google Postgres",contextMenuGroupId:"navigation",run:e=>{window.open("https://www.google.com/search?q=postgres+"+ir(e))}})),this.editor&&n&&!this.loadedFuncs&&(!function(e,t){e.languages.registerSignatureHelpProvider("sql",{signatureHelpTriggerCharacters:["(",","],provideSignatureHelp:async function(e,n){var i=e.getValueInRange({startLineNumber:1,startColumn:1,endLineNumber:n.lineNumber,endColumn:n.column});const r=i.lastIndexOf("(");if(i.lastIndexOf(")")>r)return null;const s=e.getWordUntilPosition(e.getPositionAt(r)),o=i.slice(r+1).split(",").length-1;let a={};if(a.activeParameter=o,a.activeSignature=0,s){const e=await t(s.word,o);return a.signatures=e.map((e=>({label:`${e.name}(${e.arg_list_str})`,documentation:e.description,parameters:e.args}))),{value:a,dispose:()=>{}}}}})}(s,n),this.loadedFuncs=!0,this.editor.focus());const{suggestions:{suggestions:o,settingSuggestions:a=[]}={}}=this.props;if(!this.loadedSuggestions&&o&&o.length&&(this.loadedSuggestions=!0,function(e){const{monaco:t,suggestions:n,settingSuggestions:i,sql:r}=e,s=n;if(window.completionsAddedForSQL)return;window.completionsAddedForSQL="sql";const o=n.filter((e=>"schema"===e.type));t.languages.registerCompletionItemProvider("sql",{provideCompletionItems:async(e,n,r,a)=>{const l=t.languages.CompletionItemKind,c=e=>"function"===e?l.Function:"column"===e?l.Field:"table"===e?l.Value:"dataType"===e?l.Variable:"keyword"===e?l.Keyword:"extension"===e?l.Module:"schema"===e?l.Folder:"setting"===e?l.Property:l.Keyword;function u(e){return e.map(((e,n)=>({...e,label:e.label,kind:c(e.type),insertText:e.insertText||e.label,detail:e.detail||`(${e.type})`,type:e.type,escapedParentName:e.escapedParentName,documentation:{value:e.documentation||`${e.type} ${e.detail||""}`},sortText:"",filterText:void 0,insertTextRules:t.languages.CompletionItemInsertTextRule.InsertAsSnippet})))}let d=u(s),h=u(i);function p(t){if(t&&t.column>=1&&t.lineNumber>=1){let n;return n=e.getWordUntilPosition({...t,column:t.startColumn-1}),n&&!n.word&&n.endColumn>-1&&n.startColumn>-1?p({...t,startColumn:t.startColumn-1}):n}return null}Qi=d;let f,m,g=e.getWordUntilPosition(n),y=!1,v=p({...g,...n});if(v&&(m=p({...g,...n,startColumn:v.startColumn})),g&&g.word){f=g.word;let e=null==f?void 0:f[0];y=e===e.toUpperCase()&&e!==e.toLowerCase()}function b(e){return e.split("").reverse().join("")}const w=e.getOffsetAt(n),x=e.getValue(),_=(x.split("\n"),x.slice(0,w-(f||"").length).split("\n")),E=_.slice(-8).join("\n"),S=(_.slice(-2,-1)[0],_.slice(-1)[0]||""),C=" "+E+" ",T=x.slice(w).split("\n").slice(0,8).join("\n");let A,k="any";const N=(e,t=!1)=>{let n=b(e).toLowerCase();return t&&";"!==e||(n=` ${n} `),b(C.toLowerCase()).replace(/\n/g," ").indexOf(n)},M=(e,t=!1)=>{let n=e.toLowerCase();return t&&";"!==e||(n=` ${n} `),T.replace(/\n/g," ").toLowerCase().indexOf(n)},P=["JOIN","SELECT","TABLE","SET","UPDATE","INTO","FROM","WHERE",";","\n"];let L,O,R,I=-1,D=-1;P.forEach((e=>{const t=E.toLowerCase().lastIndexOf(e.toLowerCase());t>D&&(O=e,D=t)}));let F,B,z,j=-1;if(E.toLowerCase().endsWith(" as ")||"join"===E.toLowerCase().trim().split(" ").slice(-2)[0])return{suggestions:[]};if(E.trim().endsWith(")"))d=d.filter((e=>"AS"===e.label)),k="any";else if(E.trim().endsWith("::"))k="data type";else if(v&&v.word&&(!f||!function(e){return e==e.toUpperCase()&&e!=e.toLowerCase()}(f[0]))||O){F=v.word,B=F.toLowerCase();const e=["ALL","SELECT","INSERT","UPDATE","DELETE","TRUNCATE","REFERENCES","TRIGGER","USAGE","EXECUTE","CREATE","CONNECT","TEMPORARY","TEMP"];if(["database"].includes(B))d=d.filter((e=>"database"===e.type)),k="any";else if(["user","owner"].includes(B))d=d.filter((e=>"role"===e.type)),k="any";else if(["references"].includes(B))d=d.filter((e=>"table"===e.type)),k="any";else if(["inner","left","outer","right"].includes(B))A=["JOIN"],k="command";else if(["rename"].includes(B))A=["TO","COLUMN"],k="command";else if(["add"].includes(B))A=["COLUMN","CONSTRAINT"],k="command";else if(["create","alter","drop"].includes(B))A=["TABLE","VIEW","FUNCTION","TRIGGER","SCHEMA","DATABASE","SYSTEM","EXTENSION","TYPE","COLUMN","ROLE","GROUP","USER"],k="command";else if(["system"].includes(B))A=["SET"],k="command";else if("insert"===B)A=["INTO"],k="command";else{if(null==C?void 0:C.trim().toLowerCase().endsWith("insert into"))return{suggestions:d.filter((e=>"table"===e.type)).map((e=>{var t;return e.label+=" ...",e.insertText+=` (${null===(t=e.cols)||void 0===t?void 0:t.map((e=>e.escaped_identifier)).join(", ")})`,e.kind=l.Snippet,e.sortText="public"===e.schema?"0a":"a",e}))};if("grant"===B||"revoke"===B)A=e,k="command";else if("extension"===B)k="extension";else if(!C.toLowerCase().includes("update")&&S&&(S.toLowerCase().includes("show ")||S.toLowerCase().includes("set ")))d=h,k="any";else if("to"===B&&S&&(S.toLowerCase().includes("grant ")||S.toLowerCase().includes("revoke ")))d=d.filter((e=>"role"===e.type)),k="any";else if("table"===B&&S&&S.toLowerCase().includes("create ")&&"createtable"===S.toLowerCase().replace(/\s/g,""))A=["IF NOT EXISTS"],k="command";else if("raise"===B)A=["NOTICE"],k="command";else if("delete"===B)A=["FROM"],k="command";else if(["order","group"].includes(B))A=["BY"],k="command";else{const e=P.map((e=>({k:e,p:N(e)}))).filter((e=>e.p>-1)).sort(((e,t)=>e.p-t.p));if(e[0])if(L=e[0].k,I=e[0].p,e[1]&&(O=e[1].k,D=e[1].p),"select"===L.toLowerCase()){const e=[";","SELECT","DROP","UPDATE","ALTER","DELETE","CREATE"].map((e=>({k:e,p:M(e)}))).filter((e=>e.p>-1)).sort(((e,t)=>e.p-t.p));e[0]&&(R=e[0].k,j=e[0].p),k="column"}else if(";"===L||"\n"===L)k="command";else if(["SET","WHERE","BY","ON"].includes(L.toUpperCase()))k="column";else if(["UPDATE","FROM","INTO","TABLE","COLUMN","JOIN","REFERENCES"].includes(L.toUpperCase())){const e=o.find((e=>e.label===(null==v?void 0:v.word)));if(e)return{suggestions:d.filter((t=>"table"===t.type&&t.schema===e.label)).map((e=>(e.insertText=e.label+" ",e)))};k=B!==L.toLowerCase()&&"references"!==B?"column":"table"}}}}else(null==C?void 0:C.trim())||(k="command");return A&&A.length?{suggestions:d.filter((e=>"keyword"===e.type&&A.find((t=>t.toLowerCase()===e.label.toLowerCase())))).map((e=>(e.sortText=(A.findIndex((t=>t.toLowerCase()===e.label.toLowerCase()))+"").padStart(5,"0")+"a",e.insertText=e.label+" ",e)))}:(d=d.map(((e,t)=>{var n,i;let r={...e};r.sortText="yy";const s=Vn.find((t=>t.label===e.label));if(s&&(r.sortText="xx",s.info&&(r.documentation={value:s.info})),"extension"===k&&e.type===k)r.sortText="a",z="a";else if("command"!==k||(null==s?void 0:s.start_kwd))if("command"===k&&(null==s?void 0:s.start_kwd))r.sortText="a",z="a";else if("column"===k&&["column","function"].includes(e.type)){const t="function"===e.type;if("public"===e.schema?r.sortText=t?"01b":"00b":r.sortText=t?"03b":"02b",e.escapedParentName)if(["select"].includes(null==L?void 0:L.toLowerCase())){let t=M(e.escapedParentName,!0);t>-1&&(!R||t<j)&&(r.sortText=`${t}`.padStart(6,"0")+"a")}else{let t=N(e.escapedParentName,!0);t>-1&&(!O||t<D)&&(r.sortText=`${t}`.padStart(6,"0")+"a")}}else if("table"!==k||"table"!==e.type&&"select"!==e.label.toLowerCase()){if("data type"===k&&"dataType"===e.type){const t=["numeric","integer","real","bigint","bool","geography","geometry","uuid","json","jsonb","text","tsvector","timestamp","timestamptz"];r.sortText=t.includes(null===(n=e.properties)||void 0===n?void 0:n.name)?"a":"b"===(null===(i=e.properties)||void 0===i?void 0:i.typtype)?"b":"c",z="b"}}else z="b",r.sortText="table"===e.type?"public"===e.schema?"0a":"a":"b";return r.filterText=r.label.toLowerCase(),"command"!==k&&"keyword"===e.type&&(r.filterText=r.label),"SELECT"===F&&""===T&&"column"===r.type&&(r.insertText=r.insertText+`$0\nFROM ${r.escapedParentName}\nLIMIT 200 `,r.label+=" ...",r.kind=l.Snippet),"function"===r.type||(r.insertText+=" "),r})),!y&&z&&(d=d.filter((e=>e.sortText<=z))),{suggestions:d})}})}({monaco:s,suggestions:o,settingSuggestions:a,sql:r})),s&&this.editor&&JSON.stringify(this.error||{})!==JSON.stringify(t||{})){this.error=t;const e=this.editor.getModel();if(t){let n={};if("number"==typeof t.position){let i=t.position-1||1,r=t.length||10;const s=this.editor.getSelection(),o=this.editor.getModel().getValueInRange(s);o&&(r=Math.max(1,Math.min(r,o.length)),i+=e.getOffsetAt({column:s.startColumn,lineNumber:s.startLineNumber}));const a=e.getPositionAt(i),l=e.getPositionAt(i+r);n={startLineNumber:a.lineNumber,startColumn:a.column,endLineNumber:l.lineNumber,endColumn:l.column},this.editor.setPosition(a),this.editor.revealLine(a.lineNumber),this.editor.revealLineInCenter(a.lineNumber)}s.editor.setModelMarkers(e,"test",[{severity:0,message:"error.message",startLineNumber:0,startColumn:0,endLineNumber:0,endColumn:5,code:"error.code",...t,...n}])}else s.editor.setModelMarkers(e,"test",[])}},this.onKeyDown=e=>{const{onStopQuery:t}=this.props;if("Escape"===e.key&&t)e.preventDefault(),t();else if(("F5"===e.key||(e.ctrlKey||e.altKey)&&"e"===e.key)&&this.editor&&this.editor._domElement&&this.editor._domElement.contains(e.target)){e.preventDefault();const t=ir(this.editor);this.props.onRun(t||this.editor.getValue(),Boolean(t))}},this.onChange=e=>{const{value:t="",onChange:n,debounce:i=300}=this.props;this.curVal=e,this.inDebounce&&window.clearTimeout(this.inDebounce),this.inDebounce=setTimeout((()=>{var t;n(e,null===(t=this.editor)||void 0===t?void 0:t.getPosition()),this.inDebounce=null}),i)}}componentDidMount(){document.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("beforeunload",(async e=>{await this.componentWillUnmount()}),!1),this.onUpdate()}componentDidUpdate(e){this.onUpdate(e)}async componentWillUnmount(){var e,t,n;document.removeEventListener("keydown",this.onKeyDown,!1),await(null===(t=(e=this.props).onUnmount)||void 0===t?void 0:t.call(e,this.editor,null===(n=this.editor)||void 0===n?void 0:n.getPosition()))}render(){const{value:e="",editorMounter:n}=this.state,{onMount:i}=this.props;return t.createElement("div",{className:"f-1 min-h-0 min-w-0 flex-col relative ",style:{opacity:n?void 0:0},onDragOver:e=>(e.preventDefault(),!1),onDrop:e=>{var t;let n=e.dataTransfer.getData("text");n&&(n=` ${n} `,null===(t=this.editor)||void 0===t||t.trigger("keyboard","type",{text:n}))}},t.createElement(Ji,{className:"f-1 min-h-0",language:"sql",value:e,overrideServices:tr,options:{parameterHints:{enabled:!window.isMobileDevice},fixedOverflowWidgets:!0,theme:nr,...tr},onMount:e=>{var t,n;i&&i({editor:e,getSelectedText:()=>ir(e)}),this.editor=e,e.onDidChangeModelContent((t=>{this.onChange(e.getValue())})),this.setState({editorMounter:!0});const{cursorPosition:r}=this.props;r&&!fT(r)&&(null===(t=this.editor)||void 0===t||t.setPosition(r),null===(n=this.editor)||void 0===n||n.revealLineInCenter(Math.max(-5+(r.lineNumber||1),1)))}}))}}class ProstglesQuickMenu extends RTComp{constructor(){super(...arguments),this.state={showChartMenu:!1,myLinks:[]},this.d={},this.onDelta=async()=>{var e,t;const{dbs:n,w:i}=this.props;if((null==i?void 0:i.workspace_id)&&n&&!this.d.linksSync){const r=await(null===(t=(e=n.links).sync)||void 0===t?void 0:t.call(e,{workspace_id:i.workspace_id},{handlesOnData:!0},((e,t)=>{var n;if(!this.mounted||!i)return;const r=e.filter((e=>[e.w1_id,e.w2_id].includes(i.id)));(null===(n=this.state.myLinks)||void 0===n?void 0:n.map((e=>e.id)).sort().join())!==(null==r?void 0:r.map((e=>e.id)).sort().join())&&this.setState({myLinks:r}),this.setData({links:e},{links:t})})));this.setData({linksSync:r},{linksSync:r})}},this.getMenu=()=>null}async onUnmount(){var e,t;await(null===(t=null===(e=this.d)||void 0===e?void 0:e.linksSync)||void 0===t?void 0:t.$unsync()),this.d.linksSync=void 0}render(){var e,n,i,r,s,o,a;const{w:l,setLinkMenu:c,tables:u,onAddChart:d}=this.props,{showChartMenu:h,myLinks:p}=this.state;if(!l||!p)return null;const f=null==u?void 0:u.find((e=>e.name===l.table_name)),m=Boolean(l&&l.table_name&&(null===(e=null==f?void 0:f.joins)||void 0===e?void 0:e.length))||!!p.length;let g,y=Boolean(null==f?void 0:f.columns.some((e=>"Date"===e.tsDataType||"geography"===e.udt_name||"geometry"===e.udt_name)));if("sql"===l.type){const e=l;y=Boolean((null===(n=null==e?void 0:e.options)||void 0===n?void 0:n.lastSQL)&&(null===(r=null===(i=null==e?void 0:e.options)||void 0===i?void 0:i.sqlResultCols)||void 0===r?void 0:r.some((e=>"timestamp"===e.udt_name||"timestamptz"===e.udt_name||"geography"===e.udt_name||"geometry"===e.udt_name))))}return f||m||y?(h&&y&&(g=t.createElement(AddChartMenu,{w:l,onAddChart:d})),t.createElement(t.Fragment,null,t.createElement("div",{className:"flex-row ai-center bg-gray-300 rounded b b-gray-300 h-fit w-fit m-auto",ref:e=>{e&&(this.ref=e)}},m&&t.createElement(Btn,{title:"Cross filter tables",className:"prostgles-link-btn",size:"small",iconPath:"M9,5C10.04,5 11.06,5.24 12,5.68C12.94,5.24 13.96,5 15,5A7,7 0 0,1 22,12A7,7 0 0,1 15,19C13.96,19 12.94,18.76 12,18.32C11.06,18.76 10.04,19 9,19A7,7 0 0,1 2,12A7,7 0 0,1 9,5M15,7L14,7.11C15.28,8.41 16,10.17 16,12C16,13.83 15.28,15.59 14,16.9L15,17A5,5 0 0,0 20,12A5,5 0 0,0 15,7M8.5,12C8.5,13.87 9.29,15.56 10.56,16.75L11.56,16.29C10.31,15.29 9.5,13.74 9.5,12C9.5,10.26 10.31,8.71 11.56,7.71L10.56,7.25C9.29,8.44 8.5,10.13 8.5,12Z",style:p.length?{color:null===(o=null===(s=null==p?void 0:p[0])||void 0===s?void 0:s.options)||void 0===o?void 0:o.color}:{},onClick:async e=>{c({w:l,anchorEl:e.target})}}),y&&t.createElement(Btn,{title:"Add chart",className:"prostgles-chart-btn",size:"small",iconPath:"M7.2,11.2C8.97,11.2 10.4,12.63 10.4,14.4C10.4,16.17 8.97,17.6 7.2,17.6C5.43,17.6 4,16.17 4,14.4C4,12.63 5.43,11.2 7.2,11.2M14.8,16A2,2 0 0,1 16.8,18A2,2 0 0,1 14.8,20A2,2 0 0,1 12.8,18A2,2 0 0,1 14.8,16M15.2,4A4.8,4.8 0 0,1 20,8.8C20,11.45 17.85,13.6 15.2,13.6A4.8,4.8 0 0,1 10.4,8.8C10.4,6.15 12.55,4 15.2,4Z",style:{},onClick:async e=>{this.setState({showChartMenu:!0})}}),f&&t.createElement(Btn,{title:"Show/Hide filtering",className:"prostgles-filter-btn",size:"small",iconPath:Re,color:(null===(a=l.filter)||void 0===a?void 0:a.some((e=>{var t;return!e.disabled||"not null"===e.type||"null"===e.type||(sT(e)?void 0!==(null===(t=e.filter)||void 0===t?void 0:t.value):void 0!==e.value)})))?"action":void 0,style:{},onClick:async e=>{var t;const n=l;n.$update({options:{showFilters:!(null===(t=null==n?void 0:n.options)||void 0===t?void 0:t.showFilters)}},{deepMerge:!0})}})),g&&t.createElement(Popup,{open:!0,title:"Add chart",anchorEl:this.ref,positioning:"inside",rootStyle:{padding:0},clickCatchStyle:{opacity:.5,backdropFilter:"blur(1px)"},contentClassName:"",onClose:()=>{this.setState({showChartMenu:!1})}},g))):null}}class Window extends RTComp{constructor(){super(...arguments),this.state={showMenu:!1},this.d={},this.onDelta=e=>{var t,n,i,r,s;const{w:o}=this.d,{onWChange:a}=this.props;if(this.ref&&o){const e=null!==(i=null===(n=null===(t=this.ref)||void 0===t?void 0:t.parentElement)||void 0===n?void 0:n.querySelector(":scope > .silver-grid-item-header > div > .silver-grid-item-header--title"))&&void 0!==i?i:void 0,r=o.name||o.table_name||o.id||"Empty";e&&e.innerText!==r&&(e.innerText=r,e.title=r)}if((null==e?void 0:e.onWChange)&&(null===(r=this.d)||void 0===r?void 0:r.w)&&(null==a||a(this.d.w,this.d.w)),(null===(s=this.props)||void 0===s?void 0:s.w)&&!this.d.wSync){let e=this.props.w.$cloneSync(((e,t)=>{const n=e;this.setData({w:n},{w:t}),null==a||a(n,t),this.setState({w:n})}));this.setData({wSync:e})}},this.onUnmount=async()=>{var e,t;await(null===(t=null===(e=this.d)||void 0===e?void 0:e.wSync)||void 0===t?void 0:t.$unsync()),this.d.wSync=void 0}}getTitleIcon(){const{quickMenuProps:e}=this.props,{w:n}=this.d;if(!e)return null;const{setLinkMenu:i,dbs:r,tables:s,onAddChart:o}=e;return i?t.createElement(ProstglesQuickMenu,{tables:s,w:n,dbs:r,setLinkMenu:i,onAddChart:o}):null}render(){var e,n;const{children:i,getMenu:s}=this.props,{showMenu:o}=this.state,{w:a}=this.state;if(!a)return null;let l;const c=null===(n=null===(e=this.ref)||void 0===e?void 0:e.parentElement)||void 0===n?void 0:n.querySelector(":scope > .silver-grid-item-header > .silver-grid-item-header--icon");s&&c&&(l=r.createPortal(t.createElement(t.Fragment,null,t.createElement(Btn,{className:"f-0",iconPath:"M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z",title:"Open menu",onClick:()=>{this.setState({showMenu:!o})}}),this.getTitleIcon()),c));const u=()=>{this.setState({showMenu:!1})};return t.createElement(t.Fragment,null,l,t.createElement("div",{key:a.id+"-content",className:"flex-col f-1 min-h-0 min-w-0",ref:e=>{if(e){let t;this.ref||(t=!0),this.ref=e,t&&this.forceUpdate()}}},t.createElement(ErrorTrap,null,i)),o&&s&&t.createElement(Popup,{open:!0,anchorEl:this.ref,positioning:"inside",rootStyle:{padding:0},clickCatchStyle:{opacity:.5,backdropFilter:"blur(1px)"},contentClassName:"",onClose:u},t.createElement(ErrorTrap,null,s(a,u))))}}const rr="Your prostgles account is not allowed to run SQL";class ProstglesSQL extends RTComp{constructor(){var e;super(...arguments),this.state={runningQuery:!1,sql:"",loading:!1,totalRows:0,sort:[],joins:[],filter:{},rowCount:0,duration:0,error:"",hideTable:!0,onRowClick:null,commandResult:""},this.d={page:1,pageSize:null!==(e=zC(Math.round(1.2*window.innerHeight/55)||25,FC))&&void 0!==e?e:15,w:void 0,dataAge:0,wSync:void 0},this.calculatedColWidths=!1,this.saveFunc=e=>{"s"===e.key&&e.ctrlKey&&document.activeElement&&this.editorContainer&&this.editorContainer.contains(document.activeElement)&&(e.preventDefault(),this.saveQuery())},this.loadingData=!1,this.currentDataRequestSignature="",this.dataAge=0,this.onDelta=async(e,t,n)=>{var i,r,s,o;const a={...e,...t,...n},{db:l,onClose:c}=this.props,{w:u,pageSize:d}=this.d||{};let h,{table_name:p,table_oid:f,sort:m,filter:g}=u||{},y=m;u&&(Array.isArray(y)||(y=[]),l&&(a.db||!this.state.cols||hT(a,"w.columns"))&&(h={cols:[],onSort:async e=>this.setState({sort:e}),joins:[],loading:!1}),(null===(i=null==a?void 0:a.w)||void 0===i?void 0:i.options)&&"hideTable"in(null===(r=null==a?void 0:a.w)||void 0===r?void 0:r.options)&&(h=h||{}),h||!(null===(s=null==a?void 0:a.w)||void 0===s?void 0:s.sql)||(null===(o=a.w.options)||void 0===o?void 0:o.sqlChanged)||this.forceUpdate(),h&&(p&&(h.runningQuery=!1),this.setState(h)))},this.killQuery=async()=>{const{db:e}=this.props;if(e&&this._queryHashAlias&&e.sql){const t=`SELECT pg_terminate_backend(pid) \nFROM pg_stat_activity WHERE query ilike '${this._queryHashAlias}%' OR query = $1`;console.log("killQuery...",await e.sql("SELECT query, query ilike '${this._queryHashAlias}%' OR query = $1 FROM pg_stat_activity",[this.hashedSQL],{returnType:"rows"}),this.hashedSQL),console.time("killQuery");const n=await e.sql(t,[this.hashedSQL]);console.timeEnd("killQuery"),console.log("killQuery...",n)}return!0},this.noticeEventListener=e=>{const{notices:t=[]}=this.state;this.setState({notices:[{...e,received:(new Date).toISOString().replace("T"," ")},...t]})},this.notifEventListener=e=>{const{rows:t=[]}=this.state;this.setState({rows:[[e,(new Date).toISOString().replace("T"," ")],...t]})},this.runSQL=async(e,t)=>{var n,i,r,s,o,a,l,c,u;if(void 0===e&&(e=null!==(r=this.state.selected_sql||(null===(i=null===(n=this.d)||void 0===n?void 0:n.w)||void 0===i?void 0:i.sql))&&void 0!==r?r:""),void 0===t&&(t=[]),this.state.runningQuery)return;this.setState({runningQuery:!0});const{db:d}=this.props,{queryStartDate:h=new Date}=this.state,p=null===(s=this.d)||void 0===s?void 0:s.w;if(!p||!d.sql)return void this.setState({error:d.sql?"Internal error (w is missing). Try refreshing the page":rr});let f=e.trimEnd(),m=!1;const g=`${e}`.trim().toLowerCase(),y=["select","update","insert","delete","create","drop","show","notify","listen"].find((e=>g.startsWith(e+" ")));if(y)m="select"===y;else try{if(e)try{const t=await d.sql("EXPLAIN "+e);m="SELECT"===t.command}catch(e){m=!1,console.error(e)}}catch(e){console.error({error:e})}m&&f.endsWith(";")&&(f=f.slice(0,-1));this.getPagination();let v;this.hashedSQL=e,null===(a=null===(o=this.state.notifEventSub)||void 0===o?void 0:o.removeListener)||void 0===a||a.call(o);let b={runningQuery:!1,queryStartDate:void 0};try{const n=p.options||{};n&&n.hideTable&&p.$update({options:{...n,hideTable:!1}}),"number"!=typeof p.limit&&p.$update({limit:100});const i=p.limit||100;this.setState({sqlError:void 0});let r=f;if(m){this.hashedSQL=` SELECT * FROM (\n ${r} \n ) t LIMIT 0`;const{fields:e}=await d.sql(this.hashedSQL),n=(t||[]).filter((t=>e[t.key])).map((e=>`${e.key+1}`+([1,!0].includes(e.asc)?" ASC ":" DESC "))).join(", ")||" TRUE ";try{await d.sql(` SELECT * FROM (\n ${r} \n ) t ORDER BY ${n} LIMIT 0`),r=` SELECT * FROM (\n ${r} \n ) t ORDER BY ${n} LIMIT ${i}`}catch(e){return r=` SELECT * FROM (\n ${r} \n ) t LIMIT ${i}`,p.$update({sort:[]}),void this.setState({error:e})}}this._queryHashAlias="--prostgles-"+function(e,t,n){var i,r,s=void 0===n?2166136261:n;for(i=0,r=e.length;i<r;i++)s^=e.charCodeAt(i),s+=(s<<1)+(s<<4)+(s<<7)+(s<<8)+(s<<24);if(t)return("0000000"+(s>>>0).toString(16)).substr(-8);return s>>>0}(r+Date.now(),!0),this.hashedSQL=this._queryHashAlias+" \n"+r;let s="";this.setState({queryStartDate:new Date});const o=await d.sql(this.hashedSQL,void 0,{returnType:"arrayMode",allowListen:!0});let a=[],h=[],g=.001,y="LISTEN",w=0;if(m=m||"SELECT"===y,"addListener"in o){const e={dataType:"json",format:"json",udt_name:"json",tsDataType:"any"};h=[{...e,name:"payload"},{...e,name:"received"}],a=[],v=await o.addListener((e=>(console.log(e),this.notifEventListener(e))))}else({rows:a,fields:h,duration:g=.001,command:y,rowCount:w}=o),h&&h.length||(s=`${y} command finished successfully!  ${null!==(l=o.rowCount)&&void 0!==l?l:0} rows affected`);const x={...b,loading:!1,onRowClick:null,sqlError:void 0,rowCount:null!=w?w:a.length,sql:e,rows:a,duration:g,commandResult:s,notifEventSub:v,sqlResult:!0,sort:t,queryEnded:Date.now(),cols:h.map(((e,t)=>({...e,idx:t,key:e.name,subLabel:e.dataType,sortable:m&&!["xml","json"].includes(e.dataType)})))},_=a.map((e=>e.reduce(((e,t,n)=>({...e,[n]:t})),{})));x.cols=(null===(c=x.cols)||void 0===c?void 0:c.length)?ProstglesTable.getColWidth(x.cols,_,"idx",null===(u=this.ref)||void 0===u?void 0:u.getBoundingClientRect().width):[],this.setState(x),p.$update({options:{sqlResultCols:x.cols,lastSQL:m?f:""}},{deepMerge:!0})}catch(t){console.error(t);let n=hT(t,"err_msg");"error: syntax error at end of input"===n&&(n+="\nHint: more commands expected at end of query");const i=hT(t,"err.hint"),r=hT(t,"err.detail"),s=hT(t,"err.where");n+=(i?" \n "+i:"")+(r?" \n "+r:"")+(s?" \n where: "+s:""),this.setState({...b,notifEventSub:void 0,rows:[],cols:[],commandResult:"",duration:Math.min(1e-5,Date.now()-+h),sort:[],queryEnded:Date.now(),sqlError:{message:n,position:+hT(t,"err.position")-(this.hashedSQL||"").indexOf(e.trimEnd().slice(0,-1)),length:+hT(t,"err.length")},sqlResult:!1}),p.$update({options:{sqlResultCols:[]}},{deepMerge:!0})}},this.getSelectedText=()=>""}async onMount(){const{db:e,dbs:t,w:n}=this.props;if(e&&!this.d.wSync){let e=n.$cloneSync(((e,t)=>{this.setData({w:e},{w:t})}));this.setData({wSync:e})}window.addEventListener("keydown",this.saveFunc,!1)}async onUnmount(){var e,t,n,i,r,s,o;window.removeEventListener("keydown",this.saveFunc,!1),null===(n=null===(t=null===(e=this.d)||void 0===e?void 0:e.wSync)||void 0===t?void 0:t.$unsync)||void 0===n||n.call(t);const{notifEventSub:a,noticeSub:l}=this.state;null===(i=null==a?void 0:a.removeListener)||void 0===i||i.call(a),null===(r=null==l?void 0:l.removeListener)||void 0===r||r.call(l),await(null===(o=null===(s=this.dataSub)||void 0===s?void 0:s.unsubscribe)||void 0===o?void 0:o.call(s))}saveQuery(){var e;this.d&&this.d.w&&(null===(e=this.d.w.sql)||void 0===e?void 0:e.trim())&&sr(this.d.w.sql,`${this.d.w.name||"Query"}.sql`,"text/sql")}static getDataRequestSignature(e){if("sql"in e)return e.sql;const{filter:t,select:n,limit:i,offset:r}=e;return JSON.stringify({filter:t,select:n,limit:i,offset:r})}getPagination(){const{pageSize:e,page:t}=this.d;return{limit:e,offset:(t-1)*e}}render(){var e,n,i,r;const{loading:s,totalRows:o,duration:a,rowDelta:l,rows:c=[],rowCount:u,joins:d,cols:h,popup:p,runningQuery:f,sqlError:m,sqlResult:g,sort:y,commandResult:v,queryStartDate:b,filterPopup:w,notifEventSub:x,notices:_,noticeSub:E,queryEnded:S,error:C}=this.state,{page:T,pageSize:A,w:k}=this.d,{db:N,onAddChart:M,dbs:P,suggestions:L,tables:O,setLinkMenu:R}=this.props;if(s||!k||!N)return t.createElement(Loading,{className:"m-auto"});const I=h||[],D=k.options||{},F=(e,t={})=>{var n,i,r;let s={...(null===(r=null===(i=null===(n=this.d)||void 0===n?void 0:n.w)||void 0===i?void 0:i.$get())||void 0===r?void 0:r.options)||{},...e};k.$update({...t,options:s},{deepMerge:!0})},B=t.createElement(t.Fragment,null,t.createElement("div",{className:"flex-col f-1 min-h-0 min-w-0 ",ref:e=>{e&&(this.ref=e)}},t.createElement("div",{ref:e=>{e&&(this.editorContainer=e)},className:"f-1 min-h-0 min-w-0 flex-col relative pt-1"},C&&t.createElement(ErrorComponent,{error:C}),t.createElement(SQLEditor,{value:null!==(n=null===(e=this.d.w)||void 0===e?void 0:e.sql)&&void 0!==n?n:"",sql:N.sql,suggestions:L,onMount:({editor:e,getSelectedText:t})=>{this.getSelectedText=t},onUnmount:(e,t)=>{F({cursorPosition:t})},cursorPosition:null===(r=null===(i=this.d.w)||void 0===i?void 0:i.options)||void 0===r?void 0:r.cursorPosition,onChange:(e,t)=>{var n;if(!this.d.w)throw new Error("this.d.w missing");let i={sql:e},r=this.d.w.options||{};r.sqlChanged||(r.sqlChanged=!0),r={...r,cursorPosition:t},i.options=r,null===(n=this.d.w)||void 0===n||n.$update(i,{deepMerge:!0}),m&&this.setState({sqlError:void 0})},onRun:async(e,t)=>{this.setState({selected_sql:t?e:""}),await this.runSQL(e)},onStopQuery:this.killQuery,error:m,getFuncDef:N.sql?(e,t)=>Bn({db:N,name:e,minArgs:t}):void 0}),t.createElement("div",{className:"flex-row p-p5 text-gray-400 ai-center text-sm o-auto",style:{borderTop:"1px solid #0000000d"}},b?t.createElement(t.Fragment,null,t.createElement(Btn,{title:"Kill query (Esc)",iconPath:Ye,onClick:this.killQuery}),t.createElement(Counter,{className:"p-p5 mr-1 noselect",title:"Query running time",from:b})):t.createElement(t.Fragment,null,x?t.createElement(Btn,{title:"Stop LISTEN",iconPath:Ye,onClick:async()=>{await x.removeListener(),this.setState({notifEventSub:void 0})},fadeIn:!0}):t.createElement(Btn,{title:"Run query (CTRL + E)",disabledInfo:N.sql?void 0:rr,iconPath:"M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M10,16.5L16,12L10,7.5V16.5Z",onClick:()=>this.runSQL(),fadeIn:!0}),!m&&t.createElement("div",{className:"p-p5 mr-1 noselect fade-in",title:"Query running time"},x?"LISTEN...":`${(a/1e3).toFixed(3)||0}s`)),!m&&t.createElement("div",{ref:e=>{e&&(this.refRowCount=e)},className:" p-p5 noselect",style:{marginRight:"1em"}},u," rows"),t.createElement(ErrorComponent,{error:hT(m,"message"),style:{padding:0}}),t.createElement("div",{className:"ml-auto p-p5 flex-row ai-center",style:{marginRight:"1em"}},t.createElement("div",{className:"mr-p5"},"limit"),t.createElement("input",{id:"dd"+k.limit,type:"number",style:{width:"55px"},defaultValue:k.limit,onChange:e=>{k.$update({limit:+e.target.value})}})),t.createElement(Btn,{title:"Show/Hide table",iconPath:Xe,className:"mr-1",onClick:e=>{var t;const n=null!==(t=this.d.w.options)&&void 0!==t?t:{};n.hideTable&&!u?this.refRowCount&&(this.refRowCount.classList.remove("rubberBand"),this.refRowCount.offsetWidth,this.refRowCount.classList.add("rubberBand")):k.$update({options:{...n,hideTable:!n.hideTable}})}}),t.createElement(Btn,{title:"Show/Hide notices",iconPath:xe,color:E?"action":void 0,className:"mr-1",disabledInfo:N.sql?void 0:rr,onClick:async e=>{if(E)await E.removeListener(),this.setState({notices:void 0,noticeSub:void 0});else if(N.sql){const e=(await N.sql("",{},{returnType:"noticeSubscription"})).addListener(this.noticeEventListener);this.setState({noticeSub:e})}}}))),t.createElement("div",{className:"flex-col oy-auto relative bt b-gray-300 "+(v?" f-0 ":" f-1 ")+(D.hideTable&&!_&&!x||f||!S||!(null==c?void 0:c.length)&&!g?" hidden ":"")},f?t.createElement(Loading,{variant:"cover"}):null,_?t.createElement("div",{className:"p-1 ws-pre text-gray-600"},_.slice(0).map((e=>JSON.stringify(e,null,2))).join("\n")):v?t.createElement("div",{className:"p-1 text-gray-400"},v):t.createElement(Table,{maxCharsPerCell:1e3,sort:y,onSort:e=>{this.runSQL(void 0,e)},showSubLabel:!0,cols:I.map(((e,t)=>({...e,key:t,label:e.name,filter:!1,onResize:async t=>{const n=I.map((n=>(n.key===e.key&&(n.width=t),n)));this.setState({cols:n})}}))),rows:c,style:{flex:1,boxShadow:"unset"},tableStyle:{borderRadius:"unset",border:"unset"},pagination:{page:T,pageSize:A,totalRows:o,onPageChange:e=>{console.log(e),this.setData({page:e})},onPageSizeChange:e=>{this.setData({pageSize:e})}}}))),p?t.createElement(Popup,{rootStyle:p.style,anchorEl:p.anchorEl,positioning:p.positioning,clickCatchStyle:{opacity:0},onClose:()=>{this.setState({popup:void 0})},open:!0,contentClassName:""},p.content):null);return t.createElement(Window,{w:k,quickMenuProps:{dbs:P,onAddChart:M,tables:O,setLinkMenu:R},getMenu:e=>t.createElement(ProstglesSQLMenu,{db:N,dbs:P,onAddChart:M,w:e,joins:d})},B)}}function sr(e,t,n){var i=new Blob([e],{type:n});const r=window.navigator;if(r.msSaveOrOpenBlob)r.msSaveOrOpenBlob(i,t);else{let e=document.createElement("a"),n=URL.createObjectURL(i);e.href=n,e.download=t,document.body.appendChild(e),e.click(),setTimeout((function(){document.body.removeChild(e),window.URL.revokeObjectURL(n)}),0)}}class Counter extends RTComp{constructor(){super(...arguments),this.state={sec:0}}onMount(){const{from:e}=this.props;setInterval((()=>{this.mounted&&this.setState({sec:Math.round((Date.now()-+e)/1e3)})}),1e3)}render(){const{sec:e}=this.state,{className:n,title:i}=this.props;return t.createElement("div",{title:i,className:"text-gray-400 "+n},e,"s")}}class ProstglesSQLMenu extends RTComp{constructor(){super(...arguments),this.state={l1Key:void 0,l2Key:void 0,query:void 0,running:void 0,error:void 0,initError:void 0,hint:void 0,indexes:void 0,columnsConfig:void 0,infoQuery:void 0,autoRefreshSeconds:void 0},this.d={w:void 0},this.onUnmount=async()=>{this.wSub&&await this.wSub.$unsync()},this.loading=!1,this.onDelta=async(e,t,n)=>{const i=this.d.w||this.props.w;(null==i?void 0:i.$cloneSync)&&!this.loading&&(this.loading=!0,this.wSub=await i.$cloneSync(((e,t)=>{this.setData({w:e},{w:t})}))),t&&"query"in t&&this.setState({error:void 0})},this.saveQuery=async()=>{var e,t;const n=this.props.w,i=(null===(e=null==n?void 0:n.$get())||void 0===e?void 0:e.sql)||"";sr(i,((null===(t=null==n?void 0:n.$get())||void 0===t?void 0:t.name)||`Query_${await async function(e){const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t),i=Array.from(new Uint8Array(n));return i.map((e=>e.toString(16).padStart(2,"0"))).join("")}(i)}`)+".sql","text/sql")}}render(){const{onAddChart:e,w:n}=this.props,{l1Key:i,initError:r}=this.state;if(r)return t.createElement("div",{className:"p-1"},t.createElement(ErrorComponent,{error:r}));if(!n)return null;const s=AddChartMenu.getChartCols(n),o={leftIconPath:Se,disabledText:s.dateCols.length||s.geoCols.length?void 0:"No date or geo columns to chart",content:t.createElement("div",{className:"text-gray-800 noselect flex-row ai-center"},t.createElement(AddChartMenu,{w:n,onAddChart:t=>{var n;e(t),null===(n=this.d.w)||void 0===n||n.$update({show_menu:!1})}}))},a={Query:{leftIconPath:Oe,content:t.createElement("div",{className:"flex-col ai-start"},t.createElement(FormField,{label:"Edit name",className:"ml-1 mb-1",value:n.name,asColumn:!0,type:"text",onChange:e=>{n.$update({name:e,options:{...n.options||{},sqlWasSaved:!0}},{deepMerge:!0})}}),t.createElement(Btn,{title:"Save query as file",iconPath:"M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z",onClick:this.saveQuery},"Save query as file"),t.createElement("label",{title:"Open SQL file",htmlFor:"sql-open",className:"f-0 bg-transparent p-p5 bg-active-hover text-gray-400 undefined round pointer ml-p5 mt-1 flex-row ai-center"},t.createElement(tt(),{size:1,path:Oe}),t.createElement("input",{id:"sql-open",name:"sql-open",title:"Open query from file",type:"file",accept:"text/*, .sql, .txt",style:{display:"none"},onChange:e=>{e.currentTarget.files&&e.currentTarget.files[0]&&or(e.currentTarget.files[0]).then((e=>{n.$update({sql:e,show_menu:!1})}))}}),t.createElement("div",{className:" text-gray-500  ml-p5",style:{fontWeight:500,fontSize:".875rem"}},"Open SQL file")))},"Add chart":o,Delete:{leftIconPath:Me,content:t.createElement("div",{className:"flex-col ai-start"},t.createElement(Btn,{title:"Delete this query",color:"danger",iconPath:Me,onClick:()=>{n.$update({closed:!0,deleted:!0})}},"Delete query"))}};return t.createElement("div",{className:"table-menu c--fit flex-row",style:{maxHeight:"100vh",maxWidth:"100vw"}},t.createElement(Tabs,{variant:"vertical",contentClass:" o-auto min-h-0 max-h-100v "+("Alter"===i?" ":" p-1"),items:a,compactMode:!0,activeKey:i}))}}function or(e){return new Promise(((t,n)=>{var i=new FileReader;i.addEventListener("load",(function(e){e.target?t(e.target.result):n("e.target is null")})),i.readAsBinaryString(e)}))}const ar=e=>(e=>{let t="";const n=e.trim().split("");return n.map(((e,i)=>{!i||"_"===t.slice(-1)||n[i-1].match(/[A-Z]/)&&!e.match(/[\W_]+/)||(t+="_"),e.match(/[\W_]+/)||(t+=e.toLowerCase())})),t})(e),lr=["Single text value","JSONB Rows","Properties with Geometry"];class FileImporter extends RTComp{constructor(){super(...arguments),this.state={streamColumnDataType:"TEXT",streamBatchMb:10,insertAs:"JSONB Rows",bytesPerRow:0,config:{header:!0},destination:{newTable:!0,newTableName:void 0,existingTable:void 0},open:!0,reCreateTable:!1,headerType:"First row",results:void 0,colNo:"",streamColDelimiter:"_$_"},this.getExitMessage=()=>this.isImporting?`Currently importing into table ${this.isImporting.table}. Data might be lost`:void 0,this.onBeforeUnload=e=>{const t=this.getExitMessage();if(t)return(e||window.event).returnValue=t,t},this.onDelta=async(e,t,n)=>{const{selectedFile:i}=this.state,{db:r,tables:s}=this.props,o={...e,...t,...n};window.__prglIsImporting=Boolean(this.state.importing),i&&o&&(o.customHeaders||o.headerType)},this.rowsToJson=e=>{const{config:t,headerType:n,customHeaders:i=""}=this.state,r={...e},s=r.data;let o=[],a=[];if(s&&s.length)if("Custom"===n){const e=Object.keys(r.data[0]),t=new Array(e.length).fill(null).map(((e,t)=>`c${t+1}`)).join(", ");i||this.setState({customHeaders:t});const n=i.split(", ").map((e=>e.trim()));let l={colNo:` (${e.length})`,customHeadersError:""};e.length!==n.length?l.customHeadersError="Extra/missing column names":Array.from(new Set(n)).length!==n.length?l.customHeadersError="Duplicate column names":(o=n.map((e=>({key:e,label:e,dataType:"text",escapedName:(0,Xn.asName)(e),sortable:!1}))),a=s.map((e=>{let t={};return(Array.isArray(e)?e:Object.values(e)).map(((e,i)=>{t[n[i]]=e})),t}))),this.setState(l)}else"First row"===n?(o=r.meta.fields.map((e=>({key:e,label:e,dataType:"text",escapedName:(0,Xn.asName)(e),sortable:!1}))),a=r.data):(o=new Array(s[0].length).fill(null).map(((e,t)=>({key:`c${t}`,label:`Column ${t}`,dataType:"text",escapedName:(0,Xn.asName)(`c${t}`),sortable:!1}))),a=s.map((e=>{let t={};return e.map(((e,n)=>{t[`c${n}`]=e})),t})));return{cols:o,rows:a}},this.parseFiles=async e=>{let t=[];for await(const n of e){this.setState({loadingFileName:n.name,importing:void 0});const e=await or(n);t.push({fileName:n.name,content:e})}return this.setState({loadingFileName:void 0}),t},this.setFiles=async e=>{if(e.length>1){const t=["txt","svg","html","json"],n=Array.from(e);if(n.every((e=>t.find((t=>e.name.toLowerCase().endsWith(`.${t}`)))&&e.size<1e6))){this.setState({files:e});const t=await this.parseFiles(n.slice(0,40));this.setState({files:n,multiImport:t,selectedFile:{file:n[0],type:"csv",rowsPerBatch:1e3,preview:{cols:[{key:"fileName",dataType:"TEXT",escapedName:"fileName",label:"fileName",sortable:!1},{key:"content",dataType:"TEXT",escapedName:"content",label:"content",sortable:!1}],rows:t.slice(0,40)}},loadingFileName:void 0})}else alert(`Multi import is only allowed for text files (${t}) less than 1Mb each`)}else e.length&&this.setFile(e[0])},this.setFile=e=>{const t=e.name.toLowerCase(),n=t.endsWith(".geojson")?"geojson":t.endsWith(".json")?"json":"csv",{headerType:i,customHeaders:r,streamColumnDataType:s,streamBatchMb:o}=this.state;this.setState({loadingFileName:e.name,importing:void 0});if(e.size>5e7){let t=[];hr(e,o,((i,r)=>{t=t.concat(i),t.length>100&&(t=t.map(((e,t)=>({id:t+1,value:e}))),r.abort(),this.setState({loadingFileName:void 0,selectedFile:{fileTooBig:!0,file:e,type:n,rowsPerBatch:10,preview:{rows:t,cols:[{key:"id",label:"id",dataType:"BIGSERIAL",subLabel:"BIGSERIAL",sortable:!1,escapedName:"id",width:50},{key:"value",label:"value",dataType:s,subLabel:s,sortable:!1,escapedName:"value"}]}}}))}),console.log,this.state.streamColDelimiter)}else if(n.endsWith("json"))(async function(e){let t="json";const n=await or(e),i=JSON.parse(n);let r,s=[],o={},a=0;const l=e=>{const t=e=>"number"==typeof e?"numeric":"text";dT(e).map((n=>{const i=t(e[n]),r=o[n];(!r||"numeric"===r&&"text"===i)&&(o[n]=i)}))};if("FeatureCollection"===i.type&&i.features&&Array.isArray(i.features)){t="geojson",o={geometry:"geometry"};let e=!1;i.features.map(((t,n)=>{if("Feature"!==t.type)console.warn(`Could not import feature number ${n}. Feature.type is not "Feature"`,t);else{let n=t.properties;e=e||void 0!==t.id,e&&(n={...n,dI:t.id}),l(n)}}));const n=dT(o);s=i.features.map(((t,i)=>{var s,o,l,c,u;if("Feature"===t.type){r=r||(null===(u=null===(c=null===(l=null===(o=null===(s=t.geometry)||void 0===s?void 0:s.crs)||void 0===o?void 0:o.type)||void 0===l?void 0:l.name)||void 0===c?void 0:c.properties)||void 0===u?void 0:u.name)||"EPSG:4326";let i={};return n.map((n=>{var r,s,o;"id"===n&&e?i[n]=null!==(r=t.id)&&void 0!==r?r:null:"geometry"===n?i[n]=null!==(s=t.geometry)&&void 0!==s?s:null:t.properties&&(i[n]=null!==(o=t.properties[n])&&void 0!==o?o:null)})),a=Math.max(a,JSON.stringify(i).length),i}console.warn(`Could not import feature number ${i}. Feature.type is not "Feature"`,t)}))}else if(Array.isArray(i)){i.forEach((e=>{l(e)}));const e=Object.keys(o);s=i.map((t=>(e.map((e=>{var n;t[e]=null!==(n=t[e])&&void 0!==n?n:null})),a=Math.max(a,JSON.stringify(t).length),t)))}return{type:t,rows:s,srid:r,cols:Object.keys(o).map((e=>({key:e,escapedName:(0,Xn.asName)(e),dataType:o[e]}))),rowsPerBatch:cr(a)}})(e).then((({rows:t,cols:n,srid:i,type:r,rowsPerBatch:s})=>{this.setState({loadingFileName:void 0,selectedFile:{file:e,type:r,srid:i,rowsPerBatch:s,preview:{allRows:t,cols:n.map((e=>({...e,label:e.key,subLabel:e.dataType,sortable:!1}))),rows:t.slice(0,50).map((e=>({...e})))}}})})).catch((e=>{this.setState({error:e})}));else{const{config:t}=this.state;try{const n=!("First row"===i)&&r;(async function(e,t){return new Promise((async(n,i)=>{try{Yn().parse(e,{header:!1,worker:!0,preview:4,skipEmptyLines:!0,complete:({data:r})=>{let s=!0;const o=r[0],a=r[1];(null==r?void 0:r.length)?(s=o.some(((e,t)=>{if(!a)return!1;const n=yT(e).map((e=>e.type)).join(),i=yT(a[t]).map((e=>e.type)).join();return e&&n!==i})),Yn().parse(e,{...t,header:s,worker:!0,skipEmptyLines:!0,complete:async e=>{var t;let r=e.data||[];if(r.length){let e=[];const t=r[0].length;r=r.filter(((n,i)=>n.length===t||(e.push({row_number:i,row_value:n}),!1))),e.length&&console.error("Some rows have been ommited due to the number of columns not coinciding with first row:",e)}let o=[];if(s)o=((null===(t=e.meta)||void 0===t?void 0:t.fields)||[]).map((e=>({key:e,dataType:"text",escapedName:(0,Xn.asName)(e)})));else{if(!r.length)return void i("Could not import: No data to import");o=r[0].map(((e,t)=>({key:`c${t+1}`,dataType:"text",escapedName:(0,Xn.asName)(`c${t+1}`)}))),r=r.map((e=>o.reduce(((t,n,i)=>({...t,[n.key]:e[i]})),{})))}let a=0;r.map((e=>{a=Math.max(a,JSON.stringify(e).length)})),n({rows:r,cols:o,rowsPerBatch:cr(a)})}})):i("File is empty or could not be parsed")}})}catch(e){i(e)}}))})(e,{...t,header:!n}).then((({rows:t,cols:i,rowsPerBatch:s})=>{const o=n?r.split(",").map((e=>{const t=e.trim();return{key:t,dataType:"text",escapedName:(0,Xn.asName)(t)}})):i;this.setState({loadingFileName:void 0,selectedFile:{file:e,type:"csv",rowsPerBatch:s,preview:{allRows:t,cols:o.map((e=>({...e,label:e.key,subLabel:e.dataType,sortable:!1}))),rows:t.slice(0,50).map((e=>({...e})))}}})})).catch((e=>{this.setState({error:e})}))}catch(e){console.error(e)}}},this.createTable=()=>{const{selectedFile:e,config:t,destination:n,reCreateTable:i,insertAs:r}=this.state;return new Promise((async(t,r)=>{try{if(!(null==e?void 0:e.preview))throw"selectedFile missing";const{db:r}=this.props;if(!r||!r.sql)throw"Cannot create new table";let s=n.newTableName||e.file.name;const o=await r.sql("$1:name",[s],{returnType:"statement"});i&&r[s]&&await r.sql("DROP TABLE IF EXISTS "+o);const a="CREATE TABLE "+o+" ( \n";let l=e.preview.cols;const c=a+l.map(((e,t)=>e.escapedName+" "+e.dataType)).join(",\n")+" \n);",u=l.filter((e=>"BIGSERIAL"!==e.dataType)).map(((e,t)=>e.escapedName)),d=await r.sql("INSERT INTO "+o+" (${colTypes:raw}) VALUES ",{colTypes:u.join(", ")},{returnType:"statement"});let h=await r.sql(c);console.log(h),t({tableName:s,escapedTableName:o,insertQueryPrefix:d})}catch(e){r(e)}}))},this.canceled=!1,this.importFile=async()=>{var e,t,n,i,r;const{selectedFile:s,insertAs:o,destination:a,streamBatchMb:l,streamColumnDataType:c}=this.state,{db:u}=this.props;let d,h;this.canceled=!1;try{if(!(null==s?void 0:s.file))throw"No file to import";if(!(null==s?void 0:s.preview))throw"Preview missing";let p={};if(null==a?void 0:a.newTable){const{escapedTableName:e,insertQueryPrefix:t}=await this.createTable();h=e;const n=s.preview.cols,i=n.map(((e,t)=>e.escapedName));p={importing:{table:e},escapedColnames:i,error:void 0},d=async i=>{var r;if("Single text value"===o)return this.props.db.sql(`INSERT INTO ${e} ( all_data ) VALUES ($1) `,[i[0].all_data]);const s=null===(r=this.state.selectedFile)||void 0===r?void 0:r.srid;s&&(i=i.map((e=>{let t={...e},n=t;return n.geometry.crs=n.geometry.crs||{},n.geometry.crs.type=n.geometry.crs.type||{},n.geometry.crs.type.name=n.geometry.crs.type.name||{},n.geometry.crs.type.name.properties=n.geometry.crs.type.name.properties||{},n.geometry.crs.type.name.properties.name=s,t.geometry=n.geometry,t})));let a={};const l=n.filter((e=>"BIGSERIAL"!==e.dataType));i.forEach(((e,t)=>l.map(((n,i)=>{n.key in e&&void 0!==e[n.key]?"BIGSERIAL"===n.dataType&&(e[n.key]=null):e[n.key]=null;const r=`r${t}`,s=`c${i}`;a[r]=a[r]||{},a[r][s]=e[n.key]}))));const c=i.map(((e,t)=>`(${l.map(((e,n)=>{const i="${r"+t+".c"+n+"}";return"geometry"===e.dataType?` ST_GeomFromGeoJSON(${i}) `:i})).join(", ")}) `));return c.length?this.props.db.sql(t+c.join(", "),a):[]}}else a.existingTable&&(h=a.existingTable,p={importing:{table:a.existingTable},error:void 0},d=e=>u[a.existingTable].insert(e));this.setState(p),this.isImporting=p.importing,this.elapsedCounter||(this.elapsedCounter={timeStarted:Date.now(),interval:setInterval((()=>{if(!(this.mounted&&this.elapsedCounter&&this.elapsedCounter.timeStarted&&this.isImporting))return void(this.elapsedCounter&&clearInterval(this.elapsedCounter.interval));const e=this.elapsedCounter.timeStarted,t=Math.round((Date.now()-e)/1e3),n=Math.floor(t/60);this.state&&this.state.importing&&this.setState({importing:{...this.state.importing,timeElapsed:[n,t-60*n].map((e=>e.toString().padStart(2,"0"))).join(":")}})}),1e3)});const f=null!==(t=null===(e=this.state.selectedFile)||void 0===e?void 0:e.rowsPerBatch)&&void 0!==t?t:0;this.setState({importing:{...this.state.importing,progress:0,progressRows:0}});let m,g=0;try{if(f<=0)throw"Bad stepSize";if(s.fileTooBig){let e=0,t=0,n=[];hr(s.file,l,(async(i,r)=>{if(n=i.map((e=>({value:"TEXT"!==c?JSON.parse(e):e}))),!this.mounted||this.state.error)r.abort();else{r.pause();try{await d(n)}catch(e){this.setState({error:e}),console.error(e)}t+=4*n.join("").length,e+=n.length,this.setState({importing:{...this.state.importing,progress:100*t/s.file.size,progressRows:e}}),n=[],r.resume()}}),(()=>{this.setState({importing:{...this.state.importing,progress:100,imported:h,importedRows:e,finished:!0}})}),this.state.streamColDelimiter)}else{const e=this.state.files?await this.parseFiles(this.state.files):null!==(r=null===(i=null===(n=this.state.selectedFile)||void 0===n?void 0:n.preview)||void 0===i?void 0:i.allRows)&&void 0!==r?r:[],t=e.length;do{m=e.slice(g,g+f),await d(m),this.setState({importing:{table:h,...this.state.importing,progress:Math.round(100*(g+f)/t),progressRows:g+f}}),g+=f}while((!g||g<t)&&!this.canceled);this.setState({importing:{...this.state.importing,progress:100,imported:h,importedRows:null==e?void 0:e.length,finished:!0}})}}catch(e){throw console.log(m),{startRow:g,batchSize:f,err:e}}this.isImporting=void 0}catch(e){console.error(e),this.isImporting=void 0,this.setState({error:e,importing:void 0})}},this.cancel=async()=>{this.canceled=!0;const{onClose:e,db:t}=this.props,{importing:n}=this.state;n&&!n.finished&&await t.sql("DROP TABLE IF EXISTS "+n.table),this.setState({importing:void 0,open:!1,selectedFile:void 0}),e()}}onMount(){window.addEventListener("beforeunload",this.onBeforeUnload)}onUnmount(){const e=this.getExitMessage();e?window.confirm(e):window.removeEventListener("beforeunload",this.onBeforeUnload),window.__prglIsImporting=!1}render(){var e,n,i,r;const{selectedFile:s,colNo:o,destination:a,importing:l,headerType:c,error:u,open:d,reCreateTable:h,customHeadersError:p,customHeaders:f,insertAs:m,loadingFileName:g,streamColDelimiter:y,streamBatchMb:v,files:b}=this.state,{openTable:w,parentDiv:x,db:_}=this.props,{newTableName:E}=a;let S=E;return!E&&s&&(S=s.file.name),t.createElement(Popup,{title:(null==s?void 0:s.file)?b?`Import ${b.length} files`:`Import ${s.file.name}`:"Import data from file",open:d,onClose:this.cancel,positioning:"as-is",rootStyle:{top:window.isMobileDevice?0:"2em",left:window.isMobileDevice?0:"2em",maxHeight:window.isIOSDevice?"calc(100vh - 100px)":"calc(100% - 3em)",maxWidth:window.isIOSDevice?"calc(100vw - 2em)":"100%"},contentClassName:"p-1",footer:t.createElement(t.Fragment,null,t.createElement("div",{className:"p-1 ai-center flex-row f-1",style:{justifyContent:"sspace-between"}},t.createElement(Btn,{onClick:this.cancel,className:"mr-auto",style:{border:"1px solid var(--gray-300)",padding:"8px 16px"}},"Cancel"),!s||(null==l?void 0:l.progress)?null:t.createElement(Btn,{className:"ml-auto",onClick:this.importFile,disabledInfo:p,style:{background:"var(--blue-600)",color:"white",padding:"8px 16px"}},"Import"),(null==l?void 0:l.finished)?t.createElement("div",{className:"ml-1 f-1"},t.createElement("span",{style:{color:"var(--green-500)"}},l.importedRows)," rows imported into ",t.createElement("span",{style:{color:"var(--yellow-500)"}},l.table)):null,(null==l?void 0:l.imported)&&_[l.imported]?t.createElement(Btn,{className:"ml-1",onClick:async()=>{w(l.imported),this.cancel()},disabledInfo:p,style:{background:"var(--blue-600)",color:"white",padding:"8px 16px"}},"Open table"):null,u||!l||l.progress?null:t.createElement("div",{className:"flex-row ai-center ml-auto ta-right"},"Loading file ..."),!l||l.finished||u?null:t.createElement("div",{className:"flex-row ai-center ml-auto ta-right"},t.createElement("div",{className:"mr-1 flex-col "+(l.progress||l.progressRows?"":" hidden ")},t.createElement("div",{style:{fontSize:"1.5em"}},null===(e=l.progress)||void 0===e?void 0:e.toFixed(2),"%"),t.createElement("div",null,(l.progressRows||0).toLocaleString()," rows")),t.createElement("div",{className:"flex-col ai-center"},t.createElement(Loading,{key:"elapsed-loader"}),t.createElement("div",{className:"text-gray-500 mt-p5",style:{fontSize:"1em"}},l.timeElapsed)))),u?t.createElement(ErrorComponent,{error:u.err_msg||u,pre:!0}):null)},t.createElement("div",{className:"flex-col o-auto"},g&&!u?t.createElement("div",{className:"flex-row mt-2"},t.createElement(Loading,{className:"mr-1"}),t.createElement("div",{className:"text-gray-500 mt-p5",style:{fontSize:"1em"}},"Loading ",g)):null,l&&!l.finished||g?null:t.createElement(FormField,{asColumn:!0,className:"mb-1 ",label:"File (csv/txt/json/geojson)",type:"file",inputProps:{multiple:!0},onChange:e=>{this.setFiles(e)}}),s?t.createElement(t.Fragment,null,t.createElement(FormField,{asColumn:!0,key:"new-table-name",readOnly:Boolean(l&&!l.finished),className:"mb-1 ",label:"Table name",value:S,onChange:e=>{this.setState({destination:{...a,newTableName:e}})},rightIcons:t.createElement(Btn,{iconPath:Ie,onClick:()=>this.setState({destination:{...a,newTableName:ar(S)}}),title:"Transform name to snake case"})}),(null==l?void 0:l.finished)?null:t.createElement(t.Fragment,null,t.createElement(FormField,{asColumn:!0,className:"mb-1 ",label:"Drop table if exists",type:"checkbox",value:h,onChange:e=>{this.setState({reCreateTable:e})}}),"csv"===s.type?null:t.createElement(FormField,{asColumn:!0,className:"mb-1 ",label:"Insert as",value:m,options:lr,onChange:e=>{this.setState({insertAs:e})}}),"geojson"===s.type?t.createElement(FormField,{asColumn:!0,className:"mb-1 ",label:"SRID",value:s.srid,type:"text",onChange:e=>{this.setState({selectedFile:{...this.state.selectedFile,srid:e}})}}):null,s.fileTooBig&&t.createElement("div",{className:"f-1 flex-col ai-start p-1 ta-left"},t.createElement(tt(),{className:"f-0 mt-p5 text-yellow-400",path:Be,size:1.25}),t.createElement("div",null,t.createElement("p",null," The file you have selected is over the 50Mb limit. "),t.createElement("p",null," It can only be imported as a stream into a TEXT column. "),t.createElement("p",null," An incrementing BIGSERIAL column will be added ")),t.createElement("div",{className:"f-1 flex-row ai-center mt-1 ta-left"},t.createElement(FormField,{asColumn:!0,inputProps:{min:1,max:Math.round(s.file.size/1048576)},className:"mb-1 mr-1",label:"Stream batch size in Megabytes",type:"number",value:v,onChange:e=>{e>s.file.size/1048576?alert("Must be less than file size"):this.setState({streamBatchMb:e})}}),t.createElement(FormField,{asColumn:!0,className:"mb-1 mr-1",label:"Delimiter",type:"text",value:y,onChange:e=>{this.setState({streamColDelimiter:e})}}))))):null,!s||l&&!l.finished?null:t.createElement("div",{className:"f-1 flex-col",style:{maxHeight:"400px",maxWidth:"900px"}},g?t.createElement(Loading,{key:"preview-loader"}):t.createElement("div",{className:"flex-col f-1 min-w-0 min-h-0"},t.createElement("div",{className:"divider-h"}),s.fileTooBig?t.createElement("div",{className:"f-0 mb-1 noselect"},"File size: ",Math.round(s.file.size/1e6).toLocaleString()," Megabytes"):t.createElement("div",{className:"f-0 mb-1 noselect"},"TotalRows: ",null===(i=null===(n=s.preview)||void 0===n?void 0:n.allRows)||void 0===i?void 0:i.length),t.createElement("div",{className:"f-0 mb-1 noselect"},"Preview"),(null===(r=s.preview)||void 0===r?void 0:r.rows)&&t.createElement(Table,{maxCharsPerCell:500,className:"f-1 o-auto b-gray-400 ",...s.preview,cols:s.preview.cols})))))}}function cr(e){let t=1;const n=4*(e+100)*8;if(n>ur)throw"100Mb row size limit exceeded. Cannot send upload data";return t=Math.floor(Math.min(1500,Math.max(dr/n,ur/n))),t}const ur=1e8,dr=2e7;if(dr>ur)throw"preferredBatchBitSize must be less than batchMaxBitSize";function hr(e,t=1,n,i,r){return Yn().parse(e,{chunkSize:1048576*t,chunk:function(e,t){n(e.data.map((e=>Array.isArray(e)?e.join(r):e)),t)},error:console.error,complete:function(){i()}})}function pr(){}function fr(e){return null==e?pr:function(){return this.querySelector(e)}}function mr(e){return null==e?[]:Array.isArray(e)?e:Array.from(e)}function gr(){return[]}function yr(e){return null==e?gr:function(){return this.querySelectorAll(e)}}function vr(e){return function(){return this.matches(e)}}function br(e){return function(t){return t.matches(e)}}var wr=Array.prototype.find;function xr(){return this.firstElementChild}var _r=Array.prototype.filter;function Er(){return Array.from(this.children)}function Sr(e){return new Array(e.length)}function Cr(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function Tr(e){return function(){return e}}function Ar(e,t,n,i,r,s){for(var o,a=0,l=t.length,c=s.length;a<c;++a)(o=t[a])?(o.__data__=s[a],i[a]=o):n[a]=new Cr(e,s[a]);for(;a<l;++a)(o=t[a])&&(r[a]=o)}function kr(e,t,n,i,r,s,o){var a,l,c,u=new Map,d=t.length,h=s.length,p=new Array(d);for(a=0;a<d;++a)(l=t[a])&&(p[a]=c=o.call(l,l.__data__,a,t)+"",u.has(c)?r[a]=l:u.set(c,l));for(a=0;a<h;++a)c=o.call(e,s[a],a,s)+"",(l=u.get(c))?(i[a]=l,l.__data__=s[a],u.delete(c)):n[a]=new Cr(e,s[a]);for(a=0;a<d;++a)(l=t[a])&&u.get(p[a])===l&&(r[a]=l)}function Nr(e){return e.__data__}function Mr(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function Pr(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}Cr.prototype={constructor:Cr,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var Lr="http://www.w3.org/1999/xhtml";const Or={svg:"http://www.w3.org/2000/svg",xhtml:Lr,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Rr(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),Or.hasOwnProperty(t)?{space:Or[t],local:e}:e}function Ir(e){return function(){this.removeAttribute(e)}}function Dr(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Fr(e,t){return function(){this.setAttribute(e,t)}}function Br(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function zr(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function jr(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Vr(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Ur(e){return function(){this.style.removeProperty(e)}}function Hr(e,t,n){return function(){this.style.setProperty(e,t,n)}}function $r(e,t,n){return function(){var i=t.apply(this,arguments);null==i?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function qr(e,t){return e.style.getPropertyValue(t)||Vr(e).getComputedStyle(e,null).getPropertyValue(t)}function Wr(e){return function(){delete this[e]}}function Gr(e,t){return function(){this[e]=t}}function Yr(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function Xr(e){return e.trim().split(/^|\s+/)}function Kr(e){return e.classList||new Zr(e)}function Zr(e){this._node=e,this._names=Xr(e.getAttribute("class")||"")}function Jr(e,t){for(var n=Kr(e),i=-1,r=t.length;++i<r;)n.add(t[i])}function Qr(e,t){for(var n=Kr(e),i=-1,r=t.length;++i<r;)n.remove(t[i])}function es(e){return function(){Jr(this,e)}}function ts(e){return function(){Qr(this,e)}}function ns(e,t){return function(){(t.apply(this,arguments)?Jr:Qr)(this,e)}}function is(){this.textContent=""}function rs(e){return function(){this.textContent=e}}function ss(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function os(){this.innerHTML=""}function as(e){return function(){this.innerHTML=e}}function ls(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function cs(){this.nextSibling&&this.parentNode.appendChild(this)}function us(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ds(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Lr&&t.documentElement.namespaceURI===Lr?t.createElement(e):t.createElementNS(n,e)}}function hs(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function ps(e){var t=Rr(e);return(t.local?hs:ds)(t)}function fs(){return null}function ms(){var e=this.parentNode;e&&e.removeChild(this)}function gs(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function ys(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function vs(e){return e.trim().split(/^|\s+/).map((function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}}))}function bs(e){return function(){var t=this.__on;if(t){for(var n,i=0,r=-1,s=t.length;i<s;++i)n=t[i],e.type&&n.type!==e.type||n.name!==e.name?t[++r]=n:this.removeEventListener(n.type,n.listener,n.options);++r?t.length=r:delete this.__on}}}function ws(e,t,n){return function(){var i,r=this.__on,s=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(r)for(var o=0,a=r.length;o<a;++o)if((i=r[o]).type===e.type&&i.name===e.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=n),void(i.value=t);this.addEventListener(e.type,s,n),i={type:e.type,name:e.name,value:t,listener:s,options:n},r?r.push(i):this.__on=[i]}}function xs(e,t,n){var i=Vr(e),r=i.CustomEvent;"function"==typeof r?r=new r(t,n):(r=i.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function _s(e,t){return function(){return xs(this,e,t)}}function Es(e,t){return function(){return xs(this,e,t.apply(this,arguments))}}Zr.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var Ss=[null];function Cs(e,t){this._groups=e,this._parents=t}function Ts(){return new Cs([[document.documentElement]],Ss)}Cs.prototype=Ts.prototype={constructor:Cs,select:function(e){"function"!=typeof e&&(e=fr(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s,o,a=t[r],l=a.length,c=i[r]=new Array(l),u=0;u<l;++u)(s=a[u])&&(o=e.call(s,s.__data__,u,a))&&("__data__"in s&&(o.__data__=s.__data__),c[u]=o);return new Cs(i,this._parents)},selectAll:function(e){e="function"==typeof e?function(e){return function(){return mr(e.apply(this,arguments))}}(e):yr(e);for(var t=this._groups,n=t.length,i=[],r=[],s=0;s<n;++s)for(var o,a=t[s],l=a.length,c=0;c<l;++c)(o=a[c])&&(i.push(e.call(o,o.__data__,c,a)),r.push(o));return new Cs(i,r)},selectChild:function(e){return this.select(null==e?xr:function(e){return function(){return wr.call(this.children,e)}}("function"==typeof e?e:br(e)))},selectChildren:function(e){return this.selectAll(null==e?Er:function(e){return function(){return _r.call(this.children,e)}}("function"==typeof e?e:br(e)))},filter:function(e){"function"!=typeof e&&(e=vr(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s,o=t[r],a=o.length,l=i[r]=[],c=0;c<a;++c)(s=o[c])&&e.call(s,s.__data__,c,o)&&l.push(s);return new Cs(i,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,Nr);var n=t?kr:Ar,i=this._parents,r=this._groups;"function"!=typeof e&&(e=Tr(e));for(var s=r.length,o=new Array(s),a=new Array(s),l=new Array(s),c=0;c<s;++c){var u=i[c],d=r[c],h=d.length,p=Mr(e.call(u,u&&u.__data__,c,i)),f=p.length,m=a[c]=new Array(f),g=o[c]=new Array(f),y=l[c]=new Array(h);n(u,d,m,g,y,p,t);for(var v,b,w=0,x=0;w<f;++w)if(v=m[w]){for(w>=x&&(x=w+1);!(b=g[x])&&++x<f;);v._next=b||null}}return(o=new Cs(o,i))._enter=a,o._exit=l,o},enter:function(){return new Cs(this._enter||this._groups.map(Sr),this._parents)},exit:function(){return new Cs(this._exit||this._groups.map(Sr),this._parents)},join:function(e,t,n){var i=this.enter(),r=this,s=this.exit();return"function"==typeof e?(i=e(i))&&(i=i.selection()):i=i.append(e+""),null!=t&&(r=t(r))&&(r=r.selection()),null==n?s.remove():n(s),i&&r?i.merge(r).order():r},merge:function(e){for(var t=e.selection?e.selection():e,n=this._groups,i=t._groups,r=n.length,s=i.length,o=Math.min(r,s),a=new Array(r),l=0;l<o;++l)for(var c,u=n[l],d=i[l],h=u.length,p=a[l]=new Array(h),f=0;f<h;++f)(c=u[f]||d[f])&&(p[f]=c);for(;l<r;++l)a[l]=n[l];return new Cs(a,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i,r=e[t],s=r.length-1,o=r[s];--s>=0;)(i=r[s])&&(o&&4^i.compareDocumentPosition(o)&&o.parentNode.insertBefore(i,o),o=i);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=Pr);for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var o,a=n[s],l=a.length,c=r[s]=new Array(l),u=0;u<l;++u)(o=a[u])&&(c[u]=o);c.sort(t)}return new Cs(r,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var r,s=t[n],o=0,a=s.length;o<a;++o)(r=s[o])&&e.call(r,r.__data__,o,s);return this},attr:function(e,t){var n=Rr(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==t?n.local?Dr:Ir:"function"==typeof t?n.local?jr:zr:n.local?Br:Fr)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?Ur:"function"==typeof t?$r:Hr)(e,t,null==n?"":n)):qr(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?Wr:"function"==typeof t?Yr:Gr)(e,t)):this.node()[e]},classed:function(e,t){var n=Xr(e+"");if(arguments.length<2){for(var i=Kr(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof t?ns:t?es:ts)(n,t))},text:function(e){return arguments.length?this.each(null==e?is:("function"==typeof e?ss:rs)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?os:("function"==typeof e?ls:as)(e)):this.node().innerHTML},raise:function(){return this.each(cs)},lower:function(){return this.each(us)},append:function(e){var t="function"==typeof e?e:ps(e);return this.select((function(){return this.appendChild(t.apply(this,arguments))}))},insert:function(e,t){var n="function"==typeof e?e:ps(e),i=null==t?fs:"function"==typeof t?t:fr(t);return this.select((function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)}))},remove:function(){return this.each(ms)},clone:function(e){return this.select(e?ys:gs)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var i,r,s=vs(e+""),o=s.length;if(!(arguments.length<2)){for(a=t?ws:bs,i=0;i<o;++i)this.each(a(s[i],t,n));return this}var a=this.node().__on;if(a)for(var l,c=0,u=a.length;c<u;++c)for(i=0,l=a[c];i<o;++i)if((r=s[i]).type===l.type&&r.name===l.name)return l.value},dispatch:function(e,t){return this.each(("function"==typeof t?Es:_s)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i,r=e[t],s=0,o=r.length;s<o;++s)(i=r[s])&&(yield i)}};const As=Ts;var ks={value:()=>{}};function Ns(){for(var e,t=0,n=arguments.length,i={};t<n;++t){if(!(e=arguments[t]+"")||e in i||/[\s.]/.test(e))throw new Error("illegal type: "+e);i[e]=[]}return new Ms(i)}function Ms(e){this._=e}function Ps(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",i=e.indexOf(".");if(i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}function Ls(e,t){for(var n,i=0,r=e.length;i<r;++i)if((n=e[i]).name===t)return n.value}function Os(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=ks,e=e.slice(0,i).concat(e.slice(i+1));break}return null!=n&&e.push({name:t,value:n}),e}Ms.prototype=Ns.prototype={constructor:Ms,on:function(e,t){var n,i=this._,r=Ps(e+"",i),s=-1,o=r.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++s<o;)if(n=(e=r[s]).type)i[n]=Os(i[n],e.name,t);else if(null==t)for(n in i)i[n]=Os(i[n],e.name,null);return this}for(;++s<o;)if((n=(e=r[s]).type)&&(n=Ls(i[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Ms(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,i,r=new Array(n),s=0;s<n;++s)r[s]=arguments[s+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=0,n=(i=this._[e]).length;s<n;++s)i[s].value.apply(t,r)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,s=i.length;r<s;++r)i[r].value.apply(t,n)}};const Rs=Ns;var Is,Ds,Fs=0,Bs=0,zs=0,js=0,Vs=0,Us=0,Hs="object"==typeof performance&&performance.now?performance:Date,$s="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function qs(){return Vs||($s(Ws),Vs=Hs.now()+Us)}function Ws(){Vs=0}function Gs(){this._call=this._time=this._next=null}function Ys(e,t,n){var i=new Gs;return i.restart(e,t,n),i}function Xs(){Vs=(js=Hs.now())+Us,Fs=Bs=0;try{!function(){qs(),++Fs;for(var e,t=Is;t;)(e=Vs-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Fs}()}finally{Fs=0,function(){var e,t,n=Is,i=1/0;for(;n;)n._call?(i>n._time&&(i=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:Is=t);Ds=e,Zs(i)}(),Vs=0}}function Ks(){var e=Hs.now(),t=e-js;t>1e3&&(Us-=t,js=e)}function Zs(e){Fs||(Bs&&(Bs=clearTimeout(Bs)),e-Vs>24?(e<1/0&&(Bs=setTimeout(Xs,e-Hs.now()-Us)),zs&&(zs=clearInterval(zs))):(zs||(js=Hs.now(),zs=setInterval(Ks,1e3)),Fs=1,$s(Xs)))}function Js(e,t,n){var i=new Gs;return t=null==t?0:+t,i.restart((n=>{i.stop(),e(n+t)}),t,n),i}Gs.prototype=Ys.prototype={constructor:Gs,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?qs():+n)+(null==t?0:+t),this._next||Ds===this||(Ds?Ds._next=this:Is=this,Ds=this),this._call=e,this._time=n,Zs()},stop:function(){this._call&&(this._call=null,this._time=1/0,Zs())}};var Qs=Rs("start","end","cancel","interrupt"),eo=[];function to(e,t,n,i,r,s){var o=e.__transition;if(o){if(n in o)return}else e.__transition={};!function(e,t,n){var i,r=e.__transition;function s(e){n.state=1,n.timer.restart(o,n.delay,n.time),n.delay<=e&&o(e-n.delay)}function o(s){var c,u,d,h;if(1!==n.state)return l();for(c in r)if((h=r[c]).name===n.name){if(3===h.state)return Js(o);4===h.state?(h.state=6,h.timer.stop(),h.on.call("interrupt",e,e.__data__,h.index,h.group),delete r[c]):+c<t&&(h.state=6,h.timer.stop(),h.on.call("cancel",e,e.__data__,h.index,h.group),delete r[c])}if(Js((function(){3===n.state&&(n.state=4,n.timer.restart(a,n.delay,n.time),a(s))})),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=3,i=new Array(d=n.tween.length),c=0,u=-1;c<d;++c)(h=n.tween[c].value.call(e,e.__data__,n.index,n.group))&&(i[++u]=h);i.length=u+1}}function a(t){for(var r=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(l),n.state=5,1),s=-1,o=i.length;++s<o;)i[s].call(e,r);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),l())}function l(){for(var i in n.state=6,n.timer.stop(),delete r[t],r)return;delete e.__transition}r[t]=n,n.timer=Ys(s,0,n.time)}(e,n,{name:t,index:i,group:r,on:Qs,tween:eo,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:0})}function no(e,t){var n=ro(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function io(e,t){var n=ro(e,t);if(n.state>3)throw new Error("too late; already running");return n}function ro(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function so(e,t){var n,i,r,s=e.__transition,o=!0;if(s){for(r in t=null==t?null:t+"",s)(n=s[r]).name===t?(i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete s[r]):o=!1;o&&delete e.__transition}}var oo,ao=180/Math.PI,lo={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function co(e,t,n,i,r,s){var o,a,l;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(l=e*n+t*i)&&(n-=e*l,i-=t*l),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,l/=a),e*i<t*n&&(e=-e,t=-t,l=-l,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(t,e)*ao,skewX:Math.atan(l)*ao,scaleX:o,scaleY:a}}function uo(e,t,n,i){function r(e){return e.length?e.pop()+" ":""}return function(s,o){var a=[],l=[];return s=e(s),o=e(o),function(e,i,r,s,o,a){if(e!==r||i!==s){var l=o.push("translate(",null,t,null,n);a.push({i:l-4,x:tn(e,r)},{i:l-2,x:tn(i,s)})}else(r||s)&&o.push("translate("+r+t+s+n)}(s.translateX,s.translateY,o.translateX,o.translateY,a,l),function(e,t,n,s){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),s.push({i:n.push(r(n)+"rotate(",null,i)-2,x:tn(e,t)})):t&&n.push(r(n)+"rotate("+t+i)}(s.rotate,o.rotate,a,l),function(e,t,n,s){e!==t?s.push({i:n.push(r(n)+"skewX(",null,i)-2,x:tn(e,t)}):t&&n.push(r(n)+"skewX("+t+i)}(s.skewX,o.skewX,a,l),function(e,t,n,i,s,o){if(e!==n||t!==i){var a=s.push(r(s)+"scale(",null,",",null,")");o.push({i:a-4,x:tn(e,n)},{i:a-2,x:tn(t,i)})}else 1===n&&1===i||s.push(r(s)+"scale("+n+","+i+")")}(s.scaleX,s.scaleY,o.scaleX,o.scaleY,a,l),s=o=null,function(e){for(var t,n=-1,i=l.length;++n<i;)a[(t=l[n]).i]=t.x(e);return a.join("")}}}var ho=uo((function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?lo:co(t.a,t.b,t.c,t.d,t.e,t.f)}),"px, ","px)","deg)"),po=uo((function(e){return null==e?lo:(oo||(oo=document.createElementNS("http://www.w3.org/2000/svg","g")),oo.setAttribute("transform",e),(e=oo.transform.baseVal.consolidate())?co((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):lo)}),", ",")",")");function fo(e,t){var n,i;return function(){var r=io(this,e),s=r.tween;if(s!==n)for(var o=0,a=(i=n=s).length;o<a;++o)if(i[o].name===t){(i=i.slice()).splice(o,1);break}r.tween=i}}function mo(e,t,n){var i,r;if("function"!=typeof n)throw new Error;return function(){var s=io(this,e),o=s.tween;if(o!==i){r=(i=o).slice();for(var a={name:t,value:n},l=0,c=r.length;l<c;++l)if(r[l].name===t){r[l]=a;break}l===c&&r.push(a)}s.tween=r}}function go(e,t,n){var i=e._id;return e.each((function(){var e=io(this,i);(e.value||(e.value={}))[t]=n.apply(this,arguments)})),function(e){return ro(e,i).value[t]}}function yo(e,t){var n;return("number"==typeof t?tn:t instanceof Ot?Zt:(n=Ot(t))?(t=n,Zt):on)(e,t)}function vo(e){return function(){this.removeAttribute(e)}}function bo(e){return function(){this.removeAttributeNS(e.space,e.local)}}function wo(e,t,n){var i,r,s=n+"";return function(){var o=this.getAttribute(e);return o===s?null:o===i?r:r=t(i=o,n)}}function xo(e,t,n){var i,r,s=n+"";return function(){var o=this.getAttributeNS(e.space,e.local);return o===s?null:o===i?r:r=t(i=o,n)}}function _o(e,t,n){var i,r,s;return function(){var o,a,l=n(this);if(null!=l)return(o=this.getAttribute(e))===(a=l+"")?null:o===i&&a===r?s:(r=a,s=t(i=o,l));this.removeAttribute(e)}}function Eo(e,t,n){var i,r,s;return function(){var o,a,l=n(this);if(null!=l)return(o=this.getAttributeNS(e.space,e.local))===(a=l+"")?null:o===i&&a===r?s:(r=a,s=t(i=o,l));this.removeAttributeNS(e.space,e.local)}}function So(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function Co(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function To(e,t){var n,i;function r(){var r=t.apply(this,arguments);return r!==i&&(n=(i=r)&&Co(e,r)),n}return r._value=t,r}function Ao(e,t){var n,i;function r(){var r=t.apply(this,arguments);return r!==i&&(n=(i=r)&&So(e,r)),n}return r._value=t,r}function ko(e,t){return function(){no(this,e).delay=+t.apply(this,arguments)}}function No(e,t){return t=+t,function(){no(this,e).delay=t}}function Mo(e,t){return function(){io(this,e).duration=+t.apply(this,arguments)}}function Po(e,t){return t=+t,function(){io(this,e).duration=t}}function Lo(e,t){if("function"!=typeof t)throw new Error;return function(){io(this,e).ease=t}}function Oo(e,t,n){var i,r,s=function(e){return(e+"").trim().split(/^|\s+/).every((function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e}))}(t)?no:io;return function(){var o=s(this,e),a=o.on;a!==i&&(r=(i=a).copy()).on(t,n),o.on=r}}var Ro=As.prototype.constructor;function Io(e){return function(){this.style.removeProperty(e)}}function Do(e,t,n){return function(i){this.style.setProperty(e,t.call(this,i),n)}}function Fo(e,t,n){var i,r;function s(){var s=t.apply(this,arguments);return s!==r&&(i=(r=s)&&Do(e,s,n)),i}return s._value=t,s}function Bo(e){return function(t){this.textContent=e.call(this,t)}}function zo(e){var t,n;function i(){var i=e.apply(this,arguments);return i!==n&&(t=(n=i)&&Bo(i)),t}return i._value=e,i}var jo=0;function Vo(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function Uo(){return++jo}var Ho=As.prototype;Vo.prototype=function(e){return As().transition(e)}.prototype={constructor:Vo,select:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=fr(e));for(var i=this._groups,r=i.length,s=new Array(r),o=0;o<r;++o)for(var a,l,c=i[o],u=c.length,d=s[o]=new Array(u),h=0;h<u;++h)(a=c[h])&&(l=e.call(a,a.__data__,h,c))&&("__data__"in a&&(l.__data__=a.__data__),d[h]=l,to(d[h],t,n,h,d,ro(a,n)));return new Vo(s,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=yr(e));for(var i=this._groups,r=i.length,s=[],o=[],a=0;a<r;++a)for(var l,c=i[a],u=c.length,d=0;d<u;++d)if(l=c[d]){for(var h,p=e.call(l,l.__data__,d,c),f=ro(l,n),m=0,g=p.length;m<g;++m)(h=p[m])&&to(h,t,n,m,p,f);s.push(p),o.push(l)}return new Vo(s,o,t,n)},selectChild:Ho.selectChild,selectChildren:Ho.selectChildren,filter:function(e){"function"!=typeof e&&(e=vr(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s,o=t[r],a=o.length,l=i[r]=[],c=0;c<a;++c)(s=o[c])&&e.call(s,s.__data__,c,o)&&l.push(s);return new Vo(i,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,i=t.length,r=n.length,s=Math.min(i,r),o=new Array(i),a=0;a<s;++a)for(var l,c=t[a],u=n[a],d=c.length,h=o[a]=new Array(d),p=0;p<d;++p)(l=c[p]||u[p])&&(h[p]=l);for(;a<i;++a)o[a]=t[a];return new Vo(o,this._parents,this._name,this._id)},selection:function(){return new Ro(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=Uo(),i=this._groups,r=i.length,s=0;s<r;++s)for(var o,a=i[s],l=a.length,c=0;c<l;++c)if(o=a[c]){var u=ro(o,t);to(o,e,n,c,a,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Vo(i,this._parents,e,n)},call:Ho.call,nodes:Ho.nodes,node:Ho.node,size:Ho.size,empty:Ho.empty,each:Ho.each,on:function(e,t){var n=this._id;return arguments.length<2?ro(this.node(),n).on.on(e):this.each(Oo(n,e,t))},attr:function(e,t){var n=Rr(e),i="transform"===n?po:yo;return this.attrTween(e,"function"==typeof t?(n.local?Eo:_o)(n,i,go(this,"attr."+e,t)):null==t?(n.local?bo:vo)(n):(n.local?xo:wo)(n,i,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;var i=Rr(e);return this.tween(n,(i.local?To:Ao)(i,t))},style:function(e,t,n){var i="transform"==(e+="")?ho:yo;return null==t?this.styleTween(e,function(e,t){var n,i,r;return function(){var s=qr(this,e),o=(this.style.removeProperty(e),qr(this,e));return s===o?null:s===n&&o===i?r:r=t(n=s,i=o)}}(e,i)).on("end.style."+e,Io(e)):"function"==typeof t?this.styleTween(e,function(e,t,n){var i,r,s;return function(){var o=qr(this,e),a=n(this),l=a+"";return null==a&&(this.style.removeProperty(e),l=a=qr(this,e)),o===l?null:o===i&&l===r?s:(r=l,s=t(i=o,a))}}(e,i,go(this,"style."+e,t))).each(function(e,t){var n,i,r,s,o="style."+t,a="end."+o;return function(){var l=io(this,e),c=l.on,u=null==l.value[o]?s||(s=Io(t)):void 0;c===n&&r===u||(i=(n=c).copy()).on(a,r=u),l.on=i}}(this._id,e)):this.styleTween(e,function(e,t,n){var i,r,s=n+"";return function(){var o=qr(this,e);return o===s?null:o===i?r:r=t(i=o,n)}}(e,i,t),n).on("end.style."+e,null)},styleTween:function(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==t)return this.tween(i,null);if("function"!=typeof t)throw new Error;return this.tween(i,Fo(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"==typeof e?function(e){return function(){var t=e(this);this.textContent=null==t?"":t}}(go(this,"text",e)):function(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;return this.tween(t,zo(e))},remove:function(){return this.on("end.remove",function(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}(this._id))},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var i,r=ro(this.node(),n).tween,s=0,o=r.length;s<o;++s)if((i=r[s]).name===e)return i.value;return null}return this.each((null==t?fo:mo)(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?ko:No)(t,e)):ro(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?Mo:Po)(t,e)):ro(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(Lo(t,e)):ro(this.node(),t).ease},easeVarying:function(e){if("function"!=typeof e)throw new Error;return this.each(function(e,t){return function(){var n=t.apply(this,arguments);if("function"!=typeof n)throw new Error;io(this,e).ease=n}}(this._id,e))},end:function(){var e,t,n=this,i=n._id,r=n.size();return new Promise((function(s,o){var a={value:o},l={value:function(){0==--r&&s()}};n.each((function(){var n=io(this,i),r=n.on;r!==e&&((t=(e=r).copy())._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),n.on=t})),0===r&&s()}))},[Symbol.iterator]:Ho[Symbol.iterator]};var $o={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function qo(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}As.prototype.interrupt=function(e){return this.each((function(){so(this,e)}))},As.prototype.transition=function(e){var t,n;e instanceof Vo?(t=e._id,e=e._name):(t=Uo(),(n=$o).time=qs(),e=null==e?null:e+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var o,a=i[s],l=a.length,c=0;c<l;++c)(o=a[c])&&to(o,e,t,c,a,n||qo(o,t));return new Vo(i,this._parents,e,t)};const{abs:Wo,max:Go,min:Yo}=Math;function Xo(e){return[+e[0],+e[1]]}function Ko(e){return[Xo(e[0]),Xo(e[1])]}["w","e"].map(Zo),["n","s"].map(Zo),["n","w","e","s","nw","ne","sw","se"].map(Zo);function Zo(e){return{type:e}}function Jo(e){return"string"==typeof e?new Cs([[document.querySelector(e)]],[document.documentElement]):new Cs([[e]],Ss)}function Qo(e,t){if(e=function(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,[(i=i.matrixTransform(t.getScreenCTM().inverse())).x,i.y]}if(t.getBoundingClientRect){var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}}return[e.pageX,e.pageY]}const ea={passive:!1},ta={capture:!0,passive:!1};function na(e){e.stopImmediatePropagation()}function ia(e){e.preventDefault(),e.stopImmediatePropagation()}function ra(e){var t=e.document.documentElement,n=Jo(e).on("dragstart.drag",ia,ta);"onselectstart"in t?n.on("selectstart.drag",ia,ta):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function sa(e,t){var n=e.document.documentElement,i=Jo(e).on("dragstart.drag",null);t&&(i.on("click.drag",ia,ta),setTimeout((function(){i.on("click.drag",null)}),0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const oa=e=>()=>e;function aa(e,{sourceEvent:t,subject:n,target:i,identifier:r,active:s,x:o,y:a,dx:l,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}function la(e){return!e.ctrlKey&&!e.button}function ca(){return this.parentNode}function ua(e,t){return null==t?{x:e.x,y:e.y}:t}function da(){return navigator.maxTouchPoints||"ontouchstart"in this}function ha(e){return function(){return e}}function pa(e){return 1e-6*(e()-.5)}function fa(e){return e.index}function ma(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}function ga(e,t,n,i){if(isNaN(t)||isNaN(n))return e;var r,s,o,a,l,c,u,d,h,p=e._root,f={data:i},m=e._x0,g=e._y0,y=e._x1,v=e._y1;if(!p)return e._root=f,e;for(;p.length;)if((c=t>=(s=(m+y)/2))?m=s:y=s,(u=n>=(o=(g+v)/2))?g=o:v=o,r=p,!(p=p[d=u<<1|c]))return r[d]=f,e;if(a=+e._x.call(null,p.data),l=+e._y.call(null,p.data),t===a&&n===l)return f.next=p,r?r[d]=f:e._root=f,e;do{r=r?r[d]=new Array(4):e._root=new Array(4),(c=t>=(s=(m+y)/2))?m=s:y=s,(u=n>=(o=(g+v)/2))?g=o:v=o}while((d=u<<1|c)==(h=(l>=o)<<1|a>=s));return r[h]=p,r[d]=f,e}function ya(e,t,n,i,r){this.node=e,this.x0=t,this.y0=n,this.x1=i,this.y1=r}function va(e){return e[0]}function ba(e){return e[1]}function wa(e,t,n){var i=new xa(null==t?va:t,null==n?ba:n,NaN,NaN,NaN,NaN);return null==e?i:i.addAll(e)}function xa(e,t,n,i,r,s){this._x=e,this._y=t,this._x0=n,this._y0=i,this._x1=r,this._y1=s,this._root=void 0}function _a(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}aa.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};var Ea=wa.prototype=xa.prototype;Ea.copy=function(){var e,t,n=new xa(this._x,this._y,this._x0,this._y0,this._x1,this._y1),i=this._root;if(!i)return n;if(!i.length)return n._root=_a(i),n;for(e=[{source:i,target:n._root=new Array(4)}];i=e.pop();)for(var r=0;r<4;++r)(t=i.source[r])&&(t.length?e.push({source:t,target:i.target[r]=new Array(4)}):i.target[r]=_a(t));return n},Ea.add=function(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return ga(this.cover(t,n),t,n,e)},Ea.addAll=function(e){var t,n,i,r,s=e.length,o=new Array(s),a=new Array(s),l=1/0,c=1/0,u=-1/0,d=-1/0;for(n=0;n<s;++n)isNaN(i=+this._x.call(null,t=e[n]))||isNaN(r=+this._y.call(null,t))||(o[n]=i,a[n]=r,i<l&&(l=i),i>u&&(u=i),r<c&&(c=r),r>d&&(d=r));if(l>u||c>d)return this;for(this.cover(l,c).cover(u,d),n=0;n<s;++n)ga(this,o[n],a[n],e[n]);return this},Ea.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,i=this._y0,r=this._x1,s=this._y1;if(isNaN(n))r=(n=Math.floor(e))+1,s=(i=Math.floor(t))+1;else{for(var o,a,l=r-n||1,c=this._root;n>e||e>=r||i>t||t>=s;)switch(a=(t<i)<<1|e<n,(o=new Array(4))[a]=c,c=o,l*=2,a){case 0:r=n+l,s=i+l;break;case 1:n=r-l,s=i+l;break;case 2:r=n+l,i=s-l;break;case 3:n=r-l,i=s-l}this._root&&this._root.length&&(this._root=c)}return this._x0=n,this._y0=i,this._x1=r,this._y1=s,this},Ea.data=function(){var e=[];return this.visit((function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)})),e},Ea.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},Ea.find=function(e,t,n){var i,r,s,o,a,l,c,u=this._x0,d=this._y0,h=this._x1,p=this._y1,f=[],m=this._root;for(m&&f.push(new ya(m,u,d,h,p)),null==n?n=1/0:(u=e-n,d=t-n,h=e+n,p=t+n,n*=n);l=f.pop();)if(!(!(m=l.node)||(r=l.x0)>h||(s=l.y0)>p||(o=l.x1)<u||(a=l.y1)<d))if(m.length){var g=(r+o)/2,y=(s+a)/2;f.push(new ya(m[3],g,y,o,a),new ya(m[2],r,y,g,a),new ya(m[1],g,s,o,y),new ya(m[0],r,s,g,y)),(c=(t>=y)<<1|e>=g)&&(l=f[f.length-1],f[f.length-1]=f[f.length-1-c],f[f.length-1-c]=l)}else{var v=e-+this._x.call(null,m.data),b=t-+this._y.call(null,m.data),w=v*v+b*b;if(w<n){var x=Math.sqrt(n=w);u=e-x,d=t-x,h=e+x,p=t+x,i=m.data}}return i},Ea.remove=function(e){if(isNaN(s=+this._x.call(null,e))||isNaN(o=+this._y.call(null,e)))return this;var t,n,i,r,s,o,a,l,c,u,d,h,p=this._root,f=this._x0,m=this._y0,g=this._x1,y=this._y1;if(!p)return this;if(p.length)for(;;){if((c=s>=(a=(f+g)/2))?f=a:g=a,(u=o>=(l=(m+y)/2))?m=l:y=l,t=p,!(p=p[d=u<<1|c]))return this;if(!p.length)break;(t[d+1&3]||t[d+2&3]||t[d+3&3])&&(n=t,h=d)}for(;p.data!==e;)if(i=p,!(p=p.next))return this;return(r=p.next)&&delete p.next,i?(r?i.next=r:delete i.next,this):t?(r?t[d]=r:delete t[d],(p=t[0]||t[1]||t[2]||t[3])&&p===(t[3]||t[2]||t[1]||t[0])&&!p.length&&(n?n[h]=p:this._root=p),this):(this._root=r,this)},Ea.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},Ea.root=function(){return this._root},Ea.size=function(){var e=0;return this.visit((function(t){if(!t.length)do{++e}while(t=t.next)})),e},Ea.visit=function(e){var t,n,i,r,s,o,a=[],l=this._root;for(l&&a.push(new ya(l,this._x0,this._y0,this._x1,this._y1));t=a.pop();)if(!e(l=t.node,i=t.x0,r=t.y0,s=t.x1,o=t.y1)&&l.length){var c=(i+s)/2,u=(r+o)/2;(n=l[3])&&a.push(new ya(n,c,u,s,o)),(n=l[2])&&a.push(new ya(n,i,u,c,o)),(n=l[1])&&a.push(new ya(n,c,r,s,u)),(n=l[0])&&a.push(new ya(n,i,r,c,u))}return this},Ea.visitAfter=function(e){var t,n=[],i=[];for(this._root&&n.push(new ya(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var r=t.node;if(r.length){var s,o=t.x0,a=t.y0,l=t.x1,c=t.y1,u=(o+l)/2,d=(a+c)/2;(s=r[0])&&n.push(new ya(s,o,a,u,d)),(s=r[1])&&n.push(new ya(s,u,a,l,d)),(s=r[2])&&n.push(new ya(s,o,d,u,c)),(s=r[3])&&n.push(new ya(s,u,d,l,c))}i.push(t)}for(;t=i.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},Ea.x=function(e){return arguments.length?(this._x=e,this):this._x},Ea.y=function(e){return arguments.length?(this._y=e,this):this._y};const Sa=4294967296;function Ca(e){return e.x}function Ta(e){return e.y}var Aa=Math.PI*(3-Math.sqrt(5));function ka(e){var t,n=1,i=.001,r=1-Math.pow(i,1/300),s=0,o=.6,a=new Map,l=Ys(d),c=Rs("tick","end"),u=function(){let e=1;return()=>(e=(1664525*e+1013904223)%Sa)/Sa}();function d(){h(),c.call("tick",t),n<i&&(l.stop(),c.call("end",t))}function h(i){var l,c,u=e.length;void 0===i&&(i=1);for(var d=0;d<i;++d)for(n+=(s-n)*r,a.forEach((function(e){e(n)})),l=0;l<u;++l)null==(c=e[l]).fx?c.x+=c.vx*=o:(c.x=c.fx,c.vx=0),null==c.fy?c.y+=c.vy*=o:(c.y=c.fy,c.vy=0);return t}function p(){for(var t,n=0,i=e.length;n<i;++n){if((t=e[n]).index=n,null!=t.fx&&(t.x=t.fx),null!=t.fy&&(t.y=t.fy),isNaN(t.x)||isNaN(t.y)){var r=10*Math.sqrt(.5+n),s=n*Aa;t.x=r*Math.cos(s),t.y=r*Math.sin(s)}(isNaN(t.vx)||isNaN(t.vy))&&(t.vx=t.vy=0)}}function f(t){return t.initialize&&t.initialize(e,u),t}return null==e&&(e=[]),p(),t={tick:h,restart:function(){return l.restart(d),t},stop:function(){return l.stop(),t},nodes:function(n){return arguments.length?(e=n,p(),a.forEach(f),t):e},alpha:function(e){return arguments.length?(n=+e,t):n},alphaMin:function(e){return arguments.length?(i=+e,t):i},alphaDecay:function(e){return arguments.length?(r=+e,t):+r},alphaTarget:function(e){return arguments.length?(s=+e,t):s},velocityDecay:function(e){return arguments.length?(o=1-e,t):1-o},randomSource:function(e){return arguments.length?(u=e,a.forEach(f),t):u},force:function(e,n){return arguments.length>1?(null==n?a.delete(e):a.set(e,f(n)),t):a.get(e)},find:function(t,n,i){var r,s,o,a,l,c=0,u=e.length;for(null==i?i=1/0:i*=i,c=0;c<u;++c)(o=(r=t-(a=e[c]).x)*r+(s=n-a.y)*s)<i&&(l=a,i=o);return l},on:function(e,n){return arguments.length>1?(c.on(e,n),t):c.on(e)}}}function Na(e){var t,n,i,r=ha(.1);function s(e){for(var r,s=0,o=t.length;s<o;++s)(r=t[s]).vy+=(i[s]-r.y)*n[s]*e}function o(){if(t){var s,o=t.length;for(n=new Array(o),i=new Array(o),s=0;s<o;++s)n[s]=isNaN(i[s]=+e(t[s],s,t))?0:+r(t[s],s,t)}}return"function"!=typeof e&&(e=ha(null==e?0:+e)),s.initialize=function(e){t=e,o()},s.strength=function(e){return arguments.length?(r="function"==typeof e?e:ha(+e),o(),s):r},s.y=function(t){return arguments.length?(e="function"==typeof t?t:ha(+t),o(),s):e},s}var Ma=Math.sqrt(50),Pa=Math.sqrt(10),La=Math.sqrt(2);function Oa(e,t,n){var i=(t-e)/Math.max(0,n),r=Math.floor(Math.log(i)/Math.LN10),s=i/Math.pow(10,r);return r>=0?(s>=Ma?10:s>=Pa?5:s>=La?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(s>=Ma?10:s>=Pa?5:s>=La?2:1)}function Ra(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Ia(e){let t=e,n=e,i=e;function r(e,t,r=0,s=e.length){if(r<s){if(0!==n(t,t))return s;do{const n=r+s>>>1;i(e[n],t)<0?r=n+1:s=n}while(r<s)}return r}return 2!==e.length&&(t=(t,n)=>e(t)-n,n=Ra,i=(t,n)=>Ra(e(t),n)),{left:r,center:function(e,n,i=0,s=e.length){const o=r(e,n,i,s-1);return o>i&&t(e[o-1],n)>-t(e[o],n)?o-1:o},right:function(e,t,r=0,s=e.length){if(r<s){if(0!==n(t,t))return s;do{const n=r+s>>>1;i(e[n],t)<=0?r=n+1:s=n}while(r<s)}return r}}}const Da=Ia(Ra),Fa=Da.right,Ba=(Da.left,Ia((function(e){return null===e?NaN:+e})).center,Fa);function za(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function ja(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function Va(){}var Ua=.7,Ha=1/Ua,$a="\\s*([+-]?\\d+)\\s*",qa="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Wa="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ga=/^#([0-9a-f]{3,8})$/,Ya=new RegExp("^rgb\\("+[$a,$a,$a]+"\\)$"),Xa=new RegExp("^rgb\\("+[Wa,Wa,Wa]+"\\)$"),Ka=new RegExp("^rgba\\("+[$a,$a,$a,qa]+"\\)$"),Za=new RegExp("^rgba\\("+[Wa,Wa,Wa,qa]+"\\)$"),Ja=new RegExp("^hsl\\("+[qa,Wa,Wa]+"\\)$"),Qa=new RegExp("^hsla\\("+[qa,Wa,Wa,qa]+"\\)$"),el={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function tl(){return this.rgb().formatHex()}function nl(){return this.rgb().formatRgb()}function il(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Ga.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?rl(t):3===n?new ll(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?sl(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?sl(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Ya.exec(e))?new ll(t[1],t[2],t[3],1):(t=Xa.exec(e))?new ll(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Ka.exec(e))?sl(t[1],t[2],t[3],t[4]):(t=Za.exec(e))?sl(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Ja.exec(e))?hl(t[1],t[2]/100,t[3]/100,1):(t=Qa.exec(e))?hl(t[1],t[2]/100,t[3]/100,t[4]):el.hasOwnProperty(e)?rl(el[e]):"transparent"===e?new ll(NaN,NaN,NaN,0):null}function rl(e){return new ll(e>>16&255,e>>8&255,255&e,1)}function sl(e,t,n,i){return i<=0&&(e=t=n=NaN),new ll(e,t,n,i)}function ol(e){return e instanceof Va||(e=il(e)),e?new ll((e=e.rgb()).r,e.g,e.b,e.opacity):new ll}function al(e,t,n,i){return 1===arguments.length?ol(e):new ll(e,t,n,null==i?1:i)}function ll(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}function cl(){return"#"+dl(this.r)+dl(this.g)+dl(this.b)}function ul(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function dl(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function hl(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new fl(e,t,n,i)}function pl(e){if(e instanceof fl)return new fl(e.h,e.s,e.l,e.opacity);if(e instanceof Va||(e=il(e)),!e)return new fl;if(e instanceof fl)return e;var t=(e=e.rgb()).r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),s=Math.max(t,n,i),o=NaN,a=s-r,l=(s+r)/2;return a?(o=t===s?(n-i)/a+6*(n<i):n===s?(i-t)/a+2:(t-n)/a+4,a/=l<.5?s+r:2-s-r,o*=60):a=l>0&&l<1?0:o,new fl(o,a,l,e.opacity)}function fl(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}function ml(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function gl(e,t,n,i,r){var s=e*e,o=s*e;return((1-3*e+3*s-o)*t+(4-6*s+3*o)*n+(1+3*e+3*s-3*o)*i+o*r)/6}za(Va,il,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:tl,formatHex:tl,formatHsl:function(){return pl(this).formatHsl()},formatRgb:nl,toString:nl}),za(ll,al,ja(Va,{brighter:function(e){return e=null==e?Ha:Math.pow(Ha,e),new ll(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?Ua:Math.pow(Ua,e),new ll(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:cl,formatHex:cl,formatRgb:ul,toString:ul})),za(fl,(function(e,t,n,i){return 1===arguments.length?pl(e):new fl(e,t,n,null==i?1:i)}),ja(Va,{brighter:function(e){return e=null==e?Ha:Math.pow(Ha,e),new fl(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?Ua:Math.pow(Ua,e),new fl(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new ll(ml(e>=240?e-240:e+120,r,i),ml(e,r,i),ml(e<120?e+240:e-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));const yl=e=>()=>e;function vl(e,t){return function(n){return e+n*t}}function bl(e){return 1==(e=+e)?wl:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}(t,n,e):yl(isNaN(t)?n:t)}}function wl(e,t){var n=t-e;return n?vl(e,n):yl(isNaN(e)?t:e)}const xl=function e(t){var n=bl(t);function i(e,t){var i=n((e=al(e)).r,(t=al(t)).r),r=n(e.g,t.g),s=n(e.b,t.b),o=wl(e.opacity,t.opacity);return function(t){return e.r=i(t),e.g=r(t),e.b=s(t),e.opacity=o(t),e+""}}return i.gamma=e,i}(1);function _l(e){return function(t){var n,i,r=t.length,s=new Array(r),o=new Array(r),a=new Array(r);for(n=0;n<r;++n)i=al(t[n]),s[n]=i.r||0,o[n]=i.g||0,a[n]=i.b||0;return s=e(s),o=e(o),a=e(a),i.opacity=1,function(e){return i.r=s(e),i.g=o(e),i.b=a(e),i+""}}}_l((function(e){var t=e.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),r=e[i],s=e[i+1],o=i>0?e[i-1]:2*r-s,a=i<t-1?e[i+2]:2*s-r;return gl((n-i/t)*t,o,r,s,a)}})),_l((function(e){var t=e.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*t),r=e[(i+t-1)%t],s=e[i%t],o=e[(i+1)%t],a=e[(i+2)%t];return gl((n-i/t)*t,r,s,o,a)}}));function El(e,t){var n,i=t?t.length:0,r=e?Math.min(i,e.length):0,s=new Array(r),o=new Array(i);for(n=0;n<r;++n)s[n]=Pl(e[n],t[n]);for(;n<i;++n)o[n]=t[n];return function(e){for(n=0;n<r;++n)o[n]=s[n](e);return o}}function Sl(e,t){var n=new Date;return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function Cl(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Tl(e,t){var n,i={},r={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?i[n]=Pl(e[n],t[n]):r[n]=t[n];return function(e){for(n in i)r[n]=i[n](e);return r}}var Al=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,kl=new RegExp(Al.source,"g");function Nl(e,t){var n,i,r,s=Al.lastIndex=kl.lastIndex=0,o=-1,a=[],l=[];for(e+="",t+="";(n=Al.exec(e))&&(i=kl.exec(t));)(r=i.index)>s&&(r=t.slice(s,r),a[o]?a[o]+=r:a[++o]=r),(n=n[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,l.push({i:o,x:Cl(n,i)})),s=kl.lastIndex;return s<t.length&&(r=t.slice(s),a[o]?a[o]+=r:a[++o]=r),a.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,i=0;i<t;++i)a[(n=l[i]).i]=n.x(e);return a.join("")})}function Ml(e,t){t||(t=[]);var n,i=e?Math.min(t.length,e.length):0,r=t.slice();return function(s){for(n=0;n<i;++n)r[n]=e[n]*(1-s)+t[n]*s;return r}}function Pl(e,t){var n,i=typeof t;return null==t||"boolean"===i?yl(t):("number"===i?Cl:"string"===i?(n=il(t))?(t=n,xl):Nl:t instanceof il?xl:t instanceof Date?Sl:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(t)?Ml:Array.isArray(t)?El:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?Tl:Cl)(e,t)}function Ll(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function Ol(e){return+e}var Rl=[0,1];function Il(e){return e}function Dl(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(e){return function(){return e}}(isNaN(t)?NaN:.5)}function Fl(e,t,n){var i=e[0],r=e[1],s=t[0],o=t[1];return r<i?(i=Dl(r,i),s=n(o,s)):(i=Dl(i,r),s=n(s,o)),function(e){return s(i(e))}}function Bl(e,t,n){var i=Math.min(e.length,t.length)-1,r=new Array(i),s=new Array(i),o=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<i;)r[o]=Dl(e[o],e[o+1]),s[o]=n(t[o],t[o+1]);return function(t){var n=Ba(e,t,1,i)-1;return s[n](r[n](t))}}function zl(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function jl(){var e,t,n,i,r,s,o=Rl,a=Rl,l=Pl,c=Il;function u(){var e=Math.min(o.length,a.length);return c!==Il&&(c=function(e,t){var n;return e>t&&(n=e,e=t,t=n),function(n){return Math.max(e,Math.min(t,n))}}(o[0],o[e-1])),i=e>2?Bl:Fl,r=s=null,d}function d(t){return null==t||isNaN(t=+t)?n:(r||(r=i(o.map(e),a,l)))(e(c(t)))}return d.invert=function(n){return c(t((s||(s=i(a,o.map(e),Cl)))(n)))},d.domain=function(e){return arguments.length?(o=Array.from(e,Ol),u()):o.slice()},d.range=function(e){return arguments.length?(a=Array.from(e),u()):a.slice()},d.rangeRound=function(e){return a=Array.from(e),l=Ll,u()},d.clamp=function(e){return arguments.length?(c=!!e||Il,u()):c!==Il},d.interpolate=function(e){return arguments.length?(l=e,u()):l},d.unknown=function(e){return arguments.length?(n=e,d):n},function(n,i){return e=n,t=i,u()}}function Vl(){return jl()(Il,Il)}function Ul(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}var Hl,$l=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ql(e){if(!(t=$l.exec(e)))throw new Error("invalid format: "+e);var t;return new Wl({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function Wl(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function Gl(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function Yl(e){return(e=Gl(Math.abs(e)))?e[1]:NaN}function Xl(e,t){var n=Gl(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}ql.prototype=Wl.prototype,Wl.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const Kl={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Xl(100*e,t),r:Xl,s:function(e,t){var n=Gl(e,t);if(!n)return e+"";var i=n[0],r=n[1],s=r-(Hl=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+Gl(e,Math.max(0,t+s-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Zl(e){return e}var Jl,Ql,ec,tc=Array.prototype.map,nc=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function ic(e){var t,n,i=void 0===e.grouping||void 0===e.thousands?Zl:(t=tc.call(e.grouping,Number),n=e.thousands+"",function(e,i){for(var r=e.length,s=[],o=0,a=t[0],l=0;r>0&&a>0&&(l+a+1>i&&(a=Math.max(1,i-l)),s.push(e.substring(r-=a,r+a)),!((l+=a+1)>i));)a=t[o=(o+1)%t.length];return s.reverse().join(n)}),r=void 0===e.currency?"":e.currency[0]+"",s=void 0===e.currency?"":e.currency[1]+"",o=void 0===e.decimal?".":e.decimal+"",a=void 0===e.numerals?Zl:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(tc.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"−":e.minus+"",u=void 0===e.nan?"NaN":e.nan+"";function d(e){var t=(e=ql(e)).fill,n=e.align,d=e.sign,h=e.symbol,p=e.zero,f=e.width,m=e.comma,g=e.precision,y=e.trim,v=e.type;"n"===v?(m=!0,v="g"):Kl[v]||(void 0===g&&(g=12),y=!0,v="g"),(p||"0"===t&&"="===n)&&(p=!0,t="0",n="=");var b="$"===h?r:"#"===h&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",w="$"===h?s:/[%p]/.test(v)?l:"",x=Kl[v],_=/[defgprs%]/.test(v);function E(e){var r,s,l,h=b,E=w;if("c"===v)E=x(e)+E,e="";else{var S=(e=+e)<0||1/e<0;if(e=isNaN(e)?u:x(Math.abs(e),g),y&&(e=function(e){e:for(var t,n=e.length,i=1,r=-1;i<n;++i)switch(e[i]){case".":r=t=i;break;case"0":0===r&&(r=i),t=i;break;default:if(!+e[i])break e;r>0&&(r=0)}return r>0?e.slice(0,r)+e.slice(t+1):e}(e)),S&&0==+e&&"+"!==d&&(S=!1),h=(S?"("===d?d:c:"-"===d||"("===d?"":d)+h,E=("s"===v?nc[8+Hl/3]:"")+E+(S&&"("===d?")":""),_)for(r=-1,s=e.length;++r<s;)if(48>(l=e.charCodeAt(r))||l>57){E=(46===l?o+e.slice(r+1):e.slice(r))+E,e=e.slice(0,r);break}}m&&!p&&(e=i(e,1/0));var C=h.length+e.length+E.length,T=C<f?new Array(f-C+1).join(t):"";switch(m&&p&&(e=i(T+e,T.length?f-E.length:1/0),T=""),n){case"<":e=h+e+E+T;break;case"=":e=h+T+e+E;break;case"^":e=T.slice(0,C=T.length>>1)+h+e+E+T.slice(C);break;default:e=T+h+e+E}return a(e)}return g=void 0===g?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),E.toString=function(){return e+""},E}return{format:d,formatPrefix:function(e,t){var n=d(((e=ql(e)).type="f",e)),i=3*Math.max(-8,Math.min(8,Math.floor(Yl(t)/3))),r=Math.pow(10,-i),s=nc[8+i/3];return function(e){return n(r*e)+s}}}}function rc(e,t,n,i){var r,s=function(e,t,n){var i=Math.abs(t-e)/Math.max(0,n),r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),s=i/r;return s>=Ma?r*=10:s>=Pa?r*=5:s>=La&&(r*=2),t<e?-r:r}(e,t,n);switch((i=ql(null==i?",f":i)).type){case"s":var o=Math.max(Math.abs(e),Math.abs(t));return null!=i.precision||isNaN(r=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Yl(t)/3)))-Yl(Math.abs(e)))}(s,o))||(i.precision=r),ec(i,o);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(r=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Yl(t)-Yl(e))+1}(s,Math.max(Math.abs(e),Math.abs(t))))||(i.precision=r-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(r=function(e){return Math.max(0,-Yl(Math.abs(e)))}(s))||(i.precision=r-2*("%"===i.type))}return Ql(i)}function sc(e){var t=e.domain;return e.ticks=function(e){var n=t();return function(e,t,n){var i,r,s,o,a=-1;if(n=+n,(e=+e)==(t=+t)&&n>0)return[e];if((i=t<e)&&(r=e,e=t,t=r),0===(o=Oa(e,t,n))||!isFinite(o))return[];if(o>0){let n=Math.round(e/o),i=Math.round(t/o);for(n*o<e&&++n,i*o>t&&--i,s=new Array(r=i-n+1);++a<r;)s[a]=(n+a)*o}else{o=-o;let n=Math.round(e*o),i=Math.round(t*o);for(n/o<e&&++n,i/o>t&&--i,s=new Array(r=i-n+1);++a<r;)s[a]=(n+a)/o}return i&&s.reverse(),s}(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var i=t();return rc(i[0],i[i.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var i,r,s=t(),o=0,a=s.length-1,l=s[o],c=s[a],u=10;for(c<l&&(r=l,l=c,c=r,r=o,o=a,a=r);u-- >0;){if((r=Oa(l,c,n))===i)return s[o]=l,s[a]=c,t(s);if(r>0)l=Math.floor(l/r)*r,c=Math.ceil(c/r)*r;else{if(!(r<0))break;l=Math.ceil(l*r)/r,c=Math.floor(c*r)/r}i=r}return e},e}function oc(){var e=Vl();return e.copy=function(){return zl(e,oc())},Ul.apply(e,arguments),sc(e)}!function(e){Jl=ic(e),Ql=Jl.format,ec=Jl.formatPrefix}({thousands:",",grouping:[3],currency:["$",""]});const ac=Math.PI,lc=2*ac,cc=1e-6,uc=lc-cc;function dc(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function hc(){return new dc}dc.prototype=hc.prototype={constructor:dc,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,i){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(e,t,n,i,r,s){this._+="C"+ +e+","+ +t+","+ +n+","+ +i+","+(this._x1=+r)+","+(this._y1=+s)},arcTo:function(e,t,n,i,r){e=+e,t=+t,n=+n,i=+i,r=+r;var s=this._x1,o=this._y1,a=n-e,l=i-t,c=s-e,u=o-t,d=c*c+u*u;if(r<0)throw new Error("negative radius: "+r);if(null===this._x1)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(d>cc)if(Math.abs(u*a-l*c)>cc&&r){var h=n-s,p=i-o,f=a*a+l*l,m=h*h+p*p,g=Math.sqrt(f),y=Math.sqrt(d),v=r*Math.tan((ac-Math.acos((f+d-m)/(2*g*y)))/2),b=v/y,w=v/g;Math.abs(b-1)>cc&&(this._+="L"+(e+b*c)+","+(t+b*u)),this._+="A"+r+","+r+",0,0,"+ +(u*h>c*p)+","+(this._x1=e+w*a)+","+(this._y1=t+w*l)}else this._+="L"+(this._x1=e)+","+(this._y1=t);else;},arc:function(e,t,n,i,r,s){e=+e,t=+t,s=!!s;var o=(n=+n)*Math.cos(i),a=n*Math.sin(i),l=e+o,c=t+a,u=1^s,d=s?i-r:r-i;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+l+","+c:(Math.abs(this._x1-l)>cc||Math.abs(this._y1-c)>cc)&&(this._+="L"+l+","+c),n&&(d<0&&(d=d%lc+lc),d>uc?this._+="A"+n+","+n+",0,1,"+u+","+(e-o)+","+(t-a)+"A"+n+","+n+",0,1,"+u+","+(this._x1=l)+","+(this._y1=c):d>cc&&(this._+="A"+n+","+n+",0,"+ +(d>=ac)+","+u+","+(this._x1=e+n*Math.cos(r))+","+(this._y1=t+n*Math.sin(r))))},rect:function(e,t,n,i){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}};const pc=hc;var fc=Array.prototype.slice;function mc(e){return function(){return e}}function gc(e){return e[0]}function yc(e){return e[1]}function vc(e){return e.source}function bc(e){return e.target}function wc(e){var t=vc,n=bc,i=gc,r=yc,s=null;function o(){var o,a=fc.call(arguments),l=t.apply(this,a),c=n.apply(this,a);if(s||(s=o=pc()),e(s,+i.apply(this,(a[0]=l,a)),+r.apply(this,a),+i.apply(this,(a[0]=c,a)),+r.apply(this,a)),o)return s=null,o+""||null}return o.source=function(e){return arguments.length?(t=e,o):t},o.target=function(e){return arguments.length?(n=e,o):n},o.x=function(e){return arguments.length?(i="function"==typeof e?e:mc(+e),o):i},o.y=function(e){return arguments.length?(r="function"==typeof e?e:mc(+e),o):r},o.context=function(e){return arguments.length?(s=null==e?null:e,o):s},o}function xc(e,t,n,i,r){e.moveTo(t,n),e.bezierCurveTo(t=(t+i)/2,n,t,r,i,r)}function _c(e,t,n,i,r){e.moveTo(t,n),e.bezierCurveTo(t,n=(n+r)/2,i,n,i,r)}function Ec(e){return((e=Math.exp(e))+1/e)/2}const Sc=function e(t,n,i){function r(e,r){var s,o,a=e[0],l=e[1],c=e[2],u=r[0],d=r[1],h=r[2],p=u-a,f=d-l,m=p*p+f*f;if(m<1e-12)o=Math.log(h/c)/t,s=function(e){return[a+e*p,l+e*f,c*Math.exp(t*e*o)]};else{var g=Math.sqrt(m),y=(h*h-c*c+i*m)/(2*c*n*g),v=(h*h-c*c-i*m)/(2*h*n*g),b=Math.log(Math.sqrt(y*y+1)-y),w=Math.log(Math.sqrt(v*v+1)-v);o=(w-b)/t,s=function(e){var i=e*o,r=Ec(b),s=c/(n*g)*(r*function(e){return((e=Math.exp(2*e))-1)/(e+1)}(t*i+b)-function(e){return((e=Math.exp(e))-1/e)/2}(b));return[a+s*p,l+s*f,c*r/Ec(t*i+b)]}}return s.duration=1e3*o*t/Math.SQRT2,s}return r.rho=function(t){var n=Math.max(.001,+t),i=n*n;return e(n,i,i*i)},r}(Math.SQRT2,2,4),Cc=e=>()=>e;function Tc(e,{sourceEvent:t,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function Ac(e,t,n){this.k=e,this.x=t,this.y=n}Ac.prototype={constructor:Ac,scale:function(e){return 1===e?this:new Ac(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new Ac(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var kc=new Ac(1,0,0);function Nc(e){e.stopImmediatePropagation()}function Mc(e){e.preventDefault(),e.stopImmediatePropagation()}function Pc(e){return!(e.ctrlKey&&"wheel"!==e.type||e.button)}function Lc(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function Oc(){return this.__zoom||kc}function Rc(e){return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function Ic(){return navigator.maxTouchPoints||"ontouchstart"in this}function Dc(e,t,n){var i=e.invertX(t[0][0])-n[0][0],r=e.invertX(t[1][0])-n[1][0],s=e.invertY(t[0][1])-n[0][1],o=e.invertY(t[1][1])-n[1][1];return e.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}Ac.prototype;const Fc=[{key:"all",label:"All tables"},{key:"relations",label:"With relations"},{key:"leaf",label:"Without relations"}];class SchemaGraph extends RTComp{constructor(){super(...arguments),this.state={nodes:[],links:[],displayMode:"all"},this.loaded=!1,this.onDelta=(e,t)=>{(null==t?void 0:t.displayMode)&&this.setChart()},this.setChart=()=>{const{displayMode:e,nodes:t,links:n}=this.state;let i=t.map((e=>({...e}))),r=n.map((e=>({...e})));"leaf"===e?(i=i.filter((e=>!e.hasLinks)),r=[]):"relations"===e&&(i=i.filter((e=>e.hasLinks))),function(e){var t,n;const{svgNode:i,data:r,onClickNode:s}=e,o=i;o.d3Sim&&(null===(n=(t=o.d3Sim).stop)||void 0===n||n.call(t));const a=30,l=5,c=Jo(i),u=+c.attr("width"),d=+c.attr("height"),h=240,p=60,f=(Math.sqrt(h*h+p*p),c.select("g.everything")),m=f.select("g.links"),g=f.select("g.nodes"),y=m.selectAll("path.link").data(r.links,(e=>e.id)),v=y.enter().append("path").attr("class","link").attr("stroke-width",2).attr("fill","none").attr("stroke",(e=>e.color)).merge(y);y.exit().remove();var b=g.selectAll("g.node").data(r.nodes,(e=>e.id));const w=b.enter().append("g").attr("class","node").merge(b);b.exit().remove(),w.on("click",(function(e,t){s(t.id)})),w.on("mouseover",(function(e){Jo(this).select("rect").style("fill","#f3f3f3")})).on("mouseout",(function(e){Jo(this).select("rect").style("fill","white")}));w.append("rect").attr("x",(e=>-e.width/2)).attr("y",(e=>-e.height/2)).attr("width",(e=>e.width)).attr("height",(e=>e.height)).attr("fill","white").attr("stroke","grey"),w.append("rect").attr("x",(e=>-e.width/2)).attr("y",(e=>-e.height/2)).attr("width",(e=>e.width)).attr("height",(e=>a)).attr("fill","#e1e1e1"),w.append("text").attr("x",(e=>l+-e.width/2)).attr("y",(e=>0)).style("text-anchor","start").each((function(e){const{width:t,height:n,id:i}=e;Jo(this).selectAll("tspan").data([e.header,...e.text]).enter().append("tspan").attr("x",l+-t/2).attr("y",((e,t)=>Bc(t,n))).text((e=>e.label)).style("dominant-baseline","hanging").style("fill",((e,t)=>e.color)).style("font-size",((e,t)=>t?14:18))}));function x(e){const t=[];r.nodes.forEach((e=>{t[e.cluster]?(t[e.cluster].width<e.width&&(t[e.cluster].width=e.width),t[e.cluster].height<e.height&&(t[e.cluster].height=e.height)):t[e.cluster]=e}));var n=ka().nodes(r.nodes);e.d3Sim=n;var i=function(e){var t,n,i,r,s,o,a=fa,l=function(e){return 1/Math.min(r[e.source.index],r[e.target.index])},c=ha(30),u=1;function d(i){for(var r=0,a=e.length;r<u;++r)for(var l,c,d,h,p,f,m,g=0;g<a;++g)c=(l=e[g]).source,h=(d=l.target).x+d.vx-c.x-c.vx||pa(o),p=d.y+d.vy-c.y-c.vy||pa(o),h*=f=((f=Math.sqrt(h*h+p*p))-n[g])/f*i*t[g],p*=f,d.vx-=h*(m=s[g]),d.vy-=p*m,c.vx+=h*(m=1-m),c.vy+=p*m}function h(){if(i){var o,l,c=i.length,u=e.length,d=new Map(i.map(((e,t)=>[a(e,t,i),e])));for(o=0,r=new Array(c);o<u;++o)(l=e[o]).index=o,"object"!=typeof l.source&&(l.source=ma(d,l.source)),"object"!=typeof l.target&&(l.target=ma(d,l.target)),r[l.source.index]=(r[l.source.index]||0)+1,r[l.target.index]=(r[l.target.index]||0)+1;for(o=0,s=new Array(u);o<u;++o)l=e[o],s[o]=r[l.source.index]/(r[l.source.index]+r[l.target.index]);t=new Array(u),p(),n=new Array(u),f()}}function p(){if(i)for(var n=0,r=e.length;n<r;++n)t[n]=+l(e[n],n,e)}function f(){if(i)for(var t=0,r=e.length;t<r;++t)n[t]=+c(e[t],t,e)}return null==e&&(e=[]),d.initialize=function(e,t){i=e,o=t,h()},d.links=function(t){return arguments.length?(e=t,h(),d):e},d.id=function(e){return arguments.length?(a=e,d):a},d.iterations=function(e){return arguments.length?(u=+e,d):u},d.strength=function(e){return arguments.length?(l="function"==typeof e?e:ha(+e),p(),d):l},d.distance=function(e){return arguments.length?(c="function"==typeof e?e:ha(+e),f(),d):c},d}(r.links).id((function(e){return e.id})).distance((e=>Math.max(e.sourceNode.width,e.sourceNode.height)/2+Math.max(e.targetNode.width,e.targetNode.height)/2)).strength(1),s=function(){var e,t,n,i,r,s=ha(-30),o=1,a=1/0,l=.81;function c(n){var r,s=e.length,o=wa(e,Ca,Ta).visitAfter(d);for(i=n,r=0;r<s;++r)t=e[r],o.visit(h)}function u(){if(e){var t,n,i=e.length;for(r=new Array(i),t=0;t<i;++t)n=e[t],r[n.index]=+s(n,t,e)}}function d(e){var t,n,i,s,o,a=0,l=0;if(e.length){for(i=s=o=0;o<4;++o)(t=e[o])&&(n=Math.abs(t.value))&&(a+=t.value,l+=n,i+=n*t.x,s+=n*t.y);e.x=i/l,e.y=s/l}else{(t=e).x=t.data.x,t.y=t.data.y;do{a+=r[t.data.index]}while(t=t.next)}e.value=a}function h(e,s,c,u){if(!e.value)return!0;var d=e.x-t.x,h=e.y-t.y,p=u-s,f=d*d+h*h;if(p*p/l<f)return f<a&&(0===d&&(f+=(d=pa(n))*d),0===h&&(f+=(h=pa(n))*h),f<o&&(f=Math.sqrt(o*f)),t.vx+=d*e.value*i/f,t.vy+=h*e.value*i/f),!0;if(!(e.length||f>=a)){(e.data!==t||e.next)&&(0===d&&(f+=(d=pa(n))*d),0===h&&(f+=(h=pa(n))*h),f<o&&(f=Math.sqrt(o*f)));do{e.data!==t&&(p=r[e.data.index]*i/f,t.vx+=d*p,t.vy+=h*p)}while(e=e.next)}}return c.initialize=function(t,i){e=t,n=i,u()},c.strength=function(e){return arguments.length?(s="function"==typeof e?e:ha(+e),u(),c):s},c.distanceMin=function(e){return arguments.length?(o=e*e,c):Math.sqrt(o)},c.distanceMax=function(e){return arguments.length?(a=e*e,c):Math.sqrt(a)},c.theta=function(e){return arguments.length?(l=e*e,c):Math.sqrt(l)},c}().strength((e=>e.hasLinks?-1200:-200)),o=function(e,t){var n,i=1;function r(){var r,s,o=n.length,a=0,l=0;for(r=0;r<o;++r)a+=(s=n[r]).x,l+=s.y;for(a=(a/o-e)*i,l=(l/o-t)*i,r=0;r<o;++r)(s=n[r]).x-=a,s.y-=l}return null==e&&(e=0),null==t&&(t=0),r.initialize=function(e){n=e},r.x=function(t){return arguments.length?(e=+t,r):e},r.y=function(e){return arguments.length?(t=+e,r):t},r.strength=function(e){return arguments.length?(i=+e,r):i},r}(u/2,d/2);n.force("charge_force",s).force("center_force",o).force("links",i).force("x",Na(((e,t)=>e.hasLinks?u/2:u/(t+1))).strength(.1)).force("y",Na((e=>e.hasLinks?d/2:0)).strength(.1)).force("collide",function(){let e;function t(t){const n=95,i=wa(e,(e=>e.x),(e=>e.y));for(const t of e)i.visit(((e,i,r,s,o)=>{let a=!1;if(e.data&&e.data!==t){let i,r,s,o=t.x-e.data.x,l=t.y-e.data.y,c=n+(e.data.width+t.width)/2,u=n+(e.data.height+t.height)/2,d=Math.abs(o),h=Math.abs(l);d<c&&h<u&&(i=Math.sqrt(o*o+l*l),r=(d-c)/i,s=(h-u)/i,Math.abs(r)>Math.abs(s)?r=0:s=0,t.x-=o*=r,t.y-=l*=s,e.data.x+=o,e.data.y+=l,a=!0)}return a}))}return t.initialize=t=>e=t,t}()),e.style("opacity",.5),e.attr("transform",(function(e){return"translate("+e.x+","+e.y+")"}));var a=function(){var e,t,n,i,r=la,s=ca,o=ua,a=da,l={},c=Rs("start","drag","end"),u=0,d=0;function h(e){e.on("mousedown.drag",p).filter(a).on("touchstart.drag",g).on("touchmove.drag",y,ea).on("touchend.drag touchcancel.drag",v).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(o,a){if(!i&&r.call(this,o,a)){var l=b(this,s.call(this,o,a),o,a,"mouse");l&&(Jo(o.view).on("mousemove.drag",f,ta).on("mouseup.drag",m,ta),ra(o.view),na(o),n=!1,e=o.clientX,t=o.clientY,l("start",o))}}function f(i){if(ia(i),!n){var r=i.clientX-e,s=i.clientY-t;n=r*r+s*s>d}l.mouse("drag",i)}function m(e){Jo(e.view).on("mousemove.drag mouseup.drag",null),sa(e.view,n),ia(e),l.mouse("end",e)}function g(e,t){if(r.call(this,e,t)){var n,i,o=e.changedTouches,a=s.call(this,e,t),l=o.length;for(n=0;n<l;++n)(i=b(this,a,e,t,o[n].identifier,o[n]))&&(na(e),i("start",e,o[n]))}}function y(e){var t,n,i=e.changedTouches,r=i.length;for(t=0;t<r;++t)(n=l[i[t].identifier])&&(ia(e),n("drag",e,i[t]))}function v(e){var t,n,r=e.changedTouches,s=r.length;for(i&&clearTimeout(i),i=setTimeout((function(){i=null}),500),t=0;t<s;++t)(n=l[r[t].identifier])&&(na(e),n("end",e,r[t]))}function b(e,t,n,i,r,s){var a,d,p,f=c.copy(),m=Qo(s||n,t);if(null!=(p=o.call(e,new aa("beforestart",{sourceEvent:n,target:h,identifier:r,active:u,x:m[0],y:m[1],dx:0,dy:0,dispatch:f}),i)))return a=p.x-m[0]||0,d=p.y-m[1]||0,function n(s,o,c){var g,y=m;switch(s){case"start":l[r]=n,g=u++;break;case"end":delete l[r],--u;case"drag":m=Qo(c||o,t),g=u}f.call(s,e,new aa(s,{sourceEvent:o,subject:p,target:h,identifier:r,active:g,x:m[0]+a,y:m[1]+d,dx:m[0]-y[0],dy:m[1]-y[1],dispatch:f}),i)}}return h.filter=function(e){return arguments.length?(r="function"==typeof e?e:oa(!!e),h):r},h.container=function(e){return arguments.length?(s="function"==typeof e?e:oa(e),h):s},h.subject=function(e){return arguments.length?(o="function"==typeof e?e:oa(e),h):o},h.touchable=function(e){return arguments.length?(a="function"==typeof e?e:oa(!!e),h):a},h.on=function(){var e=c.on.apply(c,arguments);return e===c?h:e},h.clickDistance=function(e){return arguments.length?(d=(e=+e)*e,h):Math.sqrt(d)},h}().on("start",h).on("drag",p).on("end",m);e.call(a);var l=function(){var e,t,n,i=Pc,r=Lc,s=Dc,o=Rc,a=Ic,l=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],u=250,d=Sc,h=Rs("start","zoom","end"),p=500,f=0,m=10;function g(e){e.property("__zoom",Oc).on("wheel.zoom",E,{passive:!1}).on("mousedown.zoom",S).on("dblclick.zoom",C).filter(a).on("touchstart.zoom",T).on("touchmove.zoom",A).on("touchend.zoom touchcancel.zoom",k).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(e,t){return(t=Math.max(l[0],Math.min(l[1],t)))===e.k?e:new Ac(t,e.x,e.y)}function v(e,t,n){var i=t[0]-n[0]*e.k,r=t[1]-n[1]*e.k;return i===e.x&&r===e.y?e:new Ac(e.k,i,r)}function b(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function w(e,t,n,i){e.on("start.zoom",(function(){x(this,arguments).event(i).start()})).on("interrupt.zoom end.zoom",(function(){x(this,arguments).event(i).end()})).tween("zoom",(function(){var e=this,s=arguments,o=x(e,s).event(i),a=r.apply(e,s),l=null==n?b(a):"function"==typeof n?n.apply(e,s):n,c=Math.max(a[1][0]-a[0][0],a[1][1]-a[0][1]),u=e.__zoom,h="function"==typeof t?t.apply(e,s):t,p=d(u.invert(l).concat(c/u.k),h.invert(l).concat(c/h.k));return function(e){if(1===e)e=h;else{var t=p(e),n=c/t[2];e=new Ac(n,l[0]-t[0]*n,l[1]-t[1]*n)}o.zoom(null,e)}}))}function x(e,t,n){return!n&&e.__zooming||new _(e,t)}function _(e,t){this.that=e,this.args=t,this.active=0,this.sourceEvent=null,this.extent=r.apply(e,t),this.taps=0}function E(e,...t){if(i.apply(this,arguments)){var n=x(this,t).event(e),r=this.__zoom,a=Math.max(l[0],Math.min(l[1],r.k*Math.pow(2,o.apply(this,arguments)))),u=Qo(e);if(n.wheel)n.mouse[0][0]===u[0]&&n.mouse[0][1]===u[1]||(n.mouse[1]=r.invert(n.mouse[0]=u)),clearTimeout(n.wheel);else{if(r.k===a)return;n.mouse=[u,r.invert(u)],so(this),n.start()}Mc(e),n.wheel=setTimeout(d,150),n.zoom("mouse",s(v(y(r,a),n.mouse[0],n.mouse[1]),n.extent,c))}function d(){n.wheel=null,n.end()}}function S(e,...t){if(!n&&i.apply(this,arguments)){var r=e.currentTarget,o=x(this,t,!0).event(e),a=Jo(e.view).on("mousemove.zoom",h,!0).on("mouseup.zoom",p,!0),l=Qo(e,r),u=e.clientX,d=e.clientY;ra(e.view),Nc(e),o.mouse=[l,this.__zoom.invert(l)],so(this),o.start()}function h(e){if(Mc(e),!o.moved){var t=e.clientX-u,n=e.clientY-d;o.moved=t*t+n*n>f}o.event(e).zoom("mouse",s(v(o.that.__zoom,o.mouse[0]=Qo(e,r),o.mouse[1]),o.extent,c))}function p(e){a.on("mousemove.zoom mouseup.zoom",null),sa(e.view,o.moved),Mc(e),o.event(e).end()}}function C(e,...t){if(i.apply(this,arguments)){var n=this.__zoom,o=Qo(e.changedTouches?e.changedTouches[0]:e,this),a=n.invert(o),l=n.k*(e.shiftKey?.5:2),d=s(v(y(n,l),o,a),r.apply(this,t),c);Mc(e),u>0?Jo(this).transition().duration(u).call(w,d,o,e):Jo(this).call(g.transform,d,o,e)}}function T(n,...r){if(i.apply(this,arguments)){var s,o,a,l,c=n.touches,u=c.length,d=x(this,r,n.changedTouches.length===u).event(n);for(Nc(n),o=0;o<u;++o)l=[l=Qo(a=c[o],this),this.__zoom.invert(l),a.identifier],d.touch0?d.touch1||d.touch0[2]===l[2]||(d.touch1=l,d.taps=0):(d.touch0=l,s=!0,d.taps=1+!!e);e&&(e=clearTimeout(e)),s&&(d.taps<2&&(t=l[0],e=setTimeout((function(){e=null}),p)),so(this),d.start())}}function A(e,...t){if(this.__zooming){var n,i,r,o,a=x(this,t).event(e),l=e.changedTouches,u=l.length;for(Mc(e),n=0;n<u;++n)r=Qo(i=l[n],this),a.touch0&&a.touch0[2]===i.identifier?a.touch0[0]=r:a.touch1&&a.touch1[2]===i.identifier&&(a.touch1[0]=r);if(i=a.that.__zoom,a.touch1){var d=a.touch0[0],h=a.touch0[1],p=a.touch1[0],f=a.touch1[1],m=(m=p[0]-d[0])*m+(m=p[1]-d[1])*m,g=(g=f[0]-h[0])*g+(g=f[1]-h[1])*g;i=y(i,Math.sqrt(m/g)),r=[(d[0]+p[0])/2,(d[1]+p[1])/2],o=[(h[0]+f[0])/2,(h[1]+f[1])/2]}else{if(!a.touch0)return;r=a.touch0[0],o=a.touch0[1]}a.zoom("touch",s(v(i,r,o),a.extent,c))}}function k(e,...i){if(this.__zooming){var r,s,o=x(this,i).event(e),a=e.changedTouches,l=a.length;for(Nc(e),n&&clearTimeout(n),n=setTimeout((function(){n=null}),p),r=0;r<l;++r)s=a[r],o.touch0&&o.touch0[2]===s.identifier?delete o.touch0:o.touch1&&o.touch1[2]===s.identifier&&delete o.touch1;if(o.touch1&&!o.touch0&&(o.touch0=o.touch1,delete o.touch1),o.touch0)o.touch0[1]=this.__zoom.invert(o.touch0[0]);else if(o.end(),2===o.taps&&(s=Qo(s,this),Math.hypot(t[0]-s[0],t[1]-s[1])<m)){var c=Jo(this).on("dblclick.zoom");c&&c.apply(this,arguments)}}}return g.transform=function(e,t,n,i){var r=e.selection?e.selection():e;r.property("__zoom",Oc),e!==r?w(e,t,n,i):r.interrupt().each((function(){x(this,arguments).event(i).start().zoom(null,"function"==typeof t?t.apply(this,arguments):t).end()}))},g.scaleBy=function(e,t,n,i){g.scaleTo(e,(function(){return this.__zoom.k*("function"==typeof t?t.apply(this,arguments):t)}),n,i)},g.scaleTo=function(e,t,n,i){g.transform(e,(function(){var e=r.apply(this,arguments),i=this.__zoom,o=null==n?b(e):"function"==typeof n?n.apply(this,arguments):n,a=i.invert(o),l="function"==typeof t?t.apply(this,arguments):t;return s(v(y(i,l),o,a),e,c)}),n,i)},g.translateBy=function(e,t,n,i){g.transform(e,(function(){return s(this.__zoom.translate("function"==typeof t?t.apply(this,arguments):t,"function"==typeof n?n.apply(this,arguments):n),r.apply(this,arguments),c)}),null,i)},g.translateTo=function(e,t,n,i,o){g.transform(e,(function(){var e=r.apply(this,arguments),o=this.__zoom,a=null==i?b(e):"function"==typeof i?i.apply(this,arguments):i;return s(kc.translate(a[0],a[1]).scale(o.k).translate("function"==typeof t?-t.apply(this,arguments):-t,"function"==typeof n?-n.apply(this,arguments):-n),e,c)}),i,o)},_.prototype={event:function(e){return e&&(this.sourceEvent=e),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(e,t){return this.mouse&&"mouse"!==e&&(this.mouse[1]=t.invert(this.mouse[0])),this.touch0&&"touch"!==e&&(this.touch0[1]=t.invert(this.touch0[0])),this.touch1&&"touch"!==e&&(this.touch1[1]=t.invert(this.touch1[0])),this.that.__zoom=t,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(e){var t=Jo(this.that).datum();h.call(e,this.that,new Tc(e,{sourceEvent:this.sourceEvent,target:g,type:e,transform:this.that.__zoom,dispatch:h}),t)}},g.wheelDelta=function(e){return arguments.length?(o="function"==typeof e?e:Cc(+e),g):o},g.filter=function(e){return arguments.length?(i="function"==typeof e?e:Cc(!!e),g):i},g.touchable=function(e){return arguments.length?(a="function"==typeof e?e:Cc(!!e),g):a},g.extent=function(e){return arguments.length?(r="function"==typeof e?e:Cc([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),g):r},g.scaleExtent=function(e){return arguments.length?(l[0]=+e[0],l[1]=+e[1],g):[l[0],l[1]]},g.translateExtent=function(e){return arguments.length?(c[0][0]=+e[0][0],c[1][0]=+e[1][0],c[0][1]=+e[0][1],c[1][1]=+e[1][1],g):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},g.constrain=function(e){return arguments.length?(s=e,g):s},g.duration=function(e){return arguments.length?(u=+e,g):u},g.interpolate=function(e){return arguments.length?(d=e,g):d},g.on=function(){var e=h.on.apply(h,arguments);return e===h?g:e},g.clickDistance=function(e){return arguments.length?(f=(e=+e)*e,g):Math.sqrt(f)},g.tapDistance=function(e){return arguments.length?(m=+e,g):m},g}().on("zoom",g);function h(e){e.active||n.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}function p(e){e.fx=e.x,e.fy=e.y}function m(e){e.active||n.alphaTarget(0),e.fx=null,e.fy=null}function g(e){f.attr("transform",e.transform)}function y(){e.attr("transform",(function(e){const{x:t,y:n}=e;return"translate("+t+","+n+")"}));const t=wc(xc).source((e=>{const t=e.source.x<e.target.x;return{x:e.source.x+(t?.5:-.5)*e.source.width,y:e.source.y+25+Bc(e.sourceColIndex,e.source.height)}})).target((e=>{const t=e.source.x<e.target.x;return{x:e.target.x-(t?.5:-.5)*e.target.width,y:e.target.y+30+Bc(e.targetColIndex,e.target.height)}})).x((e=>e.x)).y((e=>e.y));wc(_c).x((e=>e.x)).y((e=>e.y));v.attr("d",(e=>t(e)))}l(c),n.on("tick",y),n.on("end",(()=>{l.scaleTo(c,.5)}));const{nodes:b}=r}x(w)}({svgNode:this.svgRef,data:{nodes:i,links:r},onClickNode:this.props.onClickTable})}}async onMount(){const{db:e}=this.props;if(!this.loaded){this.loaded=!0;let t={nodes:[],links:[]};const n={};await Promise.all(Object.keys(e).map((async t=>{if("getColumns"in e[t]){const i=await e[t].getColumns();i.length&&(n[t]=i)}})));const i=Object.keys(n);i.map((e=>{let i={id:e,header:{label:e,color:"black"},text:n[e].map((e=>({color:"gray",label:`${e.name} ${e.udt_name.toUpperCase()}`}))),height:0,width:0,hasLinks:!1,cluster:0};i.height=Math.max(80,Bc(i.text.length+1,0)),i.width=Math.min(400,10+10*Math.max(i.header.label.length,...i.text.map((e=>e.label.length)))),t.nodes.push(i)})),i.map((e=>{const r=n[e].filter((e=>{var t;return i.includes(null===(t=e.references)||void 0===t?void 0:t.ftable)}));r.map(((i,r)=>{const s=i.references.ftable,o=i.references.fcols[0];t.links.find((t=>[t.source,t.target].sort()===[e,s].sort()))||t.links.push({color:"blue",id:[s,e].sort().join(),source:s,target:e,sourceNode:t.nodes.find((e=>e.id===s)),targetNode:t.nodes.find((t=>t.id===e)),text:{label:i.name,color:"black"},sourceColIndex:n[s].findIndex((e=>e.name===o)),targetColIndex:n[e].findIndex((e=>e.name===i.name)),sourceCol:o,targetCol:i.name})}))})),t.nodes.forEach((e=>{t.links.filter((t=>[t.source,t.target].includes(e.id))).length&&(e.hasLinks=!0,e.cluster=1)})),this.svgRef.setAttribute("width",this.svgRef.clientWidth+""),this.svgRef.setAttribute("height",this.svgRef.clientHeight+""),this.setState(t,(()=>{this.setChart()}))}}render(){return t.createElement("div",{className:"flex-col f-1",style:{minWidth:"80vw",minHeight:"80vh"}},t.createElement(Select,{value:this.state.displayMode,label:"Display",fullOptions:Fc,style:{top:"10px",left:"10px",position:"absolute"},onChange:e=>{this.setState({displayMode:e})}}),t.createElement("svg",{className:"f-1",style:{width:"100%",height:"100%"},ref:e=>{e&&(this.svgRef=e)}},t.createElement("g",{className:"everything pointer"},t.createElement("g",{className:"nodes"}),t.createElement("g",{className:"links"}))))}}function Bc(e,t){return(e?16:8)+20*e-t/2}class DashboardMenu extends RTComp{constructor(){super(...arguments),this.state={loading:!0,showImportFile:!1,showSchemaDiagram:!1,queries:[],showSettings:!1},this.d={},this.fileSelected=async e=>{const t=e.target.files[0];t&&this.props.loadTable({sql:await or(t),type:"sql"})},this.onkeyDown=e=>{var t,n;const i=null===(n=null===(t=window.getSelection())||void 0===t?void 0:t.toString())||void 0===n?void 0:n.trim();"o"===e.key&&e.ctrlKey?(e.preventDefault(),this.inptRef&&this.inptRef.click(),console.log(this.inptRef)):"p"===e.key&&e.ctrlKey?(e.preventDefault(),this.setState({showSearchAll:{mode:"views and queries",term:i}})):"k"===e.key&&e.ctrlKey?(e.preventDefault(),this.setState({showSearchAll:{mode:"commands",term:i}})):"F"===e.key&&e.shiftKey&&e.ctrlKey?(e.preventDefault(),this.setState({showSearchAll:{mode:"rows",term:i}})):"Escape"===e.key&&this.setState({showSearchAll:void 0,showImportFile:!1})},this.onDelta=async e=>{var t;const{dbs:n,workspace:i}=this.props;if(i&&!this.windowsSync){const e=(null===(t=null==i?void 0:i.options)||void 0===t?void 0:t.showAllMyQueries)?{}:{workspace_id:i.id};this.windowsSync=await n.windows.sync(e,{handlesOnData:!0,select:"*",patchText:!1},((e,t)=>{if(!this.mounted)return;let n=e.sort(((e,t)=>+e.last_updated-+t.last_updated));const i=n.filter((e=>"sql"===e.type&&!e.deleted));this.setState({queries:i})}))}}}onMount(){window.addEventListener("keydown",this.onkeyDown,!0)}onUnmount(){var e;window.removeEventListener("keydown",this.onkeyDown,!0),null===(e=this.windowsSync)||void 0===e||e.$unsync()}render(){var e,n;const{showSchemaDiagram:i,showSearchAll:r,showImportFile:s,queries:o,showSettings:a,newWspName:l,newWspErr:c}=this.state,{searchAll:u,db:d,tables:h,loadTable:p,workspace:f}=this.props,m=o.filter((e=>e.closed));let g;i?g=t.createElement(Popup,{open:!0,title:"Schema diagram",positioning:"top-center",onClose:()=>this.setState({showSchemaDiagram:!1})},t.createElement(SchemaGraph,{db:d,onClickTable:e=>{p({type:"table",table:e,name:e}),this.setState({showSchemaDiagram:!1})}})):a&&(g=t.createElement(Popup,{open:!0,positioning:"top-center",onClose:()=>this.setState({showSettings:!1}),title:"Workspace settings"},t.createElement(Checkbox,{label:"Hide all counts",checked:!!(null===(e=f.options)||void 0===e?void 0:e.hideCounts),onChange:e=>{f.$update({options:{hideCounts:e.target.checked}},{deepMerge:!0})}}),t.createElement("p",{className:"text-gray-600"},"This will disable counts for left menu and table headers. Usefull when there is a performance downgrade"),t.createElement(Checkbox,{label:"Show all my queries",className:"mt-2",checked:!!(null===(n=f.options)||void 0===n?void 0:n.showAllMyQueries),onChange:e=>{f.$update({options:{showAllMyQueries:e.target.checked}},{deepMerge:!0}),setTimeout((()=>{window.location.reload()}),500)}}),t.createElement("p",{className:"text-gray-600 ta-left"},"Will allow using queries from all your connections and not just the current one. Requires a page refresh")));window.innerHeight;return t.createElement(t.Fragment,null,g,r?t.createElement(SearchAll,{db:d,tables:h,searchType:r.mode,defaultTerm:r.term,suggestions:u,queries:o,loadTable:p,onOpenDBObject:e=>{if("function"===e.type)p({type:"sql",sql:e.definition,name:e.subLabel||e.label});else{if("table"!==e.type)throw e;d[e.label]?p({type:"table",table:e.label,name:e.label}):p({type:"sql",sql:`SELECT *\nFROM ${e.escapedIdentifier}\nLIMIT 25`,name:e.label})}},onOpen:({filter:e,table:t})=>{p({type:"table",table:t,filter:e})},onClose:()=>{this.setState({showSearchAll:void 0})}}):null,s?t.createElement(FileImporter,{tables:h,db:d,onClose:()=>{this.setState({showImportFile:!1})},openTable:e=>{p({type:"table",table:e})}}):null,t.createElement("input",{ref:e=>{e&&(this.inptRef=e)},type:"file",accept:"text/*, .sql, .txt",className:"hidden",onChange:this.fileSelected}),t.createElement(st,{title:" ",rootStyle:{top:0,left:0,maxHeight:"100%"},positioning:"as-is",button:t.createElement(Btn,{title:"Menu",style:{border:"1px solid #00d0ff",background:"rgb(240 254 255)",borderRadius:"4px",padding:"2px",marginBottom:"4px"},"data-command":"menu"},t.createElement("img",{src:"/prostgles-logo.svg"})),contentStyle:{overflow:"hidden",padding:0},render:e=>t.createElement("div",{className:"flex-col f-1 min-h-0 "+(window.isMobileDevice?" p-p25 ":" p-1  "),onKeyDown:t=>{"Escape"===t.key&&e()}},t.createElement("div",{className:"flex-row f-0"},d&&d.sql?t.createElement(Btn,{key:"sql",style:{marginLeft:"6px"},onClick:t=>{p({type:"sql",name:"SQL Query"}),e()},"data-command":"sql-editor",variant:"outline",iconPath:"M8,3A2,2 0 0,0 6,5V9A2,2 0 0,1 4,11H3V13H4A2,2 0 0,1 6,15V19A2,2 0 0,0 8,21H10V19H8V14A2,2 0 0,0 6,12A2,2 0 0,0 8,10V5H10V3M16,3A2,2 0 0,1 18,5V9A2,2 0 0,0 20,11H21V13H20A2,2 0 0,0 18,15V19A2,2 0 0,1 16,21H14V19H16V14A2,2 0 0,1 18,12A2,2 0 0,1 16,10V5H14V3H16Z"},"SQL Editor"):null,t.createElement(Btn,{iconPath:qe,title:"Show quick search menu (CTRL + P)",className:"ml-auto",onClick:()=>{this.setState({showSearchAll:{mode:"views and queries",term:void 0}}),e()}}),t.createElement(Btn,{iconPath:ke,title:"Show settings",className:"ml-p25",onClick:()=>{this.setState({showSettings:!0}),e()}})),m.length?t.createElement(SearchList,{id:"search-list-queries",className:" mt-p5 ",style:{minHeight:"120px",maxHeight:"30vh"},placeholder:"Queries",items:m.sort(((e,t)=>+t.last_updated-+e.last_updated)).map(((n,i)=>{var r;return{key:i,contentLeft:t.createElement("div",{className:"flex-col ai-start f-0 mr-p5 text-gray-500"},t.createElement(tt(),{path:$e,size:1})),label:n.name,contentRight:t.createElement("span",{className:"text-gray-400 ml-auto italic"},null===(r=n.sql)||void 0===r?void 0:r.slice(0,10),"..."),onPress:()=>{var t;null===(t=n.$update)||void 0===t||t.call(n,{closed:!1}),e()}}}))}):null,h.length?t.createElement(SearchList,{limit:100,id:"search-list-tables",className:" mt-p5 ",style:{minHeight:"120px",height:"50%"},placeholder:"Tables and views",items:h.sort(((e,t)=>{var n;return(null===(n=null==f?void 0:f.options)||void 0===n?void 0:n.hideCounts)?e.name.localeCompare(t.name):+t.count-+e.count})).map(((n,i)=>{var r;return{contentLeft:t.createElement("div",{className:"flex-col ai-start f-0 mr-p5 text-gray-500"},t.createElement(tt(),{path:(null===(r=null==d?void 0:d[n.name])||void 0===r?void 0:r.insert)?Ke:Xe,size:1})),key:n.name,label:n.name,contentRight:+n.count>0?t.createElement("span",{className:"text-gray-400 ml-auto"},ZC(+n.count)):null,onPress:()=>{p({type:"table",table:n.name}),e()}}}))}):t.createElement("div",{className:"text-gray-500 p-1"},"0 tables/views"),t.createElement("div",{className:"flex-row-wrap f-0 m-p5"},t.createElement(Btn,{iconPath:He,className:"fit",size:"small",title:"Import data from file","data-command":"import-data",variant:"outline",onClick:()=>{this.setState({showImportFile:!0}),e()}},"Import data"),t.createElement(Btn,{iconPath:"M22 13V19H21L19 17H11V9H5L3 11H2V5H3L5 7H13V15H19L21 13Z",className:"fit ml-2",size:"small",style:{opacity:.05},title:"Show schema diagram","data-command":"schema-diagram",variant:"outline",onClick:()=>{this.setState({showSchemaDiagram:!0}),e()}},"Schema diagram")))}))}}class WorkspaceMenu extends RTComp{constructor(){super(...arguments),this.state={loading:!0,queries:[],workspaces:[],showSettings:!1},this.d={},this.onDelta=async e=>{var t,n;const{dbs:i,workspace:r}=this.props;r&&!this.workspacesSync&&(this.workspacesSync=await(null===(n=(t=i.workspaces).sync)||void 0===n?void 0:n.call(t,{connection_id:r.connection_id,deleted:!1},{handlesOnData:!0,select:"*",patchText:!1},((e,t)=>{this.mounted&&this.setState({workspaces:e})}))))}}onMount(){}onUnmount(){var e;null===(e=this.workspacesSync)||void 0===e||e.$unsync()}setWorkspace(e){const t=["/connections",null==e?void 0:e.connection_id,null==e?void 0:e.id].filter((e=>e)).join("/");window.location.href=t}render(){const{workspaces:e,newWspName:n,newWspErr:i}=this.state,{workspace:r}=this.props;window.innerHeight;return t.createElement(t.Fragment,null,t.createElement(st,{title:" ",rootStyle:{top:0,left:0,maxHeight:"100%"},positioning:"as-is",button:t.createElement(Btn,{title:"Workspace",className:"ml-1",variant:"outline",style:{background:"rgba(240 254 255 111)"},"data-command":"menu"},r.name||t.createElement("i",null,"[Empty]")),contentStyle:{overflow:"hidden",padding:0},render:s=>t.createElement("div",{className:"flex-col f-1 min-h-0 "+(window.isMobileDevice?" p-p25 ":" p-1  "),style:{paddingTop:0},onKeyDown:e=>{"Escape"===e.key&&s()}},e.length?t.createElement(SearchList,{id:"search-list-queries",className:" mt-p5 ",style:{minHeight:"120px",maxHeight:"30vh"},placeholder:"Workspaces",items:e.sort(((e,t)=>+t.last_updated-+e.last_updated)).map(((e,n)=>({key:n,label:e.name,labelStyle:{},rowStyle:r.id===e.id?{border:"1px solid rgb(0, 183, 255)",background:"rgb(155 227 255)"}:{},contentLeft:t.createElement("div",{className:"flex-col ai-start f-0 mr-p5 text-gray-500"},t.createElement(tt(),{path:$e,size:1})),contentRight:t.createElement(st,{style:{height:"100%"},onClickClose:!1,button:t.createElement(Btn,{title:"Delete this workspace",iconPath:Me,className:"delete-workspace",size:"small",color:"danger"}),content:t.createElement("div",null,"Are you sure you want to delete this workspace and all related data (windows, links)?"),footerButtons:[{color:"danger",label:"Delete workspace",onClick:async t=>{t.preventDefault(),t.stopPropagation();try{if(await this.props.dbs.workspaces.update({id:e.id},{deleted:!0}),e.id===this.props.workspace.id){const t=["/connections",e.connection_id].filter((e=>e)).join("/");window.location.href=t}else window.location.reload()}catch(e){this.setState({newWspErr:e})}}},{label:"Cancel",onClickClose:!0}]}),onPress:t=>{var n,i;e.id===this.props.workspace.id||(null===(i=null===(n=t.target)||void 0===n?void 0:n.closest)||void 0===i?void 0:i.call(n,".delete-workspace"))||(this.setWorkspace(e),s())}})))}):t.createElement("div",{className:"text-gray-400"},"No other workspaces"),t.createElement(st,{style:{height:"100%"},onClickClose:!1,button:t.createElement(Btn,{title:"Add new workspace",iconPath:He,className:"h-full m-1",size:"small",variant:"outline",color:"action"},"Add"),content:t.createElement("div",null,t.createElement(FormField,{label:"Workspace name",asColumn:!0,value:n,onChange:e=>{this.setState({newWspName:e,newWspErr:void 0})},error:i})),footerButtons:[{color:"action",label:"Add workspace",onClick:async()=>{try{const e=await this.props.dbs.workspaces.insert({name:n,connection_id:this.props.workspace.connection_id},{returning:"*"});this.setWorkspace(e)}catch(e){this.setState({newWspErr:e})}}},{label:"Cancel",onClickClose:!0}]}))}))}}class JoinPathSelector extends RTComp{constructor(){super(...arguments),this.state={jpath:[]}}static hasJoins(e,t){return Boolean(t.find((t=>t.name===e&&t.columns.find((e=>e.references))||t.name!==e&&t.columns.find((t=>{var n;return(null===(n=t.references)||void 0===n?void 0:n.ftable)===e})))))}onDelta(){const{tables:e,tableName:t}=this.props;e&&t&&!this.state.joins&&this.setState({joins:uT({tables:e,tableName:t})||[]})}render(){const{jpath:e,joins:n,j:i}=this.state,{onSelect:r,className:s="",style:o={},tableName:a,onLinkTable:l}=this.props;let c=n;if(i&&(c=i.joins),!n)return t.createElement(Loading,null);const u=(e,t)=>{this.setState({jpath:e,j:t}),r(e.map((e=>e.table)),e)},d=e.map(((n,i)=>t.createElement("div",{key:i,className:"flex-col ",style:{marginLeft:5*i+"px"}},t.createElement("div",{className:"flex-row p-p25 text-gray-500",style:{marginLeft:5*(i-1)+"px"}},"(",n.on.map((e=>e.join(" = "))).join(" AND"),")"),t.createElement("div",{className:"flex-row p-p25 "+(i===e.length-1?"":" pointer  text-hover ")+(i===e.length-1?" font-bold ":"  "),style:{marginLeft:5*(i+1)+"px"},onClick:i===e.length-1?void 0:()=>{const t=e.findIndex((e=>e.table===n.table)),i=e.slice(0,t+1);u(i,n)}},n.table)))),h=e.length?t.createElement("div",{className:"flex-col ta-left bg-gray-100 mb-1"},t.createElement("div",{className:"flex-row p-p5 text-gray-500"},"Current path:"),t.createElement("div",{className:"flex-row p-p25 pointer text-hover",onClick:()=>{u([],void 0)}},a),d):null;let p=null;(null==c?void 0:c.length)&&(p=t.createElement(SearchList,{style:{backgroundColor:"transparent"},className:"",id:"link-menu",noSearch:c.length<15,items:c.map((t=>({key:t.table,label:t.table,subLabel:` (${t.on.flatMap((e=>e[0]+" = "+e[1])).join(", ")})`,onPress:()=>{const n=[...e,t];u(n,t)}})))}));const f=e.map((e=>e.table)),m=null==f?void 0:f[f.length-1];let g=null;return l&&m&&(g=t.createElement("div",{className:"flex-col w-fit"},t.createElement(Btn,{iconPath:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z",variant:"filled",color:"action",size:"small",className:" ",onClick:()=>{l(m,f)}},"Join to ",JSON.stringify(m)),p&&t.createElement("div",{className:"mt-p5"},"or"))),t.createElement("div",{className:"flex-col noselect "+s,style:o},h,g,p&&t.createElement("div",{className:"flex-col  bg-bldue-50  mt-1"},t.createElement("div",{className:"flex-row p-p5 text-blue-500 p-1"},"Choose next table"),p))}}class SmartAddFilter extends RTComp{constructor(){super(...arguments),this.state={searchTerm:"",existsFilterType:"$existsJoined"}}render(){var e,n,i,r;const{addFilter:s,existsFilterType:o}=this.state,{tableName:a,onChange:l,detailedFilter:c,className:u,style:d={},tables:h,filterFields:p}=this.props,f=c||[],m=null===(e=h.find((e=>e.name===a)))||void 0===e?void 0:e.columns.filter((e=>!p||p.includes(e.name))),g=e=>Boolean((null==e?void 0:e.references)||!["number","Date"].includes(null==e?void 0:e.tsDataType)),y=JoinPathSelector.hasJoins(a,h);let v;(null===(n=null==s?void 0:s.path)||void 0===n?void 0:n.length)&&(v=null==s?void 0:s.path[(null==s?void 0:s.path.length)-1]);let b,w=null!==(r=(null==s?void 0:s.path)?(null==s?void 0:s.path.length)?null===(i=h.find((e=>e.name===v)))||void 0===i?void 0:i.columns:[]:m)&&void 0!==r?r:[];return s&&(b=t.createElement(Popup,{open:!0,positioning:"top-center",onClose:()=>{this.setState({addFilter:void 0})},contentStyle:{padding:0}},y?t.createElement(Btn,{title:((null==s?void 0:s.path)?"Disable":"Enable")+" Join filter",className:"w-full",style:{width:"100%"},iconPath:"M9,5A7,7 0 0,0 2,12A7,7 0 0,0 9,19C10.04,19 11.06,18.76 12,18.32C12.94,18.76 13.96,19 15,19A7,7 0 0,0 22,12A7,7 0 0,0 15,5C13.96,5 12.94,5.24 12,5.68C11.06,5.24 10.04,5 9,5M9,7C9.34,7 9.67,7.03 10,7.1C8.72,8.41 8,10.17 8,12C8,13.83 8.72,15.59 10,16.89C9.67,16.96 9.34,17 9,17A5,5 0 0,1 4,12A5,5 0 0,1 9,7M15,7A5,5 0 0,1 20,12A5,5 0 0,1 15,17C14.66,17 14.33,16.97 14,16.9C15.28,15.59 16,13.83 16,12C16,10.17 15.28,8.41 14,7.11C14.33,7.04 14.66,7 15,7Z",color:(null==s?void 0:s.path)?"action":void 0,onClick:()=>{this.setState({addFilter:{...s||{},path:(null==s?void 0:s.path)?void 0:[]}})}},((null==s?void 0:s.path)?"Disable":"Enable")+" Join filter"):null,(null==s?void 0:s.path)&&t.createElement(Select,{className:"my-p5 m-auto",title:"Filter type",fullOptions:[{key:"$existsJoined",label:"Exists"},{key:"$notExistsJoined",label:"Not Exists"}],value:o,onChange:e=>{this.setState({existsFilterType:e})}}),t.createElement("div",{className:(window.isMobileDevice?" flex-col ":" flex-row ")+"  bt b-gray-200",style:{maxHeight:"90vh"}},y?t.createElement("div",{className:"flex-col f-1 o-auto br b-gray-200"},(null==s?void 0:s.path)?t.createElement(JoinPathSelector,{tables:h,tableName:a,onSelect:e=>{this.setState({addFilter:{...s||{},path:e}})}}):null):null,w.length?t.createElement(SearchList,{label:"Choose column"+(v?` (${v})`:""),id:"search-list-cols f-1",style:{maxHeight:"unset"},items:w.map((e=>({key:e.name,label:e.name,subLabel:e.udt_name,onPress:()=>{const t=e.name,n=w.find((e=>e.name===t));if(!n)return;let i,r={fieldName:t,type:(null==s?void 0:s.path)?"not null":g(n)?"$in":"$between",filter:void 0};i=(null==s?void 0:s.path)?{type:o,path:null==s?void 0:s.path,filter:r}:r,null==l||l([...f,i]),this.setState({addFilter:void 0})}})))}):null))),t.createElement(t.Fragment,null,t.createElement(Btn,{title:"Add filter",className:"shadow m-p5"+u,size:"small",style:{backgroundColor:"white",borderRadius:"6px",...d},iconPath:"M12 12V19.88C12.04 20.18 11.94 20.5 11.71 20.71C11.32 21.1 10.69 21.1 10.3 20.71L8.29 18.7C8.06 18.47 7.96 18.16 8 17.87V12H7.97L2.21 4.62C1.87 4.19 1.95 3.56 2.38 3.22C2.57 3.08 2.78 3 3 3H17C17.22 3 17.43 3.08 17.62 3.22C18.05 3.56 18.13 4.19 17.79 4.62L12.03 12H12M15 17H18V14H20V17H23V19H20V22H18V19H15V17Z",onClick:()=>{this.setState({addFilter:{}})}}),b)}}class SmartSearch extends RTComp{constructor(){super(...arguments),this.state={searchKey:Date.now()},this.onDelta=e=>{(null==e?void 0:e.defaultValue)&&this.setState({searchKey:Date.now()})},this.onSearchItems=async(e,n,i)=>{var r;if("string"!=typeof e)return[];const s=null!==(r=null==n?void 0:n.matchCase)&&void 0!==r&&r,{db:o,tableName:a,columns:l,column:c,onType:u,tables:d,detailedFilter:h=[]}=this.props,p=d.find((e=>e.name===a)),f=null==p?void 0:p.columns.filter((e=>(c&&e.name===c||(null==l?void 0:l.length)&&l.includes(e.name)||!l&&!c)&&e.select&&"geography"!==e.udt_name&&"geometry"!==e.udt_name&&"bytea"!==e.udt_name));null==p||p.columns.find((e=>e.name===c));if(!(null==f?void 0:f.length))throw"no cols ";null==u||u(e);let m=[];const g=(t="*",n=3,i=!1)=>{var r,l;const u=(n=!1)=>({[t]:{[`$${n?"n":""}${s?"":"i"}like`]:`${e}%`}});let d=[];d=i?[u()]:[u(!0),{$term_highlight:[[t],e,{matchCase:s,edgeTruncate:30,returnType:"boolean"}]}];let p={prgl_term_highlight:{$term_highlight:[[t],e,{matchCase:s,edgeTruncate:30,returnType:"object"}]}};return c&&(p[c]=1),(null==h?void 0:h.length)&&(d=[lT(h,{filters:d})]),null===(l=(r=o[a]).find)||void 0===l?void 0:l.call(r,{$and:d.filter(vT)},{select:p,limit:n,groupBy:!0})},y=Boolean(e&&/[a-z]/i.test(e));let v=[],b=[],w=!1;for(let n=0;n<f.length;n++){const r=f[n];if(w||"number"===r.tsDataType&&y);else{try{const e=await g(r.name,void 0,!0),t=3-e.length;m=m.concat(e),t>0&&(m=m.concat(await g(r.name,t)))}catch(e){console.error(e)}b=m.filter((e=>null==e?void 0:e.prgl_term_highlight)).map(((n,i)=>{var r,s,o;const a=null!=c?c:null===(r=Object.keys((null==n?void 0:n.prgl_term_highlight)||{}))||void 0===r?void 0:r[0];let l,u,d;return a&&(d=null===(s=null==n?void 0:n.prgl_term_highlight)||void 0===s?void 0:s[a].flat().join(""),u=c?null==n?void 0:n[c]:d,l=t.createElement("div",{className:"flex-col ws-pre f-1"},1!==(null==f?void 0:f.length)&&t.createElement("div",{className:"f-0 color-action font-14",style:{fontWeight:400}},a,": "),t.createElement("div",{className:"f-1 ",style:{marginTop:"4px"}},SearchAll.renderRow(null===(o=null==n?void 0:n.prgl_term_highlight)||void 0===o?void 0:o[a],i)))),{key:i,content:l,label:u,title:u+"",onPress:()=>{var t,n,i;const r={fieldName:a,type:"$term_highlight",value:null!=d?d:e};let s=[...null!==(t=this.props.detailedFilter)&&void 0!==t?t:[],r];null===(i=(n=this.props).onChange)||void 0===i||i.call(n,s,{columnValue:u,columnTermValue:d,term:e,colName:a})}}})),v=v.concat(b)}null==i||i(b,n===f.length-1,(()=>{w=!0}))}return v}}render(){const{searchItems:e,searchKey:n}=this.state,{style:i,className:r,label:s,placeholder:o="Search ...",defaultValue:a,onPressEnter:l,variant:c,searchEmpty:u=!1,detailedFilter:d}=this.props;return t.createElement(SearchList,{key:a,defaultValue:a,style:i,id:"search-all",className:r,items:e,variant:c||"search",searchEmpty:u,onSearchItems:this.onSearchItems,label:s,placeholder:o,onPressEnter:l,dataSignature:JSON.stringify(d)})}}class SmartFilterBar extends t.Component{constructor(){super(...arguments),this.state={}}render(){var e,n,i,r,s;const{db:o,tables:a,leftContent:l,filterFields:c,style:u,className:d,rightContent:h,hideSort:p}=this.props,{filter:f=[]}="w"in this.props?this.props.w:this.props,{table_name:m}="w"in this.props?this.props.w:this.props,g="w"in this.props?e=>{"w"in this.props&&this.props.w.$update({filter:e},{deepMerge:!0})}:this.props.onChange,y="w"in this.props&&this.props.w?this.props.w:void 0,v=a.find((e=>e.name===m)),b=f.map((e=>({...e})));if(!m||!v)return null;const w=null==b?void 0:b.some((e=>!e.minimised));let x=null;if(!p){const o=(e,t=!0)=>{if(!e)return;const n={key:e,asc:null==t||t};"w"in this.props?y&&y.$update({sort:[n]}):this.props.onSortChange&&(this.setState({orderByKey:e,orderAsc:t}),this.props.onSortChange(n))},a=v.columns.filter((e=>e.filter));let l,c=!0;"w"in this.props?(l=null===(e=null==y?void 0:y.sort[0])||void 0===e?void 0:e.key,c=null===(i=null===(n=null==y?void 0:y.sort[0])||void 0===n?void 0:n.asc)||void 0===i||i):"string"==typeof(null===(r=this.props.sort)||void 0===r?void 0:r.key)&&(l=this.props.sort.key,c=null===(s=this.props.sort.asc)||void 0===s||s),x=t.createElement("div",{className:" flex-row min-h-0 f-0 relative ai-center pl-p5"},t.createElement(Select,{id:"orderbycomp",buttonClassName:"shadow bg-white",style:{background:"white"},emptyLabel:"Sort by...",asRow:!0,value:l,fullOptions:a.map((e=>({key:e.name,label:e.label||e.name}))),onChange:e=>{o(e,c)}}),l&&t.createElement(Btn,{color:"action",iconPath:c?We:Ge,onClick:()=>{o(l,!c)}}))}return t.createElement("div",{className:"flex-col min-h-0 min-w-0 relative  "+d,style:u},l,t.createElement("div",{className:"flex-row-wrap min-h-0 f-0 relative ai-center px-1 "},t.createElement(SmartAddFilter,{tableName:m,filterFields:c,db:o,tables:a,detailedFilter:b,onChange:g}),Boolean(null==b?void 0:b.length)&&t.createElement(Btn,{title:"Expand/Collapse filters",iconPath:window.isMobileDevice?w?Ze:Je:void 0,onClick:()=>{const e=b.map((e=>(sT(e)&&(e.filter.minimised=w),{...e,minimised:w})));g(e)}},window.isMobileDevice?null:(w?"Collapse":"Expand")+" filters"),t.createElement("div",{className:"flex-row f-1 mx-p5 jc-center mr-p5 ai-center"},t.createElement(SmartSearch,{tables:a,db:o,style:{alignSelf:"center",width:"500px",maxWidth:"80vw"},className:"m-auto",tableName:m,detailedFilter:b,onChange:(e,{colName:t,columnValue:n,term:i})=>{const r=v.columns.find((e=>e.name===t));if(!t)throw"Unexpected: colName missing";let s=e.slice(0);if(n&&r&&"Date"===r.tsDataType){const e={fieldName:t,type:"$term_highlight",value:i};s=[...b,e]}else if(n&&r&&"number"===r.tsDataType){const e={fieldName:t,type:"=",value:n};s=[...b,e]}else if(n&&r&&"number"===r.tsDataType){const e={fieldName:t,type:"=",value:n};s=[...b,e]}g(s)}}),x,h)),!!(null==b?void 0:b.length)&&t.createElement("div",{className:"flex-row-wrap min-h-0 f-0 relative ai-start px-1 mb-p5"},t.createElement(SmartFilter,{className:"mr-1 mt-p5",tables:a,db:o,tableName:m,detailedFilter:b,onChange:g})))}}class SmartTable extends RTComp{constructor(){super(...arguments),this.state={rows:[],tableCols:[],page:1,pageSize:25,totalRows:0,sort:[]},this.getData=async(e,t,n,i)=>{var r;void 0===e&&(e=null!==(r=this.state.filter)&&void 0!==r?r:[]),void 0===t&&(t=this.state.sort),void 0===n&&(n=this.state.page),void 0===i&&(i=this.state.pageSize);const{tableName:s,db:o}=this.props,a=lT(e),l=await o[s].count(a),c=await o[s].find(a,{limit:i,orderBy:t,offset:(n-1)*i});this.setState({rows:c,filter:e,sort:t,page:n,pageSize:i,totalRows:l})}}async onMount(){var e,t;const{filter:n,tableName:i,db:r,tableCols:s,tables:o,allowEdit:a}=this.props;let l=null!=s?s:[];if(!s){const n=null!==(t=null===(e=o.find((e=>e.name===i)))||void 0===e?void 0:e.columns)&&void 0!==t?t:[];l=n.map((e=>({key:e.name,sortable:!0,subLabel:e.data_type,...e}))),a&&l.unshift(KC(n,r[i],!1,(e=>{this.setState({editRowFilter:e})})))}this.setState({filter:n,tableCols:l},(()=>this.getData()))}render(){var e;const{tableName:n,db:i,tables:r,onClickRow:s,onClosePopup:o,showInsert:a,className:l}=this.props,{tableCols:c,filter:u,rows:d,sort:h,page:p,pageSize:f,totalRows:m,showInsertPopup:g,editRowFilter:y}=this.state,v=null!==(e=this.props.title)&&void 0!==e?e:t.createElement("span",null,n," ",t.createElement("span",{className:"text-gray-400"},`(${m.toLocaleString()} record${m>1?"s":""})`)),b=t.createElement("div",{className:"flex-col f-1 min-h-0 relative "+(o?"":l)},y&&t.createElement(SmartForm,{asPopup:!0,confirmUpdates:!0,hideChangesOptions:!0,db:i,tables:r,tableName:n,rowFilter:y,onSuccess:()=>{this.getData()},onClose:()=>{this.setState({editRowFilter:void 0})}}),g&&t.createElement(SmartForm,{asPopup:!0,confirmUpdates:!0,hideChangesOptions:!0,db:i,tables:r,tableName:n,onSuccess:()=>{this.getData()},onClose:()=>{this.setState({showInsertPopup:void 0})}}),t.createElement(SmartFilterBar,{className:"py-1 bg-gray-100",db:i,table_name:n,tables:r,filter:u,onChange:e=>{this.getData(e)},hideSort:!0,rightContent:a&&t.createElement(Btn,{iconPath:He,variant:"filled",color:"action",size:"small",title:"Insert row",className:"shadow w-fit h-fit",onClick:async()=>{this.setState({showInsertPopup:!0})}})}),t.createElement(Table,{rows:d,cols:c,className:"pb-1",onRowClick:s,sort:h,onSort:e=>{this.getData(void 0,e)},pagination:{page:p,pageSize:10,totalRows:m,onPageChange:e=>{this.getData(void 0,void 0,e)},onPageSizeChange:e=>{this.getData(void 0,void 0,void 0,e)}}}));return o?t.createElement(Popup,{open:!0,title:v,positioning:"right-panel",onClose:o,contentStyle:{maxWidth:"calc(99vw - 20px)",padding:".5em 0 0 0"},contentClassName:l},b):b}}class Chip extends t.Component{render(){const{className:e="",value:n,label:i,variant:r}=this.props;let s=" chip lg gray b b-gray-300 ";return"naked"===r&&(s=""),t.createElement("div",{...pT(this.props,[],["children","label","value","variant"]),className:"chip-component flex-row ws-pre "+s+e},"string"!=typeof i?null:t.createElement("span",{className:"text-gray-600",style:{fontWeight:400}},i,": "),t.createElement("span",{className:"font-medium f-1 text-ellipsis"},n))}}const zc=[{key:"Create workspaces",subLabel:"Will be able to create and view own workspaces/dashboards"},{key:"View published workspaces",subLabel:"View already published workspaces/dashboards"}],jc=["Run SQL","All views/tables","Custom"],Vc={type:"All views/tables",userGroupNames:[],workspacePermissions:{},allowAllTables:{select:!0,update:!0,insert:!0,delete:!0}};class AccessControl extends RTComp{constructor(){super(...arguments),this.state={loading:!1,tables:[],rule:Vc,userTypes:[],rules:[],existingUserStats:[],existingACUserTypes:[]},this.d={},this.loaded=!1,this.upsertRule=async()=>{const{dbs:e,db:t,tables:n,connectionId:i}=this.props,{rule:r,selectedRuleId:s,userTypes:o}=this.state;try{if(!await e.connections.findOne({id:i}))throw`Connection not found (id = ${i})`;{const t=t=>e.access_control_user_types.insert(r.userGroupNames.map((e=>({access_control_id:t,user_type:e}))));if(s)await e.access_control.update({id:s},{rule:r}),await e.access_control_user_types.delete({access_control_id:s}),await t(s);else{const n=await e.access_control_user_types.find({user_type:{$in:r.userGroupNames}},{select:{user_type:1},returnType:"values"});if(n.length)throw`Cannot have rules with overlapping user group names: ${n.flat().join(", ")}.\nRemove these group names from this rule or from the other rules`;{const n=await e.access_control.insert({connection_id:i,rule:r},{returning:"*"});await t(n.id)}}this.setState({ruleUpdated:!0})}}catch(e){this.setState({error:e,ruleUpdated:!1})}}}static getRuleDescription(e){if("Run SQL"===e.type)return"Full database access";if("All views/tables"===e.type)return`${(0,Xn.getKeys)(e.allowAllTables).filter((t=>e.allowAllTables[t])).join(", ")||"No"} actions allowed to all tables within the database`;if("Custom"===e.type){const t=e.customTables.filter((e=>e.select)),n=e.customTables.filter((e=>e.insert)),i=e.customTables.filter((e=>e.delete)),r=e.customTables.filter((e=>e.update));return[`Select on ${t.length} tables`,`Insert on ${n.length} tables`,`Update on ${r.length} tables`,`Delete on ${i.length} tables`].join("\n")}return""}async onDelta(e,t,n){var i;const{connectionId:r,dbs:s}=this.props,o={...t,...t};if(r&&!this.conSub){const e=async()=>{const e=await s.access_control.find({connection_id:r},{select:{"*":1,access_control_user_types:{ids:{$array_agg:["user_type"]}}}});this.setState({rules:e})};this.conSub=await s.access_control.subscribe({connection_id:r},{select:""},(t=>{e()})),this.conUTypesSub=await s.access_control_user_types.subscribe({},{},(t=>{this.setState({existingACUserTypes:t}),e()})),this.ugSub=await s.user_types.subscribe({},{},(e=>{this.setState({userTypes:e})})),this.setState({connection:await s.connections.findOne({id:r}),existingUserStats:await s.users.find({},{select:{type:1,count:{$countAll:[]}},orderBy:{count:-1}})})}o.selectedRuleId&&this.setState({rule:(null===(i=await s.access_control.findOne({id:o.selectedRuleId}))||void 0===i?void 0:i.rule)||Vc});const{rule:a,selectedRule:l}=this.state;o.rule&&this.setState({ruleUpdated:!1,ruleWasEdited:Boolean(a&&JSON.stringify(a)!==JSON.stringify(l))})}async onUnmount(){var e,t,n;null===(e=this.ugSub)||void 0===e||e.unsubscribe(),null===(t=this.conSub)||void 0===t||t.unsubscribe(),null===(n=this.conUTypesSub)||void 0===n||n.unsubscribe()}render(){const{rule:e,userTypes:n,connection:i,error:r,ruleUpdated:s,ruleWasEdited:o,selectedRule:a,selectedRuleId:l,rules:c,existingUserStats:u,existingACUserTypes:d}=this.state,{dbs:h,className:p,tables:f,dbsTables:m}=this.props,{userGroupNames:g,type:y}=e;if(!n.length||!i)return t.createElement(Loading,null);const v=g.map((e=>t.createElement(Chip,{key:e,value:e}))),b=t.createElement(st,{button:t.createElement(Btn,{iconPath:je,variant:"outline",color:"action",size:"small"},"Select"),onClickClose:!1,contentStyle:{padding:0}},t.createElement(SearchList,{onMultiToggle:t=>{this.setState({rule:{...e,userGroupNames:t.filter((e=>e.checked&&n.find((t=>t.id===e.key)))).map((e=>e.key))}})},id:"targetUserGroups",items:n.map((({id:t})=>{let n="",i="";if("admin"===t)i="Cannot change admin",n="Can always access everything";else if(!l){d.some((e=>e.user_type===t))&&(i="Need to remove from existing access rule first",n="Already assigned permissions")}return{key:t,checked:e.userGroupNames.includes(t),disabledInfo:i,subLabel:n,onPress:()=>{this.setState({rule:{...e,userGroupNames:g.includes(t)?g.filter((e=>e!==t)):g.concat([t])}})}}})).sort(((e,t)=>+!!e.disabledInfo-+!!t.disabledInfo)),onNoResultsContent:e=>t.createElement("div",{className:"flex-row bg-white ai-center"},t.createElement("div",{className:"p-p5"},"Not found"),t.createElement(Btn,{onClick:()=>{h.user_types.insert({id:e}).catch((e=>{alert("Something went wrong inserting user_type: "+e.toString())}))},iconPath:He,size:"small",variant:"outline",color:"action",className:"ml-auto"},"create"))}));return t.createElement("div",{className:"flex-col f-1 "+p},t.createElement("div",{className:"f-1 flex-row bg-white min-h-0 "},t.createElement("div",{className:"f-1 flex-col  p-2 gap-1"},t.createElement("div",{className:"py-1 font-20 bold noselect"},l?`Edit rule ${l}`:"Create new rule"),t.createElement(ErrorComponent,{error:r}),t.createElement("div",{className:"flex-row ai-center"},t.createElement("h4",{className:" m-0 mr-auto"},"Target User Groups:")),t.createElement("div",{className:"flex-col gap-1"},t.createElement("div",{className:"flex-row-wrap gap-p5"},v),1!==n.length||"admin"!==n[0].id||l?t.createElement("div",{className:"flex-row gap-1"},b):t.createElement("div",{className:"flex-row gap-1 text-yellow-600 ai-center "},t.createElement(tt(),{path:we,size:1}),t.createElement("div",null,"There are no user types left. Update existing rules or insert new user types"))),t.createElement("div",{className:"f-1 flex-col min-h-0 "+(g.length?"":" hidden ")},t.createElement("h3",{className:" mb-p5 mt-2 "},"Permissions for selected user types:"),t.createElement(ButtonGroup,{value:e.type,options:jc,className:"mb-1",onChange:e=>{"Run SQL"===e?this.setState({rule:{userGroupNames:g,type:e,allowSQL:!1,workspacePermissions:{}}}):"All views/tables"===e?this.setState({rule:{userGroupNames:g,type:e,allowAllTables:{},workspacePermissions:{}}}):this.setState({rule:{userGroupNames:g,type:e,customTables:[],workspacePermissions:{}}})}}),"Run SQL"===y?t.createElement(t.Fragment,null,t.createElement("div",{className:"my-1"},"The selected user groups will be allowed to run SQL queries. This means full access to all tables and views in the database"),t.createElement(FormField,{asColumn:!0,type:"checkbox",label:"Run SQL",value:"allowSQL"in e&&e.allowSQL,onChange:t=>{this.setState({rule:{...e,allowSQL:t}})}})):"All views/tables"===y?t.createElement(t.Fragment,null,t.createElement("h4",{className:"my-1"},"Allowed on ",f.length," tables:"),t.createElement(Uc,{tableRules:{select:!!e.allowAllTables.select,update:!!e.allowAllTables.update,insert:!!e.allowAllTables.insert,delete:!!e.allowAllTables.delete},onChange:t=>{var n,i,r,s,o,a,l,c;this.setState({rule:{...e,allowAllTables:{select:null!==(i=null!==(n=t.select)&&void 0!==n?n:e.allowAllTables.select)&&void 0!==i&&i,update:null!==(s=null!==(r=t.update)&&void 0!==r?r:e.allowAllTables.update)&&void 0!==s&&s,insert:null!==(a=null!==(o=t.insert)&&void 0!==o?o:e.allowAllTables.insert)&&void 0!==a&&a,delete:null!==(c=null!==(l=t.delete)&&void 0!==l?l:e.allowAllTables.delete)&&void 0!==c&&c}}})}})):t.createElement("div",{className:"flex-col min-h-0"},t.createElement("div",{className:"flex-row ai-center p-p5 my-1"},t.createElement("div",{className:"mr-auto bold"},"Toggle All (",f.length," tables)"),t.createElement(Uc,{variant:"mini",tableRules:{select:e.customTables.length===f.length&&e.customTables.every((e=>"*"===e.select)),insert:e.customTables.length===f.length&&e.customTables.every((e=>"*"===e.insert)),update:e.customTables.length===f.length&&e.customTables.every((e=>"*"===e.update)),delete:e.customTables.length===f.length&&e.customTables.every((e=>"*"===e.delete))},onChange:t=>{const n={...e};n.customTables=f.map((e=>{const i=n.customTables.find((t=>t.tableName===e.name)),r=null!=i?i:{tableName:e.name},s=(0,Xn.getKeys)(t)[0];return r[s]=t[s]?"*":void 0,r})),this.setState({rule:n})}})),t.createElement(SearchList,{id:"custom-tables",limit:200,items:f.map((n=>{const i=e.customTables.find((e=>e.tableName===n.name)),r=null!=i?i:{tableName:n.name},s=t=>{if(t){(0,Xn.getKeys)(t).forEach((e=>{const n=t[e];"boolean"==typeof n&&(n&&!r[e]?r[e]="*":!n&&r[e]&&(r[e]=void 0))}));const s={...e};i?s.customTables=s.customTables.map((e=>e.tableName===n.name?r:e)):s.customTables.push(r),this.setState({rule:s})}};return{key:n.name,contentRight:t.createElement(Uc,{variant:"mini",tableRules:{select:!!r.select,update:!!r.update,insert:!!r.insert,delete:!!r.delete},onChange:e=>{console.log(e),s(e)}})}}))})),t.createElement("div",{className:"flex-row gap-2 py-1 mt-1"},t.createElement(Btn,{variant:"filled",color:"action",disabledInfo:o||!a?void 0:"Nothing to update",onClick:this.upsertRule},s?"Changes applied!":a?"Apply changes":"Create rule"),this.state.selectedRuleId&&t.createElement(t.Fragment,null,t.createElement(Btn,{variant:"outline",onClick:async()=>{this.setState({selectedRule:void 0,selectedRuleId:void 0,rule:{...e,userGroupNames:[]}})}},"Cancel"),t.createElement(Btn,{className:"ml-2",color:"danger",onClick:async()=>{try{await h.access_control.delete({id:l}),this.setState({rule:{...e,userGroupNames:[]}})}catch(e){this.setState({error:e})}}},"Remove rule")))),t.createElement(Select,{label:"Workspace access",multiSelect:!0,fullOptions:[{...zc[0],checked:Boolean(e.workspacePermissions.createWorkspaces)},{...zc[1],checked:Boolean(e.workspacePermissions.viewPublishedWorkspaces)}],onChange:t=>{this.setState({rule:{...e,workspacePermissions:{createWorkspaces:t.includes("Create workspaces"),viewPublishedWorkspaces:t.includes("View published workspaces")?{workspaceIds:[]}:void 0}}}),console.log(t)}})),t.createElement("div",{className:"f-1 flex-col m-1 relative"},c.length?t.createElement(t.Fragment,null,t.createElement("h3",null,"Existing rules (",c.length,"):"),t.createElement("div",{className:"flex-col"},c.map(((e,n)=>{var i,r,s;return t.createElement("div",{key:n,className:"flex-col active-shadow-hover gap-p5 pointer rounded p-p5 "+(l===e.id?" b b-blue-300 active-shadow active-border ":" b b-gray-300 shadow "),onClick:()=>this.setState({selectedRuleId:e.id,selectedRule:e.rule})},t.createElement("div",{className:"text-gray-400"},e.id),t.createElement("div",{className:"flex-row ai-center gap-p5"},t.createElement("div",{className:"f-0"},"User types:"),t.createElement("div",{className:"flex-row o-auto min-w-0 f-1 gap-p5 no-scroll-bar"},null===(s=null===(r=null===(i=e.access_control_user_types)||void 0===i?void 0:i[0])||void 0===r?void 0:r.ids)||void 0===s?void 0:s.map((e=>t.createElement(Chip,{key:e,value:e}))))," "),t.createElement("div",{className:" "},AccessControl.getRuleDescription(e.rule)))})))):null,t.createElement("h3",{className:"mt-2"},"User type stats"),t.createElement("div",{className:"flex-col gap-p5"},t.createElement(Table,{cols:[XC("type","User type","string",!1),XC("count","User count","string",!0)],rows:u}),t.createElement(st,{button:t.createElement(Btn,{iconPath:Xe,variant:"outline",color:"action",size:"small"},"View/Edit users"),onClickClose:!1,contentStyle:{padding:0},positioning:"top-center",title:"All users",render:()=>t.createElement(SmartTable,{key:l,db:h,tableName:"users",tables:m,allowEdit:!0,showInsert:!0})})))))}}const Uc=e=>{const{tableRules:n,onChange:i,variant:r,className:s=""}=e,o="mini"===r?{s:"Select",i:"Insert",u:"Update",d:"Delete"}:{s:"Select/View all records",i:"Insert/Add new records",u:"Update/Edit records",d:"Delete/Remove records"},a="mini"===r?"minimal":void 0;return t.createElement("div",{className:" gap-1 "+("mini"===r?" flex-row ":" flex-col ")+s},t.createElement(Checkbox,{label:o.s,title:"View records",variant:a,checked:!!(null==n?void 0:n.select),onChange:e=>{i({select:e.target.checked})}}),t.createElement(Checkbox,{label:o.i,title:"Insert/Add records",variant:a,checked:!!(null==n?void 0:n.insert),onChange:e=>{i({insert:e.target.checked})}}),t.createElement(Checkbox,{label:o.u,title:"Edit data",variant:a,checked:!!(null==n?void 0:n.update),onChange:e=>{i({update:e.target.checked})}}),t.createElement(Checkbox,{label:o.d,title:"Remove records",variant:a,checked:!!(null==n?void 0:n.delete),onChange:e=>{i({delete:e.target.checked})}}))};function Hc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $c(e){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;const t="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent,n=e||t;return!!(n&&n.indexOf("Electron")>=0)}function qc(){return!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||$c()}const Wc="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source";qc();class LocalStorage{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";Hc(this,"storage",void 0),Hc(this,"id",void 0),Hc(this,"config",{}),this.storage=function(e){try{const t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),t}catch(e){return null}}(n),this.id=e,this.config={},Object.assign(this.config,t),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){if(Object.assign(this.config,e),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}return this}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function Gc(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600;const r=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>i&&(n=Math.min(n,i/e.width));const s=e.width*n,o=e.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(s,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),a]}let Yc;function Xc(e){return"string"==typeof e?Yc[e.toUpperCase()]||Yc.WHITE:e}function Kc(e,t){if(!e)throw new Error(t||"Assertion failed")}!function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(Yc||(Yc={}));const Zc={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==n.g&&n.g,document:"undefined"!=typeof document&&document,process:"object"==typeof process&&process},Jc=(globalThis,Zc.window||Zc.self||Zc.global),Qc=Zc.process||{};console;function eu(){let e;var t,n;if(qc&&"performance"in Jc)e=null==Jc||null===(t=Jc.performance)||void 0===t||null===(n=t.now)||void 0===n?void 0:n.call(t);else if("hrtime"in Qc){var i;const t=null==Qc||null===(i=Qc.hrtime)||void 0===i?void 0:i.call(Qc);e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}const tu={debug:qc&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},nu={enabled:!0,level:0};function iu(){}const ru={},su={once:!0};class Log{constructor(){let{id:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""};Hc(this,"id",void 0),Hc(this,"VERSION",Wc),Hc(this,"_startTs",eu()),Hc(this,"_deltaTs",eu()),Hc(this,"_storage",void 0),Hc(this,"userData",{}),Hc(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this._storage=new LocalStorage("__probe-".concat(this.id,"__"),nu),this.userData={},this.timeStamp("".concat(this.id," started")),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"];const n=Object.getPrototypeOf(e),i=Object.getOwnPropertyNames(n);for(const n of i)"function"==typeof e[n]&&(t.find((e=>n===e))||(e[n]=e[n].bind(e)))}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((eu()-this._startTs).toPrecision(10))}getDelta(){return Number((eu()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.updateConfiguration({enabled:e}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.updateConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){Kc(e,t)}warn(e){return this._getLogFunction(0,e,tu.warn,arguments,su)}error(e){return this._getLogFunction(0,e,tu.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,tu.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,tu.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this._getLogFunction(e,t,tu.debug||tu.info,arguments,su)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||iu,n&&[n],{tag:lu(t)}):iu}image(e){let{logLevel:t,priority:i,image:r,message:s="",scale:o=1}=e;return this._shouldLog(t||i)?qc?function(e){let{image:t,message:n="",scale:i=1}=e;if("string"==typeof t){const e=new Image;return e.onload=()=>{const t=Gc(e,n,i);console.log(...t)},e.src=t,iu}const r=t.nodeName||"";if("img"===r.toLowerCase())return console.log(...Gc(t,n,i)),iu;if("canvas"===r.toLowerCase()){const e=new Image;return e.onload=()=>console.log(...Gc(e,n,i)),e.src=t.toDataURL(),iu}return iu}({image:r,message:s,scale:o}):function(e){let{image:t,message:i="",scale:r=1}=e,s=null;try{s=n(2210)}catch(e){}if(s)return()=>s(t,{fit:"box",width:"".concat(Math.round(80*r),"%")}).then((e=>console.log(e)));return iu}({image:r,message:s,scale:o}):iu}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||iu)}group(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1};const i=au({logLevel:e,message:t,opts:n}),{collapsed:r}=n;return i.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||iu)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=ou(e)}_getLogFunction(e,t,n,i,r){if(this._shouldLog(e)){r=au({logLevel:e,message:t,args:i,opts:r}),Kc(n=n||r.method),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=eu();const s=r.tag||r.message;if(r.once){if(ru[s])return iu;ru[s]=eu()}return t=function(e,t,n){if("string"==typeof t){const i=n.time?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;const n=Math.max(t-e.length,0);return"".concat(" ".repeat(n)).concat(e)}(function(e){let t;return t=e<10?"".concat(e.toFixed(2),"ms"):e<100?"".concat(e.toFixed(1),"ms"):e<1e3?"".concat(e.toFixed(0),"ms"):"".concat((e/1e3).toFixed(2),"s"),t}(n.total)):"";t=function(e,t,n){return qc||"string"!=typeof e||(t&&(t=Xc(t),e="[".concat(t,"m").concat(e,"[39m")),n&&(t=Xc(n),e="[".concat(n+10,"m").concat(e,"[49m"))),e}(t=n.time?"".concat(e,": ").concat(i,"  ").concat(t):"".concat(e,": ").concat(t),n.color,n.background)}return t}(this.id,r.message,r),n.bind(console,t,...r.args)}return iu}}function ou(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return Kc(Number.isFinite(t)&&t>=0),t}function au(e){const{logLevel:t,message:n}=e;e.logLevel=ou(t);const i=e.args?Array.from(e.args):[];for(;i.length&&i.shift()!==n;);switch(typeof t){case"string":case"function":void 0!==n&&i.unshift(n),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());const r=typeof e.message;return Kc("string"===r||"object"===r),Object.assign(e,{args:i},e.opts)}function lu(e){for(const t in e)for(const n in e[t])return n||"untitled";return"empty"}Hc(Log,"VERSION",Wc);const cu=new Log({id:"deck"}),uu={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(uu,"IDENTITY",{get:()=>cu.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")()||0});const du={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},hu={common:0,meters:1,pixels:2},pu={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},fu="draw",mu="mask",gu=new Log({id:"luma.gl"});function yu(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}const vu="Invalid WebGLRenderingContext";function bu(e){return"undefined"!=typeof WebGLRenderingContext&&e instanceof WebGLRenderingContext||("undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&Number.isFinite(e._version)))}function wu(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&2===e._version)}function xu(e){return yu(bu(e),vu),e}function _u(e){return yu(wu(e),"Requires WebGL2"),e}const Eu={};function Su(e,t){var n;Eu[e]=!0,void 0!==t&&(n=t,globalThis.console&&globalThis.console.error&&globalThis.console.error(n))}const Cu=function e(t){const n=t.gl;this.ext=t,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(t.maxVertexAttribs);for(let t=0;t<this.attribs.length;t++){const i=new e.VertexAttrib(n);this.attribs[t]=i}this.maxAttrib=0};(Cu.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Tu=function(e){const t=this;this.gl=e,function(e){const t=e.getError;e.getError=function(){let n;do{n=t.apply(e),0!==n&&(Eu[n]=!0)}while(0!==n);for(n in Eu)if(Eu[n])return delete Eu[n],parseInt(n,10);return 0}}(e);const n=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(e){return e===t.VERTEX_ARRAY_BINDING_OES?t.currentVertexArrayObject===t.defaultVertexArrayObject?null:t.currentVertexArrayObject:n.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(e){const i=t.currentVertexArrayObject;i.maxAttrib=Math.max(i.maxAttrib,e);const r=i.attribs[e];return r.enabled=!0,n.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(e){const i=t.currentVertexArrayObject;i.maxAttrib=Math.max(i.maxAttrib,e);const r=i.attribs[e];return r.enabled=!1,n.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(e,i){switch(e){case 34962:t.currentArrayBuffer=i;break;case 34963:t.currentVertexArrayObject.elementArrayBuffer=i}return n.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(e,i){const r=t.currentVertexArrayObject,s=r.attribs[e];switch(i){case 34975:return s.buffer;case 34338:return s.enabled;case 34339:return s.size;case 34340:return s.stride;case 34341:return s.type;case 34922:return s.normalized;default:return n.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(e,i,r,s,o,a){const l=t.currentVertexArrayObject;l.maxAttrib=Math.max(l.maxAttrib,e);const c=l.attribs[e];return c.buffer=t.currentArrayBuffer,c.size=i,c.type=r,c.normalized=s,c.stride=o,c.offset=a,c.recache(),n.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",(()=>{var e;e="OESVertexArrayObject emulation library context restored",globalThis.console&&globalThis.console.log&&globalThis.console.log(e),t.reset_()}),!0),this.reset_()};Tu.prototype.VERTEX_ARRAY_BINDING_OES=34229,Tu.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(let e=0;e<this.vertexArrayObjects.length;++e)this.vertexArrayObjects.isAlive=!1;const e=this.gl;this.maxVertexAttribs=e.getParameter(34921),this.defaultVertexArrayObject=new Cu(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},Tu.prototype.createVertexArrayOES=function(){const e=new Cu(this);return this.vertexArrayObjects.push(e),e},Tu.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)},Tu.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof Cu&&e.hasBeenBound&&e.ext===this)},Tu.prototype.bindVertexArrayOES=function(e){const t=this.gl;if(e&&!e.isAlive)return void Su(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");const n=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const r=this.currentVertexArrayObject;if(i===r)return;i&&r.elementArrayBuffer===i.elementArrayBuffer||n.bindBuffer.call(t,34963,r.elementArrayBuffer);let s=this.currentArrayBuffer;const o=Math.max(i?i.maxAttrib:0,r.maxAttrib);for(let e=0;e<=o;e++){const o=r.attribs[e],a=i?i.attribs[e]:null;if(i&&o.enabled===a.enabled||(o.enabled?n.enableVertexAttribArray.call(t,e):n.disableVertexAttribArray.call(t,e)),o.enabled){let r=!1;i&&o.buffer===a.buffer||(s!==o.buffer&&(n.bindBuffer.call(t,34962,o.buffer),s=o.buffer),r=!0),(r||o.cached!==a.cached)&&n.vertexAttribPointer.call(t,e,o.size,o.type,o.normalized,o.stride,o.offset)}}this.currentArrayBuffer!==s&&n.bindBuffer.call(t,34962,this.currentArrayBuffer)};const Au="OES_element_index",ku="WEBGL_draw_buffers",Nu="WEBGL_debug_renderer_info",Mu=e=>wu(e)?void 0:0,Pu={3074:e=>wu(e)?void 0:36064,35723:e=>wu(e)?void 0:4352,35977:Mu,32937:Mu,36795:(e,t)=>{const n=wu(e)?e.getExtension("EXT_disjoint_timer_query_webgl2"):e.getExtension("EXT_disjoint_timer_query");return n&&n.GPU_DISJOINT_EXT?t(n.GPU_DISJOINT_EXT):0},37445:(e,t)=>{const n=e.getExtension(Nu);return t(n&&n.UNMASKED_VENDOR_WEBGL||7936)},37446:(e,t)=>{const n=e.getExtension(Nu);return t(n&&n.UNMASKED_RENDERER_WEBGL||7937)},34047:(e,t)=>{const n=e.luma.extensions.EXT_texture_filter_anisotropic;return n?t(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:Mu,35071:Mu,37447:Mu,36063:(e,t)=>{if(!wu(e)){const n=e.getExtension(ku);return n?t(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:Mu,35374:Mu,35377:Mu,34852:e=>{if(!wu(e)){const t=e.getExtension(ku);return t?t.MAX_DRAW_BUFFERS_WEBGL:0}},36203:e=>e.getExtension(Au)?2147483647:65535,33001:e=>e.getExtension(Au)?16777216:65535,33e3:e=>16777216,37157:Mu,35373:Mu,35657:Mu,36183:Mu,37137:Mu,34045:Mu,35978:Mu,35979:Mu,35968:Mu,35376:Mu,35375:Mu,35659:Mu,37154:Mu,35371:Mu,35658:Mu,35076:Mu,35077:Mu,35380:Mu};const Lu="ANGLE_instanced_arrays";const Ou={OES_vertex_array_object:{meta:{suffix:"OES"},createVertexArray:()=>{yu(!1,"VertexArray requires WebGL2 or OES_vertex_array_object extension")},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[Lu]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(e,t){yu(0===t,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},WEBGL_draw_buffers:{meta:{suffix:"WEBGL"},drawBuffers:()=>{yu(!1)}},EXT_disjoint_timer_query:{meta:{suffix:"EXT"},createQuery:()=>{yu(!1)},deleteQuery:()=>{yu(!1)},beginQuery:()=>{yu(!1)},endQuery:()=>{},getQuery(e,t){return this.getQueryObject(e,t)},getQueryParameter(e,t){return this.getQueryObject(e,t)},getQueryObject:()=>{}}},Ru={readBuffer:(e,t,n)=>{wu(e)&&t(n)},getVertexAttrib:(e,t,n,i)=>{const{webgl2:r,ext:s}=function(e,t){return{webgl2:wu(e),ext:e.getExtension(t)}}(e,Lu);let o;switch(i){case 35069:o=!!r&&void 0;break;case 35070:o=r||s?void 0:0}return void 0!==o?o:t(n,i)},getProgramParameter:(e,t,n,i)=>{if(!wu(e))switch(i){case 35967:return 35981;case 35971:case 35382:return 0}return t(n,i)},getInternalformatParameter:(e,t,n,i,r)=>wu(e)||32937!==r?e.getInternalformatParameter(n,i,r):new Int32Array([0]),getTexParameter(e,t,n,i){if(34046===i){const{extensions:t}=e.luma,n=t.EXT_texture_filter_anisotropic;i=n&&n.TEXTURE_MAX_ANISOTROPY_EXT||34046}return t(n,i)},getParameter:function(e,t,n){const i=Pu[n],r="function"==typeof i?i(e,t,n):i;return void 0!==r?r:t(n)},hint:(e,t,n,i)=>t(n,i)};function Iu(e,{extension:t,target:n,target2:i}){const r=Ou[t];yu(r);const{meta:s={}}=r,{suffix:o=""}=s,a=e.getExtension(t);for(const t of Object.keys(r)){const s=`${t}${o}`;let l=null;"meta"===t||"function"==typeof e[t]||(a&&"function"==typeof a[s]?l=(...e)=>a[s](...e):"function"==typeof r[t]&&(l=r[t].bind(n))),l&&(n[t]=l,i[t]=l)}}globalThis.polyfillContext=function(e){e.luma=e.luma||{};const{luma:t}=e;return t.polyfilled||(!function(e){if("function"==typeof e.createVertexArray)return;const t=e.getSupportedExtensions;e.getSupportedExtensions=function(){const e=t.call(this)||[];return e.indexOf("OES_vertex_array_object")<0&&e.push("OES_vertex_array_object"),e};const n=e.getExtension;e.getExtension=function(t){return n.call(this,t)||("OES_vertex_array_object"!==t?null:(e.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Tu(this)),this.__OESVertexArrayObject))}}(e),function(e){e.luma.extensions={};const t=e.getSupportedExtensions()||[];for(const n of t)e.luma[n]=e.getExtension(n)}(e),function(e,t){for(const n of Object.getOwnPropertyNames(t))"overrides"!==n&&Iu(e,{extension:n,target:e.luma,target2:e})}(e,Ou),function(e,{target:t,target2:n}){Object.keys(Ru).forEach((i=>{if("function"==typeof Ru[i]){const r=e[i]?e[i].bind(e):()=>{},s=Ru[i].bind(null,e,r);t[i]=s,n[i]=s}}))}(e,{target:t,target2:e}),t.polyfilled=!0),e};const Du={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Fu=(e,t,n)=>t?e.enable(n):e.disable(n),Bu=(e,t,n)=>e.hint(n,t),zu=(e,t,n)=>e.pixelStorei(n,t);function ju(e){return Array.isArray(e)||ArrayBuffer.isView(e)}const Vu={3042:Fu,32773:(e,t)=>e.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(e,t)=>e.clearColor(...t),3107:(e,t)=>e.colorMask(...t),2884:Fu,2885:(e,t)=>e.cullFace(t),2929:Fu,2931:(e,t)=>e.clearDepth(t),2932:(e,t)=>e.depthFunc(t),2928:(e,t)=>e.depthRange(...t),2930:(e,t)=>e.depthMask(t),3024:Fu,35723:Bu,36006:(e,t)=>{const n=wu(e)?36009:36160;return e.bindFramebuffer(n,t)},2886:(e,t)=>e.frontFace(t),33170:Bu,2849:(e,t)=>e.lineWidth(t),32823:Fu,32824:"polygonOffset",10752:"polygonOffset",35977:Fu,32938:"sampleCoverage",32939:"sampleCoverage",3089:Fu,3088:(e,t)=>e.scissor(...t),2960:Fu,2961:(e,t)=>e.clearStencil(t),2968:(e,t)=>e.stencilMaskSeparate(1028,t),36005:(e,t)=>e.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(e,t)=>e.viewport(...t),3333:zu,3317:zu,37440:zu,37441:zu,37443:zu,3330:zu,3332:zu,3331:zu,36010:(e,t)=>e.bindFramebuffer(36008,t),3314:zu,32878:zu,3316:zu,3315:zu,32877:zu,framebuffer:(e,t)=>{const n=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,n)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{t=ju(t)?t:[t,t],e.blendEquationSeparate(...t)},blendFunc:(e,t)=>{t=ju(t)&&2===t.length?[...t,...t]:t,e.blendFuncSeparate(...t)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(...t),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=ju(t)?t:[t,t];const[n,i]=t;e.stencilMaskSeparate(1028,n),e.stencilMaskSeparate(1029,i)},stencilFunc:(e,t)=>{t=ju(t)&&3===t.length?[...t,...t]:t;const[n,i,r,s,o,a]=t;e.stencilFuncSeparate(1028,n,i,r),e.stencilFuncSeparate(1029,s,o,a)},stencilOp:(e,t)=>{t=ju(t)&&3===t.length?[...t,...t]:t;const[n,i,r,s,o,a]=t;e.stencilOpSeparate(1028,n,i,r),e.stencilOpSeparate(1029,s,o,a)},viewport:(e,t)=>e.viewport(...t)};function Uu(e,t,n){return void 0!==t[e]?t[e]:n[e]}const Hu={blendEquation:(e,t,n)=>e.blendEquationSeparate(Uu(32777,t,n),Uu(34877,t,n)),blendFunc:(e,t,n)=>e.blendFuncSeparate(Uu(32969,t,n),Uu(32968,t,n),Uu(32971,t,n),Uu(32970,t,n)),polygonOffset:(e,t,n)=>e.polygonOffset(Uu(32824,t,n),Uu(10752,t,n)),sampleCoverage:(e,t,n)=>e.sampleCoverage(Uu(32938,t,n),Uu(32939,t,n)),stencilFuncFront:(e,t,n)=>e.stencilFuncSeparate(1028,Uu(2962,t,n),Uu(2967,t,n),Uu(2963,t,n)),stencilFuncBack:(e,t,n)=>e.stencilFuncSeparate(1029,Uu(34816,t,n),Uu(36003,t,n),Uu(36004,t,n)),stencilOpFront:(e,t,n)=>e.stencilOpSeparate(1028,Uu(2964,t,n),Uu(2965,t,n),Uu(2966,t,n)),stencilOpBack:(e,t,n)=>e.stencilOpSeparate(1029,Uu(34817,t,n),Uu(34818,t,n),Uu(34819,t,n))},$u={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,n)=>e({[t]:n}),hint:(e,t,n)=>e({[t]:n}),bindFramebuffer:(e,t,n)=>{switch(t){case 36160:return e({36006:n,36010:n});case 36009:return e({36006:n});case 36008:return e({36010:n});default:return null}},blendColor:(e,t,n,i,r)=>e({32773:new Float32Array([t,n,i,r])}),blendEquation:(e,t)=>e({32777:t,34877:t}),blendEquationSeparate:(e,t,n)=>e({32777:t,34877:n}),blendFunc:(e,t,n)=>e({32969:t,32968:n,32971:t,32970:n}),blendFuncSeparate:(e,t,n,i,r)=>e({32969:t,32968:n,32971:i,32970:r}),clearColor:(e,t,n,i,r)=>e({3106:new Float32Array([t,n,i,r])}),clearDepth:(e,t)=>e({2931:t}),clearStencil:(e,t)=>e({2961:t}),colorMask:(e,t,n,i,r)=>e({3107:[t,n,i,r]}),cullFace:(e,t)=>e({2885:t}),depthFunc:(e,t)=>e({2932:t}),depthRange:(e,t,n)=>e({2928:new Float32Array([t,n])}),depthMask:(e,t)=>e({2930:t}),frontFace:(e,t)=>e({2886:t}),lineWidth:(e,t)=>e({2849:t}),polygonOffset:(e,t,n)=>e({32824:t,10752:n}),sampleCoverage:(e,t,n)=>e({32938:t,32939:n}),scissor:(e,t,n,i,r)=>e({3088:new Int32Array([t,n,i,r])}),stencilMask:(e,t)=>e({2968:t,36005:t}),stencilMaskSeparate:(e,t,n)=>e({[1028===t?2968:36005]:n}),stencilFunc:(e,t,n,i)=>e({2962:t,2967:n,2963:i,34816:t,36003:n,36004:i}),stencilFuncSeparate:(e,t,n,i,r)=>e({[1028===t?2962:34816]:n,[1028===t?2967:36003]:i,[1028===t?2963:36004]:r}),stencilOp:(e,t,n,i)=>e({2964:t,2965:n,2966:i,34817:t,34818:n,34819:i}),stencilOpSeparate:(e,t,n,i,r)=>e({[1028===t?2964:34817]:n,[1028===t?2965:34818]:i,[1028===t?2966:34819]:r}),viewport:(e,t,n,i,r)=>e({2978:[t,n,i,r]})},qu=(e,t)=>e.isEnabled(t),Wu={3042:qu,2884:qu,2929:qu,3024:qu,32823:qu,32926:qu,32928:qu,3089:qu,2960:qu,35977:qu};function Gu(e){for(const t in e)return!1;return!0}function Yu(e,t){if(e===t)return!0;const n=Array.isArray(e)||ArrayBuffer.isView(e),i=Array.isArray(t)||ArrayBuffer.isView(t);if(n&&i&&e.length===t.length){for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}return!1}function Xu(e,t){const n=e[t].bind(e);e[t]=function(...t){const i=t[0];return i in e.state.cache&&e.state.enable?e.state.cache[i]:n(...t)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function Ku(e,t,n){const i=e[t].bind(e);e[t]=function(...t){const{valueChanged:r,oldValue:s}=n(e.state._updateCache,...t);return r&&i(...t),s},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}class GLState{constructor(e,{copyState:t=!1,log:n=(()=>{})}={}){this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=t?function(e,t){if("number"==typeof(t=t||Du)){const n=t,i=Wu[n];return i?i(e,n):e.getParameter(n)}const n=Array.isArray(t)?t:Object.keys(t),i={};for(const t of n){const n=Wu[t];i[t]=n?n(e,Number(t)):e.getParameter(Number(t))}return i}(e):Object.assign({},Du),this.log=n,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){yu(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Qu(this.gl,e),this.stateStack.pop()}_updateCache(e){let t,n=!1;const i=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const r in e){yu(void 0!==r);const s=e[r],o=this.cache[r];Yu(s,o)||(n=!0,t=o,i&&!(r in i)&&(i[r]=o),this.cache[r]=s)}return{valueChanged:n,oldValue:t}}}function Zu(e,t={}){const{enable:n=!0,copyState:i}=t;if(yu(void 0!==i),!e.state){const{polyfillContext:t}=globalThis;t&&t(e),e.state=new GLState(e,{copyState:i}),function(e){const t=e.useProgram.bind(e);e.useProgram=function(n){e.state.program!==n&&(t(n),e.state.program=n)}}(e);for(const t in $u){Ku(e,t,$u[t])}Xu(e,"getParameter"),Xu(e,"isEnabled")}return e.state.enable=n,e}function Ju(e){yu(e.state),e.state.pop()}function Qu(e,t){if(yu(bu(e),"setParameters requires a WebGL context"),Gu(t))return;const n={};for(const i in t){const r=Number(i),s=Vu[i];s&&("string"==typeof s?n[s]=!0:s(e,t[i],r))}const i=e.state&&e.state.cache;if(i)for(const r in n){(0,Hu[r])(e,t,i)}}function ed(e,t,n){if(Gu(t))return n(e);const{nocatch:i=!0}=t;let r;if(function(e){e.state||Zu(e,{copyState:!1}),e.state.push()}(e),Qu(e,t),i)r=n(e),Ju(e);else try{r=n(e)}finally{Ju(e)}return r}function td(e){const{luma:t}=e;if(e.canvas&&t){const{clientWidth:n}=t.canvasSizeInfo;return n?e.drawingBufferWidth/n:1}return 1}function nd(e,t,n=!0){return function(e,t,n,i,r){const s=id(e[0],t,n);let o=rd(e[1],t,i,r),a=id(e[0]+1,t,n);const l=a===n-1?a:a-1;let c;a=rd(e[1]+1,t,i,r),r?(a=0===a?a:a+1,c=o,o=a):c=a===i-1?a:a-1;return{x:s,y:o,width:Math.max(l-s+1,1),height:Math.max(c-o+1,1)}}(t,td(e),e.drawingBufferWidth,e.drawingBufferHeight,n)}function id(e,t,n){return Math.min(Math.round(e*t),n-1)}function rd(e,t,n,i){return i?Math.max(0,n-1-Math.round(e*t)):Math.min(Math.round(e*t),n-1)}const sd=qc(),od=sd&&"undefined"!=typeof document,ad={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function ld(e={}){yu(sd,"createGLContext only available in the browser.\nCreate your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils"),e=Object.assign({},ad,e);const{width:t,height:n}=e;function i(t){if(e.throwOnError)throw new Error(t);return console.error(t),null}let r;e.onError=i;const{canvas:s}=e,o=function({canvas:e,width:t=800,height:n=600,onError:i}){let r;if("string"==typeof e){od&&"complete"===document.readyState||i(`createGLContext called on canvas '${e}' before page was loaded`),r=document.getElementById(e)}else e?r=e:(r=document.createElement("canvas"),r.id="lumagl-canvas",r.style.width=Number.isFinite(t)?`${t}px`:"100%",r.style.height=Number.isFinite(n)?`${n}px`:"100%",document.body.insertBefore(r,document.body.firstChild));return r}({canvas:s,width:t,height:n,onError:i});return r=function(e,t){const{onError:n}=t;let i=null;const r=e=>i=e.statusMessage||i;e.addEventListener("webglcontextcreationerror",r,!1);const{webgl1:s=!0,webgl2:o=!0}=t;let a=null;o&&(a=a||e.getContext("webgl2",t),a=a||e.getContext("experimental-webgl2",t));s&&(a=a||e.getContext("webgl",t),a=a||e.getContext("experimental-webgl",t));if(e.removeEventListener("webglcontextcreationerror",r,!1),!a)return n(`Failed to create ${o&&!s?"WebGL2":"WebGL"} context: ${i||"Unknown error"}`);t.onContextLost&&e.addEventListener("webglcontextlost",t.onContextLost,!1);t.onContextRestored&&e.addEventListener("webglcontextrestored",t.onContextRestored,!1);return a}(o,e),r?(r=cd(r,e),function(e){const t=wu(e)?"WebGL2":"WebGL1",n=function(e){const t=e.getParameter(7936),n=e.getParameter(7937),i=e.getExtension("WEBGL_debug_renderer_info"),r=i&&e.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),s=i&&e.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:r||t,renderer:s||n,vendorMasked:t,rendererMasked:n,version:e.getParameter(7938),shadingLanguageVersion:e.getParameter(35724)}}(e),i=n?`(${n.vendor},${n.renderer})`:"",r=e.debug?" debug":"";gu.info(1,`${t}${r} context ${i}`)()}(r),r):null}function cd(e,t={}){if(!e||e._instrumented)return e;e._version=e._version||function(e){if("undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext)return 2;return 1}(e),e.luma=e.luma||{},e.luma.canvasSizeInfo=e.luma.canvasSizeInfo||{},t=Object.assign({},ad,t);const{manageState:n,debug:i}=t;return n&&Zu(e,{copyState:!1,log:(...e)=>gu.log(1,...e)()}),sd&&i&&(globalThis.makeDebugContext?(e=globalThis.makeDebugContext(e,t),gu.level=Math.max(gu.level,1)):gu.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),e._instrumented=!0,e}function ud(e,t={}){if(e.canvas){return void function(e,t,n){let i="width"in n?n.width:e.canvas.clientWidth,r="height"in n?n.height:e.canvas.clientHeight;i&&r||(gu.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,i=e.canvas.width||1,r=e.canvas.height||1);e.luma=e.luma||{},e.luma.canvasSizeInfo=e.luma.canvasSizeInfo||{};const s=e.luma.canvasSizeInfo;if(s.clientWidth!==i||s.clientHeight!==r||s.devicePixelRatio!==t){let n=t;const s=Math.floor(i*n),o=Math.floor(r*n);e.canvas.width=s,e.canvas.height=o,e.drawingBufferWidth===s&&e.drawingBufferHeight===o||(gu.warn("Device pixel ratio clamped")(),n=Math.min(e.drawingBufferWidth/i,e.drawingBufferHeight/r),e.canvas.width=Math.floor(i*n),e.canvas.height=Math.floor(r*n)),Object.assign(e.luma.canvasSizeInfo,{clientWidth:i,clientHeight:r,devicePixelRatio:t})}}(e,function(e){const t="undefined"==typeof window?1:window.devicePixelRatio||1;return Number.isFinite(e)?e<=0?1:e:e?t:1}(t.useDevicePixels),t)}const n=e.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in t&&"height"in t&&n.resize(t.width,t.height)}function dd(){let e;if("undefined"!=typeof window&&window.performance)e=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){const t=process.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}class Stat{constructor(e,t){Hc(this,"name",void 0),Hc(this,"type",void 0),Hc(this,"sampleSize",1),Hc(this,"time",void 0),Hc(this,"count",void 0),Hc(this,"samples",void 0),Hc(this,"lastTiming",void 0),Hc(this,"lastSampleTime",void 0),Hc(this,"lastSampleCount",void 0),Hc(this,"_count",0),Hc(this,"_time",0),Hc(this,"_samples",0),Hc(this,"_startTime",0),Hc(this,"_timerPending",!1),this.name=e,this.type=t,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=dd(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(dd()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Stats{constructor(e){Hc(this,"id",void 0),Hc(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const t in this.stats)e(this.stats[t])}getTable(){const e={};return this.forEach((t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}})),e}_initializeStats(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((e=>this._getOrCreate(e)))}_getOrCreate(e){if(!e||!e.name)return null;const{name:t,type:n}=e;return this.stats[t]||(this.stats[t]=e instanceof Stat?e:new Stat(t,n)),this.stats[t]}}const hd="8.5.14";const pd=new class StatsManager{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new Stats({id:e})),this.stats.get(e)}};if(globalThis.luma&&globalThis.luma.VERSION!==hd)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs 8.5.14`);globalThis.luma||(qc()&&gu.log(1,"luma.gl 8.5.14 - set luma.log.level=1 (or higher) to trace rendering")(),globalThis.luma=globalThis.luma||{VERSION:hd,version:hd,log:gu,stats:pd,globals:{modules:{},nodeIO:{}}});globalThis.luma;function fd(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}function md(e,t){if("string"!=typeof t)return t;const n=Number(t);if(!isNaN(n))return n;const i=e[t=t.replace(/^.*\./,"")];return fd(void 0!==i,`Accessing undefined constant GL.${t}`),i}function gd(e,t){t=Number(t);for(const n in e)if(e[n]===t)return`GL.${n}`;return String(t)}const yd={};function vd(e="id"){yd[e]=yd[e]||1;return`${e}-${yd[e]++}`}function bd(e){return fd("number"==typeof e,"Input must be a number"),e&&0==(e&e-1)}function wd(e){let t=!0;for(const n in e){t=!1;break}return t}function xd(e,t,n,i){const r=`See luma.gl ${n} Upgrade Guide at https://luma.gl/docs/upgrade-guide`,s=Object.getPrototypeOf(e);i.forEach((e=>{s.methodName||(s[e]=()=>{throw gu.removed(`Calling removed method ${t}.${e}: `,r)(),new Error(e)})}))}const _d="Resource subclass must define virtual methods";class Resource{get[Symbol.toStringTag](){return"Resource"}constructor(e,t={}){xu(e);const{id:n,userData:i={}}=t;this.gl=e,this.gl2=e,this.id=n||vd(this[Symbol.toStringTag]),this.userData=i,this._bound=!1,this._handle=t.handle,void 0===this._handle&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}get handle(){return this._handle}delete({deleteChildren:e=!1}={}){const t=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,t&&e&&t.filter(Boolean).forEach((e=>e.delete())),this}bind(e=this.handle){if("function"!=typeof e)return this._bindHandle(e),this;let t;return this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}getParameter(e,t={}){fd(e=md(this.gl,e));const n=(this.constructor.PARAMETERS||{})[e];if(n){const e=wu(this.gl);if(!((!("webgl2"in n)||e)&&(!("extension"in n)||this.gl.getExtension(n.extension)))){const t=n.webgl1,i="webgl2"in n?n.webgl2:n.webgl1;return e?i:t}}return this._getParameter(e,t)}getParameters(e={}){const{parameters:t,keys:n}=e,i=this.constructor.PARAMETERS||{},r=wu(this.gl),s={},o=t||Object.keys(i);for(const t of o){const o=i[t];if(o&&(!("webgl2"in o)||r)&&(!("extension"in o)||this.gl.getExtension(o.extension))){const i=n?gd(this.gl,t):t;s[i]=this.getParameter(t,e),n&&"GLenum"===o.type&&(s[i]=gd(this.gl,s[i]))}}return s}setParameter(e,t){fd(e=md(this.gl,e));const n=(this.constructor.PARAMETERS||{})[e];if(n){const e=wu(this.gl);if(!((!("webgl2"in n)||e)&&(!("extension"in n)||this.gl.getExtension(n.extension))))throw new Error("Parameter not available on this platform");"GLenum"===n.type&&(t=md(t))}return this._setParameter(e,t),this}setParameters(e){for(const t in e)this.setParameter(t,e[t]);return this}stubRemovedMethods(e,t,n){return xd(this,e,t,n)}initialize(e){}_createHandle(){throw new Error(_d)}_deleteHandle(){throw new Error(_d)}_bindHandle(e){throw new Error(_d)}_getOptsFromHandle(){throw new Error(_d)}_getParameter(e,t){throw new Error(_d)}_setParameter(e,t){throw new Error(_d)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],t=pd.get("Resource Counts");t.get("Resources Created").incrementCount(),t.get(`${e}s Created`).incrementCount(),t.get(`${e}s Active`).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];pd.get("Resource Counts").get(`${e}s Active`).decrementCount()}_trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const n=pd.get("Memory Usage");n.get("GPU Memory").addCount(e),n.get(`${t} Memory`).addCount(e),this.byteLength=e}_trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=pd.get("Memory Usage");t.get("GPU Memory").subtractCount(this.byteLength),t.get(`${e} Memory`).subtractCount(this.byteLength),this.byteLength=0}}function Ed(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error("Failed to deduce GL constant from typed array")}}function Sd(e,{clamped:t=!0}={}){switch(e){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function Cd({data:e,width:t,height:n}){const i=Math.round(t/2),r=Math.round(n/2),s=new Uint8Array(i*r*4);for(let n=0;n<r;n++)for(let r=0;r<i;r++)for(let o=0;o<4;o++)s[4*(n*i+r)+o]=e[4*(2*n*t+2*r)+o];return{data:s,width:i,height:r}}function Td(e,t,n){const{removedProps:i={},deprecatedProps:r={},replacedProps:s={}}=n;for(const n in i)if(n in t){const t=i[n]?`${e}.${i[n]}`:"N/A";gu.removed(`${e}.${n}`,t)()}for(const n in r)if(n in t){const t=r[n];gu.deprecated(`${e}.${n}`,`${e}.${t}`)()}let o=null;for(const n in s)if(n in t){const i=s[n];gu.deprecated(`${e}.${n}`,`${e}.${i}`)(),o=o||Object.assign({},t),o[i]=t[n],delete o[n]}return o||t}const Ad={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},kd={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Accessor{static getBytesPerElement(e){return Sd(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){fd(e.size);return Sd(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new Accessor(...[Ad,...e])}constructor(...e){e.forEach((e=>this._assign(e))),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Accessor.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Accessor.getBytesPerVertex(this)}_assign(e={}){return void 0!==(e=Td("Accessor",e,kd)).type&&(this.type=e.type,5124!==e.type&&5125!==e.type||(this.integer=!0)),void 0!==e.size&&(this.size=e.size),void 0!==e.offset&&(this.offset=e.offset),void 0!==e.stride&&(this.stride=e.stride),void 0!==e.normalized&&(this.normalized=e.normalized),void 0!==e.integer&&(this.integer=e.integer),void 0!==e.divisor&&(this.divisor=e.divisor),void 0!==e.buffer&&(this.buffer=e.buffer),void 0!==e.index&&("boolean"==typeof e.index?this.index=e.index?1:0:this.index=e.index),void 0!==e.instanced&&(this.divisor=e.instanced?1:0),void 0!==e.isInstanced&&(this.divisor=e.isInstanced?1:0),this}}const Nd={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},Md={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:Nd},Pd={removedProps:Nd};class buffer_Buffer extends Resource{get[Symbol.toStringTag](){return"Buffer"}constructor(e,t={}){super(e,t),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=t.target||(this.gl.webgl2?36662:34962),this.initialize(t),Object.seal(this)}getElementCount(e=this.accessor){return Math.round(this.byteLength/Accessor.getBytesPerElement(e))}getVertexCount(e=this.accessor){return Math.round(this.byteLength/Accessor.getBytesPerVertex(e))}initialize(e={}){return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=Td("Buffer",e,Md),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return"accessor"in(e=Td("Buffer",e,Pd))&&this.setAccessor(e.accessor),this}setAccessor(e){return delete(e=Object.assign({},e)).buffer,this.accessor=new Accessor(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:t,offset:n=0,srcOffset:i=0}=e,r=e.byteLength||e.length;fd(t);const s=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(s,this.handle),0!==i||void 0!==r?(_u(this.gl),this.gl.bufferSubData(this.target,n,t,i,r)):this.gl.bufferSubData(s,n,t),this.gl.bindBuffer(s,null),this.debugData=null,this._inferType(t),this}copyData({sourceBuffer:e,readOffset:t=0,writeOffset:n=0,size:i}){const{gl:r}=this;return _u(r),r.bindBuffer(36662,e.handle),r.bindBuffer(36663,this.handle),r.copyBufferSubData(36662,36663,t,n,i),r.bindBuffer(36662,null),r.bindBuffer(36663,null),this.debugData=null,this}getData({dstData:e=null,srcByteOffset:t=0,dstOffset:n=0,length:i=0}={}){_u(this.gl);const r=Sd(this.accessor.type||5126,{clamped:!1}),s=this._getAvailableElementCount(t),o=n;let a,l;e?(l=e.length,a=l-o):(a=Math.min(s,i||s),l=o+a);const c=Math.min(s,a);return fd((i=i||c)<=c),e=e||new r(l),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,e,n,i),this.gl.bindBuffer(36662,null),e}bind({target:e=this.target,index:t=this.accessor&&this.accessor.index,offset:n=0,size:i}={}){return 35345===e||35982===e?void 0!==i?this.gl.bindBufferRange(e,t,this.handle,n,i):(fd(0===n),this.gl.bindBufferBase(e,t,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind({target:e=this.target,index:t=this.accessor&&this.accessor.index}={}){return 35345===e||35982===e?this.gl.bindBufferBase(e,t,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(10,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e,t=0,n=e.byteLength+t){fd(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const i=this._getTarget();this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.usage),this.gl.bufferSubData(i,t,e),this.gl.bindBuffer(i,null),this.debugData=e.slice(0,10),this.bytesUsed=n,this._trackAllocatedMemory(n);const r=Ed(e);return fd(r),this.setAccessor(new Accessor(this.accessor,{type:r})),this}_setByteLength(e,t=this.usage){fd(e>=0),this._trackDeallocatedMemory();let n=e;0===e&&(n=new Float32Array(0));const i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,t),this.gl.bindBuffer(i,null),this.usage=t,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const t=e/Sd(this.accessor.type||5126,{clamped:!1}).BYTES_PER_ELEMENT;return this.getElementCount()-t}_inferType(e){this.accessor.type||this.setAccessor(new Accessor(this.accessor,{type:Ed(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const t=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),t}get type(){return gu.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return gu.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return gu.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return gu.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Accessor(this.accessor,e),this}}const Ld={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},Od={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},Rd={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};const Id=[9729,9728],Dd=globalThis.WebGLBuffer||function(){};class Texture extends Resource{get[Symbol.toStringTag](){return"Texture"}static isSupported(e,t={}){const{format:n,linearFiltering:i}=t;let r=!0;return n&&(r=r&&function(e,t){const n=Ld[t];if(!n)return!1;if(void 0===n.gl1&&void 0===n.gl2)return!0;const i=wu(e)&&n.gl2||n.gl1;return"string"==typeof i?e.getExtension(i):i}(e,n),r=r&&(!i||function(e,t){const n=Ld[t];switch(n&&n.types[0]){case 5126:return e.getExtension("OES_texture_float_linear");case 5131:return e.getExtension("OES_texture_half_float_linear");default:return!0}}(e,n))),r}constructor(e,t){const{id:n=vd("texture"),handle:i,target:r}=t;super(e,{id:n,handle:i}),this.target=r,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return`Texture(${this.id},${this.width}x${this.height})`}initialize(e={}){let t=e.data;if(t instanceof Promise)return t.then((t=>this.initialize(Object.assign({},e,{pixels:t,data:t})))),this;const n="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement;if(n&&t.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,t.addEventListener("loadeddata",(()=>this.initialize(e))),this;const{pixels:i=null,format:r=6408,border:s=0,recreate:o=!1,parameters:a={},pixelStore:l={},textureUnit:c}=e;t||(t=i);let{width:u,height:d,dataFormat:h,type:p,compressed:f=!1,mipmaps:m=!0}=e;const{depth:g=0}=e;return({width:u,height:d,compressed:f,dataFormat:h,type:p}=this._deduceParameters({format:r,type:p,dataFormat:h,compressed:f,data:t,width:u,height:d})),this.width=u,this.height=d,this.depth=g,this.format=r,this.type=p,this.dataFormat=h,this.border=s,this.textureUnit=c,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),m&&this._isNPOT()&&(gu.warn(`texture: ${this} is Non-Power-Of-Two, disabling mipmaping`)(),m=!1,this._updateForNPOT(a)),this.mipmaps=m,this.setImageData({data:t,width:u,height:d,depth:g,format:r,type:p,dataFormat:h,border:s,mipmaps:m,parameters:l,compressed:f}),m&&this.generateMipmap(),this.setParameters(a),o&&(this.data=t),n&&(this._video={video:t,parameters:a,lastTime:t.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?t.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:t,lastTime:n}=this._video;if(n===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:t}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize({height:e,width:t,mipmaps:n=!1}){return t!==this.width||e!==this.height?this.initialize({width:t,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:n}):this}generateMipmap(e={}){return this._isNPOT()?(gu.warn(`texture: ${this} is Non-Power-Of-Two, disabling mipmaping`)(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),ed(this.gl,e,(()=>{this.gl.generateMipmap(this.target)})),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:t=this.target,pixels:n=null,level:i=0,format:r=this.format,border:s=this.border,offset:o=0,parameters:a={}}=e;let{data:l=null,type:c=this.type,width:u=this.width,height:d=this.height,dataFormat:h=this.dataFormat,compressed:p=!1}=e;l||(l=n),({type:c,dataFormat:h,compressed:p,width:u,height:d}=this._deduceParameters({format:r,type:c,dataFormat:h,compressed:p,data:l,width:u,height:d}));const{gl:f}=this;f.bindTexture(this.target,this.handle);let m,g=null;({data:l,dataType:g}=this._getDataType({data:l,compressed:p}));let y=0;if(ed(this.gl,a,(()=>{switch(g){case"null":f.texImage2D(t,i,r,u,d,s,h,c,l);break;case"typed-array":f.texImage2D(t,i,r,u,d,s,h,c,l,o);break;case"buffer":m=_u(f),m.bindBuffer(35052,l.handle||l),m.texImage2D(t,i,r,u,d,s,h,c,o),m.bindBuffer(35052,null);break;case"browser-object":wu(f)?f.texImage2D(t,i,r,u,d,s,h,c,l):f.texImage2D(t,i,r,h,c,l);break;case"compressed":for(const[e,n]of l.entries())f.compressedTexImage2D(t,e,n.format,n.width,n.height,s,n.data),y+=n.levelSize;break;default:fd(!1,"Unknown image data type")}})),"compressed"===g)this._trackAllocatedMemory(y,"Texture");else if(l&&l.byteLength)this._trackAllocatedMemory(l.byteLength,"Texture");else{const e=Od[this.dataFormat]||4,t=Rd[this.type]||1;this._trackAllocatedMemory(this.width*this.height*e*t,"Texture")}return this.loaded=!0,this}setSubImageData({target:e=this.target,pixels:t=null,data:n=null,x:i=0,y:r=0,width:s=this.width,height:o=this.height,level:a=0,format:l=this.format,type:c=this.type,dataFormat:u=this.dataFormat,compressed:d=!1,offset:h=0,border:p=this.border,parameters:f={}}){if(({type:c,dataFormat:u,compressed:d,width:s,height:o}=this._deduceParameters({format:l,type:c,dataFormat:u,compressed:d,data:n,width:s,height:o})),fd(0===this.depth,"texSubImage not supported for 3D textures"),n||(n=t),n&&n.data){const e=n;n=e.data,s=e.shape[0],o=e.shape[1]}n instanceof buffer_Buffer&&(n=n.handle),this.gl.bindTexture(this.target,this.handle),ed(this.gl,f,(()=>{if(d)this.gl.compressedTexSubImage2D(e,a,i,r,s,o,l,n);else if(null===n)this.gl.texSubImage2D(e,a,i,r,s,o,u,c,null);else if(ArrayBuffer.isView(n))this.gl.texSubImage2D(e,a,i,r,s,o,u,c,n,h);else if(n instanceof Dd){const t=_u(this.gl);t.bindBuffer(35052,n),t.texSubImage2D(e,a,i,r,s,o,u,c,h),t.bindBuffer(35052,null)}else if(wu(this.gl)){_u(this.gl).texSubImage2D(e,a,i,r,s,o,u,c,n)}else this.gl.texSubImage2D(e,a,i,r,u,c,n)})),this.gl.bindTexture(this.target,null)}copyFramebuffer(e={}){return gu.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e=this.textureUnit){const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,this.handle),e}unbind(e=this.textureUnit){const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,null),e}_getDataType({data:e,compressed:t=!1}){return t?{data:e,dataType:"compressed"}:null===e?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof buffer_Buffer?{data:e.handle,dataType:"buffer"}:e instanceof Dd?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(e){const{format:t,data:n}=e;let{width:i,height:r,dataFormat:s,type:o,compressed:a}=e;const l=Ld[t];return s=s||l&&l.dataFormat,o=o||l&&l.types[0],a=a||l&&l.compressed,({width:i,height:r}=this._deduceImageSize(n,i,r)),{dataFormat:s,type:o,compressed:a,width:i,height:r,format:t,data:n}}_deduceImageSize(e,t,n){let i;return i="undefined"!=typeof ImageData&&e instanceof ImageData?{width:e.width,height:e.height}:"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?{width:e.naturalWidth,height:e.naturalHeight}:"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?{width:e.width,height:e.height}:"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e?{width:t,height:n}:{width:t>=0?t:1,height:n>=0?n:1},fd(i,"Could not deduced texture size"),fd(void 0===t||i.width===t,"Deduced texture width does not match supplied width"),fd(void 0===n||i.height===n,"Deduced texture height does not match supplied height"),i}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const t=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),t}}_setParameter(e,t){switch(this.gl.bindTexture(this.target,this.handle),t=this._getNPOTParam(e,t),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,t);break;case 4096:case 4097:fd(!1);break;default:this.gl.texParameteri(this.target,e,t)}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return!wu(this.gl)&&(!(!this.width||!this.height)&&(!bd(this.width)||!bd(this.height)))}_updateForNPOT(e){void 0===e[this.gl.TEXTURE_MIN_FILTER]&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),void 0===e[this.gl.TEXTURE_WRAP_S]&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),void 0===e[this.gl.TEXTURE_WRAP_T]&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,t){if(this._isNPOT())switch(e){case 10241:-1===Id.indexOf(t)&&(t=9729);break;case 10242:case 10243:33071!==t&&(t=33071)}return t}}let Fd="";function Bd(e,t){return fd("string"==typeof e),e=Fd+e,new Promise(((n,i)=>{try{const r=new Image;r.onload=()=>n(r),r.onerror=()=>i(new Error(`Could not load image ${e}.`)),r.crossOrigin=t&&t.crossOrigin||"anonymous",r.src=e}catch(e){i(e)}}))}class Texture2D extends Texture{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,t){return Texture.isSupported(e,t)}constructor(e,t={}){xu(e),(t instanceof Promise||"string"==typeof t)&&(t={data:t}),"string"==typeof t.data&&(t=Object.assign({},t,{data:Bd(t.data)})),super(e,Object.assign({},t,{target:3553})),this.initialize(t),Object.seal(this)}}const zd="EXT_color_buffer_float",jd={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:zd,bpp:2},33327:{gl2:zd,bpp:4},34842:{gl2:zd,bpp:8},33326:{gl2:zd,bpp:4},33328:{gl2:zd,bpp:8},34836:{gl2:zd,bpp:16},35898:{gl2:zd,bpp:4}};class Renderbuffer extends Resource{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e,{format:t}={format:null}){return!t||function(e,t,n){const i=n[t];if(!i)return!1;const r=wu(e)&&i.gl2||i.gl1;return"string"==typeof r?e.getExtension(r):r}(e,t,jd)}static getSamplesForFormat(e,{format:t}){return e.getInternalformatParameter(36161,t,32937)}constructor(e,t={}){super(e,t),this.initialize(t),Object.seal(this)}initialize({format:e,width:t=1,height:n=1,samples:i=0}){return fd(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),0!==i&&wu(this.gl)?this.gl.renderbufferStorageMultisample(36161,i,e,t,n):this.gl.renderbufferStorage(36161,e,t,n),this.format=e,this.width=t,this.height=n,this.samples=i,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*jd[this.format].bpp),this}resize({width:e,height:t}){return e!==this.width||t!==this.height?this.initialize({width:e,height:t,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){this.gl.bindRenderbuffer(36161,this.handle);return this.gl.getRenderbufferParameter(36161,e)}}const Vd="clear: bad arguments";function Ud(e,{framebuffer:t=null,color:n=null,depth:i=null,stencil:r=null}={}){const s={};t&&(s.framebuffer=t);let o=0;n&&(o|=16384,!0!==n&&(s.clearColor=n)),i&&(o|=256,!0!==i&&(s.clearDepth=i)),r&&(o|=1024,!0!==i&&(s.clearStencil=i)),fd(0!==o,Vd),ed(e,s,(()=>{e.clear(o)}))}const Hd=[34069,34070,34071,34072,34073,34074];class TextureCube extends Texture{get[Symbol.toStringTag](){return"TextureCube"}constructor(e,t={}){xu(e),super(e,Object.assign({},t,{target:34067})),this.initialize(t),Object.seal(this)}initialize(e={}){const{mipmaps:t=!0,parameters:n={}}=e;return this.opts=e,this.setCubeMapImageData(e).then((()=>{this.loaded=!0,t&&this.generateMipmap(e),this.setParameters(n)})),this}subImage({face:e,data:t,x:n=0,y:i=0,mipmapLevel:r=0}){return this._subImage({target:e,data:t,x:n,y:i,mipmapLevel:r})}async setCubeMapImageData({width:e,height:t,pixels:n,data:i,border:r=0,format:s=6408,type:o=5121}){const{gl:a}=this,l=n||i,c=await Promise.all(Hd.map((e=>{const t=l[e];return Promise.all(Array.isArray(t)?t:[t])})));this.bind(),Hd.forEach(((n,i)=>{c[i].length>1&&!1!==this.opts.mipmaps&&gu.warn(`${this.id} has mipmap and multiple LODs.`)(),c[i].forEach(((i,l)=>{e&&t?a.texImage2D(n,l,s,e,t,r,s,o,i):a.texImage2D(n,l,s,s,o,i)}))})),this.unbind()}setImageDataForFace(e){const{face:t,width:n,height:i,pixels:r,data:s,border:o=0,format:a=6408,type:l=5121}=e,{gl:c}=this,u=r||s;return this.bind(),u instanceof Promise?u.then((n=>this.setImageDataForFace(Object.assign({},e,{face:t,data:n,pixels:n})))):this.width||this.height?c.texImage2D(t,0,a,n,i,o,a,l,u):c.texImage2D(t,0,a,a,l,u),this}}TextureCube.FACES=Hd;class Texture3D extends Texture{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return wu(e)}constructor(e,t={}){_u(e),super(e,t=Object.assign({depth:1},t,{target:32879,unpackFlipY:!1})),this.initialize(t),Object.seal(this)}setImageData({level:e=0,dataFormat:t=6408,width:n,height:i,depth:r=1,border:s=0,format:o,type:a=5121,offset:l=0,data:c,parameters:u={}}){if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),ed(this.gl,u,(()=>{ArrayBuffer.isView(c)&&this.gl.texImage3D(this.target,e,t,n,i,r,s,o,a,c),c instanceof buffer_Buffer&&(this.gl.bindBuffer(35052,c.handle),this.gl.texImage3D(this.target,e,t,n,i,r,s,o,a,l))})),c&&c.byteLength)this._trackAllocatedMemory(c.byteLength,"Texture");else{const e=Od[this.dataFormat]||4,t=Rd[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*e*t,"Texture")}return this.loaded=!0,this}}function $d(e,t){fd(e instanceof Texture2D||e instanceof TextureCube||e instanceof Texture3D);const n=e.constructor,{gl:i,width:r,height:s,format:o,type:a,dataFormat:l,border:c,mipmaps:u}=e;return new n(i,Object.assign({width:r,height:s,format:o,type:a,dataFormat:l,border:c,mipmaps:u},t))}function qd(e,t){const{gl:n,width:i,height:r,id:s}=e;return new Framebuffer(n,Object.assign({},t,{id:`framebuffer-for-${s}`,width:i,height:r,attachments:{36064:e}}))}function Wd(e,t={}){const{sourceX:n=0,sourceY:i=0,sourceFormat:r=6408}=t;let{sourceAttachment:s=36064,target:o=null,sourceWidth:a,sourceHeight:l,sourceType:c}=t;const{framebuffer:u,deleteFramebuffer:d}=Yd(e);fd(u);const{gl:h,handle:p,attachments:f}=u;a=a||u.width,l=l||u.height,36064===s&&null===p&&(s=1028),fd(f[s]),c=c||f[s].type,o=function(e,t,n,i,r){if(e)return e;const s=Sd(t=t||5121,{clamped:!1}),o=function(e){switch(e){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return fd(!1),0}}(n);return new s(i*r*o)}(o,c,r,a,l),c=c||Ed(o);const m=h.bindFramebuffer(36160,p);return h.readPixels(n,i,a,l,r,c,o),h.bindFramebuffer(36160,m||null),d&&u.delete(),o}function Gd(e,{sourceAttachment:t=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}={}){let i=Wd(e,{sourceAttachment:t}),{width:r,height:s}=e;for(;s>n;)({data:i,width:r,height:s}=Cd({data:i,width:r,height:s}));!function({data:e,width:t,height:n,bytesPerPixel:i=4,temp:r}){const s=t*i;r=r||new Uint8Array(s);for(let t=0;t<n/2;++t){const i=t*s,o=(n-t-1)*s;r.set(e.subarray(i,i+s)),e.copyWithin(i,o,o+s),e.set(r,o)}}({data:i,width:r,height:s});const o=document.createElement("canvas");o.width=r,o.height=s;const a=o.getContext("2d"),l=a.createImageData(r,s);return l.data.set(i),a.putImageData(l,0,0),o.toDataURL()}function Yd(e){return e instanceof Framebuffer?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:qd(e),deleteFramebuffer:!0}}const Xd="Multiple render targets not supported";class Framebuffer extends Resource{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e,t={}){const{colorBufferFloat:n,colorBufferHalfFloat:i}=t;let r=!0;return n&&(r=Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),i&&(r=r&&Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),r}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new Framebuffer(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=_u(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=_u(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e,t={}){super(e,t),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(t),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize({width:e=1,height:t=1,attachments:n=null,color:i=!0,depth:r=!0,stencil:s=!1,check:o=!0,readBuffer:a,drawBuffers:l}){if(fd(e>=0&&t>=0,"Width and height need to be integers"),this.width=e,this.height=t,n)for(const i in n){const r=n[i];(Array.isArray(r)?r[0]:r).resize({width:e,height:t})}else n=this._createDefaultAttachments(i,r,s,e,t);this.update({clearAttachments:!0,attachments:n,readBuffer:a,drawBuffers:l}),n&&o&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update({attachments:e={},readBuffer:t,drawBuffers:n,clearAttachments:i=!1,resizeAttachments:r=!0}){this.attach(e,{clearAttachments:i,resizeAttachments:r});const{gl:s}=this,o=s.bindFramebuffer(36160,this.handle);return t&&this._setReadBuffer(t),n&&this._setDrawBuffers(n),s.bindFramebuffer(36160,o||null),this}resize(e={}){let{width:t,height:n}=e;if(null===this.handle)return fd(void 0===t&&void 0===n),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;void 0===t&&(t=this.gl.drawingBufferWidth),void 0===n&&(n=this.gl.drawingBufferHeight),t!==this.width&&n!==this.height&&gu.log(2,`Resizing framebuffer ${this.id} to ${t}x${n}`)();for(const e in this.attachments)this.attachments[e].resize({width:t,height:n});return this.width=t,this.height=n,this}attach(e,{clearAttachments:t=!1,resizeAttachments:n=!0}={}){const i={};t&&Object.keys(this.attachments).forEach((e=>{i[e]=null})),Object.assign(i,e);const r=this.gl.bindFramebuffer(36160,this.handle);for(const e in i){fd(void 0!==e,"Misspelled framebuffer binding point?");const t=Number(e),r=i[t];let s=r;if(s)if(s instanceof Renderbuffer)this._attachRenderbuffer({attachment:t,renderbuffer:s});else if(Array.isArray(r)){const[e,n=0,i=0]=r;s=e,this._attachTexture({attachment:t,texture:e,layer:n,level:i})}else this._attachTexture({attachment:t,texture:s,layer:0,level:0});else this._unattach(t);n&&s&&s.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,r||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter((e=>!this.attachments[e])).forEach((e=>{delete this.attachments[e]}))}checkStatus(){const{gl:e}=this,t=this.getStatus();if(36053!==t)throw new Error(function(e){return(Framebuffer.STATUS||{})[e]||`Framebuffer error ${e}`}(t));return this}getStatus(){const{gl:e}=this,t=e.bindFramebuffer(36160,this.handle),n=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,t||null),n}clear(e={}){const{color:t,depth:n,stencil:i,drawBuffers:r=[]}=e,s=this.gl.bindFramebuffer(36160,this.handle);return(t||n||i)&&Ud(this.gl,{color:t,depth:n,stencil:i}),r.forEach(((e,t)=>{!function(e,{framebuffer:t=null,buffer:n=6144,drawBuffer:i=0,value:r=[0,0,0,0]}={}){_u(e),ed(e,{framebuffer:t},(()=>{switch(n){case 6144:switch(r.constructor){case Int32Array:e.clearBufferiv(n,i,r);break;case Uint32Array:e.clearBufferuiv(n,i,r);break;case Float32Array:default:e.clearBufferfv(n,i,r)}break;case 6145:e.clearBufferfv(6145,0,[r]);break;case 6146:e.clearBufferiv(6146,0,[r]);break;case 34041:const[t,s]=r;e.clearBufferfi(34041,0,t,s);break;default:fd(!1,Vd)}}))}(this.gl,{drawBuffer:t,value:e})})),this.gl.bindFramebuffer(36160,s||null),this}readPixels(e={}){return gu.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(e={}){return gu.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(e={}){return gu.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(e={}){return gu.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(e={}){return gu.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(e={}){return gu.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate({attachments:e=[],x:t=0,y:n=0,width:i,height:r}){const s=_u(this.gl),o=s.bindFramebuffer(36008,this.handle);return 0===t&&0===n&&void 0===i&&void 0===r?s.invalidateFramebuffer(36008,e):s.invalidateFramebuffer(36008,e,t,n,i,r),s.bindFramebuffer(36008,o),this}getAttachmentParameter(e,t,n){let i=this._getAttachmentParameterFallback(t);return null===i&&(this.gl.bindFramebuffer(36160,this.handle),i=this.gl.getFramebufferAttachmentParameter(36160,e,t),this.gl.bindFramebuffer(36160,null)),n&&i>1e3&&(i=gd(this.gl,i)),i}getAttachmentParameters(e=36064,t,n=this.constructor.ATTACHMENT_PARAMETERS||[]){const i={};for(const r of n){i[t?gd(this.gl,r):r]=this.getAttachmentParameter(e,r,t)}return i}getParameters(e=!0){const t=Object.keys(this.attachments),n={};for(const i of t){const t=Number(i);n[e?gd(this.gl,t):t]=this.getAttachmentParameters(t,e)}return n}show(){return"undefined"!=typeof window&&window.open(Gd(this),"luma-debug-texture"),this}log(e=0,t=""){if(e>gu.level||"undefined"==typeof window)return this;t=t||`Framebuffer ${this.id}`;const n=Gd(this,{targetMaxHeight:100});return gu.image({logLevel:e,message:t,image:n},t)(),this}bind({target:e=36160}={}){return this.gl.bindFramebuffer(e,this.handle),this}unbind({target:e=36160}={}){return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,t,n,i,r){let s=null;return e&&(s=s||{},s[36064]=new Texture2D(this.gl,{id:`${this.id}-color0`,pixels:null,format:6408,type:5121,width:i,height:r,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(s[36064])),t&&n?(s=s||{},s[33306]=new Renderbuffer(this.gl,{id:`${this.id}-depth-stencil`,format:35056,width:i,height:111}),this.ownResources.push(s[33306])):t?(s=s||{},s[36096]=new Renderbuffer(this.gl,{id:`${this.id}-depth`,format:33189,width:i,height:r}),this.ownResources.push(s[36096])):n&&fd(!1),s}_unattach(e){const t=this.attachments[e];t&&(t instanceof Renderbuffer?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer({attachment:e=36064,renderbuffer:t}){const{gl:n}=this;n.framebufferRenderbuffer(36160,e,36161,t.handle),this.attachments[e]=t}_attachTexture({attachment:e=36064,texture:t,layer:n,level:i}){const{gl:r}=this;switch(r.bindTexture(t.target,t.handle),t.target){case 35866:case 32879:_u(r).framebufferTextureLayer(36160,e,t.target,i,n);break;case 34067:const s=function(e){return e<34069?e+34069:e}(n);r.framebufferTexture2D(36160,e,s,t.handle,i);break;case 3553:r.framebufferTexture2D(36160,e,3553,t.handle,i);break;default:fd(!1,"Illegal texture type")}r.bindTexture(t.target,null),this.attachments[e]=t}_setReadBuffer(e){const t=wu(n=this.gl)?n:null;var n;t?t.readBuffer(e):fd(36064===e||1029===e,Xd),this.readBuffer=e}_setDrawBuffers(e){const{gl:t}=this,n=_u(t);if(n)n.drawBuffers(e);else{const n=t.getExtension("WEBGL_draw_buffers");n?n.drawBuffersWEBGL(e):fd(1===e.length&&(36064===e[0]||1029===e[0]),Xd)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const t=function(e){e.luma=e.luma||{},e.luma.caps=e.luma.caps||{};for(const t in Jd)void 0===e.luma.caps[t]&&(e.luma.caps[t]=eh(e,t));return e.luma.caps}(this.gl);switch(e){case 36052:return t.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return t.WEBGL2?null:8;case 33297:return t.WEBGL2?null:5125;case 33296:return t.WEBGL2||t.EXT_sRGB?null:9729;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}Framebuffer.ATTACHMENT_PARAMETERS=[36049,36048,33296,33298,33299,33300,33301,33302,33303];const Kd="TIMER_QUERY",Zd="ELEMENT_INDEX_UINT32";const Jd={["WEBGL2"]:[!1,!0],["VERTEX_ARRAY_OBJECT"]:["OES_vertex_array_object",!0],[Kd]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],["INSTANCED_RENDERING"]:["ANGLE_instanced_arrays",!0],["MULTIPLE_RENDER_TARGETS"]:["WEBGL_draw_buffers",!0],[Zd]:["OES_element_index_uint",!0],["BLEND_EQUATION_MINMAX"]:["EXT_blend_minmax",!0],["FLOAT_BLEND"]:["EXT_float_blend"],["COLOR_ENCODING_SRGB"]:["EXT_sRGB",!0],["TEXTURE_DEPTH"]:["WEBGL_depth_texture",!0],["TEXTURE_FLOAT"]:["OES_texture_float",!0],["TEXTURE_HALF_FLOAT"]:["OES_texture_half_float",!0],["TEXTURE_FILTER_LINEAR_FLOAT"]:["OES_texture_float_linear"],["TEXTURE_FILTER_LINEAR_HALF_FLOAT"]:["OES_texture_half_float_linear"],["TEXTURE_FILTER_ANISOTROPIC"]:["EXT_texture_filter_anisotropic"],["COLOR_ATTACHMENT_RGBA32F"]:[function(e){const t=new Texture2D(e,{format:6408,type:5126,dataFormat:6408}),n=new Framebuffer(e,{id:"test-framebuffer",check:!1,attachments:{36064:t}}),i=n.getStatus();return t.delete(),n.delete(),36053===i},"EXT_color_buffer_float"],["COLOR_ATTACHMENT_FLOAT"]:[!1,"EXT_color_buffer_float"],["COLOR_ATTACHMENT_HALF_FLOAT"]:["EXT_color_buffer_half_float"],["GLSL_FRAG_DATA"]:["WEBGL_draw_buffers",!0],["GLSL_FRAG_DEPTH"]:["EXT_frag_depth",!0],["GLSL_DERIVATIVES"]:["OES_standard_derivatives",!0],["GLSL_TEXTURE_LOD"]:["EXT_shader_texture_lod",!0]};function Qd(e,t){return(t=Array.isArray(t)?t:[t]).every((t=>eh(e,t)))}function eh(e,t){return e.luma=e.luma||{},e.luma.caps=e.luma.caps||{},void 0===e.luma.caps[t]&&(e.luma.caps[t]=function(e,t){const n=Jd[t];let i;fd(n,t);const r=wu(e)&&n[1]||n[0];if("function"==typeof r)i=r(e);else if(Array.isArray(r)){i=!0;for(const t of r)i=i&&Boolean(e.getExtension(t))}else"string"==typeof r?i=Boolean(e.getExtension(r)):"boolean"==typeof r?i=r:fd(!1);return i}(e,t)),e.luma.caps[t]||gu.log(2,`Feature: ${t} not supported`)(),e.luma.caps[t]}class ShaderAttribute{constructor(e,t){this.opts=t,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),t=this.getAccessor();if(e)return[e,t];const{value:n}=this.source,{size:i}=t;let r=n;if(n&&n.length!==i){r=new Float32Array(i);const e=t.elementOffset||0;for(let t=0;t<i;++t)r[t]=n[e+t]}return r}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}const th=new class TypedArrayManager{constructor(e){this._pool=[],this.props={overAlloc:2,poolSize:100},this.setProps(e)}setProps(e){Object.assign(this.props,e)}allocate(e,t,{size:n=1,type:i,padding:r=0,copy:s=!1,initialize:o=!1,maxCount:a}){const l=i||e&&e.constructor||Float32Array,c=t*n+r;if(ArrayBuffer.isView(e)){if(c<=e.length)return e;if(c*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new l(e.buffer,0,c)}let u;a&&(u=a*n+r);const d=this._allocate(l,c,o,u);return e&&s?d.set(e):o||d.fill(0,0,4),this._release(e),d}release(e){this._release(e)}_allocate(e,t,n,i){let r=Math.max(Math.ceil(t*this.props.overAlloc),1);r>i&&(r=i);const s=this._pool,o=e.BYTES_PER_ELEMENT*r,a=s.findIndex((e=>e.byteLength>=o));if(a>=0){const t=new e(s.splice(a,1)[0],0,r);return n&&t.fill(0),t}return new e(r)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:n}=e,{byteLength:i}=n,r=t.findIndex((e=>e.byteLength>=i));r<0?t.push(n):(r>0||t.length<this.props.poolSize)&&t.splice(r,0,n),t.length>this.props.poolSize&&t.shift()}},nh=(Math.PI,Math.PI,{EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0});function ih(e,{precision:t=nh.precision}={}){return e=function(e){return Math.round(e/nh.EPSILON)*nh.EPSILON}(e),"".concat(parseFloat(e.toPrecision(t)))}function rh(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function sh(e,t,n){return lh(e,(e=>Math.max(t,Math.min(n,e))))}function oh(e,t,n){return rh(e)?e.map(((e,i)=>oh(e,t[i],n))):n*t+(1-n)*e}function ah(e,t,n){const i=nh.EPSILON;n&&(nh.EPSILON=n);try{if(e===t)return!0;if(rh(e)&&rh(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!ah(e[n],t[n]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):"number"==typeof e&&"number"==typeof t&&Math.abs(e-t)<=nh.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))}finally{nh.EPSILON=i}}function lh(e,t,n){if(rh(e)){const i=e;n=n||function(e){return e.clone?e.clone():new Array(e.length)}(i);for(let r=0;r<n.length&&r<i.length;++r)n[r]=t(e[r],r,n);return n}return t(e)}class MathArray extends(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Array)){clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}toArray(e=[],t=0){for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:rh(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(nh)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+ih(this[n],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(t,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!ah(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){if(void 0===n)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const r=e[i];this[i]=r+n*(t[i]-r)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]+=t[e];return this.check()}subtract(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]-=t[e];return this.check()}scale(e){if("number"==typeof e)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(nh.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}get elements(){return this}}function ch(e){if(!Number.isFinite(e))throw new Error("Invalid number ".concat(e));return e}function uh(e,t,n=""){if(nh.debug&&!function(e,t){if(e.length!==t)return!1;for(let t=0;t<e.length;++t)if(!Number.isFinite(e[t]))return!1;return!0}(e,t))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return e}function dh(e,t){if(!e)throw new Error("math.gl assertion ".concat(t))}class Vector extends MathArray{get x(){return this[0]}set x(e){this[0]=ch(e)}get y(){return this[1]}set y(e){this[1]=ch(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-e[n];t+=i*i}return ch(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return ch(t)}normalize(){const e=this.magnitude();if(0!==e)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t[e];return this.check()}divide(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t[e];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return dh(e>=0&&e<this.ELEMENTS,"index is out of range"),ch(this[e])}setComponent(e,t){return dh(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}var hh=1e-6,ph="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function fh(){var e=new ph(3);return ph!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function mh(e,t,n){var i=new ph(3);return i[0]=e,i[1]=t,i[2]=n,i}function gh(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function yh(e,t,n){var i=t[0],r=t[1],s=t[2],o=n[0],a=n[1],l=n[2];return e[0]=r*l-s*a,e[1]=s*o-i*l,e[2]=i*a-r*o,e}function vh(e,t,n){var i=t[0],r=t[1],s=t[2],o=n[3]*i+n[7]*r+n[11]*s+n[15];return o=o||1,e[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])/o,e[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])/o,e[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])/o,e}function bh(e,t,n){var i=t[0],r=t[1],s=t[2];return e[0]=i*n[0]+r*n[3]+s*n[6],e[1]=i*n[1]+r*n[4]+s*n[7],e[2]=i*n[2]+r*n[5]+s*n[8],e}function wh(e,t,n){var i=n[0],r=n[1],s=n[2],o=n[3],a=t[0],l=t[1],c=t[2],u=r*c-s*l,d=s*a-i*c,h=i*l-r*a,p=r*h-s*d,f=s*u-i*h,m=i*d-r*u,g=2*o;return u*=g,d*=g,h*=g,p*=2,f*=2,m*=2,e[0]=a+u+p,e[1]=l+d+f,e[2]=c+h+m,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var xh,_h=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},Eh=function(e){var t=e[0],n=e[1],i=e[2];return Math.hypot(t,n,i)};xh=fh();function Sh(e,t,n){const i=t[0],r=t[1],s=t[2],o=n[3]*i+n[7]*r+n[11]*s||1;return e[0]=(n[0]*i+n[4]*r+n[8]*s)/o,e[1]=(n[1]*i+n[5]*r+n[9]*s)/o,e[2]=(n[2]*i+n[6]*r+n[10]*s)/o,e}function Ch(e,t,n){const i=t[0],r=t[1],s=t[2];return e[0]=n[0]*i+n[3]*r+n[6]*s,e[1]=n[1]*i+n[4]*r+n[7]*s,e[2]=n[2]*i+n[5]*r+n[8]*s,e[3]=t[3],e}const Th=[0,0,0];let Ah;class vector3_Vector3 extends Vector{static get ZERO(){return Ah||(Ah=new vector3_Vector3(0,0,0),Object.freeze(Ah)),Ah}constructor(e=0,t=0,n=0){super(-0,-0,-0),1===arguments.length&&rh(e)?this.copy(e):(nh.debug&&(ch(e),ch(t),ch(n)),this[0]=e,this[1]=t,this[2]=n)}set(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return nh.debug&&(ch(e.x),ch(e.y),ch(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=ch(e)}angle(e){return function(e,t){var n=e[0],i=e[1],r=e[2],s=t[0],o=t[1],a=t[2],l=Math.sqrt(n*n+i*i+r*r)*Math.sqrt(s*s+o*o+a*a),c=l&&gh(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))}(this,e)}cross(e){return yh(this,this,e),this.check()}rotateX({radians:e,origin:t=Th}){return function(e,t,n,i){var r=[],s=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],s[0]=r[0],s[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),s[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2]}(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Th}){return function(e,t,n,i){var r=[],s=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],s[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),s[1]=r[1],s[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2]}(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Th}){return function(e,t,n,i){var r=[],s=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],s[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),s[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),s[2]=r[2],e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2]}(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return vh(this,this,e),this.check()}transformAsVector(e){return Sh(this,this,e),this.check()}transformByMatrix3(e){return bh(this,this,e),this.check()}transformByMatrix2(e){return function(e,t,n){const i=t[0],r=t[1];e[0]=n[0]*i+n[2]*r,e[1]=n[1]*i+n[3]*r,e[2]=t[2]}(this,this,e),this.check()}transformByQuaternion(e){return wh(this,this,e),this.check()}}const kh=new vector3_Vector3;function Nh(e,t,n,i){kh.set(e,t,n);const r=kh.len();return{distance:i/r,normal:new vector3_Vector3(-e/r,-t/r,-n/r)}}function Mh(e){return e-Math.fround(e)}let Ph;function Lh(e,t){const{size:n=1,startIndex:i=0}=t,r=void 0!==t.endIndex?t.endIndex:e.length,s=(r-i)/n;Ph=th.allocate(Ph,s,{type:Float32Array,size:2*n});let o=i,a=0;for(;o<r;){for(let t=0;t<n;t++){const i=e[o++];Ph[a+t]=i,Ph[a+t+n]=Mh(i)}a+=2*n}return Ph.subarray(0,s*n*2)}function Oh(e){return e.stride||e.size*e.bytesPerElement}function Rh(e,t){t.offset&&cu.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=Oh(e),i=("vertexOffset"in t?t.vertexOffset:e.vertexOffset||0)*n+(t.elementOffset||0)*e.bytesPerElement+(e.offset||0);return{...t,offset:i,stride:n}}function Ih(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}const Dh=[],Fh=[];function Bh(e,t=0,n=1/0){let i=Dh;const r={index:-1,data:e,target:[]};return e?"function"==typeof e[Symbol.iterator]?i=e:e.length>0&&(Fh.length=e.length,i=Fh):i=Dh,(t>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(t,n),r.index=t-1),{iterable:i,objectInfo:r}}function zh(e){return e&&e[Symbol.asyncIterator]}function jh(e,t){const{size:n,stride:i,offset:r,startIndices:s,nested:o}=t,a=e.BYTES_PER_ELEMENT,l=i?i/a:n,c=r?r/a:0,u=Math.floor((e.length-c)/l);return(t,{index:i,target:r})=>{if(!s){const t=i*l+c;for(let i=0;i<n;i++)r[i]=e[t+i];return r}const a=s[i],d=s[i+1]||u;let h;if(o){h=new Array(d-a);for(let t=a;t<d;t++){const i=t*l+c;r=new Array(n);for(let t=0;t<n;t++)r[t]=e[i+t];h[t-a]=r}}else if(l===n)h=e.subarray(a*n+c,d*n+c);else{h=new e.constructor((d-a)*n);let t=0;for(let i=a;i<d;i++){const r=i*l+c;for(let i=0;i<n;i++)h[t++]=e[r+i]}}return h}}function Vh(e,t=(()=>!0)){return Array.isArray(e)?Uh(e,t,[]):t(e)?[e]:[]}function Uh(e,t,n){let i=-1;for(;++i<e.length;){const r=e[i];Array.isArray(r)?Uh(r,t,n):t(r)&&n.push(r)}return n}function Hh({target:e,source:t,start:n=0,count:i=1}){const r=t.length,s=i*r;let o=0;for(let i=n;o<r;o++)e[i++]=t[o];for(;o<s;)o<s-o?(e.copyWithin(n+o,n,n+o),o*=2):(e.copyWithin(n+o,n,n+s-o),o=s);return e}const $h=[],qh=[[0,1/0]];function Wh(e){const{source:t,target:n,start:i=0,size:r,getData:s}=e,o=e.end||n.length,a=t.length,l=o-i;if(a>l)return void n.set(t.subarray(0,l),i);if(n.set(t,i),!s)return;let c=a;for(;c<l;){const e=s(c,t);for(let t=0;t<r;t++)n[i+c]=e[t]||0,c++}}const Gh={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function Yh(e,t){return e?(Number.isFinite(e)&&(e={duration:e}),e.type=e.type||"interpolation",{...Gh[e.type],...t,...e}):null}function Xh(e,t){return t.getBuffer()?[t.getBuffer(),{divisor:0,size:t.size,normalized:t.settings.normalized}]:t.value}function Kh(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(e,'"'))}}function Zh(e){e.push(e.shift())}function Jh(e,t){const{doublePrecision:n,settings:i,value:r,size:s}=e,o=n&&r instanceof Float64Array?2:1;return(i.noAlloc?r.length:t*s)*o}function Qh({buffer:e,numInstances:t,attribute:n,fromLength:i,fromStartIndices:r,getData:s=(e=>e)}){const o=n.doublePrecision&&n.value instanceof Float64Array?2:1,a=n.size*o,l=n.byteOffset,c=n.startIndices,u=r&&c,d=Jh(n,t),h=n.state.constant;if(!u&&i>=d)return;const p=h?n.value:n.getBuffer().getData({srcByteOffset:l});if(n.settings.normalized&&!h){const e=s;s=(t,i)=>n._normalizeConstant(e(t,i))}const f=h?(e,t)=>s(p,t):(e,t)=>s(p.subarray(e,e+a),t),m=e.getData({length:i}),g=new Float32Array(d);!function({source:e,target:t,size:n,getData:i,sourceStartIndices:r,targetStartIndices:s}){if(!Array.isArray(s))return Wh({source:e,target:t,size:n,getData:i}),t;let o=0,a=0;const l=i&&((e,t)=>i(e+a,t)),c=Math.min(r.length,s.length);for(let i=1;i<c;i++){const c=r[i]*n,u=s[i]*n;Wh({source:e.subarray(o,c),target:t,start:a,end:u,size:n,getData:l}),o=c,a=u}a<t.length&&Wh({source:[],target:t,start:a,size:n,getData:l})}({source:m,target:g,sourceStartIndices:r,targetStartIndices:c,size:a,getData:f}),e.byteLength<g.byteLength+l&&e.reallocate(g.byteLength+l),e.subData({data:g,offset:l})}class Attribute extends class DataColumn{constructor(e,t){this.gl=e,this.id=t.id,this.size=t.size;const n=t.logicalType||t.type,i=5130===n;let{defaultValue:r}=t;r=Number.isFinite(r)?[r]:r||new Array(this.size).fill(0),t.defaultValue=r;let s=n;i?s=5126:!s&&t.isIndexed?s=e&&function(e,t){return Qd(e,t)}(e,Zd)?5125:5123:s||(s=5126),t.logicalType=n,t.type=s;let o=function(e){switch(e){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}(n||s||5126);this.shaderAttributes={},this.doublePrecision=i,i&&!1===t.fp64&&(o=Float32Array),t.bytesPerElement=o.BYTES_PER_ELEMENT,this.defaultType=o,this.value=null,this.settings=t,this.state={externalBuffer:null,bufferAccessor:t,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null,this.setData(t)}get buffer(){if(!this._buffer){const{isIndexed:e,type:t}=this.settings;this._buffer=new buffer_Buffer(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:t}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Oh(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),th.release(this.state.allocatedValue)}getShaderAttributes(e,t){if(this.doublePrecision){const n={},i=this.value instanceof Float64Array,r=function(e,t){const n=Rh(e,t);return{high:n,low:{...n,offset:n.offset+4*e.size}}}(this.getAccessor(),t||{});return n[e]=new ShaderAttribute(this,r.high),n["".concat(e,"64Low")]=i?new ShaderAttribute(this,r.low):new Float32Array(this.size),n}if(t){const n=Rh(this.getAccessor(),t);return{[e]:new ShaderAttribute(this,n)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant){const t=this.value.slice();e=[t,t]}else{const{value:t,numInstances:n,size:i}=this,r=n*i;if(t&&r&&t.length>=r){const n=new Array(i).fill(1/0),s=new Array(i).fill(-1/0);for(let e=0;e<r;)for(let r=0;r<i;r++){const i=t[e++];i<n[r]&&(n[r]=i),i>s[r]&&(s[r]=i)}e=[n,s]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;ArrayBuffer.isView(e)?e={value:e}:e instanceof buffer_Buffer&&(e={buffer:e});const n={...this.settings,...e};if(t.bufferAccessor=n,t.bounds=null,e.constant){let n=e.value;n=this._normalizeValue(n,[],0),this.settings.normalized&&(n=this._normalizeConstant(n));if(!(!t.constant||!this._areValuesEqual(n,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=n}else if(e.buffer){const i=e.buffer;t.externalBuffer=i,t.constant=!1,this.value=e.value;const r=e.value instanceof Float64Array;n.type=e.type||i.accessor.type,n.bytesPerElement=i.accessor.BYTES_PER_ELEMENT*(r?2:1),n.stride=Oh(n)}else if(e.value){this._checkExternalBuffer(e);let i=e.value;t.externalBuffer=null,t.constant=!1,this.value=i,n.bytesPerElement=i.BYTES_PER_ELEMENT,n.stride=Oh(n);const{buffer:r,byteOffset:s}=this;this.doublePrecision&&i instanceof Float64Array&&(i=Lh(i,n));const o=i.byteLength+s+2*n.stride;r.byteLength<o&&r.reallocate(o),r.setAccessor(null),r.subData({data:i,offset:s}),n.type=e.type||r.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const{value:t}=this,{startOffset:n=0,endOffset:i}=e;this.buffer.subData({data:this.doublePrecision&&t instanceof Float64Array?Lh(t,{size:this.size,startIndex:n,endIndex:i}):t.subarray(n,i),offset:n*t.BYTES_PER_ELEMENT+this.byteOffset})}allocate({numInstances:e,copy:t=!1}){const{state:n}=this,i=n.allocatedValue,r=th.allocate(i,e+1,{size:this.size,type:this.defaultType,copy:t});this.value=r;const{buffer:s,byteOffset:o}=this;return s.byteLength<r.byteLength+o&&(s.reallocate(r.byteLength+o),t&&i&&s.subData({data:i instanceof Float64Array?Lh(i,this):i,offset:o})),n.allocatedValue=r,n.constant=!1,n.externalBuffer=null,n.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:t}=e;if(!e.constant&&t){const n=this.defaultType;let i=!1;if(this.doublePrecision&&(i=t.BYTES_PER_ELEMENT<4),i)throw new Error("Attribute ".concat(this.id," does not support ").concat(t.constructor.name));t instanceof n||!this.settings.normalized||"normalized"in e||cu.warn("Attribute ".concat(this.id," is normalized"))()}}_normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map((e=>(e+128)/255*2-1));case 5122:return new Float32Array(e).map((e=>(e+32768)/65535*2-1));case 5121:return new Float32Array(e).map((e=>e/255));case 5123:return new Float32Array(e).map((e=>e/65535));default:return e}}_normalizeValue(e,t,n){const{defaultValue:i,size:r}=this.settings;if(Number.isFinite(e))return t[n]=e,t;if(!e)return t[n]=i[0],t;switch(r){case 4:t[n+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[n+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[n+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[n+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let s=r;for(;--s>=0;)t[n+s]=Number.isFinite(e[s])?e[s]:i[s]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}}{constructor(e,t={}){super(e,t);const{transition:n=!1,noAlloc:i=!1,update:r=null,accessor:s=null,transform:o=null,startIndices:a=null}=t;Object.assign(this.settings,{transition:n,noAlloc:i,update:r||s&&this._autoUpdater,accessor:s,transform:o}),Object.assign(this.state,{lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:qh,startIndices:a}),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat("function"!=typeof e&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,n=this.settings.transition,i=Array.isArray(t)?e[t.find((t=>e[t]))]:e[t];return Yh(i,n)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:e=0,endRow:n=1/0}=t;this.state.updateRanges=function(e,t){if(e===qh)return e;if(t[0]<0&&(t[0]=0),t[0]>=t[1])return e;const n=[],i=e.length;let r=0;for(let s=0;s<i;s++){const i=e[s];i[1]<t[0]?(n.push(i),r=s+1):i[0]>t[1]?n.push(i):t=[Math.min(i[0],t[0]),Math.max(i[1],t[1])]}return n.splice(r,0,t),n}(this.state.updateRanges,[e,n])}else this.state.updateRanges=qh}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=$h}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}update(e){this.setData(e)}allocate(e){const{state:t,settings:n}=this;return!n.noAlloc&&(!!n.update&&(super.allocate({numInstances:e,copy:t.updateRanges!==qh}),!0))}updateBuffer({numInstances:e,data:t,props:n,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:r},settings:{update:s,noAlloc:o}}=this;let a=!0;if(s){for(const[o,a]of r)s.call(i,this,{data:t,startRow:o,endRow:a,props:n,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[t,n]of r){const i=Number.isFinite(t)?this.getVertexOffset(t):0,r=Number.isFinite(n)?this.getVertexOffset(n):o||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:i,endOffset:r})}else;this._checkAttributeArray()}else a=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),a}setConstantValue(e){if(void 0===e||"function"==typeof e)return!1;return this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:n,settings:i}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;n.binaryValue=e,this.setNeedsRedraw(),ArrayBuffer.isView(e)&&(e={value:e});if(i.transform||t!==this.startIndices){Ih(ArrayBuffer.isView(e.value),"invalid ".concat(i.accessor));const r=e.size&&e.size!==this.size;return n.binaryAccessor=jh(e.value,{size:e.size||this.size,stride:e.stride,offset:e.offset,startIndices:t,nested:r}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?t[e]:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},t={};for(const n in e)Object.assign(t,super.getShaderAttributes(n,e[n]));return t}_autoUpdater(e,{data:t,startRow:n,endRow:i,props:r,numInstances:s}){if(e.constant)return;const{settings:o,state:a,value:l,size:c,startIndices:u}=e,{accessor:d,transform:h}=o,p=a.binaryAccessor||("function"==typeof d?d:r[d]);Ih("function"==typeof p,'accessor "'.concat(d,'" is not a function'));let f=e.getVertexOffset(n);const{iterable:m,objectInfo:g}=Bh(t,n,i);for(const t of m){g.index++;let n=p(t,g);if(h&&(n=h.call(this,n)),u){const t=(g.index<u.length-1?u[g.index+1]:s)-u[g.index];if(n&&Array.isArray(n[0])){let t=f;for(const i of n)e._normalizeValue(i,l,t),t+=c}else n&&n.length>c?l.set(n,f):(e._normalizeValue(n,g.target,0),Hh({target:l,source:g.target,start:f,count:t}));f+=t*c}else e._normalizeValue(n,l,f),f+=c}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||"function"==typeof e.update))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let n=!0;switch(t){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error("Illegal attribute generated for ".concat(this.id))}}}let ep={};function tp(e){cu.level>0&&ep[e]&&ep[e].call(...arguments)}function np(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}const ip="out vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}",rp=`#version 300 es\n${ip}`;function sp(e,t){t=Array.isArray(t)?t:[t];const n=e.replace(/^\s+/,"").split(/\s+/),[i,r,s]=n;if(!t.includes(i)||!r||!s)return null;return{qualifier:i,type:r,name:s.split(";")[0]}}function op(e={}){const{version:t=100,input:n,inputType:i,output:r}=e;if(!n)return 300===t?rp:t>300?`#version ${t}\n${ip}`:"void main() {gl_FragColor = vec4(0);}";const s=function(e,t){switch(t){case"float":return`vec4(${e}, 0.0, 0.0, 1.0)`;case"vec2":return`vec4(${e}, 0.0, 1.0)`;case"vec3":return`vec4(${e}, 1.0)`;case"vec4":return e;default:return np(!1),null}}(n,i);return t>=300?`#version ${t} ${300===t?"es":""}\nin ${i} ${n};\nout vec4 ${r};\nvoid main() {\n  ${r} = ${s};\n}`:`varying ${i} ${n};\nvoid main() {\n  gl_FragColor = ${s};\n}`}class TransformFeedback extends Resource{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return wu(e)}constructor(e,t={}){_u(e),super(e,t),this.initialize(t),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(e={}){return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,wd(this.buffers)||this.bind((()=>this._unbindBuffers())),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(e={}){return this.bind((()=>{for(const t in e)this.setBuffer(t,e[t])})),this}setBuffer(e,t){const n=this._getVaryingIndex(e),{buffer:i,byteSize:r,byteOffset:s}=this._getBufferParams(t);return n<0?(this.unused[e]=i,gu.warn((()=>`${this.id} unused varying buffer ${e}`))(),this):(this.buffers[n]=t,this.bindOnUse||this._bindBuffer(n,i,s,r),this)}begin(e=0){return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let t,n,i;return e instanceof buffer_Buffer==!1?(i=e.buffer,n=e.byteSize,t=e.byteOffset):i=e,void 0===t&&void 0===n||(t=t||0,n=n||i.byteLength-t),{buffer:i,byteOffset:t,byteSize:n}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const t=Number(e);return Number.isFinite(t)?t:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:t,byteSize:n,byteOffset:i}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,t,i,n)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,t,n=0,i){const r=t&&t.handle;return r&&void 0!==i?this.gl.bindBufferRange(35982,e,r,n,i):this.gl.bindBufferBase(35982,e,r),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}class BufferTransform{constructor(e,t={}){this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}setupResources(e){for(const t of this.bindings)this._setupTransformFeedback(t,e)}updateModelProps(e={}){const{varyings:t}=this;return t.length>0&&(e=Object.assign({},e,{varyings:t})),e}getDrawOptions(e={}){const t=this.bindings[this.currentIndex],{sourceBuffers:n,transformFeedback:i}=t;return{attributes:Object.assign({},n,e.attributes),transformFeedback:i}}swap(){return!!this.feedbackMap&&(this.currentIndex=this._getNextIndex(),!0)}update(e={}){this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:t}=this.bindings[this.currentIndex],n=e?t[e]:null;return n?n instanceof buffer_Buffer?n:n.buffer:null}getData(e={}){const{varyingName:t}=e,n=this.getBuffer(t);return n?n.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(e={}){this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&fd(wu(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:t={}}=e,n={};if(this.bindings[this.currentIndex]&&Object.assign(n,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const e in this.feedbackMap){const i=this.feedbackMap[e];e in t&&(n[i]=e)}Object.assign(n,e.feedbackBuffers);for(const e in n){const i=n[e];if("string"==typeof i){const r=t[i],{byteLength:s,usage:o,accessor:a}=r;n[e]=this._createNewBuffer(e,{byteLength:s,usage:o,accessor:a})}}return n}_setupBuffers(e={}){const{sourceBuffers:t=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const n=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:t,feedbackBuffers:n})}_setupTransformFeedback(e,{model:t}){const{program:n}=t;e.transformFeedback=new TransformFeedback(this.gl,{program:n,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:e,feedbackBuffers:t}=this._swapBuffers(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceBuffers:e,feedbackBuffers:t})}}_updateBinding(e,t){return e?(Object.assign(e.sourceBuffers,t.sourceBuffers),Object.assign(e.feedbackBuffers,t.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},t.sourceBuffers),feedbackBuffers:Object.assign({},t.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const t=Object.assign({},e.sourceBuffers),n=Object.assign({},e.feedbackBuffers);for(const i in this.feedbackMap){const r=this.feedbackMap[i];t[i]=e.feedbackBuffers[r],n[r]=e.sourceBuffers[i],fd(n[r]instanceof buffer_Buffer)}return{sourceBuffers:t,feedbackBuffers:n}}_createNewBuffer(e,t){const n=new buffer_Buffer(this.gl,t);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=n,n}_getNextIndex(){return(this.currentIndex+1)%2}}function ap(e){let t=100;const n=e.match(/[^\s]+/g);if(n.length>=2&&"#version"===n[0]){const e=parseInt(n[1],10);Number.isFinite(e)&&(t=e)}return t}const lp="vs",cp="fs",up={[lp]:"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n",[cp]:"#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"},dp="__LUMA_INJECT_DECLARATIONS__",hp=/void\s+main\s*\([^)]*\)\s*\{\n?/,pp=/}\n?[^{}]*$/,fp=[];function mp(e,t,n,i=!1){const r=t===lp;for(const t in n){const i=n[t];i.sort(((e,t)=>e.order-t.order)),fp.length=i.length;for(let e=0,t=i.length;e<t;++e)fp[e]=i[e].injection;const s=`${fp.join("\n")}\n`;switch(t){case"vs:#decl":r&&(e=e.replace(dp,s));break;case"vs:#main-start":r&&(e=e.replace(hp,(e=>e+s)));break;case"vs:#main-end":r&&(e=e.replace(pp,(e=>s+e)));break;case"fs:#decl":r||(e=e.replace(dp,s));break;case"fs:#main-start":r||(e=e.replace(hp,(e=>e+s)));break;case"fs:#main-end":r||(e=e.replace(pp,(e=>s+e)));break;default:e=e.replace(t,(e=>e+s))}}return e=e.replace(dp,""),i&&(e=e.replace(/\}\s*$/,(e=>e+up[t]))),e}function gp(e){const t={};return np(Array.isArray(e)&&e.length>1),e.forEach((e=>{for(const n in e)t[n]=t[n]?`${t[n]}\n${e[n]}`:e[n]})),t}const yp={name:"transform",vs:"attribute float transform_elementID;\nvec2 transform_getPixelSizeHalf(vec2 size) {\n  return vec2(1.) / (2. * size);\n}\n\nvec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {\n  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);\n  float xIndex = transform_elementID - (yIndex * texSize[0]);\n  return vec2(xIndex, yIndex);\n}\nvec2 transform_getTexCoord(vec2 size) {\n  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);\n  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);\n  vec2 coord = indices / size + pixelSizeHalf;\n  return coord;\n}\nvec2 transform_getPos(vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);\n  return pos;\n}\nvec4 transform_getInput(sampler2D texSampler, vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec4 textureColor = texture2D(texSampler, texCoord);\n  return textureColor;\n}\n",fs:null};function vp({vs:e,sourceTextureMap:t,targetTextureVarying:n,targetTexture:i}){let r=Object.keys(t).length,s=null;const o={};let a=e,l={};if(r>0||n){const e=a.split("\n"),c=e.slice();if(e.forEach(((e,i,a)=>{if(r>0){const n=function(e,t){const n={},i=function(e){return sp(e,["attribute","in"])}(e);if(!i)return null;const{type:r,name:s}=i;if(s&&t[s]){const t=`// ${e} => Replaced by Transform with a sampler`,{samplerName:i,sizeName:o,uniformDeclerations:a}=function(e){const t=`transform_uSampler_${e}`,n=`transform_uSize_${e}`;return{samplerName:t,sizeName:n,uniformDeclerations:`  uniform sampler2D ${t};\n  uniform vec2 ${n};`}}(s),l=function(e){switch(e){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return np(!1),null}}(r),c=`  ${r} ${s} = transform_getInput(${i}, ${o}).${l};\n`;n[i]=s;return{updatedLine:t,inject:{"vs:#decl":a,"vs:#main-start":c},samplerTextureMap:n}}return null}(e,t);if(n){const{updatedLine:e,inject:t}=n;c[i]=e,l=gp([l,t]),Object.assign(o,n.samplerTextureMap),r--}}n&&!s&&(s=function(e,t){const n=sp(e,["varying","out"]);if(!n)return null;return n.name===t?n.type:null}(e,n))})),n){fd(i);const e=`transform_uSize_${n}`;l=gp([l,{"vs:#decl":`uniform vec2 ${e};\n`,"vs:#main-start":`     vec2 transform_position = transform_getPos(${e});\n     gl_Position = vec4(transform_position, 0, 1.);\n`}])}a=c.join("\n")}return{vs:a,targetTextureType:s,inject:l,samplerTextureMap:o}}const bp={10241:9728,10240:9728,10242:33071,10243:33071};class TextureTransform{constructor(e,t={}){this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}updateModelProps(e={}){const t=this._processVertexShader(e);return Object.assign({},e,t)}getDrawOptions(e={}){const{sourceBuffers:t,sourceTextures:n,framebuffer:i,targetTexture:r}=this.bindings[this.currentIndex],s=Object.assign({},t,e.attributes),o=Object.assign({},e.uniforms),a=Object.assign({},e.parameters);let l=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){s.transform_elementID=this.elementIDBuffer;for(const e in this.samplerTextureMap){const t=this.samplerTextureMap[e];o[e]=n[t]}this._setSourceTextureParameters();const e=function({sourceTextureMap:e,targetTextureVarying:t,targetTexture:n}){const i={};let r,s;t&&(({width:r,height:s}=n),i[`transform_uSize_${t}`]=[r,s]);for(const t in e)({width:r,height:s}=e[t]),i[`transform_uSize_${t}`]=[r,s];return i}({sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:r});Object.assign(o,e)}return this.hasTargetTexture&&(l=!1,a.viewport=[0,0,i.width,i.height]),{attributes:s,framebuffer:i,uniforms:o,discard:l,parameters:a}}swap(){return!!this._swapTexture&&(this.currentIndex=this._getNextIndex(),!0)}update(e={}){this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData({packed:e=!1}={}){const{framebuffer:t}=this.bindings[this.currentIndex],n=Wd(t);if(!e)return n;const i=n.constructor,r=function(e){switch(e){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return np(!1),null}}(this.targetTextureType),s=new i(n.length*r/4);let o=0;for(let e=0;e<n.length;e+=4)for(let t=0;t<r;t++)s[o++]=n[e+t];return s}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(e={}){const{_targetTextureVarying:t,_swapTexture:n}=e;this._swapTexture=n,this.targetTextureVarying=t,this.hasTargetTexture=t,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:t,textureOrReference:n}=e;if(n instanceof Texture2D)return n;const i=t[n];return i?(this._targetRefTexName=n,this._createNewTexture(i)):null}_setupTextures(e={}){const{sourceBuffers:t,_sourceTextures:n={},_targetTexture:i}=e,r=this._createTargetTexture({sourceTextures:n,textureOrReference:i});this.hasSourceTextures=this.hasSourceTextures||n&&Object.keys(n).length>0,this._updateBindings({sourceBuffers:t,sourceTextures:n,targetTexture:r}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if("number"!=typeof e||this.elementCount>=e)return;const t=new Float32Array(e);t.forEach(((e,t,n)=>{n[t]=t})),this.elementIDBuffer?this.elementIDBuffer.setData({data:t}):this.elementIDBuffer=new buffer_Buffer(this.gl,{data:t,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:e,targetTexture:t}=this._swapTextures(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceTextures:e,targetTexture:t})}}_updateBinding(e,t){const{sourceBuffers:n,sourceTextures:i,targetTexture:r}=t;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,i),Object.assign(e.sourceBuffers,n),r){e.targetTexture=r;const{width:t,height:n}=r,{framebuffer:i}=e;i?(i.update({attachments:{36064:r},resizeAttachments:!1}),i.resize({width:t,height:n})):e.framebuffer=new Framebuffer(this.gl,{id:"transform-framebuffer",width:t,height:n,attachments:{36064:r}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const e in t)t[e].setParameters(bp)}_swapTextures(e){if(!this._swapTexture)return null;const t=Object.assign({},e.sourceTextures);t[this._swapTexture]=e.targetTexture;return{sourceTextures:t,targetTexture:e.sourceTextures[this._swapTexture]}}_createNewTexture(e){const t=$d(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=t,t}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(e={}){const{sourceTextures:t,targetTexture:n}=this.bindings[this.currentIndex],{vs:i,uniforms:r,targetTextureType:s,inject:o,samplerTextureMap:a}=vp({vs:e.vs,sourceTextureMap:t,targetTextureVarying:this.targetTextureVarying,targetTexture:n}),l=gp([e.inject||{},o]);this.targetTextureType=s,this.samplerTextureMap=a;return{vs:i,fs:e._fs||op({version:ap(i),input:this.targetTextureVarying,inputType:s,output:"transform_output"}),modules:this.hasSourceTextures||this.targetTextureVarying?[yp].concat(e.modules||[]):e.modules,uniforms:r,inject:l}}}const wp={number:{validate:(e,t)=>Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)},array:{validate:(e,t)=>Array.isArray(e)||ArrayBuffer.isView(e)}};function xp(e){let t=_p(e);return"object"===t?e?"type"in e?Object.assign({},e,wp[e.type]):"value"in e?(t=_p(e.value),Object.assign({type:t},e,wp[t])):{type:"object",value:e}:{type:"object",value:null}:Object.assign({type:t,value:e},wp[t])}function _p(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}class ShaderModule{constructor({name:e,vs:t,fs:n,dependencies:i=[],uniforms:r,getUniforms:s,deprecations:o=[],defines:a={},inject:l={},vertexShader:c,fragmentShader:u}){np("string"==typeof e),this.name=e,this.vs=t||c,this.fs=n||u,this.getModuleUniforms=s,this.dependencies=i,this.deprecations=this._parseDeprecationDefinitions(o),this.defines=a,this.injections=function(e){const t={vs:{},fs:{}};for(const n in e){let i=e[n];const r=n.slice(0,2);"string"==typeof i&&(i={order:0,injection:i}),t[r][n]=i}return t}(l),r&&(this.uniforms=function(e){const t={};for(const n in e){const i=xp(e[n]);t[n]=i}return t}(r))}getModuleSource(e){let t;switch(e){case"vs":t=this.vs||"";break;case"fs":t=this.fs||"";break;default:np(!1)}return`#define MODULE_${this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_")}\n${t}// END MODULE_${this.name}\n\n`}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,t){this.deprecations.forEach((n=>{n.regex.test(e)&&(n.deprecated?t.deprecated(n.old,n.new)():t.removed(n.old,n.new)())}))}_parseDeprecationDefinitions(e){return e.forEach((e=>{if("function"===e.type)e.regex=new RegExp(`\\b${e.old}\\(`);else e.regex=new RegExp(`${e.type} ${e.old};`)})),e}_defaultGetUniforms(e={}){const t={},n=this.uniforms;for(const i in n){const r=n[i];i in e&&!r.private?(r.validate&&np(r.validate(e[i],r),`${this.name}: invalid ${i}`),t[i]=e[i]):t[i]=r.value}return t}}function Ep(e){return Sp(Tp(e))}function Sp(e){const t={},n={};return Cp({modules:e,level:0,moduleMap:t,moduleDepth:n}),Object.keys(n).sort(((e,t)=>n[t]-n[e])).map((e=>t[e]))}function Cp({modules:e,level:t,moduleMap:n,moduleDepth:i}){if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const r of e)n[r.name]=r,(void 0===i[r.name]||i[r.name]<t)&&(i[r.name]=t);for(const r of e)r.dependencies&&Cp({modules:r.dependencies,level:t+1,moduleMap:n,moduleDepth:i})}function Tp(e,t){return e.map((e=>(e instanceof ShaderModule||(np("string"!=typeof e,`Shader module use by name is deprecated. Import shader module '${e}' and use it directly.`),np(e.name,"shader module has no name"),(e=new ShaderModule(e)).dependencies=Tp(e.dependencies)),e)))}const Ap={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},kp={};Object.keys(Ap).forEach((e=>{kp[e]=e}));const Np={};function Mp(e,t,n={}){const i=Ap[t];if(np(i,t),!function(e={}){const t="undefined"!=typeof window&&window.navigator||{},n=e.userAgent||t.userAgent||"",i=-1!==n.indexOf("MSIE "),r=-1!==n.indexOf("Trident/");return i||r}(n))return!0;if(t in Np)return Np[t];const r=`#extension GL_${i[0]} : ${n.behavior||"enable"}\nvoid main(void) {}`,s=e.createShader(35633);e.shaderSource(s,r),e.compileShader(s);const o=e.getShaderParameter(s,35713);return e.deleteShader(s),Np[t]=o,o}function Pp(e,t){const n=Ap[t];np(n,t);const i=function(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&2===e._version)}(e)&&n[1]||n[0],r="string"==typeof i?Boolean(e.getExtension(i)):i;return np(!1===r||!0===r),r}function Lp(e,t){return(t=Array.isArray(t)?t:[t]).every((t=>Pp(e,t)))}function Op(e){return new RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}const Rp=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],Ip=[...Rp,[Op("attribute"),"in $1"],[Op("varying"),"out $1"]],Dp=[...Rp,[Op("varying"),"in $1"]],Fp=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],Bp=[...Fp,[Op("in"),"attribute $1"],[Op("out"),"varying $1"]],zp=[...Fp,[Op("in"),"varying $1"]],jp="gl_FragColor",Vp=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,Up=/void\s+main\s*\([^)]*\)\s*\{\n?/;function Hp(e,t,n){switch(t){case 300:return n?$p(e,Ip):function(e){const t=(e=$p(e,Dp)).match(Vp);if(t){const n=t[1];e=e.replace(new RegExp("\\bgl_FragColor\\b","g"),n)}else{const t="fragmentColor";e=e.replace(Up,(e=>`out vec4 ${t};\n${e}`)).replace(new RegExp("\\bgl_FragColor\\b","g"),t)}return e}(e);case 100:return n?$p(e,Bp):function(e){const t=(e=$p(e,zp)).match(Vp);if(t){const n=t[1];e=e.replace(Vp,"").replace(new RegExp(`\\b${n}\\b`,"g"),jp)}return e}(e);default:throw new Error(`unknown GLSL version ${t}`)}}function $p(e,t){for(const[n,i]of t)e=e.replace(n,i);return e}const qp={[lp]:"vertex",[cp]:"fragment"};function Wp(e,{id:t,source:n,type:i,modules:r,defines:s={},hookFunctions:o=[],inject:a={},transpileToGLSL100:l=!1,prologue:c=!0,log:u}){np("string"==typeof n,"shader source must be a string");const d=i===lp,h=n.split("\n");let p=100,f="",m=n;0===h[0].indexOf("#version ")?(p=300,f=h[0],m=h.slice(1).join("\n")):f=`#version ${p}`;const g={};r.forEach((e=>{Object.assign(g,e.getDefines())})),Object.assign(g,s);let y=c?`${f}\n${function({id:e,source:t,type:n}){return e&&"string"==typeof e&&-1===t.indexOf("SHADER_NAME")?`\n#define SHADER_NAME ${e}_${qp[n]}\n\n`:""}({id:t,source:n,type:i})}\n${function({type:e}){return`\n#define SHADER_TYPE_${qp[e].toUpperCase()}\n`}({type:i})}\n${function(e){const t=function(e){const t=e.getExtension("WEBGL_debug_renderer_info"),n=e.getParameter(t&&t.UNMASKED_VENDOR_WEBGL||7936),i=e.getParameter(t&&t.UNMASKED_RENDERER_WEBGL||7937),r=function(e,t){return e.match(/NVIDIA/i)||t.match(/NVIDIA/i)?"NVIDIA":e.match(/INTEL/i)||t.match(/INTEL/i)?"INTEL":e.match(/AMD/i)||t.match(/AMD/i)||e.match(/ATI/i)||t.match(/ATI/i)?"AMD":"UNKNOWN GPU"}(n,i);return{gpuVendor:r,vendor:n,renderer:i,version:e.getParameter(7938),shadingLanguageVersion:e.getParameter(35724)}}(e);switch(t.gpuVendor.toLowerCase()){case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}(e)}\n${function(e,t,n){let i="#if (__VERSION__ > 120)\n\n# define FEATURE_GLSL_DERIVATIVES\n# define FEATURE_GLSL_DRAW_BUFFERS\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FEATURE_GLSL_TEXTURE_LOD\n\n// DEPRECATED FLAGS, remove in v9\n# define FRAG_DEPTH\n# define DERIVATIVES\n# define DRAW_BUFFERS\n# define TEXTURE_LOD\n\n#endif // __VERSION\n";return Lp(e,kp.GLSL_FRAG_DEPTH)&&(i+="\n// FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"),Lp(e,kp.GLSL_DERIVATIVES)&&Mp(e,kp.GLSL_DERIVATIVES)&&(i+="\n// DERIVATIVES => dxdF, dxdY and fwidth are available\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n# define FEATURE_GLSL_DERIVATIVES\n# define DERIVATIVES\n#endif\n"),Lp(e,kp.GLSL_FRAG_DATA)&&Mp(e,kp.GLSL_FRAG_DATA,{behavior:"require"})&&(i+="\n// DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers : require\n#define FEATURE_GLSL_DRAW_BUFFERS\n#define DRAW_BUFFERS\n#endif\n"),Lp(e,kp.GLSL_TEXTURE_LOD)&&(i+="// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod : enable\n\n# define FEATURE_GLSL_TEXTURE_LOD\n# define TEXTURE_LOD\n\n#endif\n"),i}(e)}\n${function(e={}){let t=0,n="";for(const i in e){0===t&&(n+="\n// APPLICATION DEFINES\n"),t++;const r=e[i];(r||Number.isFinite(r))&&(n+=`#define ${i.toUpperCase()} ${e[i]}\n`)}0===t&&(n+="\n");return n}(g)}\n${d?"":"precision highp float;\n\n"}\n`:`${f}\n`;const v=function(e){const t={vs:{},fs:{}};return e.forEach((e=>{let n;"string"!=typeof e?(n=e,e=n.hook):n={},e=e.trim();const[i,r]=e.split(":"),s=e.replace(/\(.+/,"");t[i][s]=Object.assign(n,{signature:r})})),t}(o),b={},w={},x={};for(const e in a){const t="string"==typeof a[e]?{injection:a[e],order:0}:a[e],n=e.match(/^(v|f)s:(#)?([\w-]+)$/);if(n){const i=n[2],r=n[3];i?"decl"===r?w[e]=[t]:x[e]=[t]:b[e]=[t]}else x[e]=[t]}for(const e of r){u&&e.checkDeprecations(m,u);y+=e.getModuleSource(i,p);const t=e.injections[i];for(const e in t){const n=e.match(/^(v|f)s:#([\w-]+)$/);if(n){const i="decl"===n[2]?w:x;i[e]=i[e]||[],i[e].push(t[e])}else b[e]=b[e]||[],b[e].push(t[e])}}return y+="\n\n__LUMA_INJECT_DECLARATIONS__\n\n",y=mp(y,i,w),y+=function(e,t){let n="";for(const i in e){const r=e[i];if(n+=`void ${r.signature} {\n`,r.header&&(n+=`  ${r.header}`),t[i]){const e=t[i];e.sort(((e,t)=>e.order-t.order));for(const t of e)n+=`  ${t.injection}\n`}r.footer&&(n+=`  ${r.footer}`),n+="}\n"}return n}(v[i],b),y+=m,y=mp(y,i,x),y=Hp(y,l?100:p,d),y}function Gp(e){return function(t){const n={};for(const i of e){const e=i.getUniforms(t,n);Object.assign(n,e)}return n}}const Yp={5126:cf.bind(null,"uniform1fv",ef,1,uf),35664:cf.bind(null,"uniform2fv",ef,2,uf),35665:cf.bind(null,"uniform3fv",ef,3,uf),35666:cf.bind(null,"uniform4fv",ef,4,uf),5124:cf.bind(null,"uniform1iv",tf,1,uf),35667:cf.bind(null,"uniform2iv",tf,2,uf),35668:cf.bind(null,"uniform3iv",tf,3,uf),35669:cf.bind(null,"uniform4iv",tf,4,uf),35670:cf.bind(null,"uniform1iv",tf,1,uf),35671:cf.bind(null,"uniform2iv",tf,2,uf),35672:cf.bind(null,"uniform3iv",tf,3,uf),35673:cf.bind(null,"uniform4iv",tf,4,uf),35674:cf.bind(null,"uniformMatrix2fv",ef,4,df),35675:cf.bind(null,"uniformMatrix3fv",ef,9,df),35676:cf.bind(null,"uniformMatrix4fv",ef,16,df),35678:lf,35680:lf,5125:cf.bind(null,"uniform1uiv",nf,1,uf),36294:cf.bind(null,"uniform2uiv",nf,2,uf),36295:cf.bind(null,"uniform3uiv",nf,3,uf),36296:cf.bind(null,"uniform4uiv",nf,4,uf),35685:cf.bind(null,"uniformMatrix2x3fv",ef,6,df),35686:cf.bind(null,"uniformMatrix2x4fv",ef,8,df),35687:cf.bind(null,"uniformMatrix3x2fv",ef,6,df),35688:cf.bind(null,"uniformMatrix3x4fv",ef,12,df),35689:cf.bind(null,"uniformMatrix4x2fv",ef,8,df),35690:cf.bind(null,"uniformMatrix4x3fv",ef,12,df),35678:lf,35680:lf,35679:lf,35682:lf,36289:lf,36292:lf,36293:lf,36298:lf,36299:lf,36300:lf,36303:lf,36306:lf,36307:lf,36308:lf,36311:lf},Xp={},Kp={},Zp={},Jp=[0];function Qp(e,t,n,i){1===t&&"boolean"==typeof e&&(e=e?1:0),Number.isFinite(e)&&(Jp[0]=e,e=Jp);const r=e.length;if(r%t&&gu.warn(`Uniform size should be multiples of ${t}`,e)(),e instanceof n)return e;let s=i[r];s||(s=new n(r),i[r]=s);for(let t=0;t<r;t++)s[t]=e[t];return s}function ef(e,t){return Qp(e,t,Float32Array,Xp)}function tf(e,t){return Qp(e,t,Int32Array,Kp)}function nf(e,t){return Qp(e,t,Uint32Array,Zp)}function rf(e,t,n){const i=Yp[n.type];if(!i)throw new Error(`Unknown GLSL uniform type ${n.type}`);return i().bind(null,e,t)}function sf(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};const t=e.match(/([^[]*)(\[[0-9]+\])?/);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:t[1],length:t[2]||1,isArray:Boolean(t[2])}}function of(e){return Array.isArray(e)||ArrayBuffer.isView(e)?function(e){if(0===e.length)return!1;const t=Math.min(e.length,16);for(let n=0;n<t;++n)if(!Number.isFinite(e[n]))return!1;return!0}(e):!!isFinite(e)||(!0===e||!1===e||(e instanceof Texture||(e instanceof Renderbuffer||e instanceof Framebuffer&&Boolean(e.texture))))}function af(e,t,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(e[t]){const i=e[t];for(let e=0,t=n.length;e<t;++e)i[e]=n[e]}else e[t]=n.slice();else e[t]=n}function lf(){let e=null;return(t,n,i)=>{const r=e!==i;return r&&(t.uniform1i(n,i),e=i),r}}function cf(e,t,n,i){let r=null,s=null;return(o,a,l)=>{const c=t(l,n),u=c.length;let d=!1;if(null===r)r=new Float32Array(u),s=u,d=!0;else{fd(s===u,"Uniform length cannot change.");for(let e=0;e<u;++e)if(c[e]!==r[e]){d=!0;break}}return d&&(i(o,e,a,c),r.set(c)),d}}function uf(e,t,n,i){e[t](n,i)}function df(e,t,n,i){e[t](n,!1,i)}function hf(e,t="unnamed"){const n=e.match(/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/);return n?n[1]:t}function pf(e,t,n,i){const r=e.split(/\r?\n/),s={},o={},a=i||hf(t)||"(unnamed)",l=`${function(e){switch(e){case 35632:return"fragment";case 35633:return"vertex";default:return"unknown type"}}(n)} shader ${a}`;for(let t=0;t<r.length;t++){const n=r[t];if(n.length<=1)continue;const i=n.split(":"),a=i[0],c=parseInt(i[2],10);if(isNaN(c))throw new Error(`GLSL compilation error in ${l}: ${e}`);"WARNING"!==a?s[c]=n:o[c]=n}const c=function(e,t=1,n=": "){const i=e.split(/\r?\n/),r=String(i.length+t-1).length;return i.map(((e,i)=>{const s=String(i+t),o=s.length;return mf(s,r-o)+n+e}))}(t);return{shaderName:l,errors:ff(s,c),warnings:ff(o,c)}}function ff(e,t){let n="";for(let i=0;i<t.length;i++){const r=t[i];if((e[i+3]||e[i+2]||e[i+1])&&(n+=`${r}\n`,e[i+1])){const t=e[i+1],r=t.split(":",3),s=r[0],o=parseInt(r[1],10)||0;n+=mf(`^^^ ${s}: ${t.substring(r.join(":").length+1).trim()}\n\n`,o)}}return n}function mf(e,t){let n="";for(let e=0;e<t;++e)n+=" ";return`${n}${e}`}class Shader extends Resource{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return fd(!1),"unknown"}}constructor(e,t){xu(e),fd("string"==typeof t.source,"Shader: GLSL source code must be a JavaScript string");super(e,{id:hf(t.source,null)||t.id||vd(`unnamed ${Shader.getTypeName(t.shaderType)}`)}),this.shaderType=t.shaderType,this.source=t.source,this.initialize(t)}initialize({source:e}){const t=hf(e,null);t&&(this.id=vd(t)),this._compile(e)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return`${Shader.getTypeName(this.shaderType)}:${this.id}`}getName(){return hf(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(e=this.source){e.startsWith("#version ")||(e=`#version 100\n${e}`),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle);if(!this.getParameter(35713)){const e=this.gl.getShaderInfoLog(this.handle),{shaderName:t,errors:n,warnings:i}=pf(e,this.source,this.shaderType,this.id);throw gu.error(`GLSL compilation errors in ${t}\n${n}`)(),gu.warn(`GLSL compilation warnings in ${t}\n${i}`)(),new Error(`GLSL compilation errors in ${t}`)}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class VertexShader extends Shader{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,t){"string"==typeof t&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class FragmentShader extends Shader{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,t){"string"==typeof t&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const gf=5126,yf=5124,vf=5125,bf={[gf]:[gf,1,"float"],35664:[gf,2,"vec2"],35665:[gf,3,"vec3"],35666:[gf,4,"vec4"],[yf]:[yf,1,"int"],35667:[yf,2,"ivec2"],35668:[yf,3,"ivec3"],35669:[yf,4,"ivec4"],[vf]:[vf,1,"uint"],36294:[vf,2,"uvec2"],36295:[vf,3,"uvec3"],36296:[vf,4,"uvec4"],35670:[gf,1,"bool"],35671:[gf,2,"bvec2"],35672:[gf,3,"bvec3"],35673:[gf,4,"bvec4"],35674:[gf,8,"mat2"],35685:[gf,8,"mat2x3"],35686:[gf,8,"mat2x4"],35675:[gf,12,"mat3"],35687:[gf,12,"mat3x2"],35688:[gf,12,"mat3x4"],35676:[gf,16,"mat4"],35689:[gf,16,"mat4x2"],35690:[gf,16,"mat4x3"]};function wf(e){switch(e){case 0:return 0;case 1:case 3:case 2:return 1;case 4:case 5:case 6:return 4;default:return fd(!1),0}}function xf(e){const t=bf[e];if(!t)return null;const[n,i]=t;return{type:n,components:i}}function _f(e,t){switch(e){case 5120:case 5121:case 5122:case 5123:e=gf}for(const n in bf){const[i,r,s]=bf[n];if(i===e&&r===t)return{glType:n,name:s}}return null}class ProgramConfiguration{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const t=Number(e);return Number.isFinite(t)?this.attributeInfosByLocation[t]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const t=this.getAttributeInfo(e);return t?t.location:-1}getAttributeAccessor(e){const t=this.getAttributeInfo(e);return t?t.accessor:null}getVaryingInfo(e){const t=Number(e);return Number.isFinite(t)?this.varyingInfos[t]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const t=this.getVaryingInfo();return t?t.location:-1}getVaryingAccessor(e){const t=this.getVaryingInfo();return t?t.accessor:null}_readAttributesFromProgram(e){const{gl:t}=e,n=t.getProgramParameter(e.handle,35721);for(let i=0;i<n;i++){const{name:n,type:r,size:s}=t.getActiveAttrib(e.handle,i),o=t.getAttribLocation(e.handle,n);o>=0&&this._addAttribute(o,n,r,s)}this.attributeInfos.sort(((e,t)=>e.location-t.location))}_readVaryingsFromProgram(e){const{gl:t}=e;if(!wu(t))return;const n=t.getProgramParameter(e.handle,35971);for(let i=0;i<n;i++){const{name:n,type:r,size:s}=t.getTransformFeedbackVarying(e.handle,i);this._addVarying(i,n,r,s)}this.varyingInfos.sort(((e,t)=>e.location-t.location))}_addAttribute(e,t,n,i){const{type:r,components:s}=xf(n),o={type:r,size:i*s};this._inferProperties(e,t,o);const a={location:e,name:t,accessor:new Accessor(o)};this.attributeInfos.push(a),this.attributeInfosByLocation[e]=a,this.attributeInfosByName[a.name]=a}_inferProperties(e,t,n){/instance/i.test(t)&&(n.divisor=1)}_addVarying(e,t,n,i){const{type:r,components:s}=xf(n),o={location:e,name:t,accessor:new Accessor({type:r,size:i*s})};this.varyingInfos.push(o),this.varyingInfosByName[o.name]=o}}const Ef=35981,Sf=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class Program extends Resource{get[Symbol.toStringTag](){return"Program"}constructor(e,t={}){super(e,t),this.stubRemovedMethods("Program","v6.0",Sf),this._isCached=!1,this.initialize(t),Object.seal(this),this._setId(t.id)}initialize(e={}){const{hash:t,vs:n,fs:i,varyings:r,bufferMode:s=Ef}=e;return this.hash=t||"",this.vs="string"==typeof n?new VertexShader(this.gl,{id:`${e.id}-vs`,source:n}):n,this.fs="string"==typeof i?new FragmentShader(this.gl,{id:`${e.id}-fs`,source:i}):i,fd(this.vs instanceof VertexShader),fd(this.fs instanceof FragmentShader),this.uniforms={},this._textureUniforms={},r&&r.length>0&&(_u(this.gl),this.varyings=r,this.gl2.transformFeedbackVaryings(this.handle,r,s)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new ProgramConfiguration(this),this.setProps(e)}delete(e={}){return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw({logPriority:e,drawMode:t=4,vertexCount:n,offset:i=0,start:r,end:s,isIndexed:o=!1,indexType:a=5123,instanceCount:l=0,isInstanced:c=l>0,vertexArray:u=null,transformFeedback:d,framebuffer:h,parameters:p={},uniforms:f,samplers:m}){if((f||m)&&(gu.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(f||{})),gu.priority>=e){const i=h?h.id:"default",r=`mode=${gd(this.gl,t)} verts=${n} instances=${l} indexType=${gd(this.gl,a)} isInstanced=${c} isIndexed=${o} Framebuffer=${i}`;gu.log(e,r)()}return fd(u),this.gl.useProgram(this.handle),!(!this._areTexturesRenderable()||0===n||c&&0===l)&&(u.bindForDraw(n,l,(()=>{if(void 0!==h&&(p=Object.assign({},p,{framebuffer:h})),d){const e=wf(t);d.begin(e)}this._bindTextures(),ed(this.gl,p,(()=>{o&&c?this.gl2.drawElementsInstanced(t,n,a,i,l):o&&wu(this.gl)&&!isNaN(r)&&!isNaN(s)?this.gl2.drawRangeElements(t,r,s,n,a,i):o?this.gl.drawElements(t,n,a,i):c?this.gl2.drawArraysInstanced(t,i,n,l):this.gl.drawArrays(t,i,n)})),d&&d.end()})),!0)}setUniforms(e={}){gu.priority>=2&&function(e,t,n){for(const i in e){const r=e[i];if((!n||Boolean(n[i]))&&!of(r))throw t=t?`${t} `:"",console.error(`${t} Bad uniform ${i}`,r),new Error(`${t} Bad uniform ${i}`)}}(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const t in e){const n=e[t],i=this._uniformSetters[t];if(i){let e=n,r=!1;if(e instanceof Framebuffer&&(e=e.texture),e instanceof Texture)if(r=this.uniforms[t]!==n,r){void 0===i.textureIndex&&(i.textureIndex=this._textureIndexCounter++);const n=e,{textureIndex:r}=i;n.bind(r),e=r,this._textureUniforms[t]=n}else e=i.textureIndex;else this._textureUniforms[t]&&delete this._textureUniforms[t];(i(e)||r)&&af(this.uniforms,t,n)}}return this}_areTexturesRenderable(){let e=!0;for(const t in this._textureUniforms){const n=this._textureUniforms[t];n.update(),e=e&&n.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const t=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(t)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const t=this.gl.getAttachedShaders(e),n={};for(const e of t){switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:n.vs=new VertexShader({handle:e});break;case 35632:n.fs=new FragmentShader({handle:e})}}return n}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const e=this._getName();this.id=vd(e)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?`${e}-program`:"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),gu.time(4,`linkProgram for ${this._getName()}`)(),e.linkProgram(this.handle),gu.timeEnd(4,`linkProgram for ${this._getName()}`)(),e.debug||gu.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error(`Error linking: ${e.getProgramInfoLog(this.handle)}`);e.validateProgram(this.handle);if(!e.getProgramParameter(this.handle,35715))throw new Error(`Error validating: ${e.getProgramInfoLog(this.handle)}`)}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let t=0;t<this._uniformCount;t++){const n=this.gl.getActiveUniform(this.handle,t),{name:i}=sf(n.name);let r=e.getUniformLocation(this.handle,i);if(this._uniformSetters[i]=rf(e,r,n),n.size>1)for(let t=0;t<n.size;t++)r=e.getUniformLocation(this.handle,`${i}[${t}]`),this._uniformSetters[`${i}[${t}]`]=rf(e,r,n)}this._textureIndexCounter=0}getActiveUniforms(e,t){return this.gl2.getActiveUniforms(this.handle,e,t)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,t){return this.gl2.getActiveUniformBlockParameter(this.handle,e,t)}uniformBlockBinding(e,t){this.gl2.uniformBlockBinding(this.handle,e,t)}}class ProgramManager{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new ProgramManager(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find((t=>t.name===e.name))||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter((e=>e.name!==t)),this.stateHash++}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(e={}){const{vs:t="",fs:n="",defines:i={},inject:r={},varyings:s=[],bufferMode:o=35981,transpileToGLSL100:a=!1}=e,l=this._getModuleList(e.modules),c=this._getHash(t),u=this._getHash(n),d=l.map((e=>this._getHash(e.name))).sort(),h=s.map((e=>this._getHash(e))),p=Object.keys(i).sort(),f=Object.keys(r).sort(),m=[],g=[];for(const e of p)m.push(this._getHash(e)),m.push(this._getHash(i[e]));for(const e of f)g.push(this._getHash(e)),g.push(this._getHash(r[e]));const y=`${c}/${u}D${m.join("/")}M${d.join("/")}I${g.join("/")}V${h.join("/")}H${this.stateHash}B${o}${a?"T":""}`;if(!this._programCache[y]){const e=function(e,t){const{vs:n,fs:i}=t,r=Ep(t.modules||[]);return{gl:e,vs:Wp(e,Object.assign({},t,{source:n,type:lp,modules:r})),fs:Wp(e,Object.assign({},t,{source:i,type:cp,modules:r})),getUniforms:Gp(r)}}(this.gl,{vs:t,fs:n,modules:l,inject:r,defines:i,hookFunctions:this._hookFunctions,transpileToGLSL100:a});this._programCache[y]=new Program(this.gl,{hash:y,vs:e.vs,fs:e.fs,varyings:s,bufferMode:o}),this._getUniforms[y]=e.getUniforms||(e=>{}),this._useCounts[y]=0}return this._useCounts[y]++,this._programCache[y]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const t=e.hash;this._useCounts[t]--,0===this._useCounts[t]&&(this._programCache[t].delete(),delete this._programCache[t],delete this._getUniforms[t],delete this._useCounts[t])}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),n={};let i=0;for(let e=0,r=this._defaultModules.length;e<r;++e){const r=this._defaultModules[e],s=r.name;t[i++]=r,n[s]=!0}for(let r=0,s=e.length;r<s;++r){const s=e[r],o=s.name;n[o]||(t[i++]=s,n[o]=!0)}return t.length=i,t}}let Cf=null;function Tf(e,t){const n=function(e){return(!Cf||Cf.byteLength<e)&&(Cf=new ArrayBuffer(e)),Cf}(e.BYTES_PER_ELEMENT*t);return new e(n,0,t)}const Af=globalThis;function kf(e){if(!e&&!qc())return"Node";if($c(e))return"Electron";const t="undefined"!=typeof navigator?navigator:{},n=e||t.userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const i=-1!==n.indexOf("MSIE "),r=-1!==n.indexOf("Trident/");return i||r?"IE":Af.chrome?"Chrome":Af.safari?"Safari":Af.mozInnerScreenX?"Firefox":"Unknown"}class VertexArrayObject extends Resource{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e,t={}){return!t.constantAttributeZero||(wu(e)||"Chrome"===kf())}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new VertexArrayObject(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return VertexArrayObject.MAX_ATTRIBUTES=VertexArrayObject.MAX_ATTRIBUTES||e.getParameter(34921),VertexArrayObject.MAX_ATTRIBUTES}static setConstant(e,t,n){switch(n.constructor){case Float32Array:VertexArrayObject._setConstantFloatArray(e,t,n);break;case Int32Array:VertexArrayObject._setConstantIntArray(e,t,n);break;case Uint32Array:VertexArrayObject._setConstantUintArray(e,t,n);break;default:fd(!1)}}constructor(e,t={}){const n=t.id||t.program&&t.program.id;super(e,Object.assign({},t,{id:n})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=t.isDefaultArray||!1,this.gl2=e,this.initialize(t),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return VertexArrayObject.getMaxAttributes(this.gl)}initialize(e={}){return this.setProps(e)}setProps(e){return this}setElementBuffer(e=null,t={}){return fd(!e||34963===e.target,"elements must be GL.ELEMENT_ARRAY_BUFFER"),this.bind((()=>{this.gl.bindBuffer(34963,e?e.handle:null)})),this}setBuffer(e,t,n){if(34963===t.target)return this.setElementBuffer(t,n);const{size:i,type:r,stride:s,offset:o,normalized:a,integer:l,divisor:c}=n,{gl:u,gl2:d}=this;return e=Number(e),this.bind((()=>{u.bindBuffer(34962,t.handle),l?(fd(wu(u)),d.vertexAttribIPointer(e,i,r,s,o)):u.vertexAttribPointer(e,i,r,a,s,o),u.enableVertexAttribArray(e),d.vertexAttribDivisor(e,c||0)})),this}enable(e,t=!0){return!t&&0===e&&!VertexArrayObject.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind((()=>t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e)))),this}getConstantBuffer(e,t){const n=this._normalizeConstantArrayValue(t),i=n.byteLength*e,r=n.length*e;let s=!this.buffer;if(this.buffer=this.buffer||new buffer_Buffer(this.gl,i),s=s||this.buffer.reallocate(i),s=s||!this._compareConstantArrayValues(n,this.bufferValue),s){const e=Tf(t.constructor,r);!function({target:e,source:t,start:n=0,count:i=1}){const r=t.length,s=i*r;let o=0;for(let i=n;o<r;o++)e[i++]=t[o];for(;o<s;)o<s-o?(e.copyWithin(n+o,n,n+o),o*=2):(e.copyWithin(n+o,n,n+s-o),o=s)}({target:e,source:n,start:0,count:r}),this.buffer.subData(e),this.bufferValue=t}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}static _setConstantFloatArray(e,t,n){switch(n.length){case 1:e.vertexAttrib1fv(t,n);break;case 2:e.vertexAttrib2fv(t,n);break;case 3:e.vertexAttrib3fv(t,n);break;case 4:e.vertexAttrib4fv(t,n);break;default:fd(!1)}}static _setConstantIntArray(e,t,n){switch(fd(wu(e)),n.length){case 1:e.vertexAttribI1iv(t,n);break;case 2:e.vertexAttribI2iv(t,n);break;case 3:e.vertexAttribI3iv(t,n);break;case 4:e.vertexAttribI4iv(t,n);break;default:fd(!1)}}static _setConstantUintArray(e,t,n){switch(fd(wu(e)),n.length){case 1:e.vertexAttribI1uiv(t,n);break;case 2:e.vertexAttribI2uiv(t,n);break;case 3:e.vertexAttribI3uiv(t,n);break;case 4:e.vertexAttribI4uiv(t,n);break;default:fd(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,{location:t}){return fd(Number.isFinite(t)),this.bind((()=>34373===e?this.gl.getVertexAttribOffset(t,e):this.gl.getVertexAttrib(t,e)))}}const Nf=/^(.+)__LOCATION_([0-9]+)$/,Mf=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class VertexArray{constructor(e,t={}){const n=t.id||t.program&&t.program.id;this.id=n,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new VertexArrayObject(e),xd(this,"VertexArray","v6.0",Mf),this.initialize(t),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(e={}){return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind((()=>{for(const t in e){const n=e[t];this._setAttribute(t,n)}this.gl.bindBuffer(34962,null)})),this}setElementBuffer(e=null,t={}){return this.elements=e,this.elementsAccessor=t,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,t),this}setBuffer(e,t,n={}){if(34963===t.target)return this.setElementBuffer(t,n);const{location:i,accessor:r}=this._resolveLocationAndAccessor(e,t,t.accessor,n);return i>=0&&(this.values[i]=t,this.accessors[i]=r,this.clearDrawParams(),this.vertexArrayObject.setBuffer(i,t,r)),this}setConstant(e,t,n={}){const{location:i,accessor:r}=this._resolveLocationAndAccessor(e,t,Object.assign({size:t.length},n));return i>=0&&(t=this.vertexArrayObject._normalizeConstantArrayValue(t),this.values[i]=t,this.accessors[i]=r,this.clearDrawParams(),this.vertexArrayObject.enable(i,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind((()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new buffer_Buffer(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof buffer_Buffer&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))})),this}bindBuffers(){return this.vertexArrayObject.bind((()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const t=this.values[e];t instanceof buffer_Buffer&&this.setBuffer(e,t)}})),this}bindForDraw(e,t,n){let i;return this.vertexArrayObject.bind((()=>{this._setConstantAttributes(e,t),i=n()})),i}_resolveLocationAndAccessor(e,t,n,i){const r={location:-1,accessor:null},{location:s,name:o}=this._getAttributeIndex(e);if(!Number.isFinite(s)||s<0)return this.unused[e]=t,gu.once(3,(()=>`unused value ${e} in ${this.id}`))(),r;const a=this._getAttributeInfo(o||s);if(!a)return r;const l=this.accessors[s]||{},c=Accessor.resolve(a.accessor,l,n,i),{size:u,type:d}=c;return fd(Number.isFinite(u)&&Number.isFinite(d)),{location:s,accessor:c}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const t=Number(e);if(Number.isFinite(t))return{location:t};const n=Nf.exec(e),i=n?n[1]:e,r=n?Number(n[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(i)+r,name:i}:{location:-1}}_setAttribute(e,t){if(t instanceof buffer_Buffer)this.setBuffer(e,t);else if(Array.isArray(t)&&t.length&&t[0]instanceof buffer_Buffer){const n=t[0],i=t[1];this.setBuffer(e,n,i)}else if(ArrayBuffer.isView(t)||Array.isArray(t)){const n=t;this.setConstant(e,n)}else{if(!(t.buffer instanceof buffer_Buffer))throw new Error("VertexArray: attributes must be Buffers or constants (i.e. typed array)");{const n=t;this.setBuffer(e,n.buffer,n)}}}_setConstantAttributes(e,t){const n=Math.max(0|e,0|t);let i=this.values[0];ArrayBuffer.isView(i)&&this._setConstantAttributeZero(i,n);for(let e=1;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)i=this.values[e],ArrayBuffer.isView(i)&&this._setConstantAttribute(e,i)}_setConstantAttributeZero(e,t){if(VertexArrayObject.isSupported(this.gl,{constantAttributeZero:!0}))return void this._setConstantAttribute(0,e);const n=this.vertexArrayObject.getConstantBuffer(t,e);this.vertexArrayObject.setBuffer(0,n,this.accessors[0])}_setConstantAttribute(e,t){VertexArrayObject.setConstant(this.gl,e,t)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this._updateDrawParamsForLocation(e,t);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,t){const n=this.values[t],i=this.accessors[t];if(!n)return;const{divisor:r}=i,s=r>0;if(e.isInstanced=e.isInstanced||s,n instanceof buffer_Buffer){const t=n;if(s){const n=t.getVertexCount(i);e.instanceCount=Math.min(e.instanceCount,n)}else{const n=t.getVertexCount(i);e.vertexCount=Math.min(e.vertexCount,n)}}}setElements(e=null,t={}){return gu.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,t)}}function Pf(e,t={}){const{isInteger:n=!1}=t;if(Array.isArray(e)||ArrayBuffer.isView(e))return function(e,t){const{maxElts:n=16,size:i=1}=t;let r="[";for(let s=0;s<e.length&&s<n;++s)s>0&&(r+=","+(s%i==0?" ":"")),r+=Pf(e[s],t);return`${r}${e.length>n?"...":"]"}`}(e,t);if(!Number.isFinite(e))return String(e);if(Math.abs(e)<1e-16)return n?"0":"0.";if(n)return e.toFixed(0);if(Math.abs(e)>100&&Math.abs(e)<1e4)return e.toFixed(0);const i=e.toPrecision(2);return i.indexOf(".0")===i.length-2?i.slice(0,-1):i}function Lf(e,t,n,i){const{gl:r}=e;if(!t)return{[i]:"null","Format ":"N/A"};let s,o,a,l="NOT PROVIDED",c=1,u=0,d=0;if(n&&(l=n.type,c=n.size,l=String(l).replace("Array",""),s=-1!==l.indexOf("nt")),t instanceof buffer_Buffer){const e=t,{data:h,changed:p}=e.getDebugData();let f;if(o=p?"*":"",a=h,d=e.byteLength,u=d/h.BYTES_PER_ELEMENT/c,n){f=`${n.divisor>0?"I ":"P "} ${u} (x${c}=${d} bytes ${gd(r,l)})`}else s=!0,f=`${d} bytes`;return{[i]:`${o}${Pf(a,{size:c,isInteger:s})}`,"Format ":f}}return a=t,c=t.length,l=String(t.constructor.name).replace("Array",""),s=-1!==l.indexOf("nt"),{[i]:`${Pf(a,{size:c,isInteger:s})} (constant)`,"Format ":`${c}x${l} (constant)`}}function Of(e,t){const{type:n,size:i}=t,r=_f(n,i);return r?`${e} (${r.name})`:e}function Rf({header:e="Uniforms",program:t,uniforms:n,undefinedOnly:i=!1}){fd(t);const r=".*Matrix",s=t._uniformSetters,o={},a=Object.keys(s).sort();let l=0;for(const t of a)t.match(".*_.*")||t.match(r)||If({table:o,header:e,uniforms:n,uniformName:t,undefinedOnly:i})&&l++;for(const t of a)t.match(r)&&If({table:o,header:e,uniforms:n,uniformName:t,undefinedOnly:i})&&l++;for(const t of a)o[t]||If({table:o,header:e,uniforms:n,uniformName:t,undefinedOnly:i})&&l++;let c=0;const u={};if(!i)for(const t in n){const i=n[t];o[t]||(c++,u[t]={Type:`NOT USED: ${i}`,[e]:Pf(i)})}return{table:o,count:l,unusedTable:u,unusedCount:c}}function If({table:e,header:t,uniforms:n,uniformName:i,undefinedOnly:r}){const s=n[i],o=function(e){return null!=e}(s);return(!r||!o)&&(e[i]={[t]:o?Pf(s):"N/A","Uniform Type":o?s:"NOT PROVIDED"},!0)}function Df(e){const{type:t,size:n}=e.accessor,i=_f(t,n);return i?`${i.name} ${e.name}`:e.name}const Ff={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function Bf(e,t){const{attributeMap:n=Ff}=t||{};return n&&n[e]||e}function zf(e,t){let n;switch(e){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors"}switch(n){case"vectors":t.size=t.size||3;break;case"uvs":t.size=t.size||2}fd(Number.isFinite(t.size),`attribute ${e} needs size`)}const jf=()=>{},Vf={};class Model{constructor(e,t={}){const{id:n=vd("model")}=t;fd(bu(e)),this.id=n,this.gl=e,this.id=t.id||vd("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(t)}initialize(e){this.props={},this.programManager=e.programManager||ProgramManager.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:t=null,vs:n,fs:i,modules:r,defines:s,inject:o,varyings:a,bufferMode:l,transpileToGLSL100:c}=e;this.programProps={program:t,vs:n,fs:i,modules:r,defines:s,inject:o,varyings:a,bufferMode:l,transpileToGLSL100:c},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=void 0!==e.drawMode?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},fd(void 0!==this.drawMode&&Number.isFinite(this.vertexCount),"Model needs drawMode and vertexCount")}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:t,vs:n,fs:i,modules:r,defines:s,inject:o,varyings:a,bufferMode:l,transpileToGLSL100:c}=e;this.programProps={program:t,vs:n,fs:i,modules:r,defines:s,inject:o,varyings:a,bufferMode:l,transpileToGLSL100:c},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return fd(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return fd(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=function(e,t,n){const i={};let r=t.indices;for(const s in t.attributes){const o=t.attributes[s],a=Bf(s,n);if("indices"===s)r=o;else if(o.constant)i[a]=o.value;else{const t=o.value,n={...o};delete n.value,i[a]=[new buffer_Buffer(e,t),n],zf(s,n)}}if(r){const t=r.value||r;fd(t instanceof Uint16Array||t instanceof Uint32Array,'attribute array for "indices" must be of integer type');const n={size:1,isIndexed:void 0===r.isIndexed||r.isIndexed};i.indices=[new buffer_Buffer(e,{data:t,target:34963}),n]}return i}(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(e={}){if(wd(e))return this;const t={};for(const n in e){const i=e[n];t[n]=i.getValue?i.getValue():i}return this.vertexArray.setAttributes(t),this}setUniforms(e={}){return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const t=this.programManager.getUniforms(this.program);return t?t(e):{}}updateModuleSettings(e){const t=this.getModuleUniforms(e||{});return this.setUniforms(t)}clear(e){return Ud(this.program.gl,e),this}draw(e={}){this._checkProgram();const{moduleSettings:t=null,framebuffer:n,uniforms:i={},attributes:r={},transformFeedback:s=this.transformFeedback,parameters:o={},vertexArray:a=this.vertexArray}=e;let l;this.setAttributes(r),this.updateModuleSettings(t),this.setUniforms(i),gu.priority>=2&&(l=this._logDrawCallStart(2));const c=this.vertexArray.getDrawParams(),{isIndexed:u=c.isIndexed,indexType:d=c.indexType,indexOffset:h=c.indexOffset,vertexArrayInstanced:p=c.isInstanced}=this.props;p&&!this.isInstanced&&gu.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:f,instanceCount:m}=this,{onBeforeRender:g=jf,onAfterRender:y=jf}=this.props;g(),this.program.setUniforms(this.uniforms);const v=this.program.draw(Object.assign(Vf,e,{logPriority:l,uniforms:null,framebuffer:n,parameters:o,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:a,transformFeedback:s,isIndexed:u,indexType:d,isInstanced:f,instanceCount:m,offset:u?h:0}));return y(),gu.priority>=2&&this._logDrawCallEnd(l,a,n),v}transform(e={}){const{discard:t=!0,feedbackBuffers:n,unbindModels:i=[]}=e;let{parameters:r}=e;n&&this._setFeedbackBuffers(n),t&&(r=Object.assign({},r,{35977:t})),i.forEach((e=>e.vertexArray.unbindBuffers()));try{this.draw(Object.assign({},e,{parameters:r}))}finally{i.forEach((e=>e.vertexArray.bindBuffers()))}return this}render(e={}){return gu.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:e}=this.programProps;if(e)this._managedProgram=!1;else{const{vs:t,fs:n,modules:i,inject:r,defines:s,varyings:o,bufferMode:a,transpileToGLSL100:l}=this.programProps;e=this.programManager.get({vs:t,fs:n,modules:i,inject:r,defines:s,varyings:o,bufferMode:a,transpileToGLSL100:l}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}fd(e instanceof Program,"Model needs a program"),this._programDirty=!1,e!==this.program&&(this.program=e,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new VertexArray(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const t=this.geometryBuffers[e][0]||this.geometryBuffers[e];t instanceof buffer_Buffer&&t.delete()}}_setAnimationProps(e){this.animated&&fd(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(e={}){if(wd(e))return this;const{gl:t}=this.program;return this.transformFeedback=this.transformFeedback||new TransformFeedback(t,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const t=e>3?0:1e4;if(!(Date.now()-this.lastLogTime<t))return this.lastLogTime=Date.now(),gu.group(2,`>>> DRAWING MODEL ${this.id}`,{collapsed:gu.level<=2})(),e}_logDrawCallEnd(e,t,n,i){if(void 0===e)return;const r=function({vertexArray:e,header:t="Attributes"}){if(!e.configuration)return{};const n={};e.elements&&(n.ELEMENT_ARRAY_BUFFER=Lf(e,e.elements,null,t));const i=e.values;for(const r in i){const s=e._getAttributeInfo(r);if(s){let o=`${r}: ${s.name}`;const a=e.accessors[s.location];a&&(o=`${r}: ${Of(s.name,a)}`),n[o]=Lf(e,i[r],a,t)}}return n}({vertexArray:t,header:`${this.id} attributes`,attributes:this._attributes}),{table:s,unusedTable:o,unusedCount:a}=Rf({header:`${this.id} uniforms`,program:this.program,uniforms:Object.assign({},this.program.uniforms,n)}),{table:l,count:c}=Rf({header:`${this.id} uniforms`,program:this.program,uniforms:Object.assign({},this.program.uniforms,n),undefinedOnly:!0});c>0&&gu.log("MISSING UNIFORMS",Object.keys(l))(),a>0&&gu.log("UNUSED UNIFORMS",Object.keys(o))();const u=function(e){const t={},n=`Accessors for ${e.id}`;for(const i of e.attributeInfos)i&&(t[`in ${Df(i)}`]={[n]:JSON.stringify(i.accessor)});for(const i of e.varyingInfos)i&&(t[`out ${Df(i)}`]={[n]:JSON.stringify(i.accessor)});return t}(this.vertexArray.configuration);gu.table(e,r)(),gu.table(e,s)(),gu.table(e+1,u)(),i&&i.log({logLevel:2,message:`Rendered to ${i.id}`}),gu.groupEnd(2,`>>> DRAWING MODEL ${this.id}`)()}}class transform_Transform{static isSupported(e){return wu(e)}constructor(e,t={}){this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(t),Object.seal(this)}delete(){const{model:e,bufferTransform:t,textureTransform:n}=this;e&&e.delete(),t&&t.delete(),n&&n.delete()}run(e={}){const{clearRenderTarget:t=!0}=e,n=this._updateDrawOptions(e);t&&n.framebuffer&&n.framebuffer.clear({color:!0}),this.model.transform(n)}swap(){let e=!1;const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of t)e=e||n.swap();fd(e,"Nothing to swap")}getBuffer(e=null){return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(e={}){const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of t){const t=n.getData(e);if(t)return t}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(e={}){"elementCount"in e&&this.model.setVertexCount(e.elementCount);const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of t)n.update(e)}_initialize(e={}){const{gl:t}=this;this._buildResourceTransforms(t,e),e=this._updateModelProps(e),this.model=new Model(t,Object.assign({},e,{fs:e.fs||op({version:ap(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let t=Object.assign({},e);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const e of n)t=e.updateModelProps(t);return t}_buildResourceTransforms(e,t){(function(e){if(!wd(e.feedbackBuffers)||!wd(e.feedbackMap)||e.varyings&&e.varyings.length>0)return!0;return!1})(t)&&(this.bufferTransform=new BufferTransform(e,t)),function(e){if(!wd(e._sourceTextures)||e._targetTexture||e._targetTextureVarying)return!0;return!1}(t)&&(this.textureTransform=new TextureTransform(e,t)),fd(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let t=Object.assign({},e);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const e of n)t=Object.assign(t,e.getDrawOptions(t));return t}}function Uf(){}const Hf={onStart:Uf,onUpdate:Uf,onInterrupt:Uf,onEnd:Uf};class transition_Transition{constructor(e){this._inProgress=!1,this._handle=null,this.timeline=e,this.settings={}}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings={...Hf,...e},this._inProgress=!0,this.settings.onStart(this)}end(){this._inProgress&&(this.timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd(this))}cancel(){this._inProgress&&(this.settings.onInterrupt(this),this.timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(null===this._handle){const{timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this.timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate(this),this.timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const $f="\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nuniform float time;\nattribute ATTRIBUTE_TYPE aFrom;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, time);\n  gl_Position = vec4(0.0);\n}\n";const qf={interpolation:class GPUInterpolationTransition{constructor({gl:e,attribute:t,timeline:n}){this.gl=e,this.type="interpolation",this.transition=new transition_Transition(n),this.attribute=t,this.attributeInTransition=new Attribute(e,t.settings),this.currentStartIndices=t.startIndices,this.currentLength=0,this.transform=function(e,t){const n=Kh(t.size);return new transform_Transform(e,{vs:$f,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}(e,t);const i={byteLength:0,usage:35050};this.buffers=[new buffer_Buffer(e,i),new buffer_Buffer(e,i)]}get inProgress(){return this.transition.inProgress}start(e,t){if(e.duration<=0)return void this.transition.cancel();const{gl:n,buffers:i,attribute:r}=this;Zh(i);const s={numInstances:t,attribute:r,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const e of i)Qh({buffer:e,...s});this.currentStartIndices=r.startIndices,this.currentLength=Jh(r,t),this.attributeInTransition.update({buffer:i[1],value:r.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/r.size),sourceBuffers:{aFrom:i[0],aTo:Xh(0,r)},feedbackBuffers:{vCurrent:i[1]}})}update(){const e=this.transition.update();if(e){const{time:e,settings:{duration:t,easing:n}}=this.transition,i=n(e/t);this.transform.run({uniforms:{time:i}})}return e}cancel(){for(this.transition.cancel(),this.transform.delete();this.buffers.length;)this.buffers.pop().delete()}},spring:class GPUSpringTransition{constructor({gl:e,attribute:t,timeline:n}){this.gl=e,this.type="spring",this.transition=new transition_Transition(n),this.attribute=t,this.attributeInTransition=new Attribute(e,{...t.settings,normalized:!1}),this.currentStartIndices=t.startIndices,this.currentLength=0,this.texture=function(e){return new Texture2D(e,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}(e),this.framebuffer=function(e,t){return new Framebuffer(e,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:t}})}(e,this.texture),this.transform=function(e,t,n){const i=Kh(t.size);return new transform_Transform(e,{framebuffer:n,vs:"\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nuniform float stiffness;\nuniform float damping;\nattribute ATTRIBUTE_TYPE aPrev;\nattribute ATTRIBUTE_TYPE aCur;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vNext;\nvarying float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE spring = delta * stiffness;\n  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;\n  return spring + damper + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n",fs:"\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nvarying float vIsTransitioningFlag;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  gl_FragColor = vec4(1.0);\n}",defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}(e,t,this.framebuffer);const i={byteLength:0,usage:35050};this.buffers=[new buffer_Buffer(e,i),new buffer_Buffer(e,i),new buffer_Buffer(e,i)]}get inProgress(){return this.transition.inProgress}start(e,t){const{gl:n,buffers:i,attribute:r}=this,s={numInstances:t,attribute:r,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const e of i)Qh({buffer:e,...s});this.currentStartIndices=r.startIndices,this.currentLength=Jh(r,t),this.attributeInTransition.update({buffer:i[1],value:r.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/r.size),sourceBuffers:{aTo:Xh(0,r)}})}update(){const{buffers:e,transform:t,framebuffer:n,transition:i}=this;if(!i.update())return!1;t.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),t.run({framebuffer:n,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:i.settings.stiffness,damping:i.settings.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),Zh(e),this.attributeInTransition.update({buffer:e[1],value:this.attribute.value});return Wd(n)[0]>0||i.end(),!0}cancel(){for(this.transition.cancel(),this.transform.delete();this.buffers.length;)this.buffers.pop().delete();this.texture.delete(),this.texture=null,this.framebuffer.delete(),this.framebuffer=null}}};class AttributeTransitionManager{constructor(e,{id:t,timeline:n}){this.id=t,this.gl=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=transform_Transform.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:n}){this.numInstances=n||1;for(const n in e){const i=e[n],r=i.getTransitionSetting(t);r&&this._updateAttribute(n,i,r)}for(const n in this.transitions){const i=e[n];i&&i.getTransitionSetting(t)||this._removeTransition(n)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const n=this.transitions[t];n.inProgress&&(e[t]=n.attributeInTransition)}return e}run(){if(!this.isSupported||0===this.numInstances)return!1;for(const e in this.transitions){this.transitions[e].update()&&(this.needsRedraw=!0)}const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,t,n){const i=this.transitions[e];let r=!i||i.type!==n.type;if(r){if(!this.isSupported)return void cu.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();i&&this._removeTransition(e);const s=qf[n.type];s?this.transitions[e]=new s({attribute:t,timeline:this.timeline,gl:this.gl}):(cu.error("unsupported transition type '".concat(n.type,"'"))(),r=!1)}(r||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const Wf="attributeManager.invalidate";class AttributeManager{constructor(e,{id:t="attribute-manager",stats:n,timeline:i}={}){this.id=t,this.gl=e,this.attributes={},this.updateTriggers={},this.accessors={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new AttributeTransitionManager(e,{id:"".concat(t,"-transitions"),timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(e=!0){return this.needsRedraw=!0,this}add(e,t){this._add(e,t)}addInstanced(e,t){this._add(e,t,{instanced:1})}remove(e){for(let t=0;t<e.length;t++){const n=e[t];void 0!==this.attributes[n]&&(this.attributes[n].delete(),delete this.attributes[n])}}invalidate(e,t){const n=this._invalidateTrigger(e,t);tp(Wf,this,e,n)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);tp(Wf,this,"all")}update({data:e,numInstances:t,startIndices:n=null,transitions:i,props:r={},buffers:s={},context:o={}}={}){let a=!1;tp("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const i in this.attributes){const l=this.attributes[i],c=l.settings.accessor;l.startIndices=n,l.numInstances=t,r[i]&&cu.removed("props.".concat(i),"data.attributes.".concat(i))(),l.setExternalBuffer(s[i])||l.setBinaryValue(s[c],e.startIndices)||!s[c]&&l.setConstantValue(r[c])||l.needsUpdate()&&(a=!0,this._updateAttribute({attribute:l,numInstances:t,data:e,props:r,context:o})),this.needsRedraw|=l.needsRedraw()}a&&tp("attributeManager.updateEnd",this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return this.attributes}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const r in t){const s=t[r];s.needsRedraw(e)&&!n.hasAttribute(r)&&(i[r]=s)}return i}getShaderAttributes(e,t={}){e||(e=this.getAttributes());const n={};for(const i in e)t[i]||Object.assign(n,e[i].getShaderAttributes());return n}getAccessors(){return this.updateTriggers}_add(e,t,n={}){t&&cu.warn("AttributeManager.add({updaters}) - updater map no longer supported")();for(const t in e){const i=e[t];this.attributes[t]=this._createAttribute(t,i,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,t,n){const i={...t,id:e,isIndexed:t.isIndexed||t.elements||!1,constant:t.constant||!1,size:(t.elements?1:t.size)||1,value:t.value||null,divisor:t.instanced||n.instanced?1:t.divisor||0};return new Attribute(this.gl,i)}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes){this.attributes[t].getUpdateTriggers().forEach((n=>{e[n]||(e[n]=[]),e[n].push(t)}))}this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:n,updateTriggers:i}=this,r=i[e];return r&&r.forEach((e=>{const i=n[e];i&&i.setNeedsUpdate(i.id,t)})),r}_updateAttribute(e){const{attribute:t,numInstances:n}=e;if(tp("attribute.updateStart",t),t.constant)return void t.setConstantValue(t.value);t.allocate(n)&&tp("attribute.allocate",t,n);t.updateBuffer(e)&&(this.needsRedraw=!0,tp("attribute.updateEnd",t,n))}}const Gf=1e-5;function Yf(e,t,n,i,r){const s=t-e;return(n-t)*r+-s*i+s+t}function Xf(e,t){if(Array.isArray(e)){let n=0;for(let i=0;i<e.length;i++){const r=e[i]-t[i];n+=r*r}return Math.sqrt(n)}return Math.abs(e-t)}const Kf={interpolation:class CPUInterpolationTransition extends transition_Transition{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:n,duration:i,easing:r}}=this,s=r(e/i);this._value=oh(t,n,s)}},spring:class CPUSpringTransition extends transition_Transition{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:n,stiffness:i}=this.settings,{_prevValue:r=e,_currValue:s=e}=this;let o=function(e,t,n,i,r){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=Yf(e[o],t[o],n[o],i,r);return s}return Yf(e,t,n,i,r)}(r,s,t,n,i);const a=Xf(o,t),l=Xf(o,s);a<Gf&&l<Gf&&(o=t,this.end()),this._prevValue=s,this._currValue=o}}};class UniformTransitionManager{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,n,i){const{transitions:r}=this;if(r.has(e)){const n=r.get(e),{value:i=n.settings.fromValue}=n;t=i,this.remove(e)}if(!(i=Yh(i)))return;const s=Kf[i.type];if(!s)return void cu.error("unsupported transition type '".concat(i.type,"'"))();const o=new s(this.timeline);o.start({...i,fromValue:t,toValue:n}),r.set(e,o)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,n]of this.transitions)n.update(),e[t]=n.value,n.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}const Zf="Awaiting state",Jf="Matched. State transferred from previous layer",Qf="Initialized",em="Discarded. Awaiting garbage collection",tm="No longer matched. Awaiting garbage collection",nm="Finalized! Awaiting garbage collection",im=Symbol.for("component"),rm=Symbol.for("asyncPropDefaults"),sm=Symbol.for("asyncPropOriginal"),om=Symbol.for("asyncPropResolved");function am(e,t){const n=cm({newProps:e,oldProps:t,propTypes:pm(e),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=function(e,t){if(null===t)return"oldProps is null, initial diff";let n=null;const{dataComparator:i,_dataDiff:r}=e;i?i(e.data,t.data)||(n="Data comparator detected a change"):e.data!==t.data&&(n="A new data container was supplied");n&&r&&(n=r(e.data,t.data)||n);return n}(e,t);let r=!1;return i||(r=function(e,t){if(null===t)return"oldProps is null, initial diff";if("all"in e.updateTriggers){if(hm(e,t,"all"))return{all:!0}}const n={};let i=!1;for(const r in e.updateTriggers)if("all"!==r){hm(e,t,r)&&(n[r]=!0,i=n)}return i}(e,t)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:dm(e,t),transitionsChanged:lm(e,t)}}function lm(e,t){if(!e.transitions)return null;const n={},i=pm(e);for(const r in e.transitions){const s=i[r],o=s&&s.type;("number"===o||"color"===o||"array"===o)&&um(e[r],t[r],s)&&(n[r]=!0)}return n}function cm({newProps:e,oldProps:t,ignoreProps:n={},propTypes:i={},triggerName:r="props"}){if(t===e)return null;if("object"!=typeof e||null===e)return"".concat(r," changed shallowly");if("object"!=typeof t||null===t)return"".concat(r," changed shallowly");for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return"".concat(r,".").concat(s," added");const n=um(e[s],t[s],i[s]);if(n)return"".concat(r,".").concat(s," ").concat(n)}for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return"".concat(r,".").concat(s," dropped");if(!Object.hasOwnProperty.call(e,s)){const n=um(e[s],t[s],i[s]);if(n)return"".concat(r,".").concat(s," ").concat(n)}}return null}function um(e,t,n){let i=n&&n.equal;return i&&!i(e,t,n)?"changed deeply":i||(i=e&&t&&e.equals,!i||i.call(e,t))?i||t===e?null:"changed shallowly":"changed deeply"}function dm(e,t){if(null===t)return!0;const n=t.extensions,{extensions:i}=e;if(i===n)return!1;if(!n||!i)return!0;if(i.length!==n.length)return!0;for(let e=0;e<i.length;e++)if(!i[e].equals(n[e]))return!0;return!1}function hm(e,t,n){let i=e.updateTriggers[n];i=null==i?{}:i;let r=t.updateTriggers[n];r=null==r?{}:r;return cm({oldProps:r,newProps:i,triggerName:n})}function pm(e){const t=e[im],n=t&&t.constructor;return n?n._propTypes:{}}function fm(e){if(!function(e){return null!==e&&"object"==typeof e}(e))throw new Error("count(): argument not an object");if("function"==typeof e.count)return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(function(e){return null!==e&&"object"==typeof e&&e.constructor===Object}(e))return Object.keys(e).length;throw new Error("count(): argument not a container")}function mm(e,t){if(e===t)return!0;if(Array.isArray(e)){const n=e.length;if(!t||t.length!==n)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}return!1}function gm(e){let t,n={};return i=>{for(const r in i)if(!mm(i[r],n[r])){t=e(i),n=i;break}return t}}function ym(e,t){if(!t)return e;const n={...e,...t};if("defines"in t&&(n.defines={...e.defines,...t.defines}),"modules"in t&&(n.modules=(e.modules||[]).concat(t.modules),t.modules.some((e=>"project64"===e.name)))){const e=n.modules.findIndex((e=>"project32"===e.name));e>=0&&n.modules.splice(e,1)}if("inject"in t)if(e.inject){const i={...e.inject};for(const e in t.inject)i[e]=(i[e]||"")+t.inject[e];n.inject=i}else n.inject=t.inject;return n}function vm(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=t[9],h=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15],v=n*a-i*o,b=n*l-r*o,w=n*c-s*o,x=i*l-r*a,_=i*c-s*a,E=r*c-s*l,S=u*m-d*f,C=u*g-h*f,T=u*y-p*f,A=d*g-h*m,k=d*y-p*m,N=h*y-p*g,M=v*N-b*k+w*A+x*T-_*C+E*S;return M?(M=1/M,e[0]=(a*N-l*k+c*A)*M,e[1]=(r*k-i*N-s*A)*M,e[2]=(m*E-g*_+y*x)*M,e[3]=(h*_-d*E-p*x)*M,e[4]=(l*T-o*N-c*C)*M,e[5]=(n*N-r*T+s*C)*M,e[6]=(g*w-f*E-y*b)*M,e[7]=(u*E-h*w+p*b)*M,e[8]=(o*k-a*T+c*S)*M,e[9]=(i*T-n*k-s*S)*M,e[10]=(f*_-m*w+y*v)*M,e[11]=(d*w-u*_-p*v)*M,e[12]=(a*C-o*A-l*S)*M,e[13]=(n*A-i*C+r*S)*M,e[14]=(m*b-f*x-g*v)*M,e[15]=(u*x-d*b+h*v)*M,e):null}function bm(e,t,n){var i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=t[9],p=t[10],f=t[11],m=t[12],g=t[13],y=t[14],v=t[15],b=n[0],w=n[1],x=n[2],_=n[3];return e[0]=b*i+w*a+x*d+_*m,e[1]=b*r+w*l+x*h+_*g,e[2]=b*s+w*c+x*p+_*y,e[3]=b*o+w*u+x*f+_*v,b=n[4],w=n[5],x=n[6],_=n[7],e[4]=b*i+w*a+x*d+_*m,e[5]=b*r+w*l+x*h+_*g,e[6]=b*s+w*c+x*p+_*y,e[7]=b*o+w*u+x*f+_*v,b=n[8],w=n[9],x=n[10],_=n[11],e[8]=b*i+w*a+x*d+_*m,e[9]=b*r+w*l+x*h+_*g,e[10]=b*s+w*c+x*p+_*y,e[11]=b*o+w*u+x*f+_*v,b=n[12],w=n[13],x=n[14],_=n[15],e[12]=b*i+w*a+x*d+_*m,e[13]=b*r+w*l+x*h+_*g,e[14]=b*s+w*c+x*p+_*y,e[15]=b*o+w*u+x*f+_*v,e}function wm(e,t,n){var i,r,s,o,a,l,c,u,d,h,p,f,m=n[0],g=n[1],y=n[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*y+t[12],e[13]=t[1]*m+t[5]*g+t[9]*y+t[13],e[14]=t[2]*m+t[6]*g+t[10]*y+t[14],e[15]=t[3]*m+t[7]*g+t[11]*y+t[15]):(i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=t[9],p=t[10],f=t[11],e[0]=i,e[1]=r,e[2]=s,e[3]=o,e[4]=a,e[5]=l,e[6]=c,e[7]=u,e[8]=d,e[9]=h,e[10]=p,e[11]=f,e[12]=i*m+a*g+d*y+t[12],e[13]=r*m+l*g+h*y+t[13],e[14]=s*m+c*g+p*y+t[14],e[15]=o*m+u*g+f*y+t[15]),e}function xm(e,t,n){var i=n[0],r=n[1],s=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function _m(e,t,n){var i=Math.sin(n),r=Math.cos(n),s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],d=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*r+c*i,e[5]=o*r+u*i,e[6]=a*r+d*i,e[7]=l*r+h*i,e[8]=c*r-s*i,e[9]=u*r-o*i,e[10]=d*r-a*i,e[11]=h*r-l*i,e}function Em(e,t,n){var i=Math.sin(n),r=Math.cos(n),s=t[0],o=t[1],a=t[2],l=t[3],c=t[4],u=t[5],d=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r+c*i,e[1]=o*r+u*i,e[2]=a*r+d*i,e[3]=l*r+h*i,e[4]=c*r-s*i,e[5]=u*r-o*i,e[6]=d*r-a*i,e[7]=h*r-l*i,e}function Sm(e,t){var n=t[0],i=t[1],r=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.hypot(n,i,r),e[1]=Math.hypot(s,o,a),e[2]=Math.hypot(l,c,u),e}var Cm=function(e,t,n,i,r){var s,o=1/Math.tan(t/2);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(s=1/(i-r),e[10]=(r+i)*s,e[14]=2*r*i*s):(e[10]=-1,e[14]=-2*i),e};var Tm=function(e,t,n,i,r,s,o){var a=1/(t-n),l=1/(i-r),c=1/(s-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*a,e[13]=(r+i)*l,e[14]=(o+s)*c,e[15]=1,e};function Am(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function km(e){var t=e[0],n=e[1],i=e[2],r=e[3];return Math.hypot(t,n,i,r)}function Nm(e){var t=e[0],n=e[1],i=e[2],r=e[3];return t*t+n*n+i*i+r*r}function Mm(e,t,n){var i=t[0],r=t[1],s=t[2],o=t[3];return e[0]=n[0]*i+n[4]*r+n[8]*s+n[12]*o,e[1]=n[1]*i+n[5]*r+n[9]*s+n[13]*o,e[2]=n[2]*i+n[6]*r+n[10]*s+n[14]*o,e[3]=n[3]*i+n[7]*r+n[11]*s+n[15]*o,e}!function(){var e,t=(e=new ph(4),ph!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e)}();const Pm=[0,0,0,0],Lm=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Om=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Rm=[0,0,0],Im=[0,0,0],Dm=gm((function({viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:r,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=function(e,t,n){const{viewMatrixUncentered:i,projectionMatrix:r}=e;let{viewMatrix:s,viewProjectionMatrix:o}=e,a=Pm,l=Pm,c=e.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:d,offsetMode:h}=Fm(e,t,n);h&&(l=e.projectPosition(u||d),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=Mm([],l,o),s=i||s,o=bm([],r,s),o=bm([],o,Lm));return{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:d,geospatialOrigin:u}}(e,n,i),u=e.getDistanceScales(),d=[e.width*t,e.height*t],h=Mm([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,p={project_uCoordinateSystem:n,project_uProjectionMode:e.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:o.slice(0,3),project_uCenter:r,project_uPseudoMeters:Boolean(e._pseudoMeters),project_uViewportSize:d,project_uDevicePixelRatio:t,project_uFocalDistance:h,project_uCommonUnitsPerMeter:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:Rm,project_uScale:e.scale,project_uViewProjectionMatrix:s,project_uCameraPosition:a};if(c){const t=e.getDistanceScales(c);switch(n){case uu.METER_OFFSETS:p.project_uCommonUnitsPerWorldUnit=t.unitsPerMeter,p.project_uCommonUnitsPerWorldUnit2=t.unitsPerMeter2;break;case uu.LNGLAT:case uu.LNGLAT_OFFSETS:e._pseudoMeters||(p.project_uCommonUnitsPerMeter=t.unitsPerMeter),p.project_uCommonUnitsPerWorldUnit=t.unitsPerDegree,p.project_uCommonUnitsPerWorldUnit2=t.unitsPerDegree2;break;case uu.CARTESIAN:p.project_uCommonUnitsPerWorldUnit=[1,1,t.unitsPerMeter[2]],p.project_uCommonUnitsPerWorldUnit2=[0,0,t.unitsPerMeter2[2]]}}return p}));function Fm(e,t,n=Im){n.length<3&&(n=[n[0],n[1],0]);let i,r=n,s=!0;switch(i=t===uu.LNGLAT_OFFSETS||t===uu.METER_OFFSETS?n:e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case du.WEB_MERCATOR:t!==uu.LNGLAT&&t!==uu.CARTESIAN||(i=[0,0,0],s=!1);break;case du.WEB_MERCATOR_AUTO_OFFSET:t===uu.LNGLAT?r=i:t===uu.CARTESIAN&&(r=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],i=e.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case du.IDENTITY:r=e.position.map(Math.fround),r[2]=r[2]||0;break;case du.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}class Matrix extends MathArray{toString(){let e="[";if(nh.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=" ".concat(this[n*this.RANK+t])}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=" ".concat(this[t])}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=ch(n),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let e=0;e<this.RANK;++e)t[e]=this[n+e];return t}setColumn(e,t){const n=e*this.RANK;for(let e=0;e<this.RANK;++e)this[n+e]=t[e];return this}}function Bm(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function zm(e){var t=e[0],n=e[1];return Math.hypot(t,n)}function jm(e,t){return e[0]=-t[0],e[1]=-t[1],e}function Vm(e,t,n,i){var r=t[0],s=t[1];return e[0]=r+i*(n[0]-r),e[1]=s+i*(n[1]-s),e}var Um,Hm=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e};!function(){var e,t=(e=new ph(2),ph!=Float32Array&&(e[0]=0,e[1]=0),e)}();!function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"}(Um||(Um={}));const $m=45*Math.PI/180,qm=1,Wm=.1,Gm=500,Ym=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class matrix4_Matrix4 extends Matrix{static get IDENTITY(){return function(){Km||(Km=new matrix4_Matrix4,Object.freeze(Km));return Km}()}static get ZERO(){return function(){Xm||(Xm=new matrix4_Matrix4([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Xm));return Xm}()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Um}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,n,i,r,s,o,a,l,c,u,d,h,p,f,m){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=r,this[5]=s,this[6]=o,this[7]=a,this[8]=l,this[9]=c,this[10]=u,this[11]=d,this[12]=h,this[13]=p,this[14]=f,this[15]=m,this.check()}setRowMajor(e,t,n,i,r,s,o,a,l,c,u,d,h,p,f,m){return this[0]=e,this[1]=r,this[2]=l,this[3]=h,this[4]=t,this[5]=s,this[6]=c,this[7]=p,this[8]=n,this[9]=o,this[10]=u,this[11]=f,this[12]=i,this[13]=a,this[14]=d,this[15]=m,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(Ym)}fromObject(e){return this.check()}fromQuaternion(e){return function(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],o=n+n,a=i+i,l=r+r,c=n*o,u=i*o,d=i*a,h=r*o,p=r*a,f=r*l,m=s*o,g=s*a,y=s*l;e[0]=1-d-f,e[1]=u+y,e[2]=h-g,e[3]=0,e[4]=u-y,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=h+g,e[9]=p-m,e[10]=1-c-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(this,e),this.check()}frustum(e){const{left:t,right:n,bottom:i,top:r,near:s=Wm,far:o=Gm}=e;return o===1/0?function(e,t,n,i,r,s){const o=2*s/(n-t),a=2*s/(r-i),l=(n+t)/(n-t),c=(r+i)/(r-i),u=-1,d=-1,h=-2*s;e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=l,e[9]=c,e[10]=u,e[11]=d,e[12]=0,e[13]=0,e[14]=h,e[15]=0}(this,t,n,i,r,s):function(e,t,n,i,r,s,o){var a=1/(n-t),l=1/(r-i),c=1/(s-o);e[0]=2*s*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*l,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(r+i)*l,e[10]=(o+s)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*s*2*c,e[15]=0}(this,t,n,i,r,s,o),this.check()}lookAt(e){const{eye:t,center:n=[0,0,0],up:i=[0,1,0]}=e;return function(e,t,n,i){var r,s,o,a,l,c,u,d,h,p,f=t[0],m=t[1],g=t[2],y=i[0],v=i[1],b=i[2],w=n[0],x=n[1],_=n[2];Math.abs(f-w)<hh&&Math.abs(m-x)<hh&&Math.abs(g-_)<hh?function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(e):(u=f-w,d=m-x,h=g-_,r=v*(h*=p=1/Math.hypot(u,d,h))-b*(d*=p),s=b*(u*=p)-y*h,o=y*d-v*u,(p=Math.hypot(r,s,o))?(r*=p=1/p,s*=p,o*=p):(r=0,s=0,o=0),a=d*o-h*s,l=h*r-u*o,c=u*s-d*r,(p=Math.hypot(a,l,c))?(a*=p=1/p,l*=p,c*=p):(a=0,l=0,c=0),e[0]=r,e[1]=a,e[2]=u,e[3]=0,e[4]=s,e[5]=l,e[6]=d,e[7]=0,e[8]=o,e[9]=c,e[10]=h,e[11]=0,e[12]=-(r*f+s*m+o*g),e[13]=-(a*f+l*m+c*g),e[14]=-(u*f+d*m+h*g),e[15]=1)}(this,t,n,i),this.check()}ortho(e){const{left:t,right:n,bottom:i,top:r,near:s=Wm,far:o=Gm}=e;return Tm(this,t,n,i,r,s,o),this.check()}orthographic(e){const{fovy:t=$m,aspect:n=qm,focalDistance:i=1,near:r=Wm,far:s=Gm}=e;Zm(t);const o=t/2,a=i*Math.tan(o),l=a*n;return this.ortho({left:-l,right:l,bottom:-a,top:a,near:r,far:s})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:n=1,near:i=.1,far:r=500}=e;return Zm(t),Cm(this,t,n,i,r),this.check()}determinant(){return function(e){var t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],d=e[10],h=e[11],p=e[12],f=e[13],m=e[14],g=e[15];return(t*o-n*s)*(d*g-h*m)-(t*a-i*s)*(u*g-h*f)+(t*l-r*s)*(u*m-d*f)+(n*a-i*o)*(c*g-h*p)-(n*l-r*o)*(c*m-d*p)+(i*l-r*a)*(c*f-u*p)}(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],r=1/n[1],s=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*r,e[2]=this[2]*s,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*r,e[6]=this[6]*s,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*r,e[10]=this[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],r=1/n[1],s=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*r,e[2]=this[2]*s,e[3]=this[4]*i,e[4]=this[5]*r,e[5]=this[6]*s,e[6]=this[8]*i,e[7]=this[9]*r,e[8]=this[10]*s,e}transpose(){return function(e,t){if(e===t){var n=t[1],i=t[2],r=t[3],s=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=s,e[11]=t[14],e[12]=r,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15]}(this,this),this.check()}invert(){return vm(this,this),this.check()}multiplyLeft(e){return bm(this,e,this),this.check()}multiplyRight(e){return bm(this,this,e),this.check()}rotateX(e){return _m(this,this,e),this.check()}rotateY(e){return function(e,t,n){var i=Math.sin(n),r=Math.cos(n),s=t[0],o=t[1],a=t[2],l=t[3],c=t[8],u=t[9],d=t[10],h=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r-c*i,e[1]=o*r-u*i,e[2]=a*r-d*i,e[3]=l*r-h*i,e[8]=s*i+c*r,e[9]=o*i+u*r,e[10]=a*i+d*r,e[11]=l*i+h*r}(this,this,e),this.check()}rotateZ(e){return Em(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return function(e,t,n,i){var r,s,o,a,l,c,u,d,h,p,f,m,g,y,v,b,w,x,_,E,S,C,T,A,k=i[0],N=i[1],M=i[2],P=Math.hypot(k,N,M);P<hh||(k*=P=1/P,N*=P,M*=P,r=Math.sin(n),o=1-(s=Math.cos(n)),a=t[0],l=t[1],c=t[2],u=t[3],d=t[4],h=t[5],p=t[6],f=t[7],m=t[8],g=t[9],y=t[10],v=t[11],b=k*k*o+s,w=N*k*o+M*r,x=M*k*o-N*r,_=k*N*o-M*r,E=N*N*o+s,S=M*N*o+k*r,C=k*M*o+N*r,T=N*M*o-k*r,A=M*M*o+s,e[0]=a*b+d*w+m*x,e[1]=l*b+h*w+g*x,e[2]=c*b+p*w+y*x,e[3]=u*b+f*w+v*x,e[4]=a*_+d*E+m*S,e[5]=l*_+h*E+g*S,e[6]=c*_+p*E+y*S,e[7]=u*_+f*E+v*S,e[8]=a*C+d*T+m*A,e[9]=l*C+h*T+g*A,e[10]=c*C+p*T+y*A,e[11]=u*C+f*T+v*A,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}(this,this,e,t),this.check()}scale(e){return xm(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return wm(this,this,e),this.check()}transform(e,t){return 4===e.length?(uh(t=Mm(t||[-0,-0,-0,-0],e,this),4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:n}=e;let i;switch(n){case 2:i=function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e}(t||[-0,-0],e,this);break;case 3:i=vh(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return uh(i,e.length),i}transformAsVector(e,t){let n;switch(e.length){case 2:n=function(e,t,n){const i=t[0],r=t[1],s=n[3]*i+n[7]*r||1;return e[0]=(n[0]*i+n[4]*r)/s,e[1]=(n[1]*i+n[5]*r)/s,e}(t||[-0,-0],e,this);break;case 3:n=Sh(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return uh(n,e.length),n}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,n){return this.identity().translate([e,t,n])}}let Xm,Km;function Zm(e){if(e>2*Math.PI)throw Error("expected radians")}function Jm(e,t){const n=Mm([],t,e);return Am(n,n,1/n[3]),n}function Qm(e,t){const n=e%t;return n<0?t+n:n}function eg(e,t,n){return n*t+(1-n)*e}function tg(e,t,n){return e<t?t:e>n?n:e}const ng=Math.log2||function(e){return Math.log(e)*Math.LOG2E};function ig(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const rg=Math.PI,sg=rg/4,og=rg/180,ag=180/rg,lg=512,cg=4003e4,ug=85.051129,dg=1.5;function hg(e){return Math.pow(2,e)}function pg(e){return ng(e)}function fg(e){const[t,n]=e;ig(Number.isFinite(t)),ig(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=n*og;return[lg*(t*og+rg)/(2*rg),lg*(rg+Math.log(Math.tan(sg+.5*i)))/(2*rg)]}function mg(e){const[t,n]=e,i=t/lg*(2*rg)-rg,r=2*(Math.atan(Math.exp(n/lg*(2*rg)-rg))-sg);return[i*ag,r*ag]}function gg(e){const{latitude:t,longitude:n,highPrecision:i=!1}=e;ig(Number.isFinite(t)&&Number.isFinite(n));const r=Math.cos(t*og),s=512/360,o=s/r,a=12790407194604047e-21/r,l={unitsPerMeter:[a,a,a],metersPerUnit:[1/a,1/a,1/a],unitsPerDegree:[s,o,a],degreesPerUnit:[.703125,1/o,1/a]};if(i){const e=og*Math.tan(t*og)/r,n=s*e/2,i=12790407194604047e-21*e,c=i/o*a;l.unitsPerDegree2=[0,n,i],l.unitsPerMeter2=[c,0,c]}return l}function yg(e,t){const[n,i,r]=e,[s,o,a]=t,{unitsPerMeter:l,unitsPerMeter2:c}=gg({longitude:n,latitude:i,highPrecision:!0}),u=fg(e);u[0]+=s*(l[0]+c[0]*o),u[1]+=o*(l[1]+c[1]*o);const d=mg(u),h=(r||0)+(a||0);return Number.isFinite(r)||Number.isFinite(a)?[d[0],d[1],h]:d}function vg(e){const{width:t,height:n,altitude:i,pitch:r=0,nearZMultiplier:s=1,farZMultiplier:o=1}=e;let{fovy:a=bg(dg)}=e;void 0!==i&&(a=bg(i));const l=.5*a*og,c=wg(a),u=r*og,d=Math.sin(l)*c/Math.sin(Math.min(Math.max(Math.PI/2-u-l,.01),Math.PI-.01));return{fov:2*l,aspect:t/n,focalDistance:c,near:s,far:(Math.sin(u)*d+c)*o}}function bg(e){return 2*Math.atan(.5/e)*ag}function wg(e){return.5/Math.tan(.5*e*og)}function xg(e,t){const[n,i,r=0]=e;return ig(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(r)),Jm(t,[n,i,r,1])}function _g(e,t,n=0){const[i,r,s]=e;if(ig(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(s)){return Jm(t,[i,r,s,1])}const o=Jm(t,[i,r,0,1]),a=Jm(t,[i,r,1,1]),l=o[2],c=a[2];return Vm([],o,a,l===c?0:((n||0)-l)/(c-l))}function Eg(e){const{width:t,height:n,bounds:i,minExtent:r=0,maxZoom:s=24,offset:o=[0,0]}=e,[[a,l],[c,u]]=i,d=function(e=0){if("number"==typeof e)return{top:e,bottom:e,left:e,right:e};return ig(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e}(e.padding),h=fg([a,tg(u,-85.051129,ug)]),p=fg([c,tg(l,-85.051129,ug)]),f=[Math.max(Math.abs(p[0]-h[0]),r),Math.max(Math.abs(p[1]-h[1]),r)],m=[t-d.left-d.right-2*Math.abs(o[0]),n-d.top-d.bottom-2*Math.abs(o[1])];ig(m[0]>0&&m[1]>0);const g=m[0]/f[0],y=m[1]/f[1],v=(d.right-d.left)/2/g,b=(d.bottom-d.top)/2/y,w=mg([(p[0]+h[0])/2+v,(p[1]+h[1])/2+b]),x=Math.min(s,ng(Math.abs(Math.min(g,y))));return ig(Number.isFinite(x)),{longitude:w[0],latitude:w[1],zoom:x}}const Sg=Math.PI/180;function Cg(e,t,n){const{pixelUnprojectionMatrix:i}=e,r=Jm(i,[t,0,1,1]),s=Jm(i,[t,e.height,1,1]),o=mg(Vm([],r,s,(n*e.distanceScales.unitsPerMeter[2]-r[2])/(s[2]-r[2])));return o.push(n),o}const Tg=["longitude","latitude","zoom"],Ag={curve:1.414,speed:1.2};function kg(e,t,n){const i=(n=Object.assign({},Ag,n)).curve,r=e.zoom,s=[e.longitude,e.latitude],o=hg(r),a=t.zoom,l=[t.longitude,t.latitude],c=hg(a-r),u=fg(s),d=fg(l),h=Hm([],d,u),p=Math.max(e.width,e.height),f=p/c,m=zm(h)*o,g=Math.max(m,.01),y=i*i,v=(f*f-p*p+y*y*g*g)/(2*p*y*g),b=(f*f-p*p-y*y*g*g)/(2*f*y*g),w=Math.log(Math.sqrt(v*v+1)-v),x=Math.log(Math.sqrt(b*b+1)-b);return{startZoom:r,startCenterXY:u,uDelta:h,w0:p,u1:m,S:(x-w)/i,rho:i,rho2:y,r0:w,r1:x}}const Ng=Math.PI/180,Mg=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Pg=[0,0,0],Lg={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class Viewport{constructor(e={}){const{id:t=null,x:n=0,y:i=0,width:r=1,height:s=1}=e;this.id=t||this.constructor.displayName||"viewport",this.x=n,this.y=i,this.width=r||1,this.height=s||1,this._frustumPlanes={},this._initViewMatrix(e),this._initProjectionMatrix(e),this._initPixelMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?du.WEB_MERCATOR:du.WEB_MERCATOR_AUTO_OFFSET:du.IDENTITY}equals(e){return e instanceof Viewport&&(this===e||e.width===this.width&&e.height===this.height&&e.scale===this.scale&&ah(e.projectionMatrix,this.projectionMatrix)&&ah(e.viewMatrix,this.viewMatrix))}project(e,{topLeft:t=!0}={}){const n=xg(this.projectPosition(e),this.pixelProjectionMatrix),[i,r]=n,s=t?r:this.height-r;return 2===e.length?[i,s]:[i,s,n[2]]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[i,r,s]=e,o=t?r:this.height-r,a=n&&n*this.distanceScales.unitsPerMeter[2],l=_g([i,o,s],this.pixelUnprojectionMatrix,a),[c,u,d]=this.unprojectPosition(l);return Number.isFinite(s)?[c,u,d]:Number.isFinite(n)?[c,u,n]:[c,u]}projectPosition(e){const[t,n]=this.projectFlat(e);return[t,n,(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(e){const[t,n]=this.unprojectFlat(e);return[t,n,(e[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(e){if(this.isGeospatial){const t=fg(e);return t[1]=sh(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?mg(e):e}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,0],t),i=this.unproject([this.width,0],t),r=this.unproject([0,this.height],t),s=this.unproject([this.width,this.height],t);return[Math.min(n[0],i[0],r[0],s[0]),Math.min(n[1],i[1],r[1],s[1]),Math.max(n[0],i[0],r[0],s[0]),Math.max(n[1],i[1],r[1],s[1])]}getDistanceScales(e=null){return e?gg({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:n=1,height:i=1}){return e<this.x+this.width&&this.x<e+n&&t<this.y+this.height&&this.y<t+i}getFrustumPlanes(){return this._frustumPlanes.near||Object.assign(this._frustumPlanes,{left:Nh((e=this.viewProjectionMatrix)[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:Nh(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:Nh(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:Nh(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:Nh(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:Nh(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}),this._frustumPlanes;var e}panByPosition(e,t){return null}getCameraPosition(){return this.cameraPosition}getCameraDirection(){return this.cameraDirection}getCameraUp(){return this.cameraUp}_createProjectionMatrix({orthographic:e,fovyRadians:t,aspect:n,focalDistance:i,near:r,far:s}){return e?(new matrix4_Matrix4).orthographic({fovy:t,aspect:n,focalDistance:i,near:r,far:s}):(new matrix4_Matrix4).perspective({fovy:t,aspect:n,near:r,far:s})}_initViewMatrix(e){const{viewMatrix:t=Mg,longitude:n=null,latitude:i=null,zoom:r=null,position:s=null,modelMatrix:o=null,focalDistance:a=1,distanceScales:l=null}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this.zoom=r,Number.isFinite(this.zoom)||(this.zoom=this.isGeospatial?function(e){const{latitude:t}=e;ig(Number.isFinite(t));const n=Math.cos(t*og);return pg(cg*n)-9}({latitude:i})+Math.log2(a):0);const c=Math.pow(2,this.zoom);this.scale=c,this.distanceScales=this.isGeospatial?gg({latitude:i,longitude:n}):l||Lg,this.focalDistance=a,this.distanceScales.metersPerUnit=new vector3_Vector3(this.distanceScales.metersPerUnit),this.distanceScales.unitsPerMeter=new vector3_Vector3(this.distanceScales.unitsPerMeter),this.position=Pg,this.meterOffset=Pg,s&&(this.position=s,this.modelMatrix=o,this.meterOffset=o?o.transformVector(s):s),this.isGeospatial?(this.longitude=n,this.latitude=i,this.center=this._getCenterInWorld({longitude:n,latitude:i})):this.center=s?this.projectPosition(s):[0,0,0],this.viewMatrixUncentered=t,this.viewMatrix=(new matrix4_Matrix4).multiplyRight(this.viewMatrixUncentered).translate(new vector3_Vector3(this.center||Pg).negate())}_getCenterInWorld({longitude:e,latitude:t}){const{meterOffset:n,distanceScales:i}=this,r=new vector3_Vector3(this.projectPosition([e,t,0]));if(n){const e=new vector3_Vector3(n).scale(i.unitsPerMeter);r.add(e)}return r}_initProjectionMatrix(e){const{projectionMatrix:t=null,orthographic:n=!1,fovyRadians:i,fovy:r=75,near:s=.1,far:o=1e3,focalDistance:a=1}=e;this.projectionMatrix=t||this._createProjectionMatrix({orthographic:n,fovyRadians:i||r*Ng,aspect:this.width/this.height,focalDistance:a,near:s,far:o})}_initPixelMatrices(){const e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var t;bm(e,e,this.projectionMatrix),bm(e,e,this.viewMatrix),this.viewProjectionMatrix=e,this.viewMatrixInverse=vm([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=[(t=this.viewMatrixInverse)[12],t[13],t[14]];const n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];xm(n,n,[this.width/2,-this.height/2,1]),wm(n,n,[1,-1,0]),bm(i,n,this.viewProjectionMatrix),this.pixelProjectionMatrix=i,this.viewportMatrix=n,this.pixelUnprojectionMatrix=vm([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||cu.warn("Pixel project matrix not invertible")()}}Viewport.displayName="Viewport";const Og=Math.PI/180;function Rg(e){return 512/4003e4/Math.cos(e*Og)}class web_mercator_viewport_WebMercatorViewport extends Viewport{constructor(e={}){const{latitude:t=0,longitude:n=0,zoom:i=11,pitch:r=0,bearing:s=0,nearZMultiplier:o=.1,farZMultiplier:a=1.01,orthographic:l=!1,projectionMatrix:c,repeat:u=!1,worldOffset:d=0,legacyMeterSizes:h=!1}=e;let{width:p,height:f,altitude:m=1.5}=e;const g=Math.pow(2,i);let y;p=p||1,f=f||1;let v=null;c?(m=c[5]/2,y=bg(m)):(e.fovy?(y=e.fovy,m=wg(y)):y=bg(m),v=vg({width:p,height:f,pitch:r,fovy:y,nearZMultiplier:o,farZMultiplier:a}));let b=function(e){const{height:t,pitch:n,bearing:i,altitude:r,scale:s,center:o}=e,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];wm(a,a,[0,0,-r]),_m(a,a,-n*og),Em(a,a,i*og);const l=s/t;return xm(a,a,[l,l,l]),o&&wm(a,a,function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}([],o)),a}({height:f,pitch:r,bearing:s,scale:g,altitude:m});if(d){b=(new matrix4_Matrix4).translate([512*d,0,0]).multiplyLeft(b)}super({...e,width:p,height:f,viewMatrix:b,longitude:n,latitude:t,zoom:i,...v,fovy:y,focalDistance:m}),this.latitude=t,this.longitude=n,this.zoom=i,this.pitch=r,this.bearing=s,this.altitude=m,this.fovy=y,this.orthographic=l,this._subViewports=u?[]:null,this._pseudoMeters=h,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let e=t;e<=n;e++){const t=e?new web_mercator_viewport_WebMercatorViewport({...this,worldOffset:e}):this;this._subViewports.push(t)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,n]=this.projectFlat(e);return[t,n,(e[2]||0)*Rg(e[1])]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,n]=this.unprojectFlat(e);return[t,n,(e[2]||0)/Rg(n)]}addMetersToLngLat(e,t){return yg(e,t)}panByPosition(e,t){const n=_g(t,this.pixelUnprojectionMatrix),i=Bm([],this.projectFlat(e),jm([],n)),r=Bm([],this.center,i),[s,o]=this.unprojectFlat(r);return{longitude:s,latitude:o}}getBounds(e={}){const t=function(e,t=0){const{width:n,height:i,unproject:r}=e,s={targetZ:t},o=r([0,i],s),a=r([n,i],s);let l,c;return(e.fovy?.5*e.fovy*Sg:Math.atan(.5/e.altitude))>(90-e.pitch)*Sg-.01?(l=Cg(e,0,t),c=Cg(e,n,t)):(l=r([0,0],s),c=r([n,0],s)),[o,a,c,l]}(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:n,height:i}=this,{longitude:r,latitude:s,zoom:o}=Eg({width:n,height:i,bounds:e,...t});return new web_mercator_viewport_WebMercatorViewport({width:n,height:i,longitude:r,latitude:s,zoom:o})}}function Ig(e,t,n=!1){const i=t.projectPosition(e);if(n&&t instanceof web_mercator_viewport_WebMercatorViewport){const[n,r,s=0]=e,o=t.getDistanceScales([n,r]);i[2]=s*o.unitsPerMeter[2]}return i}function Dg(e,{viewport:t,modelMatrix:n,coordinateSystem:i,coordinateOrigin:r,offsetMode:s}){let[o,a,l=0]=e;switch(n&&([o,a,l]=Mm([],[o,a,l,1],n)),i){case uu.LNGLAT:return Ig([o,a,l],t,s);case uu.LNGLAT_OFFSETS:return Ig([o+r[0],a+r[1],l+(r[2]||0)],t,s);case uu.METER_OFFSETS:return Ig(yg(r,[o,a,l]),t,s);default:return t.isGeospatial?[o+r[0],a+r[1],l+r[2]]:t.projectPosition([o,a,l])}}function Fg(e,t){const{viewport:n,coordinateSystem:i,coordinateOrigin:r,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=function(e){const t={...e};let{coordinateSystem:n}=e;const{viewport:i,coordinateOrigin:r,fromCoordinateSystem:s,fromCoordinateOrigin:o}=e;return n===uu.DEFAULT&&(n=i.isGeospatial?uu.LNGLAT:uu.CARTESIAN),void 0===s&&(t.fromCoordinateSystem=n),void 0===o&&(t.fromCoordinateOrigin=r),t.coordinateSystem=n,t}(t),{geospatialOrigin:l,shaderCoordinateOrigin:c,offsetMode:u}=Fm(n,i,r),d=Dg(e,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:u});if(u){const e=n.projectPosition(l||c);_h(d,d,e)}return d}web_mercator_viewport_WebMercatorViewport.displayName="WebMercatorViewport";const Bg={10241:9987,10240:9729,10242:33071,10243:33071},zg={};function jg(e,t){if(e===t)return!0;if(!e||!t)return!1;for(const n in e){const i=e[n],r=t[n];if(!(i===r||Array.isArray(i)&&Array.isArray(r)&&jg(i,r)))return!1}return!0}const Vg={boolean:{validate:(e,t)=>!0,equal:(e,t,n)=>Boolean(e)===Boolean(t)},number:{validate:(e,t)=>Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)},color:{validate:(e,t)=>t.optional&&!e||qg(e)&&(3===e.length||4===e.length),equal:(e,t,n)=>Ug(e,t)},accessor:{validate(e,t){const n=Wg(e);return"function"===n||n===Wg(t.value)},equal:(e,t,n)=>"function"==typeof t||Ug(e,t)},array:{validate:(e,t)=>t.optional&&!e||qg(e),equal:(e,t,n)=>n.compare?Ug(e,t):e===t},object:{equal:(e,t,n)=>n.compare?jg(e,t):e===t},function:{validate:(e,t)=>t.optional&&!e||"function"==typeof e,equal:(e,t,n)=>!n.compare||e===t},data:{transform:(e,t,n)=>{const{dataTransform:i}=n.props;return i&&e?i(e):e}},image:{transform:(e,t,n)=>function(e,t){const n=e.context&&e.context.gl;if(!n||!t)return null;if(t instanceof Texture2D)return t;t.constructor&&"Object"!==t.constructor.name&&(t={data:t});let i=null;t.compressed&&(i={10241:t.data.length>1?9985:9729});const r=new Texture2D(n,{...t,parameters:{...Bg,...i,...e.props.textureParameters}});return zg[r.id]=!0,r}(n,e),release:e=>{var t;(t=e)&&t instanceof Texture2D&&zg[t.id]&&(t.delete(),delete zg[t.id])}}};function Ug(e,t){if(e===t)return!0;if(!qg(e)||!qg(t))return!1;const n=e.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}function Hg(e,t){switch(Wg(t)){case"object":return $g(e,t);case"array":return $g(e,{type:"array",value:t,compare:!1});case"boolean":return $g(e,{type:"boolean",value:t});case"number":return $g(e,{type:"number",value:t});case"function":return $g(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function $g(e,t){return"type"in t?{name:e,...Vg[t.type],...t}:"value"in t?{name:e,type:Wg(t.value),...t}:{name:e,type:"object",value:t}}function qg(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function Wg(e){return qg(e)?"array":null===e?"null":typeof e}function Gg(e){const t=Kg(e,"_mergedDefaultProps");return t||(function(e){if(!e.prototype)return;const t=Object.getPrototypeOf(e),n=Gg(t),i=function(e){const t={},n={},i={};for(const[r,s]of Object.entries(e)){const e=null==s?void 0:s.deprecatedFor;if(e)i[r]=Array.isArray(e)?e:[e];else{const e=Hg(r,s);t[r]=e,n[r]=e.value}}return{propTypes:t,defaultProps:n,deprecatedProps:i}}(Kg(e,"defaultProps")||{}),r=function(e,t,n){const i=Object.create(null);Object.assign(i,t,e);const r=function(e){const t=Kg(e,"layerName")||Kg(e,"componentName");t||cu.once(0,"".concat(e.name,".componentName not specified"))();return t||e.name}(n);return delete e.id,Object.defineProperties(i,{id:{writable:!0,value:r}}),i}(i.defaultProps,n,e),s={...t._propTypes,...i.propTypes};!function(e,t){const n={},i={};for(const e in t){const r=t[e],{name:s,value:o}=r;r.async&&(n[s]=o,i[s]=Yg(s))}e[rm]=n,e[sm]={},Object.defineProperties(e,i)}(r,s);const o={...t._deprecatedProps,...i.deprecatedProps};(function(e,t){for(const n in t)Object.defineProperty(e,n,{enumerable:!1,set(e){const i="".concat(this.id,": ").concat(n);for(const i of t[n])Xg(this,i)||(this[i]=e);cu.deprecated(i,t[n].join("/"))()}})})(r,o),e._mergedDefaultProps=r,e._propTypes=s,e._deprecatedProps=o}(e),e._mergedDefaultProps)}function Yg(e){return{enumerable:!0,set(t){"string"==typeof t||t instanceof Promise||zh(t)?this[sm][e]=t:this[om][e]=t},get(){if(this[om]){if(e in this[om]){return this[om][e]||this[rm][e]}if(e in this[sm]){const t=this[im]&&this[im].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[rm][e]}}return this[rm][e]}}}function Xg(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Kg(e,t){return Xg(e,t)&&e[t]}const Zg=Object.freeze({});class ComponentState{constructor(e){Hc(this,"component",void 0),Hc(this,"onAsyncPropUpdated",void 0),Hc(this,"asyncProps",void 0),Hc(this,"oldProps",void 0),Hc(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}}getOldProps(){return this.oldAsyncProps||this.oldProps||Zg}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component.props}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return Boolean(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){const t=e[om]||{},n=e[sm]||e,i=e[rm]||{};for(const e in t){const n=t[e];this._createAsyncPropData(e,i[e]),this._updateAsyncProp(e,n),t[e]=this.getAsyncProp(e)}for(const e in n){const t=n[e];this._createAsyncPropData(e,i[e]),this._updateAsyncProp(e,t)}}_fetch(e,t){return t}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){this._didAsyncInputValueChange(e,t)&&("string"==typeof t&&(t=this._fetch(e,t)),t instanceof Promise?this._watchPromise(e,t):zh(t)?this._resolveAsyncIterable(e,t):this._setPropValue(e,t))}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const n=this.asyncProps[e];return t!==n.resolvedValue&&t!==n.lastValue&&(n.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(t=this._postProcessValue(n,t),n.resolvedValue=t,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,t,n){const i=this.asyncProps[e];i&&n>=i.resolvedLoadCount&&void 0!==t&&(this._freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=n,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;t.then((t=>{t=this._postProcessValue(n,t),this._setAsyncPropValue(e,t,i),this._onResolve(e,t)})).catch((t=>{this._onError(e,t)}))}}async _resolveAsyncIterable(e,t){if("data"!==e)return void this._setPropValue(e,t);const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let r=[],s=0;for await(const n of t){const{dataTransform:t}=this.component.props;r=t?t(n,r):r.concat(n),Object.defineProperty(r,"__diff",{enumerable:!1,value:[{startRow:s,endRow:r.length}]}),s=r.length,this._setAsyncPropValue(e,r,i)}this._onResolve(e,r)}_postProcessValue(e,t){const n=e.type;return n&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(t,n,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const n=this.component&&this.component.constructor._propTypes;this.asyncProps[e]={type:n&&n[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}let Jg=0;class Component{constructor(...e){Hc(this,"id",void 0),Hc(this,"props",void 0),Hc(this,"count",void 0),Hc(this,"lifecycle",void 0),Hc(this,"parent",void 0),Hc(this,"context",void 0),Hc(this,"state",void 0),Hc(this,"internalState",void 0),this.props=function(e,t){const n=Gg(e.constructor),i=Object.create(n);i[im]=e,i[sm]={},i[om]={};for(let e=0;e<t.length;++e){const n=t[e];for(const e in n)i[e]=n[e]}return Object.freeze(i),i}(this,e),this.id=this.props.id,this.count=Jg++,this.lifecycle=Zf,this.parent=null,this.context=null,this.state=null,this.internalState=null,Object.seal(this)}get root(){let e=this;for(;e.parent;)e=e.parent;return e}clone(e){const{props:t}=this,n={};for(const e in t[rm])e in t[om]?n[e]=t[om][e]:e in t[sm]&&(n[e]=t[sm][e]);return new this.constructor({...t,...n,...e})}_initState(){this.internalState=new ComponentState(this)}}Hc(Component,"componentName","Component"),Hc(Component,"defaultProps",{});class LayerState extends ComponentState{constructor({attributeManager:e,layer:t}){super(t),Hc(this,"attributeManager",void 0),Hc(this,"needsRedraw",void 0),Hc(this,"subLayers",void 0),Hc(this,"usesPickingColorCache",void 0),this.attributeManager=e,this.needsRedraw=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}set layer(e){this.component=e}_fetch(e,t){const n=this.component.props.fetch;return n?n(t,{propName:e,layer:this.layer}):super._fetch(e,t)}_onResolve(e,t){const n=this.component.props.onDataLoad;"data"===e&&n&&n(t,{propName:e,layer:this.layer})}_onError(e,t){this.layer.raiseError(t,"loading ".concat(e," of ").concat(this.layer))}}const Qg=e=>"boolean"==typeof e,ey=e=>"function"==typeof e,ty=e=>null!==e&&"object"==typeof e,ny=e=>ty(e)&&e.constructor==={}.constructor,iy=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,ry=e=>"undefined"!=typeof Blob&&e instanceof Blob,sy=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||ty(e)&&ey(e.tee)&&ey(e.cancel)&&ey(e.getReader))(e)||(e=>ty(e)&&ey(e.read)&&ey(e.pipe)&&Qg(e.readable))(e);function oy(e,t){if(!e)throw new Error(t||"loader assertion failed.")}function ay(e){var t;if(!e)return!1;Array.isArray(e)&&(e=e[0]);return Array.isArray(null===(t=e)||void 0===t?void 0:t.extensions)}function ly(e){var t,n;let i;return oy(e,"null loader"),oy(ay(e),"invalid loader"),Array.isArray(e)&&(i=e[1],e=e[0],e={...e,options:{...e.options,...i}}),(null!==(t=e)&&void 0!==t&&t.parseTextSync||null!==(n=e)&&void 0!==n&&n.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}let cy="";const uy={};const dy=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,hy=/^([-\w.]+\/[-\w.+]+)/;function py(e){const t=hy.exec(e);return t?t[1]:e}function fy(e){const t=dy.exec(e);return t?t[1]:""}const my=/\?.*/;function gy(e){if(iy(e)){const t=yy(e.url||"");return{url:t,type:py(e.headers.get("content-type")||"")||fy(t)}}return ry(e)?{url:yy(e.name||""),type:e.type||""}:"string"==typeof e?{url:yy(e),type:fy(e)}:{url:"",type:""}}function yy(e){return e.replace(my,"")}async function vy(e){if(iy(e))return e;const t={},n=function(e){return iy(e)?e.headers["content-length"]||-1:ry(e)?e.size:"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}(e);n>=0&&(t["content-length"]=String(n));const{url:i,type:r}=gy(e);r&&(t["content-type"]=r);const s=await async function(e){const t=5;if("string"==typeof e)return"data:,".concat(e.slice(0,t));if(e instanceof Blob){const t=e.slice(0,5);return await new Promise((e=>{const n=new FileReader;n.onload=t=>{var n;return e(null==t||null===(n=t.target)||void 0===n?void 0:n.result)},n.readAsDataURL(t)}))}if(e instanceof ArrayBuffer){const n=function(e){let t="";const n=new Uint8Array(e);for(let e=0;e<n.byteLength;e++)t+=String.fromCharCode(n[e]);return btoa(t)}(e.slice(0,t));return"data:base64,".concat(n)}return null}(e);s&&(t["x-first-bytes"]=s),"string"==typeof e&&(e=(new TextEncoder).encode(e));const o=new Response(e,{headers:t});return Object.defineProperty(o,"url",{value:i}),o}async function by(e,t){if("string"==typeof e){e=function(e){for(const t in uy)if(e.startsWith(t)){const n=uy[t];e=e.replace(t,n)}return e.startsWith("http://")||e.startsWith("https://")||(e="".concat(cy).concat(e)),e}(e);let n=t;return null!=t&&t.fetch&&"function"!=typeof(null==t?void 0:t.fetch)&&(n=t.fetch),await fetch(e,n)}return await vy(e)}const wy=new Log({id:"loaders.gl"});class NullLog{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,void 0!==n.g&&n.g,"undefined"!=typeof document&&document;const xy=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser),_y="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version),Ey=(_y&&parseFloat(_y[1]),{fetch:null,mimeType:void 0,nothrow:!1,log:new class ConsoleLog{constructor(){Hc(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}},CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:xy,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]}),Sy={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Cy(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state=e._state||{},e._state}const Ty=()=>{const e=Cy();return e.globalOptions=e.globalOptions||{...Ey},e.globalOptions};function Ay(e,t,n,i){return n=n||[],function(e,t){Ny(e,null,Ey,Sy,t);for(const n of t){const i=e&&e[n.id]||{},r=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};Ny(i,n.id,r,s,t)}}(e,n=Array.isArray(n)?n:[n]),Py(t,e,i)}function ky(e,t){const n=Ty(),i=e||n;return"function"==typeof i.fetch?i.fetch:ty(i.fetch)?e=>by(e,i):null!=t&&t.fetch?null==t?void 0:t.fetch:by}function Ny(e,t,n,i,r){const s=t||"Top level",o=t?"".concat(t,"."):"";for(const a in e){const l=!t&&ty(e[a]),c="baseUri"===a&&!t,u="workerUrl"===a&&t;if(!(a in n)&&!c&&!u)if(a in i)wy.warn("".concat(s," loader option '").concat(o).concat(a,"' no longer supported, use '").concat(i[a],"'"))();else if(!l){const e=My(a,r);wy.warn("".concat(s," loader option '").concat(o).concat(a,"' not recognized. ").concat(e))()}}}function My(e,t){const n=e.toLowerCase();let i="";for(const r of t)for(const t in r.options){if(e===t)return"Did you mean '".concat(r.id,".").concat(t,"'?");const s=t.toLowerCase();(n.startsWith(s)||s.startsWith(n))&&(i=i||"Did you mean '".concat(r.id,".").concat(t,"'?"))}return i}function Py(e,t,n){const i={...e.options||{}};return function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}(i,n),null===i.log&&(i.log=new NullLog),Ly(i,Ty()),Ly(i,t),i}function Ly(e,t){for(const n in t)if(n in t){const i=t[n];ny(i)&&ny(e[n])?e[n]={...e[n],...t[n]}:e[n]=t[n]}}function Oy(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,void 0!==n.g&&n.g,"undefined"!=typeof document&&document;const Ry="object"!=typeof process||"[object process]"!==String(process)||process.browser,Iy="undefined"!=typeof window&&void 0!==window.orientation,Dy="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);Dy&&parseFloat(Dy[1]);class worker_threads_browser_Worker{on(e,t){}postMessage(...e){}terminate(){}}const Fy=new Map;function By(e){Oy(e.source&&!e.url||!e.source&&e.url);let t=Fy.get(e.source||e.url);return t||(e.url&&(t=function(e){if(!e.startsWith("http"))return e;return zy((t=e,"try {\n  importScripts('".concat(t,"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}")));var t}(e.url),Fy.set(e.url,t)),e.source&&(t=zy(e.source),Fy.set(e.source,t))),Oy(t),t}function zy(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function jy(e,t=!0,n){const i=n||new Set;if(e){if(Vy(e))i.add(e);else if(Vy(e.buffer))i.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(const n in e)jy(e[n],t,i)}else;return void 0===n?Array.from(i):[]}function Vy(e){return!!e&&(e instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&e instanceof MessagePort||("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}const Uy=()=>{};class WorkerThread{static isSupported(){return"undefined"!=typeof Worker&&Ry||void 0!==typeof worker_threads_browser_Worker}constructor(e){Hc(this,"name",void 0),Hc(this,"source",void 0),Hc(this,"url",void 0),Hc(this,"terminated",!1),Hc(this,"worker",void 0),Hc(this,"onMessage",void 0),Hc(this,"onError",void 0),Hc(this,"_loadableURL","");const{name:t,source:n,url:i}=e;Oy(n||i),this.name=t,this.source=n,this.url=i,this.onMessage=Uy,this.onError=e=>console.log(e),this.worker=Ry?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Uy,this.onError=Uy,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||jy(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}_createBrowserWorker(){this._loadableURL=By({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>console.error(e),e}_createNodeWorker(){let e;if(this.url){const t=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new worker_threads_browser_Worker(t,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new worker_threads_browser_Worker(this.source,{eval:!0})}return e.on("message",(e=>{this.onMessage(e)})),e.on("error",(e=>{this.onError(e)})),e.on("exit",(e=>{})),e}}class WorkerJob{constructor(e,t){Hc(this,"name",void 0),Hc(this,"workerThread",void 0),Hc(this,"isRunning",!0),Hc(this,"result",void 0),Hc(this,"_resolve",(()=>{})),Hc(this,"_reject",(()=>{})),this.name=e,this.workerThread=t,this.result=new Promise(((e,t)=>{this._resolve=e,this._reject=t}))}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Oy(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Oy(this.isRunning),this.isRunning=!1,this._reject(e)}}class WorkerPool{static isSupported(){return WorkerThread.isSupported()}constructor(e){Hc(this,"name","unnamed"),Hc(this,"source",void 0),Hc(this,"url",void 0),Hc(this,"maxConcurrency",1),Hc(this,"maxMobileConcurrency",1),Hc(this,"onDebug",(()=>{})),Hc(this,"reuseWorkers",!0),Hc(this,"props",{}),Hc(this,"jobQueue",[]),Hc(this,"idleQueue",[]),Hc(this,"count",0),Hc(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach((e=>e.destroy())),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e,t=((e,t,n)=>e.done(n)),n=((e,t)=>e.error(t))){const i=new Promise((i=>(this.jobQueue.push({name:e,onMessage:t,onError:n,onStart:i}),this)));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const n=new WorkerJob(t.name,e);e.onMessage=e=>t.onMessage(n,e.type,e.payload),e.onError=e=>t.onError(n,e),t.onStart(n);try{await n.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new WorkerThread({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Iy?this.maxMobileConcurrency:this.maxConcurrency}}const Hy={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class WorkerFarm{static isSupported(){return WorkerThread.isSupported()}static getWorkerFarm(e={}){return WorkerFarm._workerFarm=WorkerFarm._workerFarm||new WorkerFarm({}),WorkerFarm._workerFarm.setProps(e),WorkerFarm._workerFarm}constructor(e){Hc(this,"props",void 0),Hc(this,"workerPools",new Map),this.props={...Hy},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:n,url:i}=e;let r=this.workerPools.get(t);return r||(r=new WorkerPool({name:t,source:n,url:i}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}Hc(WorkerFarm,"_workerFarm",void 0);async function $y(e,t,n,i,r){const s=e.id,o=function(e,t={}){const n=t[e.id]||{},i="".concat(e.id,"-worker.js");let r=n.workerUrl;if(r||"compression"!==e.id||(r=t.workerUrl),"test"===t._workerType&&(r="modules/".concat(e.module,"/dist/").concat(i)),!r){let t=e.version;"latest"===t&&(t="beta");const n=t?"@".concat(t):"";r="https://unpkg.com/@loaders.gl/".concat(e.module).concat(n,"/dist/").concat(i)}return Oy(r),r}(e,n),a=WorkerFarm.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const l=await a.startJob("process-on-worker",qy.bind(null,r));l.postMessage("process",{input:t,options:n,context:i});const c=await l.result;return await c.result}async function qy(e,t,n,i){switch(n){case"done":t.done(i);break;case"error":t.error(new Error(i.error));break;case"process":const{id:r,input:s,options:o}=i;try{const n=await e(s,o);t.postMessage("done",{id:r,result:n})}catch(e){const n=e instanceof Error?e.message:"unknown error";t.postMessage("error",{id:r,error:n})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}n(2709);function Wy(e){return e&&"object"==typeof e&&e.isBuffer}function Gy(e){if(Wy(e))return function(e){if(Wy(e))return new Uint8Array(e.buffer,e.byteOffset,e.length).slice().buffer;return e}(e);if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e){const t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}async function Yy(e){const t=[];for await(const n of e)t.push(n);return function(...e){const t=e.map((e=>e instanceof ArrayBuffer?new Uint8Array(e):e)),n=t.reduce(((e,t)=>e+t.byteLength),0),i=new Uint8Array(n);let r=0;for(const e of t)i.set(e,r),r+=e.byteLength;return i.buffer}(...t)}const Xy=262144;function Ky(e,t){return xy?async function*(e,t){const n=e.getReader();let i;try{for(;;){const e=i||n.read();null!=t&&t._streamReadAhead&&(i=n.read());const{done:r,value:s}=await e;if(r)return;yield Gy(s)}}catch(e){n.releaseLock()}}(e,t):async function*(e,t){for await(const t of e)yield Gy(t)}(e)}function Zy(e,t){if("string"==typeof e)return function*(e,t){const n=(null==t?void 0:t.chunkSize)||262144;let i=0;const r=new TextEncoder;for(;i<e.length;){const t=Math.min(e.length-i,n),s=e.slice(i,i+t);i+=t,yield r.encode(s)}}(e,t);if(e instanceof ArrayBuffer)return function*(e,t={}){const{chunkSize:n=Xy}=t;let i=0;for(;i<e.byteLength;){const t=Math.min(e.byteLength-i,n),r=new ArrayBuffer(t),s=new Uint8Array(e,i,t);new Uint8Array(r).set(s),i+=t,yield r}}(e,t);if(ry(e))return async function*(e,t){const n=(null==t?void 0:t.chunkSize)||1048576;let i=0;for(;i<e.size;){const t=i+n,r=await e.slice(i,t).arrayBuffer();i=t,yield r}}(e,t);if(sy(e))return Ky(e,t);if(iy(e)){return Ky(e.body,t)}throw new Error("makeIterator")}const Jy="Cannot convert supplied data type";async function Qy(e,t,n){const i=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||i)return function(e,t,n){if(t.text&&"string"==typeof e)return e;if((e=>e&&"object"==typeof e&&e.isBuffer)(e)&&(e=e.buffer),e instanceof ArrayBuffer){const n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer;const i=e.byteLength||e.length;return 0===e.byteOffset&&i===n.byteLength||(n=n.slice(e.byteOffset,e.byteOffset+i)),n}throw new Error(Jy)}(e,t);if(ry(e)&&(e=await vy(e)),iy(e)){const n=e;return await async function(e){if(!e.ok){const t=await async function(e){let t="Failed to fetch resource ".concat(e.url," (").concat(e.status,"): ");try{const n=e.headers.get("Content-Type");let i=e.statusText;n.includes("application/json")&&(i+=" ".concat(await e.text())),t+=i,t=t.length>60?"".concat(t.slice(0,60),"..."):t}catch(e){}return t}(e);throw new Error(t)}}(n),t.binary?await n.arrayBuffer():await n.text()}if(sy(e)&&(e=Zy(e,n)),(e=>e&&"function"==typeof e[Symbol.iterator])(e)||(e=>e&&"function"==typeof e[Symbol.asyncIterator])(e))return Yy(e);throw new Error(Jy)}const ev=new Log({id:"loaders.gl"}),tv=()=>{const e=Cy();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};const nv=/\.([^.]+)$/;function iv(e,t=[],n,i){if(!rv(e))return null;if(t&&!Array.isArray(t))return ly(t);let r=[];t&&(r=r.concat(t)),null!=n&&n.ignoreRegisteredLoaders||r.push(...tv()),function(e){for(const t of e)ly(t)}(r);const s=function(e,t,n,i){const{url:r,type:s}=gy(e),o=r||(null==i?void 0:i.url);let a=null,l="";null!=n&&n.mimeType&&(a=ov(t,null==n?void 0:n.mimeType),l="match forced by supplied MIME type ".concat(null==n?void 0:n.mimeType));var c;a=a||function(e,t){const n=t&&nv.exec(t),i=n&&n[1];return i?function(e,t){t=t.toLowerCase();for(const n of e)for(const e of n.extensions)if(e.toLowerCase()===t)return n;return null}(e,i):null}(t,o),l=l||(a?"matched url ".concat(o):""),a=a||ov(t,s),l=l||(a?"matched MIME type ".concat(s):""),a=a||function(e,t){if(!t)return null;for(const n of e)if("string"==typeof t){if(av(t,n))return n}else if(ArrayBuffer.isView(t)){if(lv(t.buffer,t.byteOffset,n))return n}else if(t instanceof ArrayBuffer){if(lv(t,0,n))return n}return null}(t,e),l=l||(a?"matched initial data ".concat(cv(e)):""),a=a||ov(t,null==n?void 0:n.fallbackMimeType),l=l||(a?"matched fallback MIME type ".concat(s):""),l&&ev.log(1,"selectLoader selected ".concat(null===(c=a)||void 0===c?void 0:c.name,": ").concat(l,"."));return a}(e,r,n,i);if(!(s||null!=n&&n.nothrow))throw new Error(sv(e));return s}function rv(e){return!(e instanceof Response&&204===e.status)}function sv(e){const{url:t,type:n}=gy(e);let i="No valid loader found (";i+=t?"".concat(function(e){const t=e&&e.lastIndexOf("/");return t>=0?e.substr(t+1):""}(t),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const r=e?cv(e):"";return i+=r?' first bytes: "'.concat(r,'"'):"first bytes: not available",i+=")",i}function ov(e,t){for(const n of e){if(n.mimeTypes&&n.mimeTypes.includes(t))return n;if(t==="application/x.".concat(n.id))return n}return null}function av(e,t){if(t.testText)return t.testText(e);return(Array.isArray(t.tests)?t.tests:[t.tests]).some((t=>e.startsWith(t)))}function lv(e,t,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some((i=>function(e,t,n,i){if(i instanceof ArrayBuffer)return function(e,t,n){if(n=n||e.byteLength,e.byteLength<n||t.byteLength<n)return!1;const i=new Uint8Array(e),r=new Uint8Array(t);for(let e=0;e<i.length;++e)if(i[e]!==r[e])return!1;return!0}(i,e,i.byteLength);switch(typeof i){case"function":return i(e,n);case"string":return i===uv(e,t,i.length);default:return!1}}(e,t,n,i)))}function cv(e,t=5){if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return uv(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer){return uv(e,0,t)}return""}function uv(e,t,n){if(e.byteLength<t+n)return"";const i=new DataView(e);let r="";for(let e=0;e<n;e++)r+=String.fromCharCode(i.getUint8(t+e));return r}async function dv(e,t,n,i){Oy(!i||"object"==typeof i),!t||Array.isArray(t)||ay(t)||(i=void 0,n=t,t=void 0),e=await e,n=n||{};const{url:r}=gy(e),s=function(e,t){if(!t&&e&&!Array.isArray(e))return e;let n;if(e&&(n=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];n=n?[...n,...e]:e}return n&&n.length?n:null}(t,i),o=await async function(e,t=[],n,i){if(!rv(e))return null;let r=iv(e,t,{...n,nothrow:!0},i);if(r)return r;if(ry(e)&&(r=iv(e=await e.slice(0,10).arrayBuffer(),t,n,i)),!(r||null!=n&&n.nothrow))throw new Error(sv(e));return r}(e,s,n);return o?(i=function(e,t,n=null){if(n)return n;const i={fetch:ky(t,e),...e};return Array.isArray(i.loaders)||(i.loaders=null),i}({url:r,parse:dv,loaders:s},n=Ay(n,o,s,r),i),await async function(e,t,n,i){if(function(e,t="3.2.0"){Oy(e,"no worker provided");const n=e.version}(e),iy(t)){const e=t,{ok:n,redirected:r,status:s,statusText:o,type:a,url:l}=e,c=Object.fromEntries(e.headers.entries());i.response={headers:c,ok:n,redirected:r,status:s,statusText:o,type:a,url:l}}if(t=await Qy(t,e,n),e.parseTextSync&&"string"==typeof t)return n.dataType="text",e.parseTextSync(t,n,i,e);if(function(e,t){return!!WorkerFarm.isSupported()&&!!(Ry||null!=t&&t._nodeWorkers)&&e.worker&&(null==t?void 0:t.worker)}(e,n))return await $y(e,t,n,i,dv);if(e.parseText&&"string"==typeof t)return await e.parseText(t,n,i,e);if(e.parse)return await e.parse(t,n,i,e);throw Oy(!e.parseSync),new Error("".concat(e.id," loader - no parser found and worker is disabled"))}(o,e,n,i)):null}async function hv(e,t,n,i){Array.isArray(t)||ay(t)||(void 0,n=t,t=void 0);const r=ky(n);let s=e;return"string"==typeof e&&(s=await r(e)),ry(e)&&(s=await r(e)),await dv(s,t,n)}const pv=2**24-1,fv=Object.freeze([]),mv=gm((({oldViewport:e,viewport:t})=>e.equals(t)));let gv=new Uint8ClampedArray(0);const yv={data:{type:"data",value:fv,async:!0},dataComparator:{type:"function",value:null,compare:!1,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},onError:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:n,loaders:i,loadOptions:r,signal:s})=>{const{resourceManager:o}=n.context;var a;(r=r||n.getLoadOptions(),i=i||n.props.loaders,s)&&(r={...r,fetch:{...null===(a=r)||void 0===a?void 0:a.fetch,signal:s}});let l=o.contains(e);return l||r||(o.add({resourceId:e,data:hv(e,i),persistent:!1}),l=!0),l?o.subscribe({resourceId:e,onChange:e=>n.internalState.reloadAsyncProp(t,e),consumerId:n.id,requestId:t}):hv(e,i,r)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:fu,onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:uu.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,compare:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,100*-e],compare:!1},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Layer extends Component{toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}raiseError(e,t){var n,i,r,s;(t&&(e.message="".concat(t,": ").concat(e.message)),null!==(n=(i=this.props).onError)&&void 0!==n&&n.call(i,e))||(null===(r=this.context)||void 0===r||null===(s=r.onError)||void 0===s||s.call(r,e,this))}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(e=!0){this.internalState&&(this.internalState.needsRedraw=e)}setNeedsUpdate(){this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams())}hasUniformTransition(){return this.internalState.uniformTransitions.active}get isLoaded(){return this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||(this.state.model?[this.state.model]:[]))}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}project(e){const{viewport:t}=this.context,n=Dg(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,r,s]=xg(n,t.pixelProjectionMatrix);return 2===e.length?[i,r]:[i,r,s]}unproject(e){const{viewport:t}=this.context;return t.unproject(e)}projectPosition(e,t){return Fg(e,{viewport:this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===uu.DEFAULT||e===uu.LNGLAT||e===uu.CARTESIAN}onHover(e,t){return!!this.props.onHover&&this.props.onHover(e,t)}onClick(e,t){return!!this.props.onClick&&this.props.onClick(e,t)}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Ih(e instanceof Uint8Array);const[t,n,i]=e;return t+256*n+65536*i-1}initializeState(){throw new Error("Layer ".concat(this," has not defined initializeState"))}getShaders(e){for(const t of this.props.extensions)e=ym(e,t.getShaders.call(this,t));return e}getBounds(){var e;const t=this.getAttributeManager();if(!t)return null;const{positions:n,instancePositions:i}=t.attributes;return null===(e=n||i)||void 0===e?void 0:e.getBounds()}shouldUpdateState({oldProps:e,props:t,context:n,changeFlags:i}){return i.propsOrDataChanged}updateState({oldProps:e,props:t,context:n,changeFlags:i}){const r=this.getAttributeManager();if(i.dataChanged&&r){const{dataChanged:e}=i;if(Array.isArray(e))for(const t of e)r.invalidateAll(t);else r.invalidateAll()}const s=Number.isInteger(e.highlightedObjectIndex)||e.pickable,o=Number.isInteger(t.highlightedObjectIndex)||t.pickable;if(s!==o&&r){const{pickingColors:e,instancePickingColors:t}=r.attributes,n=e||t;n&&(o&&n.constant&&(n.constant=!1,r.invalidate(n.id)),n.value||o||(n.constant=!0,n.value=[0,0,0]))}}finalizeState(){for(const e of this.getModels())e.delete();const e=this.getAttributeManager();e&&e.finalize(),this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState.uniformTransitions.clear(),this.internalState.finalize()}draw(e){for(const t of this.getModels())t.draw(e)}getPickingInfo({info:e,mode:t}){const{index:n}=e;return n>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[n]),e}activateViewport(e){const t=this.internalState.viewport;this.internalState.viewport=e,t&&mv({oldViewport:t,viewport:e})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all",t=""){const n=this.getAttributeManager();n&&("all"===e?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const t of this.getModels())this._setModelAttributes(t,e)}_updateAttributes(e){const t=this.getAttributeManager();if(!t)return;const n=this.getNumInstances(e),i=this.getStartIndices(e);t.update({data:e.data,numInstances:n,startIndices:i,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this,ignoreUnknownAttributes:!0});const r=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(r)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),n=Object.create(this.props);for(const e in t)Object.defineProperty(n,e,{value:t[e]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const n=Math.floor(gv.length/3);if(this.internalState.usesPickingColorCache=!0,n<t){t>pv&&cu.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),gv=th.allocate(gv,t,{size:3,copy:!0,maxCount:Math.max(t,pv)});const e=Math.floor(gv.length/3),i=[];for(let t=n;t<e;t++)this.encodePickingColor(t,i),gv[3*t+0]=i[0],gv[3*t+1]=i[1],gv[3*t+2]=i[2]}e.value=gv.subarray(0,3*t)}_setModelAttributes(e,t){const n=this.getAttributeManager(),i=e.userData.excludeAttributes||{},r=n.getShaderAttributes(t,i);e.setAttributes(r)}disablePickingIndex(e){this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:n}=this.getAttributeManager().attributes,i=t||n,r=i.getVertexOffset(e),s=i.getVertexOffset(e+1);i.buffer.subData({data:new Uint8Array(s-r),offset:r})}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,n=e||t;this.internalState.usesPickingColorCache&&n.value.buffer!==gv.buffer&&(n.value=gv.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0})}getNumInstances(e){return void 0!==(e=e||this.props).numInstances?e.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:fm(e.data)}getStartIndices(e){return void 0!==(e=e||this.props).startIndices?e.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}_initialize(){tp("layer.initialize",this),this._initState(),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:!0,propsChanged:!0,viewportChanged:!0,extensionsChanged:!0}),this._updateState()}_update(){const e=this.needsUpdate();tp("layer.update",this,e),e&&this._updateState()}_updateState(){const e=this.props,t=this.context.viewport,n=this._updateUniformTransition();this.internalState.propsInTransition=n,this.context.viewport=this.internalState.viewport||t,this.props=n;try{const n=this._getUpdateParams(),i=this.getModels();if(this.context.gl)this.updateState(n);else try{this.updateState(n)}catch(e){}for(const e of this.props.extensions)e.updateState.call(this,n,e);const r=this.getModels()[0]!==i[0];this._updateModules(n,r),this.isComposite?this._renderLayers(n):(this.setNeedsRedraw(),this._updateAttributes(this.props),this.state.model&&this.state.model.setInstanceCount(this.getNumInstances()))}finally{this.context.viewport=t,this.props=e,this.clearChangeFlags(),this.internalState.needsUpdate=!1,this.internalState.resetOldProps()}}_finalize(){tp("layer.finalize",this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,e)}drawLayer({moduleParameters:e=null,uniforms:t={},parameters:n={}}){this._updateAttributeTransition();const i=this.props;this.props=this.internalState.propsInTransition||i;const{opacity:r}=this.props;t.opacity=Math.pow(r,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:r}=this.props,s=r&&r(t)||[0,0];Qu(this.context.gl,{polygonOffset:s}),ed(this.context.gl,n,(()=>{const i={moduleParameters:e,uniforms:t,parameters:n,context:this.context};for(const e of this.props.extensions)e.draw.call(this,i,e);this.draw(i)}))}finally{this.props=i}}getChangeFlags(){return this.internalState.changeFlags}setChangeFlags(e){const{changeFlags:t}=this.internalState;for(const n in e)if(e[n]){let i=!1;"dataChanged"===n&&Array.isArray(t[n])&&(t[n]=Array.isArray(e[n])?t[n].concat(e[n]):e[n],i=!0),t[n]||(t[n]=e[n],i=!0),i&&tp("layer.changeFlag",this,n,e)}const n=t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged;t.propsOrDataChanged=n,t.somethingChanged=n||e.viewportChanged||e.stateChanged}clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}diffProps(e,t){const n=am(e,t);if(n.updateTriggersChanged)for(const e in n.updateTriggersChanged)n.updateTriggersChanged[e]&&this.invalidateAttribute(e);if(n.transitionsChanged)for(const i in n.transitionsChanged)this.internalState.uniformTransitions.add(i,t[i],e[i],e.transitions[i]);return this.setChangeFlags(n)}validateProps(){!function(e){const t=pm(e);for(const n in t){const i=t[n],{validate:r}=i;if(r&&!r(e[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(e[n]))}}(this.props)}setModuleParameters(e){for(const t of this.getModels())t.updateModuleSettings(e)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={pickingSelectedColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&"function"==typeof n&&(t.pickingHighlightColor=n(e)),this.setModuleParameters(t),this.setNeedsRedraw()}_updateModules({props:e,oldProps:t},n){const{autoHighlight:i,highlightedObjectIndex:r,highlightColor:s}=e;if(n||t.autoHighlight!==i||t.highlightedObjectIndex!==r||t.highlightColor!==s){const e={};i||(e.pickingSelectedColor=null),Array.isArray(s)&&(e.pickingHighlightColor=s),Number.isInteger(r)&&(e.pickingSelectedColor=r>=0?this.encodePickingColor(r):null),this.setModuleParameters(e)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags;const n=this.getAttributeManager(),i=n&&n.getNeedsRedraw(e);return t=t||i,t}_getAttributeManager(){return new AttributeManager(this.context.gl,{id:this.props.id,stats:this.context.stats,timeline:this.context.timeline})}_initState(){Ih(!this.internalState&&!this.state),Ih(isFinite(this.props.coordinateSystem));const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new LayerState({attributeManager:e,layer:this}),this.clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(cu.deprecated("layer.state.attributeManager","layer.getAttributeManager()"),e)}),this.internalState.layer=this,this.internalState.uniformTransitions=new UniformTransitionManager(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props)}_transferState(e){tp("layer.matched",this,this===e);const{state:t,internalState:n}=e;this!==e&&(this.internalState=n,this.internalState.layer=this,this.state=t,this.internalState.setAsyncProps(this.props),this.diffProps(this.props,this.internalState.getOldProps()))}_onAsyncPropUpdated(){this.diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Layer.layerName="Layer",Layer.defaultProps=yv;class CompositeLayer extends Layer{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every((e=>e.isLoaded))}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id?(e.object=t.__source.object,e.index=t.__source.index,e):e}renderLayers(){return null}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:n}=this.props;return n&&n[e]&&n[e].type||t}getSubLayerRow(e,t,n){return e.__source={parent:this,object:t,index:n},e}getSubLayerAccessor(e){if("function"==typeof e){const t={data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(t.index=n.__source.index,e(n.__source.object,t)):e(n,i)}return e}getSubLayerProps(e={}){const{opacity:t,pickable:n,visible:i,parameters:r,getPolygonOffset:s,highlightedObjectIndex:o,autoHighlight:a,highlightColor:l,coordinateSystem:c,coordinateOrigin:u,wrapLongitude:d,positionFormat:h,modelMatrix:p,extensions:f,fetch:m,operation:g,_subLayerProps:y}=this.props,v={opacity:t,pickable:n,visible:i,parameters:r,getPolygonOffset:s,highlightedObjectIndex:o,autoHighlight:a,highlightColor:l,coordinateSystem:c,coordinateOrigin:u,wrapLongitude:d,positionFormat:h,modelMatrix:p,extensions:f,fetch:m,operation:g},b=y&&y[e.id],w=b&&b.updateTriggers,x=e.id||"sublayer";if(b){const t=this.constructor._propTypes,n=e.type?e.type._propTypes:{};for(const e in b){const i=n[e]||t[e];i&&"accessor"===i.type&&(b[e]=this.getSubLayerAccessor(b[e]))}}Object.assign(v,e,b),v.id="".concat(this.props.id,"-").concat(x),v.updateTriggers={all:this.props.updateTriggers.all,...e.updateTriggers,...w};for(const e of f){const t=e.getSubLayerProps.call(this,e);t&&Object.assign(v,t,{updateTriggers:Object.assign(v.updateTriggers,t.updateTriggers)})}return v}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_renderLayers(){let{subLayers:e}=this.internalState;const t=!e||this.needsUpdate();t&&(e=this.renderLayers(),e=Vh(e,Boolean),this.internalState.subLayers=e),tp("compositeLayer.renderLayers",this,t,e);for(const t of e)t.parent=this}}function vv({data:e,getIndex:t,dataRange:n,replace:i}){const{startRow:r=0,endRow:s=1/0}=n,o=e.length;let a=o,l=o;for(let n=0;n<o;n++){const i=t(e[n]);if(a>n&&i>=r&&(a=n),i>=s){l=n;break}}let c=a;const u=l-a!==i.length,d=u&&e.slice(l);for(let t=0;t<i.length;t++)e[c++]=i[t];if(u){for(let t=0;t<d.length;t++)e[c++]=d[t];e.length=c}return{startRow:a,endRow:a+i.length}}CompositeLayer.layerName="CompositeLayer";const bv={name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 1.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 1.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n",fs:null},wv="#define SMOOTH_EDGE_RADIUS 0.5",xv={name:"geometry",vs:"\n".concat(wv,"\n\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n  vec3 pickingColor;\n} geometry = VertexGeometry(\n  vec4(0.0, 0.0, 1.0, 0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec2(0.0),\n  vec3(0.0)\n);\n"),fs:"\n".concat(wv,"\n\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n\nfloat smoothedge(float edge, float x) {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n")},_v=Object.keys(uu).map((e=>"const int COORDINATE_SYSTEM_".concat(e," = ").concat(uu[e],";"))).join(""),Ev=Object.keys(du).map((e=>"const int PROJECTION_MODE_".concat(e," = ").concat(du[e],";"))).join(""),Sv=Object.keys(hu).map((e=>"const int UNIT_".concat(e.toUpperCase()," = ").concat(hu[e],";"))).join(""),Cv="".concat(_v,"\n").concat(Ev,"\n").concat(Sv,"\n\nuniform int project_uCoordinateSystem;\nuniform int project_uProjectionMode;\nuniform float project_uScale;\nuniform bool project_uWrapLongitude;\nuniform vec3 project_uCommonUnitsPerMeter;\nuniform vec3 project_uCommonUnitsPerWorldUnit;\nuniform vec3 project_uCommonUnitsPerWorldUnit2;\nuniform vec4 project_uCenter;\nuniform mat4 project_uModelMatrix;\nuniform mat4 project_uViewProjectionMatrix;\nuniform vec2 project_uViewportSize;\nuniform float project_uDevicePixelRatio;\nuniform float project_uFocalDistance;\nuniform vec3 project_uCameraPosition;\nuniform vec3 project_uCoordinateOrigin;\nuniform vec3 project_uCommonOrigin;\nuniform bool project_uPseudoMeters;\n\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec3 ZERO_64_LOW = vec3(0.0);\nconst float EARTH_RADIUS = 6370972.0;\nconst float GLOBE_RADIUS = 256.0;\nfloat project_size() {\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\n    project_uPseudoMeters == false) {\n    \n    if (geometry.position.w == 0.0) {\n      float y = clamp(geometry.worldPosition.y, -89.9, 89.9);\n      return 1.0 / cos(radians(y));\n    }\n  \n    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\n    float y2 = y * y;\n    float y4 = y2 * y2;\n    float y6 = y4 * y2;\n    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n  }\n  return 1.0;\n}\nfloat project_size(float meters) {\n  return meters * project_uCommonUnitsPerMeter.z * project_size();\n}\n\nvec2 project_size(vec2 meters) {\n  return meters * project_uCommonUnitsPerMeter.xy * project_size();\n}\n\nvec3 project_size(vec3 meters) {\n  return meters * project_uCommonUnitsPerMeter * project_size();\n}\n\nvec4 project_size(vec4 meters) {\n  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);\n}\nmat3 project_get_orientation_matrix(vec3 up) {\n  vec3 uz = normalize(up);\n  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));\n  vec3 uy = cross(uz, ux);\n  return mat3(ux, uy, uz);\n}\n\nbool project_needs_rotation(vec3 commonPosition, out mat3 transform) {\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    transform = project_get_orientation_matrix(commonPosition);\n    return true;\n  }\n  return false;\n}\nvec3 project_normal(vec3 vector) {\n  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);\n  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);\n  mat3 rotation;\n  if (project_needs_rotation(geometry.position.xyz, rotation)) {\n    n = rotation * n;\n  }\n  return n;\n}\n\nvec4 project_offset_(vec4 offset) {\n  float dy = offset.y;\n  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;\n  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\n  float x = lnglat.x;\n  if (project_uWrapLongitude) {\n    x = mod(x + 180., 360.0) - 180.;\n  }\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\nvec3 project_globe_(vec3 lnglatz) {\n  float lambda = radians(lnglatz.x);\n  float phi = radians(lnglatz.y);\n  float cosPhi = cos(phi);\n  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\n\n  return vec3(\n    sin(lambda) * cosPhi,\n    -cos(lambda) * cosPhi,\n    sin(phi)\n  ) * D;\n}\nvec4 project_position(vec4 position, vec3 position64Low) {\n  vec4 position_world = project_uModelMatrix * position;\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_mercator_(position_world.xy),\n        project_size(position_world.z),\n        position_world.w\n      );\n    }\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\n      position_world.xyz += project_uCoordinateOrigin;\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_globe_(position_world.xyz),\n        position_world.w\n      );\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {\n        return vec4(\n          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,\n          project_size(position_world.z),\n          position_world.w\n        );\n      }\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||\n    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\n    position_world.xyz -= project_uCoordinateOrigin;\n  }\n  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));\n}\n\nvec4 project_position(vec4 position) {\n  return project_position(position, ZERO_64_LOW);\n}\n\nvec3 project_position(vec3 position, vec3 position64Low) {\n  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);\n  return projected_position.xyz;\n}\n\nvec3 project_position(vec3 position) {\n  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);\n  return projected_position.xyz;\n}\n\nvec2 project_position(vec2 position) {\n  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);\n  return projected_position.xy;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  return viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;\n  return offset * project_uFocalDistance;\n}\n\nfloat project_size_to_pixel(float meters) {\n  return project_size(meters) * project_uScale;\n}\nfloat project_size_to_pixel(float size, int unit) {\n  if (unit == UNIT_METERS) return project_size_to_pixel(size);\n  if (unit == UNIT_COMMON) return size * project_uScale;\n  return size;\n}\nfloat project_pixel_size(float pixels) {\n  return pixels / project_uScale;\n}\nvec2 project_pixel_size(vec2 pixels) {\n  return pixels / project_uScale;\n}\n"),Tv={};const Av={name:"project",dependencies:[bv,xv],vs:Cv,getUniforms:function(e=Tv){return e.viewport?function({viewport:e,devicePixelRatio:t=1,modelMatrix:n=null,coordinateSystem:i=uu.DEFAULT,coordinateOrigin:r,autoWrapLongitude:s=!1}={}){i===uu.DEFAULT&&(i=e.isGeospatial?uu.LNGLAT:uu.CARTESIAN);const o=Dm({viewport:e,devicePixelRatio:t,coordinateSystem:i,coordinateOrigin:r});return o.project_uWrapLongitude=s,o.project_uModelMatrix=n||Om,o}(e):{}}},kv={name:"project32",dependencies:[Av],vs:"\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64Low);\n  mat3 rotation;\n  if (project_needs_rotation(projectedPosition, rotation)) {\n    // offset is specified as ENU\n    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe\n    offset = rotation * offset;\n  }\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64Low, offset, commonPosition);\n}\n"},Nv={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingActive:!1,pickingAttribute:!1};const Mv={name:"picking",vs:"uniform bool picking_uActive;\nuniform bool picking_uAttribute;\nuniform vec3 picking_uSelectedColor;\nuniform bool picking_uSelectedColorValid;\n\nout vec4 picking_vRGBcolor_Avalid;\n\nconst float COLOR_SCALE = 1. / 255.;\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.001;\n}\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    picking_uSelectedColorValid &&\n    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));\n}\n\nvoid picking_setPickingColor(vec3 pickingColor) {\n  if (picking_uActive) {\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    if (!picking_uAttribute) {\n      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;\n    }\n  } else {\n    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\nvoid picking_setPickingAttribute(vec2 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\nvoid picking_setPickingAttribute(vec3 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n",fs:"uniform bool picking_uActive;\nuniform vec3 picking_uSelectedColor;\nuniform vec4 picking_uHighlightColor;\n\nin vec4 picking_vRGBcolor_Avalid;\nvec4 picking_filterHighlightColor(vec4 color) {\n  if (picking_uActive) {\n    return color;\n  }\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    float highLightAlpha = picking_uHighlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\nvec4 picking_filterPickingColor(vec4 color) {\n  if (picking_uActive) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\nvec4 picking_filterColor(vec4 color) {\n  vec4 highightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highightColor);\n}\n\n",getUniforms:function(e=Nv){const t={};if(void 0!==e.pickingSelectedColor)if(e.pickingSelectedColor){const n=e.pickingSelectedColor.slice(0,3);t.picking_uSelectedColorValid=1,t.picking_uSelectedColor=n}else t.picking_uSelectedColorValid=0;if(e.pickingHighlightColor){const n=Array.from(e.pickingHighlightColor,(e=>e/255));Number.isFinite(n[3])||(n[3]=1),t.picking_uHighlightColor=n}return void 0!==e.pickingActive&&(t.picking_uActive=Boolean(e.pickingActive),t.picking_uAttribute=Boolean(e.pickingAttribute)),t}},Pv={inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    // for picking depth values\n    picking_setPickingAttribute(position.z / position.w);\n  ","vs:DECKGL_FILTER_COLOR":"\n  picking_setPickingColor(geometry.pickingColor);\n  ","fs:DECKGL_FILTER_COLOR":{order:99,injection:"\n  // use highlight color if this fragment belongs to the selected object.\n  color = picking_filterHighlightColor(color);\n\n  // use picking color if rendering to picking FBO.\n  color = picking_filterPickingColor(color);\n    "}},...Mv},Lv={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Geometry{static get DRAW_MODE(){return Lv}constructor(e={}){const{id:t=vd("geometry"),drawMode:n=Lv.TRIANGLES,attributes:i={},indices:r=null,vertexCount:s=null}=e;this.id=t,this.drawMode=0|n,this.attributes={},this.userData={},this._setAttributes(i,r),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){t&&(this.indices=ArrayBuffer.isView(t)?{value:t,size:1}:t);for(const t in e){let n=e[t];n=ArrayBuffer.isView(n)?{value:n}:n,fd(ArrayBuffer.isView(n.value),`${this._print(t)}: must be typed array or object with value as typed array`),"POSITION"!==t&&"positions"!==t||n.size||(n.size=3),"indices"===t?(fd(!this.indices),this.indices=n):this.attributes[t]=n}return this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,t){if(t)return t.value.length;let n=1/0;for(const t in e){const i=e[t],{value:r,size:s,constant:o}=i;!o&&r&&s>=1&&(n=Math.min(n,r.length/s))}return fd(Number.isFinite(n)),n}}function Ov(e,t){if(!e)throw new Error(t||"loader assertion failed.")}"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,void 0!==n.g&&n.g,"undefined"!=typeof document&&document;const Rv=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser),Iv="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version),{_parseImageNode:Dv}=(Iv&&parseFloat(Iv[1]),globalThis),Fv="undefined"!=typeof Image,Bv="undefined"!=typeof ImageBitmap,zv=Boolean(Dv),jv=!!Rv||zv;function Vv(e){const t=Hv(e);if(!t)throw new Error("Not an image");return t}function Uv(e){switch(Vv(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("getImageData");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function Hv(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&e instanceof Image?"image":e&&"object"==typeof e&&e.data&&e.width&&e.height?"data":null}const $v=/^data:image\/svg\+xml/,qv=/\.svg((\?|#).*)?$/;function Wv(e){return e&&($v.test(e)||qv.test(e))}function Gv(e,t){if(Wv(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function Yv(e,t,n){const i=function(e,t){if(Wv(t)){let t=(new TextDecoder).decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(e){throw new Error(e.message)}return"data:image/svg+xml;base64,".concat(btoa(t))}return Gv(e,t)}(e,n),r=self.URL||self.webkitURL,s="string"!=typeof i&&r.createObjectURL(i);try{return await async function(e,t){const n=new Image;if(n.src=e,t.image&&t.image.decode&&n.decode)return await n.decode(),n;return await new Promise(((t,i)=>{try{n.onload=()=>t(n),n.onerror=t=>i(new Error("Could not load image ".concat(e,": ").concat(t)))}catch(e){i(e)}}))}(s||i,t)}finally{s&&r.revokeObjectURL(s)}}const Xv={};let Kv=!0;async function Zv(e,t,n){let i;if(Wv(n)){i=await Yv(e,t,n)}else i=Gv(e,n);const r=t&&t.imagebitmap;return await async function(e,t=null){!function(e){for(const t in e||Xv)return!1;return!0}(t)&&Kv||(t=null);if(t)try{return await createImageBitmap(e,t)}catch(e){console.warn(e),Kv=!1}return await createImageBitmap(e)}(i,r)}const Jv=!1,Qv=!0;function eb(e){const t=tb(e);return function(e){const t=tb(e);if(!(t.byteLength>=24&&2303741511===t.getUint32(0,Jv)))return null;return{mimeType:"image/png",width:t.getUint32(16,Jv),height:t.getUint32(20,Jv)}}(t)||function(e){const t=tb(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,Jv)&&255===t.getUint8(2)))return null;const{tableMarkers:n,sofMarkers:i}=function(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);const t=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:e,sofMarkers:t}}();let r=2;for(;r+9<t.byteLength;){const e=t.getUint16(r,Jv);if(i.has(e))return{mimeType:"image/jpeg",height:t.getUint16(r+5,Jv),width:t.getUint16(r+7,Jv)};if(!n.has(e))return null;r+=2,r+=t.getUint16(r,Jv)}return null}(t)||function(e){const t=tb(e);if(!(t.byteLength>=10&&1195984440===t.getUint32(0,Jv)))return null;return{mimeType:"image/gif",width:t.getUint16(6,Qv),height:t.getUint16(8,Qv)}}(t)||function(e){const t=tb(e);if(!(t.byteLength>=14&&16973===t.getUint16(0,Jv)&&t.getUint32(2,Qv)===t.byteLength))return null;return{mimeType:"image/bmp",width:t.getUint32(18,Qv),height:t.getUint32(22,Qv)}}(t)}function tb(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}const nb={id:"image",module:"images",name:"Images",version:"3.2.3",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:async function(e,t,n){const i=((t=t||{}).image||{}).type||"auto",{url:r}=n||{},s=function(e){switch(e){case"auto":case"data":return function(){if(Bv)return"imagebitmap";if(Fv)return"image";if(jv)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return Bv||Fv||jv;case"imagebitmap":return Bv;case"image":return Fv;case"data":return jv;default:throw new Error("@loaders.gl/images: image ".concat(e," not supported in this environment"))}}(e),e}}(i);let o;switch(s){case"imagebitmap":o=await Zv(e,t,r);break;case"image":o=await Yv(e,t,r);break;case"data":o=await async function(e,t){const{mimeType:n}=eb(e)||{},i=globalThis._parseImageNode;return Ov(i),await i(e,n)}(e);break;default:Ov(!1)}return"data"===i&&(o=Uv(o)),o},tests:[e=>Boolean(eb(new DataView(e)))],options:{image:{type:"auto",decode:!0}}},ib=()=>{},rb={10241:9987,10240:9729,10242:33071,10243:33071};function sb(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function ob(e,t,n,i){return n===t.width&&i===t.height?t:(e.canvas.height=i,e.canvas.width=n,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.drawImage(t,0,0,t.width,t.height,0,0,n,i),e.canvas)}function ab(e){return e&&(e.id||e.url)}function lb(e,t,n,i){const r=t.width,s=t.height,o=$d(t,{width:n,height:i});return function(e,t,n={}){const{sourceX:i=0,sourceY:r=0,targetMipmaplevel:s=0,targetInternalFormat:o=6408}=n;let{targetX:a,targetY:l,targetZ:c,width:u,height:d}=n;const{framebuffer:h,deleteFramebuffer:p}=Yd(e);fd(h);const{gl:f,handle:m}=h,g=void 0!==a||void 0!==l||void 0!==c;a=a||0,l=l||0,c=c||0;const y=f.bindFramebuffer(36160,m);fd(t);let v=null;if(t instanceof Texture&&(v=t,u=Number.isFinite(u)?u:v.width,d=Number.isFinite(d)?d:v.height,v.bind(0),t=v.target),g)switch(t){case 3553:case 34067:f.copyTexSubImage2D(t,s,a,l,i,r,u,d);break;case 35866:case 32879:_u(f).copyTexSubImage3D(t,s,a,l,c,i,r,u,d)}else f.copyTexImage2D(t,s,o,i,r,u,d,0);v&&v.unbind(),f.bindFramebuffer(36160,y||null),p&&h.delete()}(t,o,{targetY:0,width:r,height:s}),t.delete(),o}function cb(e,t,n){for(let i=0;i<t.length;i++){const{icon:r,xOffset:s}=t[i];e[ab(r)]={...r,x:s,y:n}}}class IconManager{constructor(e,{onUpdate:t=ib,onError:n=ib}){this.gl=e,this.onUpdate=t,this.onError=n,this._loadOptions=null,this._getIcon=null,this._texture=null,this._externalTexture=null,this._mapping={},this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=4,this._canvasWidth=1024,this._canvasHeight=0,this._canvas=null}finalize(){var e;null===(e=this._texture)||void 0===e||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?ab(e):e;return this._mapping[t]||{}}setProps({loadOptions:e,autoPacking:t,iconAtlas:n,iconMapping:i,data:r,getIcon:s}){e&&(this._loadOptions=e),void 0!==t&&(this._autoPacking=t),s&&(this._getIcon=s),i&&(this._mapping=i),n&&this._updateIconAtlas(n),this._autoPacking&&(r||s)&&"undefined"!=typeof document&&(this._canvas=this._canvas||document.createElement("canvas"),this._updateAutoPacking(r))}get isLoaded(){return 0===this._pendingCount}_updateIconAtlas(e){var t;null===(t=this._texture)||void 0===t||t.delete(),this._texture=null,this._externalTexture=e,this.onUpdate()}_updateAutoPacking(e){const t=Object.values(function(e,t,n){if(!e||!t)return null;n=n||{};const i={},{iterable:r,objectInfo:s}=Bh(e);for(const e of r){s.index++;const r=t(e,s),o=ab(r);if(!r)throw new Error("Icon is missing.");if(!r.url)throw new Error("Icon url is missing.");i[o]||n[o]&&r.url===n[o].url||(i[o]={...r,source:e,sourceIndex:s.index})}return i}(e,this._getIcon,this._mapping)||{});if(t.length>0){const{mapping:e,xOffset:n,yOffset:i,rowHeight:r,canvasHeight:s}=function({icons:e,buffer:t,mapping:n={},xOffset:i=0,yOffset:r=0,rowHeight:s=0,canvasWidth:o}){let a=[];for(let l=0;l<e.length;l++){const c=e[l];if(!n[ab(c)]){const{height:e,width:l}=c;i+l+t>o&&(cb(n,a,r),i=0,r=s+r+t,s=0,a=[]),a.push({icon:c,xOffset:i}),i=i+l+t,s=Math.max(s,e)}}return a.length>0&&cb(n,a,r),{mapping:n,rowHeight:s,xOffset:i,yOffset:r,canvasWidth:o,canvasHeight:sb(s+r+t)}}({icons:t,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=r,this._mapping=e,this._xOffset=n,this._yOffset=i,this._canvasHeight=s,this._texture||(this._texture=new Texture2D(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:rb})),this._texture.height!==this._canvasHeight&&(this._texture=lb(this.gl,this._texture,this._canvasWidth,this._canvasHeight)),this.onUpdate(),this._loadIcons(t)}}_loadIcons(e){const t=this._canvas.getContext("2d");for(const n of e)this._pendingCount++,hv(n.url,nb,this._loadOptions).then((e=>{const i=ab(n),{x:r,y:s,width:o,height:a}=this._mapping[i],l=ob(t,e,o,a);this._texture.setSubImageData({data:l,x:r,y:s,width:o,height:a}),this._texture.generateMipmap(),this.onUpdate()})).catch((e=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:e})})).finally((()=>{this._pendingCount--}))}}const ub=[0,0,0,255],db={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:e=>e.position},getIcon:{type:"accessor",value:e=>e.icon},getColor:{type:"accessor",value:ub},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,compare:!1,optional:!0}};class IconLayer extends Layer{getShaders(){return super.getShaders({vs:"#define SHADER_NAME icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\nattribute float instanceColorModes;\nattribute vec2 instanceOffsets;\nattribute vec2 instancePixelOffset;\n\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform bool billboard;\nuniform int sizeUnits;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = angle * PI / 180.0;\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = positions;\n  geometry.pickingColor = instancePickingColors;\n  uv = positions;\n\n  vec2 iconSize = instanceIconFrames.zw;\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), \n    sizeMinPixels, sizeMaxPixels\n  );\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\n  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;\n  pixelOffset += instancePixelOffset;\n  pixelOffset.y *= -1.0;\n\n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); \n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTextureCoords = mix(\n    instanceIconFrames.xy,\n    instanceIconFrames.xy + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vColor = instanceColors;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n\n  vColorMode = instanceColorModes;\n}\n",fs:"#define SHADER_NAME icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float alphaCutoff;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\n  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\n  float a = texColor.a * opacity * vColor.a;\n\n  if (a < alphaCutoff) {\n    discard;\n  }\n\n  gl_FragColor = vec4(color, a);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[kv,Pv]})}initializeState(){this.state={iconManager:new IconManager(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})};this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:ub},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState({oldProps:e,props:t,changeFlags:n}){super.updateState({props:t,oldProps:e,changeFlags:n});const i=this.getAttributeManager(),{iconAtlas:r,iconMapping:s,data:o,getIcon:a}=t,{iconManager:l}=this.state;l.setProps({loadOptions:t.loadOptions});let c=!1;if(r||this.internalState.isAsyncPropLoading("iconAtlas")?(e.iconAtlas!==t.iconAtlas&&l.setProps({iconAtlas:r,autoPacking:!1}),e.iconMapping!==t.iconMapping&&(l.setProps({iconMapping:s}),c=!0)):l.setProps({autoPacking:!0}),(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getIcon))&&l.setProps({data:o,getIcon:a}),c&&(i.invalidate("instanceOffsets"),i.invalidate("instanceIconFrames"),i.invalidate("instanceColorModes")),n.extensionsChanged){var u;const{gl:e}=this.context;null===(u=this.state.model)||void 0===u||u.delete(),this.state.model=this._getModel(e),i.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(){super.finalizeState(),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeMinPixels:n,sizeMaxPixels:i,sizeUnits:r,billboard:s,alphaCutoff:o}=this.props,{iconManager:a}=this.state,l=a.getTexture();l&&this.state.model.setUniforms(e).setUniforms({iconsTexture:l,iconsTextureDim:[l.width,l.height],sizeUnits:hu[r],sizeScale:t,sizeMinPixels:n,sizeMaxPixels:i,billboard:s,alphaCutoff:o}).draw()}_getModel(e){return new Model(e,{...this.getShaders(),id:this.props.id,geometry:new Geometry({drawMode:6,attributes:{positions:{size:2,value:new Float32Array([-1,-1,-1,1,1,1,1,-1])}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){const{onIconError:t}=this.getCurrentLayer().props;t?t(e):cu.error(e.error)()}getInstanceOffset(e){const t=this.state.iconManager.getIconMapping(e);return[t.width/2-t.anchorX||0,t.height/2-t.anchorY||0]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const t=this.state.iconManager.getIconMapping(e);return[t.x||0,t.y||0,t.width||0,t.height||0]}}IconLayer.layerName="IconLayer",IconLayer.defaultProps=db;const hb=[0,0,0,255],pb={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:hb},getLineColor:{type:"accessor",value:hb},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class ScatterplotLayer extends Layer{getShaders(){return super.getShaders({vs:"#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceRadius;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float lineWidthScale;\nuniform float lineWidthMinPixels;\nuniform float lineWidthMaxPixels;\nuniform float stroked;\nuniform bool filled;\nuniform bool antialiasing;\nuniform bool billboard;\nuniform int radiusUnits;\nuniform int lineWidthUnits;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  outerRadiusPixels = clamp(\n    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),\n    radiusMinPixels, radiusMaxPixels\n  );\n  float lineWidthPixels = clamp(\n    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),\n    lineWidthMinPixels, lineWidthMaxPixels\n  );\n  outerRadiusPixels += stroked * lineWidthPixels / 2.0;\n  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;\n  unitPosition = edgePadding * positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n\n  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;\n  \n  if (billboard) {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    vec3 offset = edgePadding * positions * outerRadiusPixels;\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  } else {\n    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\n  }\n\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\n  DECKGL_FILTER_COLOR(vFillColor, geometry);\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\n  DECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#define SHADER_NAME scatterplot-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool filled;\nuniform float stroked;\nuniform bool antialiasing;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n\n  float distToCenter = length(unitPosition) * outerRadiusPixels;\n  float inCircle = antialiasing ? \n    smoothedge(distToCenter, outerRadiusPixels) : \n    step(distToCenter, outerRadiusPixels);\n\n  if (inCircle == 0.0) {\n    discard;\n  }\n\n  if (stroked > 0.5) {\n    float isLine = antialiasing ? \n      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :\n      step(innerUnitRadius * outerRadiusPixels, distToCenter);\n\n    if (filled) {\n      gl_FragColor = mix(vFillColor, vLineColor, isLine);\n    } else {\n      if (isLine == 0.0) {\n        discard;\n      }\n      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);\n    }\n  } else if (filled) {\n    gl_FragColor = vFillColor;\n  } else {\n    discard;\n  }\n\n  gl_FragColor.a *= inCircle;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[kv,Pv]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState({props:e,oldProps:t,changeFlags:n}){if(super.updateState({props:e,oldProps:t,changeFlags:n}),n.extensionsChanged){var i;const{gl:e}=this.context;null===(i=this.state.model)||void 0===i||i.delete(),this.state.model=this._getModel(e),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{radiusUnits:t,radiusScale:n,radiusMinPixels:i,radiusMaxPixels:r,stroked:s,filled:o,billboard:a,antialiasing:l,lineWidthUnits:c,lineWidthScale:u,lineWidthMinPixels:d,lineWidthMaxPixels:h}=this.props;this.state.model.setUniforms(e).setUniforms({stroked:s?1:0,filled:o,billboard:a,antialiasing:l,radiusUnits:hu[t],radiusScale:n,radiusMinPixels:i,radiusMaxPixels:r,lineWidthUnits:hu[c],lineWidthScale:u,lineWidthMinPixels:d,lineWidthMaxPixels:h}).draw()}_getModel(e){return new Model(e,{...this.getShaders(),id:this.props.id,geometry:new Geometry({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0])}}}),isInstanced:!0})}}ScatterplotLayer.layerName="ScatterplotLayer",ScatterplotLayer.defaultProps=pb;const fb=[];class MultiIconLayer extends IconLayer{getShaders(){return{...super.getShaders(),fs:"#define SHADER_NAME multi-icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float gamma;\nuniform bool sdf;\nuniform float alphaCutoff;\nuniform float buffer;\nuniform float outlineBuffer;\nuniform vec4 outlineColor;\n\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  if (!picking_uActive) {\n    float alpha = texture2D(iconsTexture, vTextureCoords).a;\n    vec4 color = vColor;\n    if (sdf) {\n      float distance = alpha;\n      alpha = smoothstep(buffer - gamma, buffer + gamma, distance);\n\n      if (outlineBuffer > 0.0) {\n        float inFill = alpha;\n        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);\n        color = mix(outlineColor, vColor, inFill);\n        alpha = inBorder;\n      }\n    }\n    float a = alpha * color.a;\n    \n    if (a < alphaCutoff) {\n      discard;\n    }\n\n    gl_FragColor = vec4(color.rgb, a * opacity);\n  }\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"}}initializeState(){super.initializeState();this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(e,{index:t,target:n})=>this.encodePickingColor(t,n)}})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;let{outlineColor:i}=t;i!==n.outlineColor&&(i=i.map((e=>e/255)),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!t.sdf&&t.outlineWidth&&cu.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){const{sdf:t,smoothing:n,outlineWidth:i}=this.props,{outlineColor:r}=this.state;e.uniforms={...e.uniforms,buffer:.75,outlineBuffer:i?Math.max(n,.75*(1-i)):-1,gamma:n,sdf:Boolean(t),outlineColor:r},super.draw(e)}getInstanceOffset(e){return e?Array.from(e).map((e=>super.getInstanceOffset(e))):fb}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).map((e=>super.getInstanceIconFrame(e))):fb}}MultiIconLayer.layerName="MultiIconLayer",MultiIconLayer.defaultProps={getIconOffsets:{type:"accessor",value:e=>e.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};var mb=n(5886),gb=n.n(mb);const yb=[];function vb(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function bb(e,t,n,i){let r=0;for(let s=t;s<n;s++){const t=e[s];let n=null;const o=i&&i[t];o&&(n=o.width),r+=n}return r}function wb(e,t,n,i,r,s){let o=t,a=0;for(let l=t;l<n;l++){const t=bb(e,l,l+1,r);a+t>i&&(o<l&&s.push(l),o=l,a=0),a+=t}return a}function xb(e,t,n,i,r=0,s){void 0===s&&(s=e.length);const o=[];return"break-all"===t?wb(e,r,s,n,i,o):function(e,t,n,i,r,s){let o=t,a=t,l=t,c=0;for(let u=t;u<n;u++)if(" "===e[u]?l=u+1:" "!==e[u+1]&&u+1!==n||(l=u+1),l>a){let t=bb(e,a,l,r);c+t>i&&(o<a&&(s.push(a),o=a,c=0),t>i&&(t=wb(e,a,l,i,r,s),o=s[s.length-1])),a=l,c+=t}}(e,r,s,n,i,o),o}function _b(e,t,n,i,r,s){let o=0,a=0;for(let s=t;s<n;s++){const t=e[s],n=i[t];n?(a||(a=n.height),r[s]=o+n.width/2,o+=n.width):(cu.warn("Missing character: ".concat(t," (").concat(t.codePointAt(0),")"))(),r[s]=o,o+=32)}s[0]=o,s[1]=a}function Eb(e,t,n,i,r){const s=(e=Array.from(e)).length,o=new Array(s),a=new Array(s),l=new Array(s),c=("break-word"===n||"break-all"===n)&&isFinite(i)&&i>0,u=[0,0],d=[];let h=0,p=0,f=0;for(let m=0;m<=s;m++){const g=e[m];if("\n"!==g&&m!==s||(f=m),f>p){const s=c?xb(e,n,i,r,p,f):yb;for(let n=0;n<=s.length;n++){const i=0===n?p:s[n-1],c=n<s.length?s[n]:f;_b(e,i,c,r,o,d);for(let e=i;e<c;e++)a[e]=h+d[1]/2,l[e]=d[0];h+=d[1]*t,u[0]=Math.max(u[0],d[0])}p=f}"\n"===g&&(o[p]=0,a[p]=0,l[p]=0,p++)}return u[1]=h,{x:o,y:a,rowWidth:l,size:u}}class LRUCache{constructor(e=5){this.limit=e,this.clear()}clear(){this._cache={},this._order=[]}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(this._deleteCache(e),this._deleteOrder(e))}_deleteCache(e){delete this._cache[e]}_deleteOrder(e){const t=this._order.findIndex((t=>t===e));t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}const Sb=function(){const e=[];for(let t=32;t<128;t++)e.push(String.fromCharCode(t));return e}(),Cb="Monaco, monospace",Tb="normal";let Ab=new LRUCache(3);const kb=["fontFamily","fontWeight","characterSet","fontSize","sdf","buffer","cutoff","radius"];function Nb(e,t){for(let n=0;n<e.length;n++)t.data[4*n+3]=e[n]}function Mb(e,t,n,i){e.font="".concat(i," ").concat(n,"px ").concat(t),e.fillStyle="#000",e.textBaseline="baseline",e.textAlign="left"}class FontAtlasManager{constructor(){this.props={fontFamily:Cb,fontWeight:Tb,characterSet:Sb,fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12},this._key=null,this._atlas=null}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){return 1.2}setProps(e={}){kb.forEach((t=>{t in e&&(this.props[t]=e[t])}));const t=this._key;this._key=this._getKey();const n=function(e,t){const n=Ab.get(e);if(!n)return t;const i=[],r=n.mapping;let s=Object.keys(r);s=new Set(s);let o=t;return o instanceof Array&&(o=new Set(o)),o.forEach((e=>{s.has(e)||i.push(e)})),i}(this._key,this.props.characterSet),i=Ab.get(this._key);if(i&&0===n.length)return void(this._key!==t&&(this._atlas=i));const r=this._generateFontAtlas(this._key,n,i);this._atlas=r,Ab.set(this._key,r)}_generateFontAtlas(e,t,n){const{fontFamily:i,fontWeight:r,fontSize:s,buffer:o,sdf:a,radius:l,cutoff:c}=this.props;let u=n&&n.data;u||(u=document.createElement("canvas"),u.width=1024);const d=u.getContext("2d");Mb(d,i,s,r);const{mapping:h,canvasHeight:p,xOffset:f,yOffset:m}=function({characterSet:e,getFontWidth:t,fontHeight:n,buffer:i,maxCanvasWidth:r,mapping:s={},xOffset:o=0,yOffset:a=0}){let l=0,c=o,u=0;for(const o of e)if(!s[o]){const e=t(o,u++);c+e+2*i>r&&(c=0,l++),s[o]={x:c+i,y:a+l*(n+2*i)+i,width:e,height:n},c+=e+2*i}const d=n+2*i;return{mapping:s,xOffset:c,yOffset:a+l*d,canvasHeight:vb(a+(l+1)*d)}}({getFontWidth:e=>d.measureText(e).width,fontHeight:1.2*s,buffer:o,characterSet:t,maxCanvasWidth:1024,...n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset}});if(u.height!==p){const e=d.getImageData(0,0,u.width,u.height);u.height=p,d.putImageData(e,0,0)}if(Mb(d,i,s,r),a){const e=new(gb())(s,o,l,c,i,r),n=d.getImageData(0,0,e.size,e.size);for(const i of t)Nb(e.draw(i),n),d.putImageData(n,h[i].x-o,h[i].y+o)}else for(const e of t)d.fillText(e,h[e].x,h[e].y+.9*s);return{xOffset:f,yOffset:m,mapping:h,data:u,width:u.width,height:u.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:n,buffer:i,sdf:r,radius:s,cutoff:o}=this.props;return r?"".concat(e," ").concat(t," ").concat(n," ").concat(i," ").concat(s," ").concat(o):"".concat(e," ").concat(t," ").concat(n," ").concat(i)}}const Pb={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:e=>e.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class TextBackgroundLayer extends Layer{getShaders(){return super.getShaders({vs:"#define SHADER_NAME text-background-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute vec4 instanceRects;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec2 instancePixelOffsets;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform bool billboard;\nuniform float opacity;\nuniform float sizeScale;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform vec4 padding;\nuniform int sizeUnits;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying float vLineWidth;\nvarying vec2 uv;\nvarying vec2 dimensions;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = radians(angle);\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = positions;\n  geometry.pickingColor = instancePickingColors;\n  uv = positions;\n  vLineWidth = instanceLineWidths;\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),\n    sizeMinPixels, sizeMaxPixels\n  );\n\n  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;\n\n  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);\n  pixelOffset += instancePixelOffsets;\n  pixelOffset.y *= -1.0;\n\n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\n  DECKGL_FILTER_COLOR(vFillColor, geometry);\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\n  DECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#define SHADER_NAME text-background-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool stroked;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying float vLineWidth;\nvarying vec2 uv;\nvarying vec2 dimensions;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  vec2 pixelPosition = uv * dimensions;\n  if (stroked) {\n    float distToEdge = min(\n      min(pixelPosition.x, dimensions.x - pixelPosition.x),\n      min(pixelPosition.y, dimensions.y - pixelPosition.y)\n    );\n    float isBorder = smoothedge(distToEdge, vLineWidth);\n    gl_FragColor = mix(vFillColor, vLineColor, isBorder);\n  } else {\n    gl_FragColor = vFillColor;\n  }\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[kv,Pv]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState({props:e,oldProps:t,changeFlags:n}){if(super.updateState({props:e,oldProps:t,changeFlags:n}),n.extensionsChanged){var i;const{gl:e}=this.context;null===(i=this.state.model)||void 0===i||i.delete(),this.state.model=this._getModel(e),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{billboard:t,sizeScale:n,sizeUnits:i,sizeMinPixels:r,sizeMaxPixels:s,getLineWidth:o}=this.props;let{padding:a}=this.props;a.length<4&&(a=[a[0],a[1],a[0],a[1]]),this.state.model.setUniforms(e).setUniforms({billboard:t,stroked:Boolean(o),padding:a,sizeUnits:hu[i],sizeScale:n,sizeMinPixels:r,sizeMaxPixels:s}).draw()}_getModel(e){return new Model(e,{...this.getShaders(),id:this.props.id,geometry:new Geometry({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array([0,0,1,0,1,1,0,1])}}}),isInstanced:!0})}}TextBackgroundLayer.layerName="TextBackgroundLayer",TextBackgroundLayer.defaultProps=Pb;const Lb={fontSize:64,buffer:4,sdf:!1,radius:12,cutoff:.25,smoothing:.1},Ob={start:1,middle:0,end:-1},Rb={top:1,center:0,bottom:-1},Ib=[0,0,0,255],Db=["fontSize","buffer","sdf","radius","cutoff"],Fb={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:Ib},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Sb},fontFamily:Cb,fontWeight:Tb,lineHeight:1,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:Ib},fontSettings:{},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:e=>e.text},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:Ib},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class TextLayer extends CompositeLayer{initializeState(){this.state={styleVersion:0,fontAtlasManager:new FontAtlasManager}}updateState({props:e,oldProps:t,changeFlags:n}){const i=n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getText),r=this.state.characterSet;i&&this._updateText();const s=r!==this.state.characterSet||this._fontChanged(t,e);s&&this._updateFontAtlas(t,e);(s||e.lineHeight!==t.lineHeight||e.wordBreak!==t.wordBreak||e.maxWidth!==t.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(e,t){const{fontSettings:n,fontFamily:i,fontWeight:r}=t,{fontAtlasManager:s,characterSet:o}=this.state;s.setProps({...Lb,...n,characterSet:o,fontFamily:i,fontWeight:r})}_fontChanged(e,t){if(e.fontFamily!==t.fontFamily||e.fontWeight!==t.fontWeight)return!0;if(e.fontSettings===t.fontSettings)return!1;const n=e.fontSettings||{},i=t.fontSettings||{};return Db.some((e=>n[e]!==i[e]))}_updateText(){const{data:e,characterSet:t}=this.props,n=e.attributes&&e.attributes.getText;let i,{getText:r}=this.props,{startIndices:s}=e;const o="auto"===t&&new Set;if(n&&s){const{texts:t,characterCount:a}=function({value:e,length:t,stride:n,offset:i,startIndices:r,characterSet:s}){const o=e.BYTES_PER_ELEMENT,a=n?n/o:1,l=i?i/o:0,c=r[t]||Math.ceil((e.length-l)/a),u=s&&new Set,d=new Array(t);let h=e;if(a>1||l>0){h=new e.constructor(c);for(let t=0;t<c;t++)h[t]=e[t*a+l]}for(let e=0;e<t;e++){const t=r[e],n=r[e+1]||c,i=h.subarray(t,n);d[e]=String.fromCodePoint.apply(null,i),u&&i.forEach(u.add,u)}if(u)for(const e of u)s.add(String.fromCodePoint(e));return{texts:d,characterCount:c}}({...ArrayBuffer.isView(n)?{value:n}:n,length:e.length,startIndices:s,characterSet:o});i=a,r=(e,{index:n})=>t[n]}else{const{iterable:t,objectInfo:n}=Bh(e);s=[0],i=0;for(const e of t){n.index++;const t=Array.from(r(e,n)||"");o&&t.forEach(o.add,o),i+=t.length,s.push(i)}}this.setState({getText:r,startIndices:s,numInstances:i,characterSet:o||t})}getBoundingRect(e,t){const n=this.state.fontAtlasManager.mapping,{getText:i}=this.state,{wordBreak:r,maxWidth:s,lineHeight:o,getTextAnchor:a,getAlignmentBaseline:l}=this.props,c=i(e,t)||"",{size:[u,d]}=Eb(c,o,r,s,n);return[(Ob["function"==typeof a?a(e,t):a]-1)*u/2,(Rb["function"==typeof l?l(e,t):l]-1)*d/2,u,d]}getIconOffsets(e,t){const n=this.state.fontAtlasManager.mapping,{getText:i}=this.state,{wordBreak:r,maxWidth:s,lineHeight:o,getTextAnchor:a,getAlignmentBaseline:l}=this.props,c=i(e,t)||"",{x:u,y:d,rowWidth:h,size:[p,f]}=Eb(c,o,r,s,n),m=Ob["function"==typeof a?a(e,t):a],g=Rb["function"==typeof l?l(e,t):l],y=u.length,v=new Array(2*y);let b=0;for(let e=0;e<y;e++){const t=(1-m)*(p-h[e])/2;v[b++]=(m-1)*p/2+t+u[e],v[b++]=(g-1)*f/2+d[e]}return v}renderLayers(){const{startIndices:e,numInstances:t,getText:n,fontAtlasManager:{scale:i,texture:r,mapping:s},styleVersion:o}=this.state,{data:a,_dataDiff:l,getPosition:c,getColor:u,getSize:d,getAngle:h,getPixelOffset:p,getBackgroundColor:f,getBorderColor:m,getBorderWidth:g,backgroundPadding:y,background:v,billboard:b,fontSettings:w,outlineWidth:x,outlineColor:_,sizeScale:E,sizeUnits:S,sizeMinPixels:C,sizeMaxPixels:T,transitions:A,updateTriggers:k}=this.props,N=this.getSubLayerClass("characters",MultiIconLayer),M=this.getSubLayerClass("background",TextBackgroundLayer);return[v&&new M({getFillColor:f,getLineColor:m,getLineWidth:g,padding:y,getPosition:c,getSize:d,getAngle:h,getPixelOffset:p,billboard:b,sizeScale:E/this.state.fontAtlasManager.props.fontSize,sizeUnits:S,sizeMinPixels:C,sizeMaxPixels:T,transitions:A&&{getPosition:A.getPosition,getAngle:A.getAngle,getSize:A.getSize,getFillColor:A.getBackgroundColor,getLineColor:A.getBorderColor,getLineWidth:A.getBorderWidth,getPixelOffset:A.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:k.getPosition,getAngle:k.getAngle,getSize:k.getSize,getFillColor:k.getBackgroundColor,getLineColor:k.getBorderColor,getLineWidth:k.getBorderWidth,getPixelOffset:k.getPixelOffset,getBoundingRect:{getText:k.getText,getTextAnchor:k.getTextAnchor,getAlignmentBaseline:k.getAlignmentBaseline,styleVersion:o}}}),{data:a.attributes&&a.attributes.background?{length:a.length,attributes:a.attributes.background}:a,_dataDiff:l,autoHighlight:!1,getBoundingRect:this.getBoundingRect.bind(this)}),new N({sdf:w.sdf,smoothing:Number.isFinite(w.smoothing)?w.smoothing:Lb.smoothing,outlineWidth:x,outlineColor:_,iconAtlas:r,iconMapping:s,getPosition:c,getColor:u,getSize:d,getAngle:h,getPixelOffset:p,billboard:b,sizeScale:E*i,sizeUnits:S,sizeMinPixels:C*i,sizeMaxPixels:T*i,transitions:A&&{getPosition:A.getPosition,getAngle:A.getAngle,getColor:A.getColor,getSize:A.getSize,getPixelOffset:A.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getIcon:k.getText,getPosition:k.getPosition,getAngle:k.getAngle,getColor:k.getColor,getSize:k.getSize,getPixelOffset:k.getPixelOffset,getIconOffsets:{getText:k.getText,getTextAnchor:k.getTextAnchor,getAlignmentBaseline:k.getAlignmentBaseline,styleVersion:o}}}),{data:a,_dataDiff:l,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets.bind(this),getIcon:n})]}static set fontAtlasCacheLimit(e){!function(e){cu.assert(Number.isFinite(e)&&e>=3,"Invalid cache limit"),Ab=new LRUCache(e)}(e)}}TextLayer.layerName="TextLayer",TextLayer.defaultProps=Fb;class Tesselator{constructor(e={}){const{attributes:t={}}=e;this.typedArrayManager=th,this.indexStarts=null,this.vertexStarts=null,this.vertexCount=0,this.instanceCount=0,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e),Object.seal(this)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:n={},getGeometry:i,geometryBuffer:r,positionFormat:s,dataChanged:o,normalize:a=!0}=this.opts;if(this.data=t,this.getGeometry=i,this.positionSize=r&&r.size||("XY"===s?2:3),this.buffers=n,this.normalize=a,r&&(Ih(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(r),a||(n.positions=r)),this.geometryBuffer=n.positions,Array.isArray(o))for(const e of o)this._rebuildGeometry(e);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}normalizeGeometry(e){return e}updateGeometryAttributes(e,t,n){throw new Error("Not implemented")}getGeometrySize(e){throw new Error("Not implemented")}getGeometryFromBuffer(e){const t=e.value||e;return Ih(ArrayBuffer.isView(t)),jh(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices})}_allocate(e,t){const{attributes:n,buffers:i,_attributeDefs:r,typedArrayManager:s}=this;for(const o in r)if(o in i)s.release(n[o]),n[o]=null;else{const i=r[o];i.copy=t,n[o]=s.allocate(n[o],e,i)}}_forEachGeometry(e,t,n){const{data:i,getGeometry:r}=this,{iterable:s,objectInfo:o}=Bh(i,t,n);for(const t of s){o.index++;e(r(t,o),o.index)}}_rebuildGeometry(e){if(!this.data||!this.getGeometry)return;let{indexStarts:t,vertexStarts:n,instanceCount:i}=this;const{data:r,geometryBuffer:s}=this,{startRow:o=0,endRow:a=1/0}=e||{},l={};if(e||(t=[0],n=[0]),this.normalize||!s)this._forEachGeometry(((e,t)=>{e=this.normalizeGeometry(e),l[t]=e,n[t+1]=n[t]+this.getGeometrySize(e)}),o,a),i=n[n.length-1];else if(s.buffer instanceof buffer_Buffer){const e=s.stride||4*this.positionSize;n=r.startIndices,i=n[r.length]||s.buffer.byteLength/e}else{const e=s.value||s,t=s.stride/e.BYTES_PER_ELEMENT||this.positionSize;n=r.startIndices,i=n[r.length]||e.length/t}this._allocate(i,Boolean(e)),this.indexStarts=t,this.vertexStarts=n,this.instanceCount=i;const c={};this._forEachGeometry(((e,r)=>{e=l[r]||e,c.vertexStart=n[r],c.indexStart=t[r];const s=r<n.length-1?n[r+1]:i;c.geometrySize=s-n[r],c.geometryIndex=r,this.updateGeometryAttributes(e,c)}),o,a),this.vertexCount=t[t.length-1]}}let Bb;function zb(e,t,n={}){const i=function(e,t={}){return Math.sign(function(e,t={}){const{start:n=0,end:i=e.length}=t,r=t.size||2;let s=0;for(let t=n,o=i-r;t<i;t+=r)s+=(e[t]-e[o])*(e[t+1]+e[o+1]),o=t;return s/2}(e,t))}(e,n);return i!==t&&(function(e,t){const{start:n=0,end:i=e.length,size:r=2}=t,s=(i-n)/r,o=Math.floor(s/2);for(let t=0;t<o;++t){const i=n+t*r,o=n+(s-1-t)*r;for(let t=0;t<r;++t){const n=e[i+t];e[i+t]=e[o+t],e[o+t]=n}}}(e,n),!0)}!function(e){e[e.CLOCKWISE=1]="CLOCKWISE",e[e.COUNTER_CLOCKWISE=-1]="COUNTER_CLOCKWISE"}(Bb||(Bb={}));function jb(e,t,n,i,r=[]){let s,o;if(8&n)s=(i[3]-e[1])/(t[1]-e[1]),o=3;else if(4&n)s=(i[1]-e[1])/(t[1]-e[1]),o=1;else if(2&n)s=(i[2]-e[0])/(t[0]-e[0]),o=2;else{if(!(1&n))return null;s=(i[0]-e[0])/(t[0]-e[0]),o=0}for(let n=0;n<e.length;n++)r[n]=(1&o)===n?i[o]:s*(t[n]-e[n])+e[n];return r}function Vb(e,t){let n=0;return e[0]<t[0]?n|=1:e[0]>t[2]&&(n|=2),e[1]<t[1]?n|=4:e[1]>t[3]&&(n|=8),n}function Ub(e,t){const n=t.length,i=e.length;if(i>0){let r=!0;for(let s=0;s<n;s++)if(e[i-n+s]!==t[s]){r=!1;break}if(r)return!1}for(let r=0;r<n;r++)e[i+r]=t[r];return!0}function Hb(e,t){const n=t.length;for(let i=0;i<n;i++)e[i]=t[i]}function $b(e,t,n,i,r=[]){const s=i+t*n;for(let t=0;t<n;t++)r[t]=e[s+t];return r}function qb(e,t){const{size:n=2,broken:i=!1,gridResolution:r=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:a=e.length}=t||{},l=(a-o)/n;let c=[];const u=[c],d=$b(e,0,n,o);let h,p;const f=Xb(d,r,s,[]),m=[];Ub(c,d);for(let t=1;t<l;t++){for(h=$b(e,t,n,o,h),p=Vb(h,f);p;){jb(d,h,p,f,m);const e=Vb(m,f);e&&(jb(d,m,e,f,m),p=e),Ub(c,m),Hb(d,m),Kb(f,r,p),i&&c.length>n&&(c=[],u.push(c),Ub(c,d)),p=Vb(h,f)}Ub(c,h),Hb(d,h)}return i?u:u[0]}function Wb(e,t){for(let n=0;n<t.length;n++)e.push(t[n]);return e}function Gb(e,t=null,n){if(!e.length)return[];const{size:i=2,gridResolution:r=10,gridOffset:s=[0,0],edgeTypes:o=!1}=n||{},a=[],l=[{pos:e,types:o?new Array(e.length/i).fill(1):null,holes:t||[]}],c=[[],[]];let u=[];for(;l.length;){const{pos:e,types:t,holes:n}=l.shift();Zb(e,i,n[0]||e.length,c),u=Xb(c[0],r,s,u);const d=Vb(c[1],u);if(d){let r=Yb(e,t,i,0,n[0]||e.length,u,d);const s={pos:r[0].pos,types:r[0].types,holes:[]},a={pos:r[1].pos,types:r[1].types,holes:[]};l.push(s,a);for(let l=0;l<n.length;l++)r=Yb(e,t,i,n[l],n[l+1]||e.length,u,d),r[0]&&(s.holes.push(s.pos.length),s.pos=Wb(s.pos,r[0].pos),o&&(s.types=Wb(s.types,r[0].types))),r[1]&&(a.holes.push(a.pos.length),a.pos=Wb(a.pos,r[1].pos),o&&(a.types=Wb(a.types,r[1].types)))}else{const i={positions:e};o&&(i.edgeTypes=t),n.length&&(i.holeIndices=n),a.push(i)}}return a}function Yb(e,t,n,i,r,s,o){const a=(r-i)/n,l=[],c=[],u=[],d=[],h=[];let p,f,m;const g=$b(e,a-1,n,i);let y=Math.sign(8&o?g[1]-s[3]:g[0]-s[2]),v=t&&t[a-1],b=0,w=0;for(let r=0;r<a;r++)p=$b(e,r,n,i,p),f=Math.sign(8&o?p[1]-s[3]:p[0]-s[2]),m=t&&t[i/n+r],f&&y&&y!==f&&(jb(g,p,o,s,h),Ub(l,h)&&u.push(v),Ub(c,h)&&d.push(v)),f<=0?(Ub(l,p)&&u.push(m),b-=f):u.length&&(u[u.length-1]=0),f>=0?(Ub(c,p)&&d.push(m),w+=f):d.length&&(d[d.length-1]=0),Hb(g,p),y=f,v=m;return[b?{pos:l,types:t&&u}:null,w?{pos:c,types:t&&d}:null]}function Xb(e,t,n,i){const r=Math.floor((e[0]-n[0])/t)*t+n[0],s=Math.floor((e[1]-n[1])/t)*t+n[1];return i[0]=r,i[1]=s,i[2]=r+t,i[3]=s+t,i}function Kb(e,t,n){8&n?(e[1]+=t,e[3]+=t):4&n?(e[1]-=t,e[3]-=t):2&n?(e[0]+=t,e[2]+=t):1&n&&(e[0]-=t,e[2]-=t)}function Zb(e,t,n,i){let r=1/0,s=-1/0,o=1/0,a=-1/0;for(let i=0;i<n;i+=t){const t=e[i],n=e[i+1];r=t<r?t:r,s=t>s?t:s,o=n<o?n:o,a=n>a?n:a}return i[0][0]=r,i[0][1]=o,i[1][0]=s,i[1][1]=a,i}function Jb(e,t,n,i){let r=-1,s=-1;for(let o=n+1;o<i;o+=t){const t=Math.abs(e[o]);t>r&&(r=t,s=o-1)}return s}function Qb(e,t,n,i,r=85.051129){const s=e[n],o=e[i-t];if(Math.abs(s-o)>180){const i=$b(e,0,t,n);i[0]+=360*Math.round((o-s)/360),Ub(e,i),i[1]=Math.sign(i[1])*r,Ub(e,i),i[0]=s,Ub(e,i)}}function ew(e,t,n,i){let r,s=e[0];for(let o=n;o<i;o+=t){r=e[o];const t=r-s;(t>180||t<-180)&&(r-=360*Math.round(t/360)),e[o]=s=r}}function tw(e,t){let n;const i=e.length/t;for(let r=0;r<i&&(n=e[r*t],(n+180)%360==0);r++);const r=360*-Math.round(n/360);if(0!==r)for(let n=0;n<i;n++)e[n*t]+=r}function nw(e,t,n,i){let r=e;if(Array.isArray(e[0])){const n=e.length*t;r=new Array(n);for(let n=0;n<e.length;n++)for(let i=0;i<t;i++)r[n*t+i]=e[n][i]||0}return n?qb(r,{size:t,gridResolution:n}):i?function(e,t){const{size:n=2,startIndex:i=0,endIndex:r=e.length,normalize:s=!0}=t||{},o=e.slice(i,r);ew(o,n,0,r-i);const a=qb(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const e of a)tw(e,n);return a}(r,{size:t}):r}class PathTesselator extends Tesselator{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):()=>null}normalizeGeometry(e){return this.normalize?nw(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}get(e){return this.attributes[e]}getGeometrySize(e){if(Array.isArray(e[0])){let t=0;for(const n of e)t+=this.getGeometrySize(n);return t}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(0!==t.geometrySize)if(e&&Array.isArray(e[0]))for(const n of e){const e=this.getGeometrySize(n);t.geometrySize=e,this.updateGeometryAttributes(n,t),t.vertexStart+=e}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const{segmentTypes:n}=this.attributes,i=this.isClosed(e),{vertexStart:r,geometrySize:s}=t;n.fill(0,r,r+s),i?(n[r]=4,n[r+s-2]=4):(n[r]+=1,n[r+s-2]+=2),n[r+s-1]=4}_updatePositions(e,t){const{positions:n}=this.attributes;if(!n)return;const{vertexStart:i,geometrySize:r}=t,s=new Array(3);for(let t=i,o=0;o<r;t++,o++)this.getPointOnPath(e,o,s),n[3*t]=s[0],n[3*t+1]=s[1],n[3*t+2]=s[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,n=[]){const{positionSize:i}=this;t*i>=e.length&&(t+=1-e.length/i);const r=t*i;return n[0]=e[r],n[1]=e[r+1],n[2]=3===i&&e[r+2]||0,n}isClosed(e){if(!this.normalize)return this.opts.loop;const{positionSize:t}=this,n=e.length-t;return e[0]===e[n]&&e[1]===e[n+1]&&(2===t||e[2]===e[n+2])}}const iw=[0,0,0,255],rw={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:e=>e.path},getColor:{type:"accessor",value:iw},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},sw={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class PathLayer extends Layer{getShaders(){return super.getShaders({vs:"#define SHADER_NAME path-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute float instanceTypes;\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec3 instanceLeftPositions64Low;\nattribute vec3 instanceStartPositions64Low;\nattribute vec3 instanceEndPositions64Low;\nattribute vec3 instanceRightPositions64Low;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float capType;\nuniform float miterLimit;\nuniform bool billboard;\nuniform int widthUnits;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\nvarying float vJointType;\n\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\nvec3 lineJoin(\n  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,\n  vec2 width\n) {\n  bool isEnd = positions.x > 0.0;\n  float sideOfPath = positions.y;\n  float isJoint = float(sideOfPath == 0.0);\n\n  vec3 deltaA3 = (currPoint - prevPoint);\n  vec3 deltaB3 = (nextPoint - currPoint);\n\n  mat3 rotationMatrix;\n  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);\n  if (needsRotation) {\n    deltaA3 = deltaA3 * rotationMatrix;\n    deltaB3 = deltaB3 * rotationMatrix;\n  }\n  vec2 deltaA = deltaA3.xy / width;\n  vec2 deltaB = deltaB3.xy / width;\n\n  float lenA = length(deltaA);\n  float lenB = length(deltaB);\n\n  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n  vec2 tangent = dirA + dirB;\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  vec2 dir = isEnd ? dirA : dirB;\n  vec2 perp = isEnd ? perpA : perpB;\n  float L = isEnd ? lenA : lenB;\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);\n  float cornerPosition = sideOfPath * turnDirection;\n\n  float miterSize = 1.0 / max(sinHalfA, EPSILON);\n  miterSize = mix(\n    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),\n    miterSize,\n    step(0.0, cornerPosition)\n  );\n\n  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))\n    * (sideOfPath + isJoint * turnDirection);\n  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));\n  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));\n  bool isCap = isStartCap || isEndCap;\n  if (isCap) {\n    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);\n    vJointType = capType;\n  } else {\n    vJointType = jointType;\n  }\n  vPathLength = L;\n  vCornerOffset = offsetVec;\n  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);\n  vMiterLength = isCap ? isJoint : vMiterLength;\n\n  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);\n  vPathPosition = vec2(\n    dot(offsetFromStartOfPath, perp),\n    dot(offsetFromStartOfPath, dir)\n  );\n  geometry.uv = vPathPosition;\n\n  float isValid = step(instanceTypes, 3.5);\n  vec3 offset = vec3(offsetVec * width * isValid, 0.0);\n\n  if (needsRotation) {\n    offset = rotationMatrix * offset;\n  }\n  return currPoint + offset;\n}\nvoid clipLine(inout vec4 position, vec4 refPosition) {\n  if (position.w < EPSILON) {\n    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\n    position = refPosition + (position - refPosition) * r;\n  }\n}\n\nvoid main() {\n  geometry.pickingColor = instancePickingColors;\n\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);\n\n  float isEnd = positions.x;\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);\n\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);\n\n  geometry.worldPosition = currPosition;\n  vec2 widthPixels = vec2(clamp(\n    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),\n    widthMinPixels, widthMaxPixels) / 2.0);\n  vec3 width;\n\n  if (billboard) {\n    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);\n    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);\n    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);\n\n    clipLine(prevPositionScreen, currPositionScreen);\n    clipLine(nextPositionScreen, currPositionScreen);\n    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\n\n    width = vec3(widthPixels, 0.0);\n    DECKGL_FILTER_SIZE(width, geometry);\n\n    vec3 pos = lineJoin(\n      prevPositionScreen.xyz / prevPositionScreen.w,\n      currPositionScreen.xyz / currPositionScreen.w,\n      nextPositionScreen.xyz / nextPositionScreen.w,\n      project_pixel_size_to_clipspace(width.xy)\n    );\n\n    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);\n  } else {\n    prevPosition = project_position(prevPosition, prevPosition64Low);\n    currPosition = project_position(currPosition, currPosition64Low);\n    nextPosition = project_position(nextPosition, nextPosition64Low);\n\n    width = vec3(project_pixel_size(widthPixels), 0.0);\n    DECKGL_FILTER_SIZE(width, geometry);\n\n    vec4 pos = vec4(\n      lineJoin(prevPosition, currPosition, nextPosition, width.xy),\n      1.0);\n    geometry.position = pos;\n    gl_Position = project_common_position_to_clipspace(pos);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME path-layer-fragment-shader\n\nprecision highp float;\n\nuniform float miterLimit;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\nvarying float vJointType;\n\nvoid main(void) {\n  geometry.uv = vPathPosition;\n\n  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {\n    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {\n      discard;\n    }\n    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {\n      discard;\n    }\n  }\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[kv,Pv]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:sw,accessor:"getPath",update:this.calculatePositions,noAlloc:true,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:true},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:sw,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:sw,defaultValue:iw},instancePickingColors:{size:3,type:5121,accessor:(e,{index:t,target:n})=>this.encodePickingColor(e&&e.__source?e.__source.index:t,n)}}),this.setState({pathTesselator:new PathTesselator({fp64:this.use64bitPositions()})}),this.props.getDashArray&&!this.props.extensions.length&&cu.removed("getDashArray","PathStyleExtension")()}updateState({oldProps:e,props:t,changeFlags:n}){super.updateState({props:t,oldProps:e,changeFlags:n});const i=this.getAttributeManager();if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath)){const{pathTesselator:e}=this.state,r=t.data.attributes||{};e.updateGeometry({data:t.data,geometryBuffer:r.getPath,buffers:r,normalize:!t._pathType,loop:"loop"===t._pathType,getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:n.dataChanged}),this.setState({numInstances:e.instanceCount,startIndices:e.vertexStarts}),n.dataChanged||i.invalidateAll()}if(n.extensionsChanged){var r;const{gl:e}=this.context;null===(r=this.state.model)||void 0===r||r.delete(),this.state.model=this._getModel(e),i.invalidateAll()}}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n}=t,{data:i}=this.props;return i[0]&&i[0].__source&&(t.object=i.find((e=>e.__source.index===n))),t}disablePickingIndex(e){const{data:t}=this.props;if(t[0]&&t[0].__source)for(let n=0;n<t.length;n++)t[n].__source.index===e&&this._disablePickingIndex(n);else this._disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:n,billboard:i,miterLimit:r,widthUnits:s,widthScale:o,widthMinPixels:a,widthMaxPixels:l}=this.props;this.state.model.setUniforms(e).setUniforms({jointType:Number(t),capType:Number(n),billboard:i,widthUnits:hu[s],widthScale:o,miterLimit:r,widthMinPixels:a,widthMaxPixels:l}).draw()}_getModel(e){return new Model(e,{...this.getShaders(),id:this.props.id,geometry:new Geometry({drawMode:4,attributes:{indices:new Uint16Array([0,1,2,1,4,2,1,3,4,3,5,4]),positions:{value:new Float32Array([0,0,0,-1,0,1,1,-1,1,1,1,0]),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}PathLayer.layerName="PathLayer",PathLayer.defaultProps=rw;const ow="#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\n\nstruct AmbientLight {\n vec3 color;\n};\n\nstruct PointLight {\n vec3 color;\n vec3 position;\n vec3 attenuation;\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform AmbientLight lighting_uAmbientLight;\nuniform PointLight lighting_uPointLight[MAX_LIGHTS];\nuniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];\nuniform int lighting_uPointLightCount;\nuniform int lighting_uDirectionalLightCount;\n\nuniform bool lighting_uEnabled;\n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n#endif\n",aw={lightSources:{}};function lw({color:e=[0,0,0],intensity:t=1}={}){return e.map((e=>e*t/255))}const cw={name:"lights",vs:ow,fs:ow,getUniforms:function e(t=aw){if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:i}=t.lightSources||{};return e||n&&n.length>0||i&&i.length>0?Object.assign({},function({ambientLight:e,pointLights:t=[],directionalLights:n=[]}){const i={};return i["lighting_uAmbientLight.color"]=e?lw(e):[0,0,0],t.forEach(((e,t)=>{i[`lighting_uPointLight[${t}].color`]=lw(e),i[`lighting_uPointLight[${t}].position`]=e.position,i[`lighting_uPointLight[${t}].attenuation`]=e.attenuation||[1,0,0]})),i.lighting_uPointLightCount=t.length,n.forEach(((e,t)=>{i[`lighting_uDirectionalLight[${t}].color`]=lw(e),i[`lighting_uDirectionalLight[${t}].direction`]=e.direction})),i.lighting_uDirectionalLightCount=n.length,i}({ambientLight:e,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const n={pointLights:[],directionalLights:[]};for(const e of t.lights||[])switch(e.type){case"ambient":n.ambientLight=e;break;case"directional":n.directionalLights.push(e);break;case"point":n.pointLights.push(e)}return e({lightSources:n})}return{}},defines:{MAX_LIGHTS:3}},uw="\nuniform float lighting_uAmbient;\nuniform float lighting_uDiffuse;\nuniform float lighting_uShininess;\nuniform vec3  lighting_uSpecularColor;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n    vec3 halfway_direction = normalize(light_direction + view_direction);\n    float lambertian = dot(light_direction, normal_worldspace);\n    float specular = 0.0;\n    if (lambertian > 0.0) {\n      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n      specular = pow(specular_angle, lighting_uShininess);\n    }\n    lambertian = max(lambertian, 0.0);\n    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = vec3(0, 0, 0);\n  vec3 surfaceColor = vec3(0, 0, 0);\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n",dw={};function hw(e=dw){if(!("material"in e))return{};const{material:t}=e;return t?function(e){const{ambient:t=.35,diffuse:n=.6,shininess:i=32,specularColor:r=[30,30,30]}=e;return{lighting_uAmbient:t,lighting_uDiffuse:n,lighting_uShininess:i,lighting_uSpecularColor:r.map((e=>e/255))}}(t):{lighting_uEnabled:!1}}const pw={name:"gouraud-lighting",dependencies:[cw],vs:uw,defines:{LIGHTING_VERTEX:1},getUniforms:hw};var fw=n(1106),mw=n.n(fw);const gw=Bb.CLOCKWISE,yw=Bb.COUNTER_CLOCKWISE,vw={isClosed:!0};function bw(e,t,n,i,r){let s=t;const o=n.length;for(let t=0;t<o;t++)for(let r=0;r<i;r++)e[s++]=n[t][r]||0;if(!function(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]}(n))for(let t=0;t<i;t++)e[s++]=n[0][t]||0;return vw.start=t,vw.end=s,vw.size=i,zb(e,r,vw),s}function ww(e,t,n,i,r=0,s,o){const a=(s=s||n.length)-r;if(a<=0)return t;let l=t;for(let t=0;t<a;t++)e[l++]=n[r+t];if(!function(e,t,n,i){for(let r=0;r<t;r++)if(e[n+r]!==e[i-t+r])return!1;return!0}(n,i,r,s))for(let t=0;t<i;t++)e[l++]=n[r+t];return vw.start=t,vw.end=l,vw.size=i,zb(e,o,vw),l}function xw(e,t){!function(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}(e);const n=[],i=[];if(e.positions){const{positions:r,holeIndices:s}=e;if(s){let e=0;for(let o=0;o<=s.length;o++)e=ww(n,e,r,t,s[o-1],s[o],0===o?gw:yw),i.push(e);return i.pop(),{positions:n,holeIndices:i}}e=r}if(Number.isFinite(e[0]))return ww(n,0,e,t,0,n.length,gw),n;if(!function(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}(e)){let r=0;for(const[s,o]of e.entries())r=bw(n,r,o,t,0===s?gw:yw),i.push(r);return i.pop(),{positions:n,holeIndices:i}}return bw(n,0,e,t,gw),n}class PolygonTesselator extends Tesselator{constructor(e){const{fp64:t,IndexType:n=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:n,size:1}}})}get(e){const{attributes:t}=this;return"indices"===e?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;t&&(this.vertexCount=(t.value||t).length)}normalizeGeometry(e){if(this.normalize){if(e=xw(e,this.positionSize),this.opts.resolution)return Gb(e.positions||e,e.holeIndices,{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0});if(this.opts.wrapLongitude)return function(e,t=null,n){const{size:i=2,normalize:r=!0,edgeTypes:s=!1}=n||{};t=t||[];const o=[],a=[];let l=0,c=0;for(let r=0;r<=t.length;r++){const s=t[r]||e.length,u=c,d=Jb(e,i,l,s);for(let t=d;t<s;t++)o[c++]=e[t];for(let t=l;t<d;t++)o[c++]=e[t];ew(o,i,u,c),Qb(o,i,u,c,null==n?void 0:n.maxLatitude),l=s,a[r]=c}a.pop();const u=Gb(o,a,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(r)for(const e of u)tw(e.positions,i);return u}(e.positions||e,e.holeIndices,{size:this.positionSize,maxLatitude:86,edgeTypes:!0})}return e}getGeometrySize(e){if(Array.isArray(e)&&!Number.isFinite(e[0])){let t=0;for(const n of e)t+=this.getGeometrySize(n);return t}return(e.positions||e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):()=>null}updateGeometryAttributes(e,t){if(Array.isArray(e)&&!Number.isFinite(e[0]))for(const n of e){const e=this.getGeometrySize(n);t.geometrySize=e,this.updateGeometryAttributes(n,t),t.vertexStart+=e,t.indexStart=this.indexStarts[t.geometryIndex+1]}else this._updateIndices(e,t),this._updatePositions(e,t),this._updateVertexValid(e,t)}_updateIndices(e,{geometryIndex:t,vertexStart:n,indexStart:i}){const{attributes:r,indexStarts:s,typedArrayManager:o}=this;let a=r.indices;if(!a)return;let l=i;const c=function(e,t,n){let i=null;e.holeIndices&&(i=e.holeIndices.map((e=>e/t)));let r=e.positions||e;if(n){const e=r.length;r=r.slice();const i=[];for(let s=0;s<e;s+=t){i[0]=r[s],i[1]=r[s+1];const e=n(i);r[s]=e[0],r[s+1]=e[1]}}return mw()(r,i,t)}(e,this.positionSize,this.opts.preproject);a=o.allocate(a,i+c.length,{copy:!0});for(let e=0;e<c.length;e++)a[l++]=c[e]+n;s[t+1]=i+c.length,r.indices=a}_updatePositions(e,{vertexStart:t,geometrySize:n}){const{attributes:{positions:i},positionSize:r}=this;if(!i)return;const s=e.positions||e;for(let e=t,o=0;o<n;e++,o++){const t=s[o*r],n=s[o*r+1],a=r>2?s[o*r+2]:0;i[3*e]=t,i[3*e+1]=n,i[3*e+2]=a}}_updateVertexValid(e,{vertexStart:t,geometrySize:n}){const{attributes:{vertexValid:i},positionSize:r}=this,s=e&&e.holeIndices;if(e&&e.edgeTypes?i.set(e.edgeTypes,t):i.fill(1,t,t+n),s)for(let e=0;e<s.length;e++)i[t+s[e]/r-1]=0;i[t+n-1]=0}}const _w="\nattribute vec2 vertexPositions;\nattribute float vertexValid;\n\nuniform bool extruded;\nuniform bool isWireframe;\nuniform float elevationScale;\nuniform float opacity;\n\nvarying vec4 vColor;\n\nstruct PolygonProps {\n  vec4 fillColors;\n  vec4 lineColors;\n  vec3 positions;\n  vec3 nextPositions;\n  vec3 pickingColors;\n  vec3 positions64Low;\n  vec3 nextPositions64Low;\n  float elevations;\n};\n\nvec3 project_offset_normal(vec3 vector) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    return normalize(vector * project_uCommonUnitsPerWorldUnit);\n  }\n  return project_normal(vector);\n}\n\nvoid calculatePosition(PolygonProps props) {\n#ifdef IS_SIDE_VERTEX\n  if(vertexValid < 0.5){\n    gl_Position = vec4(0.);\n    return;\n  }\n#endif\n\n  vec3 pos;\n  vec3 pos64Low;\n  vec3 normal;\n  vec4 colors = isWireframe ? props.lineColors : props.fillColors;\n\n  geometry.worldPosition = props.positions;\n  geometry.worldPositionAlt = props.nextPositions;\n  geometry.pickingColor = props.pickingColors;\n\n#ifdef IS_SIDE_VERTEX\n  pos = mix(props.positions, props.nextPositions, vertexPositions.x);\n  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);\n#else\n  pos = props.positions;\n  pos64Low = props.positions64Low;\n#endif\n\n  if (extruded) {\n    pos.z += props.elevations * vertexPositions.y * elevationScale;\n  }\n  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);\n\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  if (extruded) {\n  #ifdef IS_SIDE_VERTEX\n    normal = vec3(\n      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),\n      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),\n      0.0);\n    normal = project_offset_normal(normal);\n  #else\n    normal = project_normal(vec3(0.0, 0.0, 1.0));\n  #endif\n    geometry.normal = normal;\n    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);\n    vColor = vec4(lightColor, colors.a * opacity);\n  } else {\n    vColor = vec4(colors.rgb, colors.a * opacity);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",Ew="#define SHADER_NAME solid-polygon-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 positions64Low;\nattribute float elevations;\nattribute vec4 fillColors;\nattribute vec4 lineColors;\nattribute vec3 pickingColors;\n\n".concat(_w,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = positions;\n  props.positions64Low = positions64Low;\n  props.elevations = elevations;\n  props.fillColors = fillColors;\n  props.lineColors = lineColors;\n  props.pickingColors = pickingColors;\n\n  calculatePosition(props);\n}\n"),Sw="#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\n\n\nattribute vec3 instancePositions;\nattribute vec3 nextPositions;\nattribute vec3 instancePositions64Low;\nattribute vec3 nextPositions64Low;\nattribute float instanceElevations;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\n".concat(_w,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  #if RING_WINDING_ORDER_CW == 1\n    props.positions = instancePositions;\n    props.positions64Low = instancePositions64Low;\n    props.nextPositions = nextPositions;\n    props.nextPositions64Low = nextPositions64Low;\n  #else\n    props.positions = nextPositions;\n    props.positions64Low = nextPositions64Low;\n    props.nextPositions = instancePositions;\n    props.nextPositions64Low = instancePositions64Low;\n  #endif\n  props.elevations = instanceElevations;\n  props.fillColors = instanceFillColors;\n  props.lineColors = instanceLineColors;\n  props.pickingColors = instancePickingColors;\n\n  calculatePosition(props);\n}\n"),Cw=[0,0,0,255],Tw={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:e=>e.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Cw},getLineColor:{type:"accessor",value:Cw},material:!0},Aw={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class SolidPolygonLayer extends Layer{getShaders(e){return super.getShaders({vs:"top"===e?Ew:Sw,fs:"#define SHADER_NAME solid-polygon-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",defines:{RING_WINDING_ORDER_CW:this.props._normalize||"CCW"!==this.props._windingOrder?1:0},modules:[kv,pw,Pv]})}get wrapLongitude(){return!1}initializeState(){const{gl:e,viewport:t}=this.context;let{coordinateSystem:n}=this.props;t.isGeospatial&&n===uu.DEFAULT&&(n=uu.LNGLAT),this.setState({numInstances:0,polygonTesselator:new PolygonTesselator({preproject:n===uu.LNGLAT&&t.projectFlat,fp64:this.use64bitPositions(),IndexType:!e||Qd(e,Zd)?Uint32Array:Uint16Array})});const i=this.getAttributeManager(),r=!0;i.remove(["instancePickingColors"]),i.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:r},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:Aw,accessor:"getPolygon",update:this.calculatePositions,noAlloc:r,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:r},elevations:{size:1,transition:Aw,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{alias:"colors",size:this.props.colorFormat.length,type:5121,normalized:!0,transition:Aw,accessor:"getFillColor",defaultValue:Cw,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{alias:"colors",size:this.props.colorFormat.length,type:5121,normalized:!0,transition:Aw,accessor:"getLineColor",defaultValue:Cw,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(e,{index:t,target:n})=>this.encodePickingColor(e&&e.__source?e.__source.index:t,n),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n}=t,{data:i}=this.props;return i[0]&&i[0].__source&&(t.object=i.find((e=>e.__source.index===n))),t}disablePickingIndex(e){const{data:t}=this.props;if(t[0]&&t[0].__source)for(let n=0;n<t.length;n++)t[n].__source.index===e&&this._disablePickingIndex(n);else this._disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:n,wireframe:i,elevationScale:r}=this.props,{topModel:s,sideModel:o,polygonTesselator:a}=this.state,l={...e,extruded:Boolean(t),elevationScale:r};o&&(o.setInstanceCount(a.instanceCount-1),o.setUniforms(l),i&&(o.setDrawMode(3),o.setUniforms({isWireframe:!0}).draw()),n&&(o.setDrawMode(6),o.setUniforms({isWireframe:!1}).draw())),s&&(s.setVertexCount(a.vertexCount),s.setUniforms(l).draw())}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:n,changeFlags:i}=e,r=this.getAttributeManager();var s;(i.extensionsChanged||t.filled!==n.filled||t.extruded!==n.extruded)&&(null===(s=this.state.models)||void 0===s||s.forEach((e=>e.delete())),this.setState(this._getModels(this.context.gl)),r.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:t}=this.state,i=e.data.attributes||{};t.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:i.getPolygon,buffers:i,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged}),this.setState({numInstances:t.instanceCount,startIndices:t.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(e){const{id:t,filled:n,extruded:i}=this.props;let r,s;if(n){const n=this.getShaders("top");n.defines.NON_INSTANCED_MODEL=1,r=new Model(e,{...n,id:"".concat(t,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return i&&(s=new Model(e,{...this.getShaders("side"),id:"".concat(t,"-side"),geometry:new Geometry({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),s.userData.excludeAttributes={indices:!0}),{models:[s,r].filter(Boolean),topModel:r,sideModel:s}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}SolidPolygonLayer.layerName="SolidPolygonLayer",SolidPolygonLayer.defaultProps=Tw;const kw={circle:{type:ScatterplotLayer,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:IconLayer,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:TextLayer,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Nw={type:PathLayer,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Mw={type:SolidPolygonLayer,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Pw({type:e,props:t}){const n={};for(const i in t)n[i]=e.defaultProps[t[i]];return n}function Lw(e,t){const{transitions:n,updateTriggers:i}=e.props,r={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const s in t){const o=t[s];let a=e.props[s];s.startsWith("get")&&(a=e.getSubLayerAccessor(a),r.updateTriggers[o]=i[s],n&&(r.transitions[o]=n[s])),r[o]=a}return r}function Ow(e,t,n={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:r=0,endRow:s=e.length}=n;for(let n=r;n<s;n++){const r=e[n];cu.assert(r&&r.geometry,"GeoJSON does not have geometry");const{geometry:s}=r;if("GeometryCollection"===s.type){cu.assert(Array.isArray(s.geometries),"GeoJSON does not have geometries array");const{geometries:e}=s;for(let s=0;s<e.length;s++){Rw(e[s],i,t,r,n)}}else Rw(s,i,t,r,n)}return i}function Rw(e,t,n,i,r){const{type:s,coordinates:o}=e,{pointFeatures:a,lineFeatures:l,polygonFeatures:c,polygonOutlineFeatures:u}=t;if(function(e,t){let n=Iw[e];cu.assert(n,"Unknown GeoJSON type ".concat(e));for(;t&&--n>0;)t=t[0];return t&&Number.isFinite(t[0])}(s,o))switch(s){case"Point":a.push(n({geometry:e},i,r));break;case"MultiPoint":o.forEach((e=>{a.push(n({geometry:{type:"Point",coordinates:e}},i,r))}));break;case"LineString":l.push(n({geometry:e},i,r));break;case"MultiLineString":o.forEach((e=>{l.push(n({geometry:{type:"LineString",coordinates:e}},i,r))}));break;case"Polygon":c.push(n({geometry:e},i,r)),o.forEach((e=>{u.push(n({geometry:{type:"LineString",coordinates:e}},i,r))}));break;case"MultiPolygon":o.forEach((e=>{c.push(n({geometry:{type:"Polygon",coordinates:e}},i,r)),e.forEach((e=>{u.push(n({geometry:{type:"LineString",coordinates:e}},i,r))}))}))}else cu.warn("".concat(s," coordinates are malformed"))()}const Iw={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function Dw(e){return e.geometry.coordinates}function Fw(e,t){const n={points:{},lines:{},polygons:{},polygonsOutline:{}},{points:i,lines:r,polygons:s}=e,o=function(e,t){const n={points:null,lines:null,polygons:null};for(const i in n){const r=e[i].globalFeatureIds.value;n[i]=new Uint8ClampedArray(3*r.length);const s=[];for(let e=0;e<r.length;e++)t(r[e],s),n[i][3*e+0]=s[0],n[i][3*e+1]=s[1],n[i][3*e+2]=s[2]}return n}(e,t);return n.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:3,value:o.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines.data={length:r.pathIndices.value.length-1,startIndices:r.pathIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:3,value:o.lines}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines._pathType="open",n.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygons._normalize=!1,s.triangles&&(n.polygons.data.attributes.indices=s.triangles.value),n.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygonsOutline._pathType="open",n}const Bw=["points","linestrings","polygons"],zw={...Pw(kw.circle),...Pw(kw.icon),...Pw(kw.text),...Pw(Nw),...Pw(Mw),stroked:!0,filled:!0,extruded:!1,wireframe:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:e=>e.properties.icon},getText:{type:"accessor",value:e=>e.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class GeoJsonLayer extends CompositeLayer{initializeState(){this.state={layerProps:{},features:{}},this.props.getLineDashArray&&cu.removed("getLineDashArray","PathStyleExtension")()}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;const{data:n}=this.props,i=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){const n=Fw(e.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON({props:e,changeFlags:t}){const n=function(e){if(Array.isArray(e))return e;switch(cu.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return cu.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}(e.data),i=this.getSubLayerRow.bind(this);let r={};const s={};if(Array.isArray(t.dataChanged)){const e=this.state.features;for(const t in e)r[t]=e[t].slice(),s[t]=[];for(const o of t.dataChanged){const t=Ow(n,i,o);for(const n in e)s[n].push(vv({data:r[n],getIndex:e=>e.__source.index,dataRange:o,replace:t[n]}))}}else r=Ow(n,i);const o=function(e,t){const n={points:{},lines:{},polygons:{},polygonsOutline:{}},{pointFeatures:i,lineFeatures:r,polygonFeatures:s,polygonOutlineFeatures:o}=e;return n.points.data=i,n.points._dataDiff=t.pointFeatures&&(()=>t.pointFeatures),n.points.getPosition=Dw,n.lines.data=r,n.lines._dataDiff=t.lineFeatures&&(()=>t.lineFeatures),n.lines.getPath=Dw,n.polygons.data=s,n.polygons._dataDiff=t.polygonFeatures&&(()=>t.polygonFeatures),n.polygons.getPolygon=Dw,n.polygonsOutline.data=o,n.polygonsOutline._dataDiff=t.polygonOutlineFeatures&&(()=>t.polygonOutlineFeatures),n.polygonsOutline.getPath=Dw,n}(r,s);this.setState({features:r,featuresDiff:s,layerProps:o})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n,sourceLayer:i}=t;return t.featureType=Bw.find((e=>i.id.startsWith("".concat(this.id,"-").concat(e,"-")))),n>=0&&i.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[n]),t}_updateAutoHighlight(e){const t="".concat(this.id,"-points-"),n="points"===e.featureType;for(const i of this.getSubLayers())i.id.startsWith(t)===n&&i.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:t}=this.props,{layerProps:n}=this.state,i="polygons-fill",r=this.shouldRenderSubLayer(i,n.polygons.data)&&this.getSubLayerClass(i,Mw.type);if(r){const s=Lw(this,Mw.props),o=e&&t;return o||delete s.getLineColor,s.updateTriggers.lineColors=o,new r(s,this.getSubLayerProps({id:i,updateTriggers:s.updateTriggers}),n.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:t}=this.props,{layerProps:n}=this.state,i="polygons-stroke",r="linestrings",s=!e&&t&&this.shouldRenderSubLayer(i,n.polygonsOutline.data)&&this.getSubLayerClass(i,Nw.type),o=this.shouldRenderSubLayer(r,n.lines.data)&&this.getSubLayerClass(r,Nw.type);if(s||o){const e=Lw(this,Nw.props);return[s&&new s(e,this.getSubLayerProps({id:i,updateTriggers:e.updateTriggers}),n.polygonsOutline),o&&new o(e,this.getSubLayerProps({id:r,updateTriggers:e.updateTriggers}),n.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:t,binary:n}=this.state;let{highlightedObjectIndex:i}=this.props;!n&&Number.isFinite(i)&&(i=t.points.data.findIndex((e=>e.__source.index===i)));const r=new Set(e.split("+")),s=[];for(const e of r){const n="points-".concat(e),r=kw[e],o=r&&this.shouldRenderSubLayer(n,t.points.data)&&this.getSubLayerClass(n,r.type);if(o){const a=Lw(this,r.props);let l=t.points;if("text"===e&&this.state.binary){const{instancePickingColors:e,...t}=l.data.attributes;l={...l,data:{...l.data,attributes:t}}}s.push(new o(a,this.getSubLayerProps({id:n,updateTriggers:a.updateTriggers,highlightedObjectIndex:i}),l))}}return s}renderLayers(){const{extruded:e}=this.props,t=this._renderPolygonLayer();return[!e&&t,this._renderLineLayers(),this._renderPointLayers(),e&&t]}getSubLayerAccessor(e){const{binary:t}=this.state;return t&&"function"==typeof e?(t,n)=>{const{data:i,index:r}=n,s=function(e,t){if(!e)return null;const n="startIndices"in e?e.startIndices[t]:t,i=e.featureIds.value[n];return-1!==n?function(e,t,n){const i={properties:{...e.properties[t]}};for(const t in e.numericProps)i.properties[t]=e.numericProps[t].value[n];return i}(e,i,n):null}(i,r);return e(s,n)}:super.getSubLayerAccessor(e)}}GeoJsonLayer.layerName="GeoJsonLayer",GeoJsonLayer.defaultProps=zw;let jw=1,Vw=1;class Timeline{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:t=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:r=1}=e,s=jw++,o={time:0,delay:t,duration:n,rate:i,repeat:r};return this._setChannelTime(o,this.time),this.channels.set(s,o),s}removeChannel(e){this.channels.delete(e);for(const[t,n]of this.animations)n.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return void 0!==t&&this.time>=t.delay+t.duration*t.repeat}getTime(e){if(void 0===e)return this.time;const t=this.channels.get(e);return void 0===t?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const e of t)this._setChannelTime(e,this.time);const n=this.animations.values();for(const e of n){const{animation:t,channel:n}=e;t.setTime(this.getTime(n))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const n=Vw++;return this.animations.set(n,{animation:e,channel:t}),e.setTime(this.getTime(t)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const n=t-e.delay;n>=e.duration*e.repeat?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}class resource_Resource{constructor(e,t,n){this.id=e,this.context=n,this._loadCount=0,this._subscribers=new Set,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then((()=>this.getData()))}setData(e,t){if(e===this._data&&!t)return;this._data=e;const n=++this._loadCount;let i=e;"string"==typeof e&&(i=hv(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then((e=>{this._loadCount===n&&(this.isLoaded=!0,this._error=null,this._content=e)})).catch((e=>{this._loadCount===n&&(this.isLoaded=!0,this._error=e||!0)}))):(this.isLoaded=!0,this._error=null,this._content=e);for(const e of this._subscribers)e.onChange(this.getData())}}class ResourceManager{constructor({gl:e,protocol:t}){this.protocol=t||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return!!e.startsWith(this.protocol)||e in this._resources}add({resourceId:e,data:t,forceUpdate:n=!1,persistent:i=!0}){let r=this._resources[e];r?r.setData(t,n):(r=new resource_Resource(e,t,this._context),this._resources[e]=r),r.persistent=i}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const e in t){const n=t[e];n.resource&&n.resource.unsubscribe(n)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:n,requestId:i="default"}){const{_resources:r,protocol:s}=this;e.startsWith(s)&&(r[e=e.replace(s,"")]||this.add({resourceId:e,data:null,persistent:!1}));const o=r[e];if(this._track(n,i,o,t),o)return o.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout((()=>this._prune()),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,n,i){const r=this._consumers,s=r[e]=r[e]||{},o=s[t]||{};o.resource&&(o.resource.unsubscribe(o),o.resource=null,this.prune()),n&&(s[t]=o,o.onChange=i,o.resource=n,n.subscribe(o))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];t.persistent||t.inUse()||(t.delete(),delete this._resources[e])}}}const Uw=[Av],Hw=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function $w(e){const t=ProgramManager.getDefaultProgramManager(e);for(const e of Uw)t.addDefaultModule(e);for(const e of Hw)t.addShaderHook(e);return t}const qw=Object.seal({layerManager:null,resourceManager:null,deck:null,gl:null,stats:null,shaderCache:null,pickingFBO:null,mousePosition:null,userData:{}});class LayerManager{constructor(e,{deck:t,stats:n,viewport:i,timeline:r}={}){this.lastRenderedLayers=[],this.layers=[],this.resourceManager=new ResourceManager({gl:e,protocol:"deck://"}),this.context={...qw,layerManager:this,gl:e,deck:t,programManager:e&&$w(e),stats:n||new Stats({id:"deck.gl"}),viewport:i||new Viewport({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:r||new Timeline,resourceManager:this.resourceManager},this._nextLayers=null,this._needsRedraw="Initial render",this._needsUpdate=!1,this._debug=!1,this.activateViewport=this.activateViewport.bind(this),Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(e);t=t||i}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this.lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e=null}={}){return e?this.layers.filter((t=>e.find((e=>0===t.id.indexOf(e))))):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){tp("layerManager.setLayers",this,t,e),this.lastRenderedLayers=e,e=Vh(e,Boolean);for(const t of e)t.context=this.context;return this._updateLayers(this.layers,e),this}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this.lastRenderedLayers,e)),this._nextLayers=null}activateViewport(e){return tp("layerManager.activateViewport",this,e),e&&(this.context.viewport=e),this}_handleError(e,t,n){n.raiseError(t,"".concat(e," of ").concat(n))}_updateLayers(e,t){const n={};for(const t of e)n[t.id]?cu.warn("Multiple old layers with same id ".concat(t.id))():n[t.id]=t;const i=[];this._updateSublayersRecursively(t,n,i),this._finalizeOldLayers(n);let r=!1;for(const e of i)if(e.hasUniformTransition()){r=!0;break}this._needsUpdate=r,this.layers=i}_updateSublayersRecursively(e,t,n){for(const i of e){i.context=this.context;const e=t[i.id];null===e&&cu.warn("Multiple new layers with same id ".concat(i.id))(),t[i.id]=null;let r=null;try{this._debug&&e!==i&&i.validateProps(),e?(this._transferLayerState(e,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),r=i.isComposite&&i.getSubLayers()}catch(e){this._handleError("matching",e,i)}r&&this._updateSublayersRecursively(r,t,n)}}_finalizeOldLayers(e){for(const t in e){const n=e[t];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Qf}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=Jf,t!==e&&(e.lifecycle=em)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=tm;try{e._finalize(),e.lifecycle=nm}catch(t){this._handleError("finalization",t,e)}}}class ViewManager{constructor(e={}){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="Initial render",this._needsUpdate=!0,this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers)this.controllers[e]&&this.controllers[e].finalize();this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter((t=>t.containsPixel(e))):this._viewports}getViews(){const e={};return this.views.forEach((t=>{e[t.id]=t})),e}getView(e){return"string"==typeof e?this.views.find((t=>t.id===e)):e}getViewState(e){const t=this.getView(e),n=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,t){const n=this.getViewports(),i={x:e[0],y:e[1]};for(let r=n.length-1;r>=0;--r){const s=n[r];if(s.containsPixel(i)){const n=e.slice();return n[0]-=s.x,n[1]-=s.y,s.unproject(n,t)}}return null}setProps(e){"views"in e&&this._setViews(e.views),"viewState"in e&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){e===this.width&&t===this.height||(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Vh(e,Boolean);this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){if(e){!jg(e,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=e}else cu.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,t){t.viewId=e,this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange(t)}_createController(e,t){return new(0,t.type)({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,t.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:t=>e._getViewport(t,{width:t.width,height:t.height}),...t})}_updateController(e,t,n,i){let r=e.controller;return r?(r={...t,...e.props,...r,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height},i?i.setProps(r):i=this._createController(e,r),i):null}_rebuildViewports(){const{width:e,height:t,views:n}=this,i=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let s=n.length;s--;){const o=n[s],a=this.getViewState(o),l=o.makeViewport({width:e,height:t,viewState:a});let c=i[o.id];o.controller&&!c&&(r=!0),!r&&o.controller||!c||(c.finalize(),c=null),this.controllers[o.id]=this._updateController(o,a,l,c),this._viewports.unshift(l)}for(const e in i)i[e]&&!this.controllers[e]&&i[e].finalize();this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach((e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)}))}_diffViews(e,t){return e.length!==t.length||e.some(((n,i)=>!e[i].equals(t[i])))}}const Ww=/([0-9]+\.?[0-9]*)(%|px)/;function Gw(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":const t=Ww.exec(e);if(t&&t.length>=3){const e="%"===t[2],n=parseFloat(t[1]);return{position:e?n/100:n,relative:e}}default:throw new Error("Could not parse position string ".concat(e))}}function Yw(e,t){return e.relative?Math.round(e.position*t):e.position}class View{constructor(e={}){const{id:t=null,x:n=0,y:i=0,width:r="100%",height:s="100%",viewportInstance:o,type:a=Viewport}=e;Ih(!o||o instanceof Viewport),this.viewportInstance=o,this.id=t||this.constructor.displayName||"view",this.type=a,this.props={...e,id:this.id},this._parseDimensions({x:n,y:i,width:r,height:s}),this.equals=this.equals.bind(this),Object.seal(this)}equals(e){if(this===e)return!0;if(this.viewportInstance)return e.viewportInstance&&this.viewportInstance.equals(e.viewportInstance);return jg(this.props,e.props)}makeViewport({width:e,height:t,viewState:n}){if(this.viewportInstance)return this.viewportInstance;n=this.filterViewState(n);const i=this.getDimensions({width:e,height:t});return this._getViewport(n,i)}getViewStateId(){switch(typeof this.props.viewState){case"string":return this.props.viewState;case"object":return this.props.viewState&&this.props.viewState.id;default:return this.id}}filterViewState(e){if(this.props.viewState&&"object"==typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const e in this.props.viewState)"id"!==e&&(t[e]=this.props.viewState[e]);return t}return e}getDimensions({width:e,height:t}){return{x:Yw(this._x,e),y:Yw(this._y,t),width:Yw(this._width,e),height:Yw(this._height,t)}}_getControllerProps(e){let t=this.props.controller;return t?!0===t?e:("function"==typeof t&&(t={type:t}),{...e,...t}):null}_getViewport(e,t){const{type:n}=this;return new n({...e,...this.props,...t})}_parseDimensions({x:e,y:t,width:n,height:i}){this._x=Gw(e),this._y=Gw(t),this._width=Gw(n),this._height=Gw(i)}}const Xw=()=>{},Kw=1,Zw=2,Jw=3,Qw={transitionEasing:e=>e,transitionInterruption:Kw,onTransitionStart:Xw,onTransitionInterrupt:Xw,onTransitionEnd:Xw};class TransitionManager{constructor(e,t={}){this.ControllerState=e,this.props={...Qw,...t},this.propsInTransition=null,this.transition=new transition_Transition(t.timeline),this.onViewStateChange=t.onViewStateChange||Xw,this.onStateChange=t.onStateChange||Xw,this._onTransitionUpdate=this._onTransitionUpdate.bind(this)}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const n=this.props;if(e={...Qw,...e},this.props=e,this._shouldIgnoreViewportChange(n,e))return t;if(this._isTransitionEnabled(e)){const{interruption:i,endProps:r}=this.transition.settings,s={...n,...i===Zw?r:this.propsInTransition||n};this._triggerTransition(s,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:n}=e;return(t>0||"auto"===t)&&Boolean(n)}_isUpdateDueToCurrentTransition(e){return!!this.transition.inProgress&&this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition)}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===Jw||this._isUpdateDueToCurrentTransition(t):!this._isTransitionEnabled(t)||t.transitionInterpolator.arePropsEqual(e,t)}_triggerTransition(e,t){const n=new this.ControllerState(e),i=new this.ControllerState(t).shortestPathFrom(n),{transitionInterpolator:r}=t,s=r.getDuration?r.getDuration(e,t):t.transitionDuration;if(0===s)return;const o=t.transitionInterpolator.initializeProps(e,i);this.propsInTransition={},this.duration=s,this.transition.start({duration:s,easing:t.transitionEasing,interpolator:t.transitionInterpolator,interruption:t.transitionInterruption,startProps:o.start,endProps:o.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)}),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e(t)}}_onTransitionUpdate(e){const{time:t,settings:{interpolator:n,startProps:i,endProps:r,duration:s,easing:o}}=e,a=o(t/s),l=n.interpolateProps(i,r,a);this.propsInTransition=new this.ControllerState({...this.props,...l}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}}class TransitionInterpolator{constructor(e={}){Array.isArray(e)&&(e={compare:e,extract:e,required:e});const{compare:t,extract:n,required:i}=e;this._propsToCompare=t,this._propsToExtract=n,this._requiredProps=i}arePropsEqual(e,t){for(const n of this._propsToCompare||Object.keys(t))if(!(n in e)||!(n in t)||!ah(e[n],t[n]))return!1;return!0}initializeProps(e,t){let n;if(this._propsToExtract){const i={},r={};for(const n of this._propsToExtract)i[n]=e[n],r[n]=t[n];n={start:i,end:r}}else n={start:e,end:t};return this._checkRequiredProps(n.start),this._checkRequiredProps(n.end),n}interpolateProps(e,t,n){return t}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach((t=>{const n=e[t];Ih(Number.isFinite(n)||Array.isArray(n),"".concat(t," is required for transition"))}))}}const ex=["longitude","latitude","zoom","bearing","pitch"],tx=["longitude","latitude","zoom"];class LinearInterpolator extends TransitionInterpolator{constructor(e={}){super((Array.isArray(e)?e:e.transitionProps)||{compare:ex,extract:ex,required:tx}),this.opts=e}initializeProps(e,t){const n=super.initializeProps(e,t),{makeViewport:i,around:r}=this.opts;if(i&&r){const s=i(e),o=i(t),a=s.unproject(r);n.start.around=r,Object.assign(n.end,{around:o.project(a),aroundPosition:a,width:t.width,height:t.height})}return n}interpolateProps(e,t,n){const i={};for(const r of this._propsToExtract)i[r]=oh(e[r]||0,t[r]||0,n);if(t.aroundPosition){const r=this.opts.makeViewport({...t,...i});Object.assign(i,r.panByPosition(t.aroundPosition,oh(e.around,t.around,n)))}return i}}const nx={transitionDuration:0},ix={transitionDuration:300,transitionEasing:e=>e,transitionInterruption:Kw},rx=e=>1-(1-e)*(1-e),sx=["wheel"],ox=["panstart","panmove","panend"],ax=["pinchstart","pinchmove","pinchend"],lx=["tripanstart","tripanmove","tripanend"],cx=["doubletap"],ux=["keydown"];class controller_Controller{constructor(e,t={}){Hc(this,"ControllerState",void 0),Hc(this,"controllerState",null),Hc(this,"controllerStateProps",null),Hc(this,"transitionManager",void 0),Hc(this,"_transition",void 0),Hc(this,"_events",null),Hc(this,"eventManager",null),Hc(this,"_interactionState",{isDragging:!1}),Hc(this,"_customEvents",[]),Hc(this,"onViewStateChange",null),Hc(this,"onStateChange",null),Hc(this,"makeViewport",void 0),Hc(this,"_eventStartBlocked",void 0),Hc(this,"_state",void 0),Hc(this,"_panMove",void 0),Hc(this,"invertPan",void 0),Hc(this,"dragMode","rotate"),Hc(this,"inertia",0),Hc(this,"scrollZoom",!0),Hc(this,"dragPan",!0),Hc(this,"dragRotate",!0),Hc(this,"doubleClickZoom",!0),Hc(this,"touchZoom",!0),Hc(this,"touchRotate",!1),Hc(this,"keyboard",!0),this.ControllerState=e,this.transitionManager=new TransitionManager(e,{...t,onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)});const n=this.linearTransitionProps;this._transition=n&&{...ix,transitionInterpolator:new LinearInterpolator({transitionProps:n})},this.handleEvent=this.handleEvent.bind(this),this.setProps(t)}get linearTransitionProps(){return null}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.setProps(this.controllerStateProps)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){const{ControllerState:t}=this;this.controllerState=new t({makeViewport:this.makeViewport,...this.controllerStateProps,...this._state});const n=this._eventStartBlocked;switch(e.type){case"panstart":return!n&&this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return!n&&this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return!n&&this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}getCenter(e){const{x:t,y:n}=this.controllerStateProps,{offsetCenter:i}=e;return[i.x-t,i.y-n]}isPointInBounds(e,t){const{width:n,height:i}=this.controllerStateProps;if(t&&t.handled)return!1;const r=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=i;return r&&t&&t.stopPropagation(),r}isFunctionKeyPressed(e){const{srcEvent:t}=e;return Boolean(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging}blockEvents(e){const t=setTimeout((()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)}),e);this._eventStartBlocked=t}setProps(e){"onViewStateChange"in e&&(this.onViewStateChange=e.onViewStateChange),"onStateChange"in e&&(this.onStateChange=e.onStateChange),"makeViewport"in e&&(this.makeViewport=e.makeViewport),"dragMode"in e&&(this.dragMode=e.dragMode),this.controllerStateProps=e,"eventManager"in e&&this.eventManager!==e.eventManager&&(this.eventManager=e.eventManager,this._events={},this.toggleEvents(this._customEvents,!0)),"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);let{inertia:t}=e;!0===t&&(t=300),this.inertia=t;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:r=!0,doubleClickZoom:s=!0,touchZoom:o=!0,touchRotate:a=!1,keyboard:l=!0}=e,c=Boolean(this.onViewStateChange);this.toggleEvents(sx,c&&n),this.toggleEvents(ox,c&&(i||r)),this.toggleEvents(ax,c&&(o||a)),this.toggleEvents(lx,c&&a),this.toggleEvents(cx,c&&s),this.toggleEvents(ux,c&&l),this.scrollZoom=n,this.dragPan=i,this.dragRotate=r,this.doubleClickZoom=s,this.touchZoom=o,this.touchRotate=a,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach((e=>{this._events[e]!==t&&(this._events[e]=t,t?this.eventManager.on(e,this.handleEvent):this.eventManager.off(e,this.handleEvent))}))}updateViewport(e,t={},n={}){const i={...e.getViewportProps(),...t},r=this.controllerState!==e;if(this._state=e.getState(),this._setInteractionState(n),r){const e=this.controllerState?this.controllerState.getViewportProps():null;this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:e})}}_onTransition(e){this.onViewStateChange&&(e.interactionState=this._interactionState,this.onViewStateChange(e))}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange&&this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton;(this.invertPan||"pan"===this.dragMode)&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:t});return this._panMove=n,this.updateViewport(i,nx,{isDragging:!0}),!0}_onPan(e){return!!this.isDragging()&&(this._panMove?this._onPanMove(e):this._onPanRotate(e))}_onPanEnd(e){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e))}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),n=this.controllerState.pan({pos:t});return this.updateViewport(n,nx,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],r=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:rx},{isDragging:!1,isPanning:!0})}else{const e=this.controllerState.panEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),n=this.controllerState.rotate({pos:t});return this.updateViewport(n,nx,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],r=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:rx},{isDragging:!1,isRotating:!0})}else{const e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;e.preventDefault();const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const{speed:n=.01,smooth:i=!1}=this.scrollZoom,{delta:r}=e;let s=2/(1+Math.exp(-Math.abs(r*n)));r<0&&0!==s&&(s=1/s);const o=this.controllerState.zoom({pos:t,scale:s});return this.updateViewport(o,{...this._getTransitionProps({around:t}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.rotateStart({pos:t});return this.updateViewport(n,nx,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate)return!1;if(!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const n=this.controllerState.rotate({pos:t});return this.updateViewport(n,nx,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const n=this.getCenter(e),i=[n[0],n[1]+=e.velocityY*t/2],r=this.controllerState.rotate({pos:i});this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:rx},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return this._startPinchRotation=e.rotation,this._lastPinchEvent=e,this.updateViewport(n,nx,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate)return!1;if(!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:n}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=e;t=t.rotate({deltaAngleX:this._startPinchRotation-n})}return this.updateViewport(t,nx,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),this._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t,_lastPinchEvent:n}=this;if(this.touchZoom&&t&&n&&e.scale!==n.scale){const i=this.getCenter(e);let r=this.controllerState.rotateEnd();const s=Math.log2(e.scale),o=(s-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),a=Math.pow(2,s+o*t/2);r=r.zoom({pos:i,scale:a}).zoomEnd(),this.updateViewport(r,{...this._getTransitionProps({around:i}),transitionDuration:t,transitionEasing:rx},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const e=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return this._startPinchRotation=null,this._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:r,rotateSpeedY:s}=this.keyboard,{controllerState:o}=this;let a;const l={};switch(e.srcEvent.code){case"Minus":a=t?o.zoomOut(n).zoomOut(n):o.zoomOut(n),l.isZooming=!0;break;case"Equal":a=t?o.zoomIn(n).zoomIn(n):o.zoomIn(n),l.isZooming=!0;break;case"ArrowLeft":t?(a=o.rotateLeft(r),l.isRotating=!0):(a=o.moveLeft(i),l.isPanning=!0);break;case"ArrowRight":t?(a=o.rotateRight(r),l.isRotating=!0):(a=o.moveRight(i),l.isPanning=!0);break;case"ArrowUp":t?(a=o.rotateUp(s),l.isRotating=!0):(a=o.moveUp(i),l.isPanning=!0);break;case"ArrowDown":t?(a=o.rotateDown(s),l.isRotating=!0):(a=o.moveDown(i),l.isPanning=!0);break;default:return!1}return this.updateViewport(a,this._getTransitionProps(),l),!0}_getTransitionProps(e){const{_transition:t}=this;return t?e?{...t,transitionInterpolator:new LinearInterpolator({...e,transitionProps:this.linearTransitionProps,makeViewport:this.controllerState.makeViewport})}:t:nx}}class ViewState{constructor(e){Hc(this,"_viewportProps",void 0),Hc(this,"_state",void 0),this._viewportProps=this._applyConstraints(e)}getViewportProps(){return this._viewportProps}getState(){return this._state}shortestPathFrom(e){return this._viewportProps}_applyConstraints(e){return e}}const dx={pitch:0,bearing:0,altitude:1.5,minZoom:0,maxZoom:20,minPitch:0,maxPitch:60,position:[0,0,0]};class MapState extends ViewState{constructor(e){e={...dx,...e};const{makeViewport:t,width:n,height:i,latitude:r,longitude:s,zoom:o,bearing:a,pitch:l,altitude:c,position:u,maxZoom:d,minZoom:h,maxPitch:p,minPitch:f,startPanLngLat:m,startZoomLngLat:g,startRotatePos:y,startBearing:v,startPitch:b,startZoom:w,normalize:x}=e||{};Ih(Number.isFinite(s)),Ih(Number.isFinite(r)),Ih(Number.isFinite(o)),super({width:n,height:i,latitude:r,longitude:s,zoom:o,bearing:a,pitch:l,altitude:c,maxZoom:d,minZoom:h,maxPitch:p,minPitch:f,normalize:x,position:u}),this._state={startPanLngLat:m,startZoomLngLat:g,startRotatePos:y,startBearing:v,startPitch:b,startZoom:w},this.makeViewport=t}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const n=this._state.startPanLngLat||this._unproject(t);if(!n)return this;const i=this.makeViewport(this._viewportProps).panByPosition(n,e);return this._getUpdatedState(i)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:n=0}){const{startRotatePos:i,startBearing:r,startPitch:s}=this._state;if(!i||!Number.isFinite(r)||!Number.isFinite(s))return this;let o;return o=e?this._calculateNewPitchAndBearing({...this._getRotationParams(e,i),startBearing:r,startPitch:s}):{bearing:r+t,pitch:s+n},this._getUpdatedState(o)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this._viewportProps.zoom})}zoom({pos:e,startPos:t,scale:n}){let{startZoom:i,startZoomLngLat:r}=this._state;Number.isFinite(i)||(i=this._viewportProps.zoom,r=this._unproject(t)||this._unproject(e));const s=this._calculateNewZoom({scale:n,startZoom:i}),o=this.makeViewport({...this._viewportProps,zoom:s});return this._getUpdatedState({zoom:s,...o.panByPosition(r,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this._viewportProps.bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this._viewportProps.bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this._viewportProps.pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this._viewportProps.pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),n={...this._viewportProps},{bearing:i,longitude:r}=n;return Math.abs(i-t.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(r-t.longitude)>180&&(n.longitude=r<0?r+360:r-360),n}_zoomFromCenter(e){const{width:t,height:n}=this._viewportProps;return this.zoom({pos:[t/2,n/2],scale:e})}_panFromCenter(e){const{width:t,height:n}=this._viewportProps;return this.pan({startPos:[t/2,n/2],pos:[t/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this._viewportProps,...this._state,...e})}_applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:i}=e;e.zoom=sh(i,n,t);const{maxPitch:r,minPitch:s,pitch:o}=e;e.pitch=sh(o,s,r);const{normalize:a=!0}=e;return a&&Object.assign(e,function(e){const{width:t,height:n,pitch:i=0}=e;let{longitude:r,latitude:s,zoom:o,bearing:a=0}=e;(r<-180||r>180)&&(r=Qm(r+180,360)-180),(a<-180||a>180)&&(a=Qm(a+180,360)-180);const l=ng(n/512);if(o<=l)o=l,s=0;else{const e=n/2/Math.pow(2,o),t=mg([0,e])[1];if(s<t)s=t;else{const t=mg([0,512-e])[1];s>t&&(s=t)}}return{width:t,height:n,longitude:r,latitude:s,zoom:o,pitch:i,bearing:a}}(e)),e}_unproject(e){const t=this.makeViewport(this._viewportProps);return e&&t.unproject(e)}_calculateNewZoom({scale:e,startZoom:t}){const{maxZoom:n,minZoom:i}=this._viewportProps;return sh(t+Math.log2(e),i,n)}_calculateNewPitchAndBearing({deltaScaleX:e,deltaScaleY:t,startBearing:n,startPitch:i}){t=sh(t,-1,1);const{minPitch:r,maxPitch:s}=this._viewportProps;let o=i;return t>0?o=i+t*(s-i):t<0&&(o=i-t*(r-i)),{pitch:o,bearing:n+180*e}}_getRotationParams(e,t){const n=e[0]-t[0],i=e[1]-t[1],r=e[1],s=t[1],{width:o,height:a}=this._viewportProps,l=n/o;let c=0;return i>0?Math.abs(a-s)>5&&(c=i/(s-a)*1.2):i<0&&s>5&&(c=1-r/s),c=Math.min(1,Math.max(-1,c)),{deltaScaleX:l,deltaScaleY:c}}}class MapController extends controller_Controller{constructor(e){e.dragMode=e.dragMode||"pan",super(MapState,e)}setProps(e){e.position=e.position||[0,0,0];const t=this.controllerStateProps;super.setProps(e);(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...this.controllerStateProps,...this._state}))}get linearTransitionProps(){return["longitude","latitude","zoom","bearing","pitch","position"]}}class MapView extends View{constructor(e){super({...e,type:web_mercator_viewport_WebMercatorViewport})}get controller(){return this._getControllerProps({type:MapController})}}MapView.displayName="MapView";const hx=[255,255,255],px=1;let fx=0;class AmbientLight{constructor(e={}){const{color:t=hx}=e,{intensity:n=px}=e;this.id=e.id||"ambient-".concat(fx++),this.color=t,this.intensity=n,this.type="ambient"}}const mx=[255,255,255],gx=1,yx=[0,0,-1];let vx=0;class DirectionalLight{constructor(e={}){const{color:t=mx}=e,{intensity:n=gx}=e,{direction:i=yx}=e,{_shadow:r=!1}=e;this.id=e.id||"directional-".concat(vx++),this.color=t,this.intensity=n,this.type="directional",this.direction=new vector3_Vector3(i).normalize().toArray(),this.shadow=r}getProjectedLight(){return this}}class Effect{constructor(e={}){Hc(this,"id",void 0),Hc(this,"props",void 0),Hc(this,"useInPicking",void 0);const{id:t="effect"}=e;this.id=t,this.props={...e},this.useInPicking=!1}preRender(){}getModuleParameters(e){}cleanup(){}}class LayersPass extends class Pass{constructor(e,t={id:"pass"}){Hc(this,"id",void 0),Hc(this,"gl",void 0),Hc(this,"props",void 0);const{id:n}=t;this.id=n,this.gl=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}{render(e){return Qu(this.gl,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:t,moduleParameters:n,viewports:i,views:r,onViewportActive:s,clearCanvas:o=!0}=e;e.pass=e.pass||"unknown";const a=this.gl;o&&function(e){const t=e.drawingBufferWidth,n=e.drawingBufferHeight;Qu(e,{viewport:[0,0,t,n]}),e.clear(16640)}(a);const l=[];for(const o of i){const i=r&&r[o.id];s(o);const c=this._getDrawLayerParams(o,e),u=o.subViewports||[o];for(const r of u){const s=this._drawLayersInViewport(a,{target:t,moduleParameters:n,viewport:r,view:i,pass:e.pass,layers:e.layers},c);l.push(s)}}return l}_getDrawLayerParams(e,{layers:t,pass:n,layerFilter:i,effects:r,moduleParameters:s}){const o=[],a=bx(),l={layer:t[0],viewport:e,isPicking:n.startsWith("picking"),renderPass:n},c={};for(let u=0;u<t.length;u++){const d=t[u],h=this._shouldDrawLayer(d,l,i,c),p={shouldDrawLayer:h,layerRenderIndex:a(d,h)};h&&(p.moduleParameters=this._getModuleParameters(d,r,n,s),p.layerParameters=this.getLayerParameters(d,u,e)),o[u]=p}return o}_drawLayersInViewport(e,{layers:t,moduleParameters:n,pass:i,target:r,viewport:s,view:o},a){const l=function(e,{moduleParameters:t,target:n,viewport:i}){const r=n&&"default-framebuffer"!==n.id,s=t&&t.devicePixelRatio||td(e),o=r?n.height:e.drawingBufferHeight,a=i;return[a.x*s,o-(a.y+a.height)*s,a.width*s,a.height*s]}(e,{moduleParameters:n,target:r,viewport:s});if(o&&o.props.clear){const t=!0===o.props.clear?{color:!0,depth:!0}:o.props.clear;ed(e,{scissorTest:!0,scissor:l},(()=>Ud(e,t)))}const c={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};Qu(e,{viewport:l});for(let e=0;e<t.length;e++){const n=t[e],{shouldDrawLayer:r,layerRenderIndex:o,moduleParameters:l,layerParameters:u}=a[e];if(r&&n.props.pickable&&c.pickableCount++,n.isComposite)c.compositeCount++;else if(r){c.visibleCount++,l.viewport=s;try{n.drawLayer({moduleParameters:l,uniforms:{layerIndex:o},parameters:u})}catch(e){n.raiseError(e,"drawing ".concat(n," to ").concat(i))}}}return c}shouldDrawLayer(e){return!0}getModuleParameters(e,t){return null}getLayerParameters(e,t,n){return e.props.parameters}_shouldDrawLayer(e,t,n,i){if(!(this.shouldDrawLayer(e)&&e.props.visible))return!1;t.layer=e;let r=e.parent;for(;r;){if(!r.props.visible||!r.filterSubLayer(t))return!1;t.layer=r,r=r.parent}if(n){const e=t.layer.id;if(e in i||(i[e]=n(t)),!i[e])return!1}return e.activateViewport(t.viewport),!0}_getModuleParameters(e,t,n,i){var r;const s=Object.assign(Object.create((null===(r=e.internalState)||void 0===r?void 0:r.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:td(this.gl)});if(t)for(const n of t)Object.assign(s,n.getModuleParameters(e));return Object.assign(s,this.getModuleParameters(e,t),i)}}function bx(e=0,t={}){const n={},i=(r,s)=>{const o=r.props._offset,a=r.id,l=r.parent&&r.parent.id;let c;if(l&&!(l in t)&&i(r.parent,!1),l in n){const e=n[l]=n[l]||bx(t[l],t);c=e(r,s),n[a]=e}else Number.isFinite(o)?(c=o+(t[l]||0),n[a]=null):c=e;return s&&c>=e&&(e=c+1),t[a]=c,c};return i}class ShadowPass extends LayersPass{constructor(e,t){super(e,t),Hc(this,"shadowMap",void 0),Hc(this,"depthBuffer",void 0),Hc(this,"fbo",void 0),this.shadowMap=new Texture2D(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new Renderbuffer(e,{format:33189,width:1,height:1}),this.fbo=new Framebuffer(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const t=this.fbo;ed(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},(()=>{const n=e.viewports[0],i=td(this.gl),r=n.width*i,s=n.height*i;r===t.width&&s===t.height||t.resize({width:r,height:s}),super.render({...e,target:t,pass:"shadow"})}))}shouldDrawLayer(e){return!1!==e.props.shadowEnabled}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const wx=gm((function({viewport:e,center:t}){return new matrix4_Matrix4(e.viewProjectionMatrix).invert().transform(t)})),xx=gm((function({viewport:e,shadowMatrices:t}){const n=[],i=e.pixelUnprojectionMatrix,r=e.isGeospatial?void 0:1,s=[[0,0,r],[e.width,0,r],[0,e.height,r],[e.width,e.height,r],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map((e=>function(e,t){const[n,i,r]=e,s=_g([n,i,r],t);if(Number.isFinite(r))return s;return[s[0],s[1],0]}(e,i)));for(const i of t){const t=i.clone().translate(new vector3_Vector3(e.center).negate()),r=s.map((e=>t.transform(e))),o=(new matrix4_Matrix4).ortho({left:Math.min(...r.map((e=>e[0]))),right:Math.max(...r.map((e=>e[0]))),bottom:Math.min(...r.map((e=>e[1]))),top:Math.max(...r.map((e=>e[1]))),near:Math.min(...r.map((e=>-e[2]))),far:Math.max(...r.map((e=>-e[2])))});n.push(o.multiplyRight(i))}return n})),_x=[0,0,0,1],Ex=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];const Sx={name:"shadow",dependencies:[Av],vs:"\nconst int max_lights = 2;\nuniform mat4 shadow_uViewProjectionMatrices[max_lights];\nuniform vec4 shadow_uProjectCenters[max_lights];\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform int shadow_uLightId;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\n  if (shadow_uDrawShadowMap) {\n    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);\n  }\n  if (shadow_uUseShadowMap) {\n    for (int i = 0; i < max_lights; i++) {\n      if(i < int(shadow_uLightCount)) {\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\n      }\n    }\n  }\n  return gl_Position;\n}\n",fs:"\nconst int max_lights = 2;\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform sampler2D shadow_uShadowMap0;\nuniform sampler2D shadow_uShadowMap1;\nuniform vec4 shadow_uColor;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\n\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\n  vec4 rgbaDepth = texture2D(shadowMap, position.xy);\n\n  float z = dot(rgbaDepth, bitUnpackShift);\n  return smoothstep(0.001, 0.01, position.z - z);\n}\n\nvec4 shadow_filterShadowColor(vec4 color) {\n  if (shadow_uDrawShadowMap) {\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\n    return rgbaDepth;\n  }\n  if (shadow_uUseShadowMap) {\n    float shadowAlpha = 0.0;\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\n    if(shadow_uLightCount > 1.0) {\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\n    }\n    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\n\n    return vec4(\n      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),\n      blendedAlpha\n    );\n  }\n  return color;\n}\n",inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    position = shadow_setVertexPosition(geometry.position);\n    ","fs:DECKGL_FILTER_COLOR":"\n    color = shadow_filterShadowColor(color);\n    "},getUniforms:(e={},t={})=>{if(e.drawToShadowMap||e.shadowMaps&&e.shadowMaps.length>0){const{shadowEnabled:n=!0}=e;return n&&e.shadowMatrices&&e.shadowMatrices.length>0?function(e={},t={}){const n={shadow_uDrawShadowMap:Boolean(e.drawToShadowMap),shadow_uUseShadowMap:!!e.shadowMaps&&e.shadowMaps.length>0,shadow_uColor:e.shadowColor||_x,shadow_uLightId:e.shadowLightId||0,shadow_uLightCount:e.shadowMatrices.length},i=wx({viewport:e.viewport,center:t.project_uCenter}),r=[],s=xx({shadowMatrices:e.shadowMatrices,viewport:e.viewport}).slice();for(let n=0;n<e.shadowMatrices.length;n++){const o=s[n],a=o.clone().translate(new vector3_Vector3(e.viewport.center).negate());t.project_uCoordinateSystem===uu.LNGLAT&&t.project_uProjectionMode===du.WEB_MERCATOR?(s[n]=a,r[n]=i):(s[n]=o.clone().multiplyRight(Ex),r[n]=a.transform(i))}for(let t=0;t<s.length;t++)n["shadow_uViewProjectionMatrices[".concat(t,"]")]=s[t],n["shadow_uProjectCenters[".concat(t,"]")]=r[t],e.shadowMaps&&e.shadowMaps.length>0?n["shadow_uShadowMap".concat(t)]=e.shadowMaps[t]:n["shadow_uShadowMap".concat(t)]=e.dummyShadowMap;return n}(e,t):{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1}}return{}}},Cx={color:[255,255,255],intensity:1},Tx=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Ax=[0,0,0,200/255];class LightingEffect extends Effect{constructor(e){super(e),this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowColor=Ax,this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.shadow=!1,this.programManager=null;for(const t in e){const n=e[t];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n)}}this._applyDefaultLights(),this.shadow=this.directionalLights.some((e=>e.shadow))}preRender(e,{layers:t,layerFilter:n,viewports:i,onViewportActive:r,views:s}){if(this.shadow){this.shadowMatrices=this._createLightMatrix(),0===this.shadowPasses.length&&this._createShadowPasses(e),this.programManager||(this.programManager=ProgramManager.getDefaultProgramManager(e),Sx&&this.programManager.addDefaultModule(Sx)),this.dummyShadowMap||(this.dummyShadowMap=new Texture2D(e,{width:1,height:1}));for(let e=0;e<this.shadowPasses.length;e++){this.shadowPasses[e].render({layers:t,layerFilter:n,viewports:i,onViewportActive:r,views:s,moduleParameters:{shadowLightId:e,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}}getModuleParameters(e){const t=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return t.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map((t=>t.getProjectedLight({layer:e}))),pointLights:this.pointLights.map((t=>t.getProjectedLight({layer:e})))},t}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(Sx),this.programManager=null)}_createLightMatrix(){const e=[];for(const t of this.directionalLights){const n=(new matrix4_Matrix4).lookAt({eye:new vector3_Vector3(t.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const n=new ShadowPass(e);this.shadowPasses[t]=n,this.shadowMaps[t]=n.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:n}=this;e||0!==t.length||0!==n.length||(this.ambientLight=new AmbientLight(Cx),this.directionalLights.push(new DirectionalLight(Tx[0]),new DirectionalLight(Tx[1])))}}class MaskPass extends LayersPass{constructor(e,t){super(e,t),Hc(this,"maskMap",void 0),Hc(this,"fbo",void 0);const{mapSize:n=2048}=t;this.maskMap=new Texture2D(e,{width:n,height:n,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.fbo=new Framebuffer(e,{id:"maskmap",width:n,height:n,attachments:{36064:this.maskMap}})}render(e){const t=this.gl,n=[!1,!1,!1,!1];return n[e.channel]=!0,ed(t,{clearColor:[255,255,255,255],blend:!0,blendFunc:[0,1],blendEquation:32778,colorMask:n,depthTest:!1},(()=>super.render({...e,target:this.fbo,pass:"mask"})))}shouldDrawLayer(e){return e.props.operation===mu}delete(){this.fbo.delete(),this.maskMap.delete()}}const kx=0,Nx=0,Mx=0,Px=[0,0,0],Lx=-90,Ox=90,Rx=-1/0,Ix=1/0;class OrbitState extends ViewState{constructor({makeViewport:e,width:t,height:n,rotationX:i=kx,rotationOrbit:r=Nx,target:s=Px,zoom:o=Mx,minRotationX:a=Lx,maxRotationX:l=Ox,minZoom:c=Rx,maxZoom:u=Ix,startPanPosition:d,startRotatePos:h,startRotationX:p,startRotationOrbit:f,startZoomPosition:m,startZoom:g}){super({width:t,height:n,rotationX:i,rotationOrbit:r,target:s,zoom:o,minRotationX:a,maxRotationX:l,minZoom:c,maxZoom:u}),this._state={startPanPosition:d,startRotatePos:h,startRotationX:p,startRotationOrbit:f,startZoomPosition:m,startZoom:g},this.makeViewport=e}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:t}){const n=this._state.startPanPosition||t;if(!n)return this;const i=this.makeViewport(this._viewportProps).panByPosition(n,e);return this._getUpdatedState(i)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this._viewportProps.rotationX,startRotationOrbit:this._viewportProps.rotationOrbit})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:n=0}){const{startRotatePos:i,startRotationX:r,startRotationOrbit:s}=this._state,{width:o,height:a}=this._viewportProps;if(!i||!Number.isFinite(r)||!Number.isFinite(s))return this;let l;if(e){let t=(e[0]-i[0])/o;const n=(e[1]-i[1])/a;(r<-90||r>90)&&(t*=-1),l={rotationX:r+180*n,rotationOrbit:s+180*t}}else l={rotationX:r+n,rotationOrbit:s+t};return this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const t=e.getViewportProps(),n={...this._viewportProps},{rotationOrbit:i}=n;return Math.abs(i-t.rotationOrbit)>180&&(n.rotationOrbit=i<0?i+360:i-360),n}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this._viewportProps.zoom})}zoom({pos:e,startPos:t,scale:n}){const{zoom:i}=this._viewportProps;let{startZoom:r,startZoomPosition:s}=this._state;Number.isFinite(r)||(r=i,s=this._unproject(t)||this._unproject(e));const o=this._calculateNewZoom({scale:n,startZoom:r}),a=this.makeViewport({...this._viewportProps,zoom:o});return this._getUpdatedState({zoom:o,...a.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this._viewportProps.rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this._viewportProps.rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this._viewportProps.rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this._viewportProps.rotationX+e})}_unproject(e){const t=this.makeViewport(this._viewportProps);return e&&t.unproject(e)}_calculateNewZoom({scale:e,startZoom:t}){const{maxZoom:n,minZoom:i}=this._viewportProps;Number.isFinite(t)||(t=this._viewportProps.zoom);return sh(t+Math.log2(e),i,n)}_panFromCenter(e){const{width:t,height:n,target:i}=this._viewportProps;return this.pan({startPosition:i,pos:[t/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({...this._viewportProps,...this._state,...e})}_applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:i,maxRotationX:r,minRotationX:s,rotationOrbit:o}=e;return e.zoom=sh(i,n,t),e.rotationX=sh(e.rotationX,s,r),(o<-180||o>180)&&(e.rotationOrbit=function(e,t){const n=e%t;return n<0?t+n:n}(o+180,360)-180),e}}class OrthographicState extends OrbitState{constructor(e){super(e),Hc(this,"zoomAxis",void 0),this.zoomAxis=e.zoomAxis||"all"}_applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:i}=e;return e.zoom=Array.isArray(i)?[sh(i[0],n,t),sh(i[1],n,t)]:sh(i,n,t),e}_calculateNewZoom({scale:e,startZoom:t}){const{maxZoom:n,minZoom:i}=this._viewportProps;t||0===t||(t=this._viewportProps.zoom);let r=Math.log2(e);if(Array.isArray(t)){let[e,s]=t;switch(this.zoomAxis){case"X":e=sh(e+r,i,n);break;case"Y":s=sh(s+r,i,n);break;default:let t=Math.min(e+r,s+r);t<i&&(r+=i-t),t=Math.max(e+r,s+r),t>n&&(r+=n-t),e+=r,s+=r}return[e,s]}return sh(t+r,i,n)}}class OrthographicController extends controller_Controller{constructor(e){e.dragMode=e.dragMode||"pan",super(OrthographicState,e)}_onPanRotate(e){return!1}get linearTransitionProps(){return["target","zoom"]}}const Dx=(new matrix4_Matrix4).lookAt({eye:[0,0,1]});function Fx({width:e,height:t,near:n,far:i}){return e=e||1,t=t||1,(new matrix4_Matrix4).ortho({left:-e/2,right:e/2,bottom:-t/2,top:t/2,near:n,far:i})}class OrthographicViewport extends Viewport{constructor(e){const{width:t,height:n,near:i=.1,far:r=1e3,zoom:s=0,target:o=[0,0,0],flipY:a=!0}=e,l=Array.isArray(s)?s[0]:s,c=Array.isArray(s)?s[1]:s,u=Math.min(l,c),d=Math.pow(2,u);let h;if(l!==c){const e=Math.pow(2,l),t=Math.pow(2,c);h={unitsPerMeter:[e/d,t/d,1],metersPerUnit:[d/e,d/t,1]}}super({...e,longitude:null,position:o,viewMatrix:Dx.clone().scale([d,d*(a?-1:1),d]),projectionMatrix:Fx({width:t,height:n,near:i,far:r}),zoom:u,distanceScales:h})}projectFlat([e,t]){const{unitsPerMeter:n}=this.distanceScales;return[e*n[0],t*n[1]]}unprojectFlat([e,t]){const{metersPerUnit:n}=this.distanceScales;return[e*n[0],t*n[1]]}panByPosition(e,t){const n=_g(t,this.pixelUnprojectionMatrix),i=Bm([],this.projectFlat(e),jm([],n)),r=Bm([],this.center,i);return{target:this.unprojectFlat(r)}}}class OrthographicView extends View{constructor(e){super({...e,type:OrthographicViewport})}get controller(){return this._getControllerProps({type:OrthographicController})}}OrthographicView.displayName="OrthographicView";class MaskEffect extends Effect{constructor(e){super(e),this.dummyMaskMap=null,this.useInPicking=!0,this.channels=[],this.masks=null}preRender(e,{layers:t,layerFilter:n,viewports:i,onViewportActive:r,views:s}){this.dummyMaskMap||(this.dummyMaskMap=new Texture2D(e,{width:1,height:1}));const o=t.filter((e=>e.props.operation===mu&&e.props.visible));if(0===o.length)return this.masks=null,void(this.channels.length=0);this.masks={},this.maskPass||(this.maskPass=new MaskPass(e,{id:"default-mask"}),this.maskMap=this.maskPass.maskMap);const a=this._sortMaskChannels(o),l=i[0],c=!this.lastViewport||!this.lastViewport.equals(l);for(const e in a)this._renderChannel(a[e],{layerFilter:n,onViewportActive:r,views:s,viewport:l,viewportChanged:c})}_renderChannel(e,{layerFilter:t,onViewportActive:n,views:i,viewport:r,viewportChanged:s}){const o=this.channels[e.index],a=e===o||o.layers.length!==e.layers.length||e.layerBounds.some(((e,t)=>e!==o.layerBounds[t]));if(e.bounds=o.bounds,e.maskBounds=o.maskBounds,this.channels[e.index]=e,(a||s)&&(this.lastViewport=r,e.bounds=function({layers:e,viewport:t}){let n=null;for(const t of e){const e=t.getBounds();e&&(n?(n[0]=Math.min(n[0],e[0][0]),n[1]=Math.min(n[1],e[0][1]),n[2]=Math.max(n[2],e[1][0]),n[3]=Math.max(n[3],e[1][1])):n=[e[0][0],e[0][1],e[1][0],e[1][1]])}const i=t.getBounds();if(!n)return i;const r=function(e){const t={x:e[2]-e[0],y:e[3]-e[1]},n={x:e[0]+.5*t.x,y:e[1]+.5*t.y};return[n.x-t.x,n.y-t.y,n.x+t.x,n.y+t.y]}(i);return n[2]-n[0]<r[2]-r[0]||n[3]-n[1]<r[3]-r[1]||(n[0]=Math.max(n[0],r[0]),n[1]=Math.max(n[1],r[1]),n[2]=Math.min(n[2],r[2]),n[3]=Math.min(n[3],r[3])),n}({layers:e.layers,viewport:r}),a||!ah(e.bounds,o.bounds))){const{maskPass:s,maskMap:o}=this,a=function({bounds:e,viewport:t,width:n,height:i}){if(e[2]<=e[0]||e[3]<=e[1])return null;if(n-=2,i-=2,t instanceof web_mercator_viewport_WebMercatorViewport){const{longitude:t,latitude:r,zoom:s}=Eg({width:n,height:i,bounds:[[e[0],e[1]],[e[2],e[3]]],maxZoom:20});return new web_mercator_viewport_WebMercatorViewport({longitude:t,latitude:r,zoom:s,x:1,y:1,width:n,height:i})}const r=[(e[0]+e[2])/2,(e[1]+e[3])/2,0],s=Math.min(20,n/(e[2]-e[0]),i/(e[3]-e[1]));return new OrthographicView({x:1,y:1}).makeViewport({width:n,height:i,viewState:{target:r,zoom:Math.log2(s)}})}({bounds:e.bounds,viewport:r,width:o.width,height:o.height});e.maskBounds=a?a.getBounds():[0,0,1,1],s.render({channel:e.index,layers:e.layers,layerFilter:t,viewports:a?[a]:[],onViewportActive:n,views:i,moduleParameters:{devicePixelRatio:1}})}this.masks[e.id]={index:e.index,bounds:e.maskBounds,coordinateOrigin:e.coordinateOrigin,coordinateSystem:e.coordinateSystem}}_sortMaskChannels(e){const t={};let n=0;for(const i of e){const{id:e}=i.root;let r=t[e];if(!r){if(++n>4){cu.warn("Too many mask layers. The max supported is 4")();continue}r={id:e,index:this.channels.findIndex((t=>(null==t?void 0:t.id)===e)),layers:[],layerBounds:[],coordinateOrigin:i.root.props.coordinateOrigin,coordinateSystem:i.root.props.coordinateSystem},t[e]=r}r.layers.push(i),r.layerBounds.push(i.getBounds())}for(let e=0;e<4;e++){const n=this.channels[e];n&&n.id in t||(this.channels[e]=null)}for(const e in t){const n=t[e];n.index<0&&(n.index=this.channels.findIndex((e=>!e)),this.channels[n.index]=n)}return t}getModuleParameters(){return{maskMap:this.masks?this.maskMap:this.dummyMaskMap,maskChannels:this.masks}}cleanup(){this.dummyMaskMap&&(this.dummyMaskMap.delete(),this.dummyMaskMap=null),this.maskPass&&(this.maskPass.delete(),this.maskPass=null,this.maskMap=null),this.lastViewport=null,this.masks=null,this.channels.length=0}}const Bx=new LightingEffect;class EffectManager{constructor(){Hc(this,"effects",void 0),Hc(this,"_internalEffects",void 0),Hc(this,"_needsRedraw",void 0),this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}setProps(e){"effects"in e&&(e.effects.length===this.effects.length&&jg(e.effects,this.effects)||(this.setEffects(e.effects),this._needsRedraw="effects changed"))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._internalEffects}finalize(){this.cleanup()}setEffects(e=[]){this.cleanup(),this.effects=e,this._internalEffects=e.slice(),this._internalEffects.push(new MaskEffect),e.some((e=>e instanceof LightingEffect))||this._internalEffects.push(Bx)}cleanup(){for(const e of this.effects)e.cleanup();for(const e of this._internalEffects)e.cleanup();this.effects.length=0,this._internalEffects.length=0}}class DrawLayersPass extends LayersPass{shouldDrawLayer(e){return e.props.operation===fu}}const zx={blendFunc:[1,0,32771,0],blendEquation:32774};class PickLayersPass extends LayersPass{constructor(...e){super(...e),Hc(this,"pickZ",void 0),Hc(this,"_colors",null)}render(e){return e.pickingFBO?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:n,viewports:i,onViewportActive:r,pickingFBO:s,deviceRect:{x:o,y:a,width:l,height:c},effects:u,pass:d="picking",pickZ:h}){const p=this.gl;this.pickZ=h;const f=h?null:{byLayer:new Map,byAlpha:[]};this._colors=f;const m=ed(p,{scissorTest:!0,scissor:[o,a,l,c],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...zx,blend:!h},(()=>super.render({target:s,layers:e,layerFilter:t,views:n,viewports:i,onViewportActive:r,effects:null==u?void 0:u.filter((e=>e.useInPicking)),pass:d})));this._colors=null;return{decodePickingColor:f&&jx.bind(null,f),stats:m}}shouldDrawLayer(e){return e.props.pickable&&e.props.operation===fu}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,t,n){const i={...e.props.parameters};return this._colors?(Object.assign(i,zx),i.blend=!0,i.blendColor=function(e,t,n){const{byLayer:i,byAlpha:r}=e;let s,o=i.get(t);o?(o.viewports.push(n),s=o.a):(s=i.size+1,s<=255?(o={a:s,layer:t,viewports:[n]},i.set(t,o),r[s]=o):(cu.warn("Too many pickable layers, only picking the first 255")(),s=0));return[0,0,0,s/255]}(this._colors,e,n)):i.blend=!1,i}}function jx(e,t){const n=e.byAlpha[t[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(t)}}class DeckRenderer{constructor(e){this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new DrawLayersPass(e),this.pickLayersPass=new PickLayersPass(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){"layerFilter"in e&&this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in e&&this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;e.layerFilter=e.layerFilter||this.layerFilter,e.effects=e.effects||[],e.target=e.target||Framebuffer.getDefaultFramebuffer(this.gl),this._preRender(e.effects,e);const n=this.lastPostProcessEffect?this.renderBuffers[0]:e.target,i=t.render({...e,target:n});this._postRender(e.effects,e),this.renderCount++,tp("deckRenderer.renderLayers",this,i,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){let n=null;for(const i of e)i.preRender(this.gl,t),i.postRender&&(n=i);n&&this._resizeRenderBuffers(),this.lastPostProcessEffect=n}_resizeRenderBuffers(){const{renderBuffers:e}=this;0===e.length&&e.push(new Framebuffer(this.gl),new Framebuffer(this.gl));for(const t of e)t.resize()}_postRender(e,t){const{renderBuffers:n}=this,i={inputBuffer:n[0],swapBuffer:n[1],target:null};for(const r of e)if(r.postRender){if(r===this.lastPostProcessEffect){i.target=t.target,r.postRender(this.gl,i);break}const e=r.postRender(this.gl,i);i.inputBuffer=e,i.swapBuffer=e===n[0]?n[1]:n[0]}}}const Vx={pickedColor:null,pickedLayer:null,pickedObjectIndex:-1};function Ux({pickedColors:e,decodePickingColor:t,deviceX:n,deviceY:i,deviceRadius:r,deviceRect:s}){if(e){const{x:o,y:a,width:l,height:c}=s;let u=r*r,d=-1,h=0;for(let t=0;t<c;t++){const r=t+a-i,s=r*r;if(s>u)h+=4*l;else for(let t=0;t<l;t++){if(e[h+3]-1>=0){const e=t+o-n,i=e*e+s;i<=u&&(u=i,d=h)}h+=4}}if(d>=0){const n=e.slice(d,d+4),i=t(n);if(i){const e=Math.floor(d/4/l),t=d/4-e*l;return{...i,pickedColor:n,pickedX:o+t,pickedY:a+e}}cu.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return Vx}function Hx({pickInfo:e,viewports:t,pixelRatio:n,x:i,y:r,z:s}){let o=t[0];t.length>1&&(o=function(e,t){for(let n=e.length-1;n>=0;n--){const i=e[n];if(i.containsPixel(t))return i}return e[0]}((null==e?void 0:e.pickedViewports)||t,{x:i,y:r}));const a=o&&o.unproject([i-o.x,r-o.y,s]);return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:i,y:r,pixel:[i,r],coordinate:a,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:null,pixelRatio:n}}function $x(e){const{pickInfo:t,lastPickedInfo:n,mode:i,layers:r}=e,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=t,l=o?[o]:[];if("hover"===i){const e=n.index,t=n.layerId,i=o&&o.props.id;if(i!==t||a!==e){if(i!==t){const e=r.find((e=>e.props.id===t));e&&l.unshift(e)}n.layerId=i,n.index=a,n.info=null}}const c=Hx(e),u=new Map;return u.set(null,c),l.forEach((e=>{let t={...c};e===o&&(t.color=s,t.index=a,t.picked=!0),t=qx({layer:e,info:t,mode:i}),e===o&&"hover"===i&&(n.info=t),u.set(t.layer.id,t),"hover"===i&&t.layer.updateAutoHighlight(t)})),u}function qx({layer:e,info:t,mode:n}){for(;e&&t;){const i=t.layer||null;t.sourceLayer=i,t.layer=e,t=e.getPickingInfo({info:t,mode:n,sourceLayer:i}),e=e.parent}return t}class DeckPicker{constructor(e){this.gl=e,this.pickingFBO=null,this.pickLayersPass=new PickLayersPass(e),this.layerFilter=null,this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:n,viewports:i},r=this.lastPickedInfo.info){const s=r&&r.layer&&r.layer.id,o=r&&r.viewport&&r.viewport.id,a=s?n.find((e=>e.id===s)):null,l=o&&i.find((e=>e.id===o))||i[0],c=l&&l.unproject([e-l.x,t-l.y]),u={x:e,y:t,viewport:l,coordinate:c,layer:a};return{...r,...u}}_resizeBuffer(){const{gl:e}=this;return this.pickingFBO||(this.pickingFBO=new Framebuffer(e),Framebuffer.isSupported(e,{colorBufferFloat:!0})&&(this.depthFBO=new Framebuffer(e),this.depthFBO.attach({36064:new Texture2D(e,{format:wu(e)?34836:6408,type:5126})}))),this.pickingFBO.resize({width:e.canvas.width,height:e.canvas.height}),this.depthFBO&&this.depthFBO.resize({width:e.canvas.width,height:e.canvas.height}),this.pickingFBO}_getPickable(e){if(!1===this._pickable)return null;const t=e.filter((e=>e.isPickable()&&!e.isComposite));return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:n,x:i,y:r,radius:s=0,depth:o=1,mode:a="query",unproject3D:l,onViewportActive:c,effects:u}){if(!(e=this._getPickable(e)))return{result:[],emptyInfo:Hx({viewports:n,x:i,y:r})};this._resizeBuffer();const d=td(this.gl),h=nd(this.gl,[i,r],!0),p=[h.x+Math.floor(h.width/2),h.y+Math.floor(h.height/2)],f=Math.round(s*d),{width:m,height:g}=this.pickingFBO,y=this._getPickingRect({deviceX:p[0],deviceY:p[1],deviceRadius:f,deviceWidth:m,deviceHeight:g});let v;const b=[],w=new Set;for(let s=0;s<o;s++){const h=Ux({...y&&this._drawAndSample({layers:e,views:t,viewports:n,onViewportActive:c,deviceRect:y,effects:u,pass:"picking:".concat(a),redrawReason:a}),deviceX:p[0],deviceY:p[1],deviceRadius:f,deviceRect:y});let m;if(h.pickedLayer&&l&&this.depthFBO){m=this._drawAndSample({layers:[h.pickedLayer],views:t,viewports:n,onViewportActive:c,deviceRect:{x:h.pickedX,y:h.pickedY,width:1,height:1},effects:u,pass:"picking:".concat(a),redrawReason:"pick-z",pickZ:!0}).pickedColors[0]}h.pickedLayer&&s+1<o&&(w.add(h.pickedLayer),h.pickedLayer.disablePickingIndex(h.pickedObjectIndex)),v=$x({pickInfo:h,lastPickedInfo:this.lastPickedInfo,mode:a,layers:e,viewports:n,x:i,y:r,z:m,pixelRatio:d});for(const e of v.values())e.layer&&b.push(e);if(!h.pickedColor)break}for(const e of w)e.restorePickingColors();return{result:b,emptyInfo:v&&v.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:n,x:i,y:r,width:s=1,height:o=1,mode:a="query",maxObjects:l=null,onViewportActive:c,effects:u}){if(!(e=this._getPickable(e)))return[];this._resizeBuffer();const d=td(this.gl),h=nd(this.gl,[i,r],!0),p=h.x,f=h.y+h.height,m=nd(this.gl,[i+s,r+o],!0),g=m.x+m.width,y=m.y,v={x:p,y,width:g-p,height:f-y},b=function({pickedColors:e,decodePickingColor:t}){const n=new Map;if(e)for(let i=0;i<e.length;i+=4)if(e[i+3]-1>=0){const r=e.slice(i,i+4),s=r.join(",");if(!n.has(s)){const e=t(r);e?n.set(s,{...e,pickedColor:r}):cu.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return Array.from(n.values())}(this._drawAndSample({layers:e,views:t,viewports:n,onViewportActive:c,deviceRect:v,effects:u,pass:"picking:".concat(a),redrawReason:a})),w=new Map,x=Number.isFinite(l);for(let e=0;e<b.length&&!(x&&w.size>=l);e++){const t=b[e];let n={color:t.pickedColor,layer:null,index:t.pickedObjectIndex,picked:!0,x:i,y:r,width:s,height:o,pixelRatio:d};n=qx({layer:t.pickedLayer,info:n,mode:a}),w.has(n.object)||w.set(n.object,n)}return Array.from(w.values())}_drawAndSample({layers:e,views:t,viewports:n,onViewportActive:i,deviceRect:r,effects:s,pass:o,redrawReason:a,pickZ:l}){const c=l?this.depthFBO:this.pickingFBO,{decodePickingColor:u}=this.pickLayersPass.render({layers:e,layerFilter:this.layerFilter,views:t,viewports:n,onViewportActive:i,pickingFBO:c,deviceRect:r,effects:s,pass:o,redrawReason:a,pickZ:l}),{x:d,y:h,width:p,height:f}=r,m=new(l?Float32Array:Uint8Array)(p*f*4);return Wd(c,{sourceX:d,sourceY:h,sourceWidth:p,sourceHeight:f,target:m}),{pickedColors:m,decodePickingColor:u}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:n,deviceWidth:i,deviceHeight:r}){const s=Math.max(0,e-n),o=Math.max(0,t-n),a=Math.min(i,e+n+1)-s,l=Math.min(r,t+n+1)-o;return a<=0||l<=0?null:{x:s,y:o,width:a,height:l}}}const Wx={zIndex:1,position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:0,left:0,display:"none"};class Tooltip{constructor(e){const t=e.parentElement;t&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,Wx),t.appendChild(this.el)),this.isVisible=!1}setTooltip(e,t,n){const i=this.el;if("string"==typeof e)i.innerText=e;else{if(!e)return this.isVisible=!1,void(i.style.display="none");"text"in e&&(i.innerText=e.text),"html"in e&&(i.innerHTML=e.html),"className"in e&&(i.className=e.className),Object.assign(i.style,e.style)}this.isVisible=!0,i.style.display="block",i.style.transform="translate(".concat(t,"px, ").concat(n,"px)")}remove(){this.el&&this.el.remove()}}const Gx={name:"JSON",extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function(e){const t=e[0],n=e[e.length-1];return"{"===t&&"}"===n||"["===t&&"]"===n},parseTextSync:JSON.parse},Yx="8.7.11",Xx=globalThis.deck&&globalThis.deck.VERSION;if(Xx&&Xx!==Yx)throw new Error("deck.gl - multiple versions detected: ".concat(Xx," vs ").concat(Yx));Xx||(cu.log(1,"deck.gl ".concat(Yx))(),globalThis.deck={...globalThis.deck,VERSION:Yx,version:Yx,log:cu,_registerLoggers:function(e){ep=e}},function(e){const t=tv();e=Array.isArray(e)?e:[e];for(const n of e){const e=ly(n);t.find((t=>e===t))||t.unshift(e)}}([Gx,[nb,{imagebitmap:{premultiplyAlpha:"none"}}]]));const Kx=globalThis.deck;class Query extends Resource{get[Symbol.toStringTag](){return"Query"}static isSupported(e,t=[]){const n=wu(e),i=Qd(e,Kd);let r=n||i;for(const e of t)switch(e){case"queries":r=r&&n;break;case"timers":r=r&&i;break;default:fd(!1)}return r}constructor(e,t={}){super(e,t),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(35007)}beginOcclusionQuery({conservative:e=!1}={}){return this.begin(e?36202:35887)}beginTransformFeedbackQuery(){return this.begin(35976)}begin(e){return this._queryPending||(this.target=e,this.gl2.beginQuery(this.target,this.handle)),this}end(){return this._queryPending||this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(36795)}getResult(){return this.gl2.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise(((n,i)=>{const r=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):t++>e?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(r)};requestAnimationFrame(r)})),this._pollingPromise}_createHandle(){return Query.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}const Zx=qc()&&"undefined"!=typeof document;let Jx=0;class AnimationLoop{constructor(e={}){const{onCreateContext:t=(e=>ld(e)),onAddHTML:n=null,onInitialize:i=(()=>{}),onRender:r=(()=>{}),onFinalize:s=(()=>{}),onError:o,gl:a=null,glOptions:l={},debug:c=!1,createFramebuffer:u=!1,autoResizeViewport:d=!0,autoResizeDrawingBuffer:h=!0,stats:p=pd.get("animation-loop-"+Jx++)}=e;let{useDevicePixels:f=!0}=e;"useDevicePixelRatio"in e&&(gu.deprecated("useDevicePixelRatio","useDevicePixels")(),f=e.useDevicePixelRatio),this.props={onCreateContext:t,onAddHTML:n,onInitialize:i,onRender:r,onFinalize:s,onError:o,gl:a,glOptions:l,debug:c,createFramebuffer:u},this.gl=a,this.needsRedraw=null,this.timeline=null,this.stats=p,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:d,autoResizeDrawingBuffer:h,useDevicePixels:f}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return fd("string"==typeof e),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(e={}){if(this._running)return this;this._running=!0;const t=this._getPageLoadPromise().then((()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=Query.isSupported(this.gl,["timers"])?new Query(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps)))).then((e=>{this._running&&(this._addCallbackData(e||{}),!1!==e&&this._startLoop())}));return this.props.onError&&t.catch(this.props.onError),this}redraw(){return this.isContextLost()||(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers()),this}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise((e=>{this._resolveNextFrame=e}))),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(...e){return this.props.onCreateContext(...e)}onInitialize(...e){return this.props.onInitialize(...e)}onRender(...e){return this.props.onRender(...e)}onFinalize(...e){return this.props.onFinalize(...e)}getHTMLControlValue(e,t=1){const n=document.getElementById(e);return n?Number(n.value):t}setViewParameters(){return gu.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=Zx?new Promise(((e,t)=>{Zx&&"complete"===document.readyState?e(document):window.addEventListener("load",(()=>{e(document)}))})):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):(t=e,"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t));var t}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):(t=e,"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60));var t}_renderFrame(...e){this.display?this.display._renderFrame(...e):this.onRender(...e)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:t,aspect:n}=this._getSizeAndAspect();e===this.animationProps.width&&t===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){"object"==typeof e&&null!==e&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&"undefined"!=typeof OffscreenCanvas&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?cd(this.props.gl,e):this.onCreateContext(e),!bu(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");Qu(this.gl,Du),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(t);const n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,t=this.gl.drawingBufferHeight;let n=1;const{canvas:i}=this.gl;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:e>0&&t>0&&(n=e/t),{width:e,height:t,aspect:n}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&ud(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Framebuffer(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}var Qx=n(1272),e_=n.n(Qx);const t_={mousedown:1,mousemove:2,mouseup:4};!function(e){const t=e.prototype.handler;e.prototype.handler=function(e){const n=this.store;e.button>0&&"pointerdown"===e.type&&(function(e,t){for(let n=0;n<e.length;n++)if(t(e[n]))return!0;return!1}(n,(t=>t.pointerId===e.pointerId))||n.push(e)),t.call(this,e)}}(e_().PointerEventInput),e_().MouseInput.prototype.handler=function(e){let t=t_[e.type];1&t&&e.button>=0&&(this.pressed=!0),2&t&&0===e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))};const n_=e_().Manager,i_=e_();class input_Input{constructor(e,t,n){this.element=e,this.callback=t,this.options={enable:!0,...n}}}const r_=i_?[[i_.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[i_.Rotate,{enable:!1}],[i_.Pinch,{enable:!1}],[i_.Swipe,{enable:!1}],[i_.Pan,{threshold:0,enable:!1}],[i_.Press,{enable:!1}],[i_.Tap,{event:"doubletap",taps:2,enable:!1}],[i_.Tap,{event:"anytap",enable:!1}],[i_.Tap,{enable:!1}]]:null,s_={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},o_={doubletap:["tap"]},a_={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},l_={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},c_={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},u_={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},d_="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",h_="undefined"!=typeof window?window:n.g;void 0!==n.g?n.g:window,"undefined"!=typeof document&&document;let p_=!1;try{const e={get passive(){return p_=!0,!0}};h_.addEventListener("test",null,e),h_.removeEventListener("test",null)}catch(e){p_=!1}const f_=-1!==d_.indexOf("firefox"),{WHEEL_EVENTS:m_}=l_,g_="wheel",y_=4.000244140625;class WheelInput extends input_Input{constructor(e,t,n){super(e,t,n),this.handleEvent=e=>{if(!this.options.enable)return;let t=e.deltaY;h_.WheelEvent&&(f_&&e.deltaMode===h_.WheelEvent.DOM_DELTA_PIXEL&&(t/=h_.devicePixelRatio),e.deltaMode===h_.WheelEvent.DOM_DELTA_LINE&&(t*=40)),0!==t&&t%y_==0&&(t=Math.floor(t/y_)),e.shiftKey&&t&&(t*=.25),this.callback({type:g_,center:{x:e.clientX,y:e.clientY},delta:-t,srcEvent:e,pointerType:"mouse",target:e.target})},this.events=(this.options.events||[]).concat(m_),this.events.forEach((t=>e.addEventListener(t,this.handleEvent,!!p_&&{passive:!1})))}destroy(){this.events.forEach((e=>this.element.removeEventListener(e,this.handleEvent)))}enableEventType(e,t){e===g_&&(this.options.enable=t)}}const{MOUSE_EVENTS:v_}=l_,b_="pointermove",w_="pointerover",x_="pointerout",__="pointerenter",E_="pointerleave";class MoveInput extends input_Input{constructor(e,t,n){super(e,t,n),this.handleEvent=e=>{this.handleOverEvent(e),this.handleOutEvent(e),this.handleEnterEvent(e),this.handleLeaveEvent(e),this.handleMoveEvent(e)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(v_),this.events.forEach((t=>e.addEventListener(t,this.handleEvent)))}destroy(){this.events.forEach((e=>this.element.removeEventListener(e,this.handleEvent)))}enableEventType(e,t){e===b_&&(this.enableMoveEvent=t),e===w_&&(this.enableOverEvent=t),e===x_&&(this.enableOutEvent=t),e===__&&(this.enableEnterEvent=t),e===E_&&(this.enableLeaveEvent=t)}handleOverEvent(e){this.enableOverEvent&&"mouseover"===e.type&&this._emit(w_,e)}handleOutEvent(e){this.enableOutEvent&&"mouseout"===e.type&&this._emit(x_,e)}handleEnterEvent(e){this.enableEnterEvent&&"mouseenter"===e.type&&this._emit(__,e)}handleLeaveEvent(e){this.enableLeaveEvent&&"mouseleave"===e.type&&this._emit(E_,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":0===e.which&&(this.pressed=!1),this.pressed||this._emit(b_,e);break;case"mouseup":this.pressed=!1}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const{KEY_EVENTS:S_}=l_,C_="keydown",T_="keyup";class KeyInput extends input_Input{constructor(e,t,n){super(e,t,n),this.handleEvent=e=>{const t=e.target||e.srcElement;"INPUT"===t.tagName&&"text"===t.type||"TEXTAREA"===t.tagName||(this.enableDownEvent&&"keydown"===e.type&&this.callback({type:C_,srcEvent:e,key:e.key,target:e.target}),this.enableUpEvent&&"keyup"===e.type&&this.callback({type:T_,srcEvent:e,key:e.key,target:e.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(S_),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach((t=>e.addEventListener(t,this.handleEvent)))}destroy(){this.events.forEach((e=>this.element.removeEventListener(e,this.handleEvent)))}enableEventType(e,t){e===C_&&(this.enableDownEvent=t),e===T_&&(this.enableUpEvent=t)}}const A_="contextmenu";class ContextmenuInput extends input_Input{constructor(e,t,n){super(e,t,n),this.handleEvent=e=>{this.options.enable&&this.callback({type:A_,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e===A_&&(this.options.enable=t)}}const k_={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4};function N_(e){const t=k_[e.srcEvent.type];if(!t)return null;const{buttons:n,button:i,which:r}=e.srcEvent;let s=!1,o=!1,a=!1;return 4===t||2===t&&!Number.isFinite(n)?(s=1===r,o=2===r,a=3===r):2===t?(s=Boolean(1&n),o=Boolean(4&n),a=Boolean(2&n)):1===t&&(s=0===i,o=1===i,a=2===i),{leftButton:s,middleButton:o,rightButton:a}}function M_(e,t){const n=e.center;if(!n)return null;const i=t.getBoundingClientRect(),r=i.width/t.offsetWidth||1,s=i.height/t.offsetHeight||1;return{center:n,offsetCenter:{x:(n.x-i.left-t.clientLeft)/r,y:(n.y-i.top-t.clientTop)/s}}}const P_={srcElement:"root",priority:0};class EventRegistrar{constructor(e){this.handleEvent=e=>{if(this.isEmpty())return;const t=this._normalizeEvent(e);let n=e.srcEvent.target;for(;n&&n!==t.rootElement;){if(this._emit(t,n),t.handled)return;n=n.parentNode}this._emit(t,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,n,i=!1,r=!1){const{handlers:s,handlersByElement:o}=this;let a=P_;"string"==typeof n||n&&n.addEventListener?a={...P_,srcElement:n}:n&&(a={...P_,...n});let l=o.get(a.srcElement);l||(l=[],o.set(a.srcElement,l));const c={type:e,handler:t,srcElement:a.srcElement,priority:a.priority};i&&(c.once=!0),r&&(c.passive=!0),s.push(c),this._active=this._active||!c.passive;let u=l.length-1;for(;u>=0&&!(l[u].priority>=c.priority);)u--;l.splice(u+1,0,c)}remove(e,t){const{handlers:n,handlersByElement:i}=this;for(let r=n.length-1;r>=0;r--){const s=n[r];if(s.type===e&&s.handler===t){n.splice(r,1);const e=i.get(s.srcElement);e.splice(e.indexOf(s),1),0===e.length&&i.delete(s.srcElement)}}this._active=n.some((e=>!e.passive))}_emit(e,t){const n=this.handlersByElement.get(t);if(n){let t=!1;const i=()=>{e.handled=!0},r=()=>{e.handled=!0,t=!0},s=[];for(let o=0;o<n.length;o++){const{type:a,handler:l,once:c}=n[o];if(l({...e,type:a,stopPropagation:i,stopImmediatePropagation:r}),c&&s.push(n[o]),t)break}for(let e=0;e<s.length;e++){const{type:t,handler:n}=s[e];this.remove(t,n)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...N_(e),...M_(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}const L_={events:null,recognizers:null,recognizerOptions:{},Manager:n_,touchAction:"none",tabIndex:0};class EventManager{constructor(e=null,t){this._onBasicInput=e=>{const{srcEvent:t}=e,n=a_[t.type];n&&this.manager.emit(n,e)},this._onOtherEvent=e=>{this.manager.emit(e.type,e)},this.options={...L_,...t},this.events=new Map,this.setElement(e);const{events:n}=this.options;n&&this.on(n)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:t}=this,n=t.Manager;this.manager=new n(e,{touchAction:t.touchAction,recognizers:t.recognizers||r_}).on("hammer.input",this._onBasicInput),t.recognizers||Object.keys(s_).forEach((e=>{const t=this.manager.get(e);t&&s_[e].forEach((e=>{t.recognizeWith(e)}))}));for(const e in t.recognizerOptions){const n=this.manager.get(e);if(n){const i=t.recognizerOptions[e];delete i.enable,n.set(i)}}this.wheelInput=new WheelInput(e,this._onOtherEvent,{enable:!1}),this.moveInput=new MoveInput(e,this._onOtherEvent,{enable:!1}),this.keyInput=new KeyInput(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new ContextmenuInput(e,this._onOtherEvent,{enable:!1});for(const[e,t]of this.events)t.isEmpty()||(this._toggleRecognizer(t.recognizerName,!0),this.manager.on(e,t.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,t,n){this._addEventHandler(e,t,n,!1)}once(e,t,n){this._addEventHandler(e,t,n,!0)}watch(e,t,n){this._addEventHandler(e,t,n,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:n}=this;if(!n)return;const i=n.get(e);if(i&&i.options.enable!==t){i.set({enable:t});const r=o_[e];r&&!this.options.recognizers&&r.forEach((r=>{const s=n.get(r);t?(s.requireFailure(e),i.dropRequireFailure(r)):s.dropRequireFailure(e)}))}this.wheelInput.enableEventType(e,t),this.moveInput.enableEventType(e,t),this.keyInput.enableEventType(e,t),this.contextmenuInput.enableEventType(e,t)}_addEventHandler(e,t,n,i,r){if("string"!=typeof e){n=t;for(const t in e)this._addEventHandler(t,e[t],n,i,r);return}const{manager:s,events:o}=this,a=u_[e]||e;let l=o.get(a);l||(l=new EventRegistrar(this),o.set(a,l),l.recognizerName=c_[a]||a,s&&s.on(a,l.handleEvent)),l.add(e,t,n,i,r),l.isEmpty()||this._toggleRecognizer(l.recognizerName,!0)}_removeEventHandler(e,t){if("string"!=typeof e){for(const t in e)this._removeEventHandler(t,e[t]);return}const{events:n}=this,i=u_[e]||e,r=n.get(i);if(r&&(r.remove(e,t),r.isEmpty())){const{recognizerName:e}=r;let t=!1;for(const i of n.values())if(i.recognizerName===e&&!i.isEmpty()){t=!0;break}t||this._toggleRecognizer(e,!1)}}}function O_(){}const R_={id:"",width:"100%",height:"100%",pickingRadius:0,layerFilter:null,glOptions:{},gl:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},onWebGLInitialized:O_,onResize:O_,onViewStateChange:O_,onInteractionStateChange:O_,onBeforeRender:O_,onAfterRender:O_,onLoad:O_,onError:(e,t)=>cu.error(e)(),_onMetrics:null,getCursor:({isDragging:e})=>e?"grabbing":"grab",debug:!1,drawPickingColors:!1};class Deck{constructor(e){e={...R_,...e},this.props={},this.width=0,this.height=0,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this._needsRedraw=!0,this._pickRequest={},this._lastPointerDownInfo=null,this.viewState=null,this.interactiveState={isHovering:!1,isDragging:!1},this._onEvent=this._onEvent.bind(this),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),e.viewState&&e.initialViewState&&cu.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),"IE"===kf()&&cu.warn("IE 11 support will be deprecated in v8.0")(),e.gl||"undefined"!=typeof document&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Stats({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&th.setProps(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager&&(this.layerManager.finalize(),this.layerManager=null,this.viewManager.finalize(),this.viewManager=null,this.effectManager.finalize(),this.effectManager=null,this.deckRenderer.finalize(),this.deckRenderer=null,this.deckPicker.finalize(),this.deckPicker=null,this.eventManager.destroy(),this.eventManager=null,this.tooltip.remove(),this.tooltip=null),this.props.canvas||this.props.gl||!this.canvas||(this.canvas.parentElement.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&cu.removed("onLayerHover","onHover")(),"onLayerClick"in e&&cu.removed("onLayerClick","onClick")(),e.initialViewState&&!jg(this.props.initialViewState,e.initialViewState)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),r=this.effectManager.needsRedraw(e),s=this.deckRenderer.needsRedraw(e);return t=t||n||i||r||s,t}redraw(e){if(!this.layerManager)return;const t=e||this.needsRedraw({clearRedrawFlags:!0});t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}getViews(){return this.viewManager.views}getViewports(e){return this.viewManager.getViewports(e)}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_pick(e,t,n){const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(t).timeStart();const r=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(t).timeEnd(),r}_createCanvas(e){let t=e.canvas;if("string"==typeof t&&(t=document.getElementById(t),Ih(t)),!t){t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay";(e.parent||document.body).appendChild(t)}return Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;let{width:t,height:n}=e;(t||0===t)&&(t=Number.isFinite(t)?"".concat(t,"px"):t,this.canvas.style.width=t),(n||0===n)&&(n=Number.isFinite(n)?"".concat(n,"px"):n,this.canvas.style.position="absolute",this.canvas.style.height=n)}_updateCanvasSize(){if(this._checkForCanvasSizeChange()){const{width:e,height:t}=this;this.viewManager.setProps({width:e,height:t}),this.props.onResize({width:this.width,height:this.height})}}_checkForCanvasSizeChange(){const{canvas:e}=this;if(!e)return!1;const t=e.clientWidth||e.width,n=e.clientHeight||e.height;return(t!==this.width||n!==this.height)&&(this.width=t,this.height=n,!0)}_createAnimationLoop(e){const{width:t,height:n,gl:i,glOptions:r,debug:s,onError:o,onBeforeRender:a,onAfterRender:l,useDevicePixels:c,autoResizeDrawingBuffer:u}=e;return new AnimationLoop({width:t,height:n,useDevicePixels:c,autoResizeDrawingBuffer:u,autoResizeViewport:!1,gl:i,onCreateContext:e=>ld({...r,...e,canvas:this.canvas,debug:s,onContextLost:()=>this._onContextLost()}),onInitialize:e=>this._setGLContext(e.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:a,onAfterRender:l,onError:o})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new MapView({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_onPointerMove(e){const{_pickRequest:t}=this;if("pointerleave"===e.type)t.x=-1,t.y=-1,t.radius=0;else{if(e.leftButton||e.rightButton)return;{const n=e.offsetCenter;if(!n)return;t.x=n.x,t.y=n.y,t.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:t.x,y:t.y}),t.event=e,t.mode="hover"}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:t,emptyInfo:n}=this._pick("pickObject","pickObject Time",e);this.interactiveState.isHovering=t.length>0;let i=n,r=!1;for(const n of t)i=n,r=n.layer.onHover(n,e.event);if(!r&&this.props.onHover&&this.props.onHover(i,e.event),this.props.getTooltip){const e=this.props.getTooltip(i);this.tooltip.setTooltip(e,i.x,i.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.interactiveState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,cd(e,{enable:!0,copyState:!0})),this.tooltip=new Tooltip(this.canvas),Qu(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const t=new Timeline;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new EventManager(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const e in pu)this.eventManager.on(e,this._onEvent);this.viewManager=new ViewManager({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new LayerManager(e,{deck:this,stats:this.stats,viewport:n,timeline:t}),this.effectManager=new EffectManager,this.deckRenderer=new DeckRenderer(e),this.deckPicker=new DeckPicker(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{gl:n}=this.layerManager.context;Qu(n,this.props.parameters),this.props.onBeforeRender({gl:n}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:e,effects:this.effectManager.getEffects(),...t}),this.props.onAfterRender({gl:n})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),cu.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(!1),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.interactiveState.isDragging=e.isDragging,this.props.onInteractionStateChange(e)}_onEvent(e){const t=pu[e.type],n=e.offsetCenter;if(!t||!n)return;const i=this.layerManager.getLayers(),r=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:i,viewports:this.getViewports(n)},this._lastPointerDownInfo),{layer:s}=r,o=s&&(s[t.handler]||s.props[t.handler]),a=this.props[t.handler];let l=!1;o&&(l=o.call(s,r,e)),!l&&a&&a(r,e)}_onPointerDown(e){const t=e.offsetCenter,n=this._pick("pickObject","pickObject Time",{x:t.x,y:t.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=n.result[0]||n.emptyInfo}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const n=pd.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}Deck.getPropTypes=function(e){return{id:e.string,width:e.oneOfType([e.number,e.string]),height:e.oneOfType([e.number,e.string]),layers:e.oneOfType([e.object,e.array]),layerFilter:e.func,views:e.oneOfType([e.object,e.array]),viewState:e.object,effects:e.arrayOf(e.instanceOf(Effect)),controller:e.oneOfType([e.func,e.bool,e.object]),gl:e.object,glOptions:e.object,parameters:e.object,pickingRadius:e.number,useDevicePixels:e.oneOfType([e.bool,e.number]),touchAction:e.string,eventRecognizerOptions:e.object,onWebGLInitialized:e.func,onResize:e.func,onViewStateChange:e.func,onInteractionStateChange:e.func,onBeforeRender:e.func,onAfterRender:e.func,onLoad:e.func,onError:e.func,debug:e.bool,drawPickingColors:e.bool,_framebuffer:e.object,_animate:e.bool,_pickable:e.bool,_typedArrayManagerProps:e.object}},Deck.defaultProps=R_,Deck.VERSION=Kx.VERSION;const I_="undefined"!=typeof window?t.useLayoutEffect:t.useEffect;function D_(e,t){for(;e;){if(e===t)return!0;e=Object.getPrototypeOf(e)}return!1}function F_(e){return e?"function"==typeof e?(0,t.createElement)(View,{},e):Array.isArray(e)?e.map(F_):e.type===t.Fragment?F_(e.props.children):(D_(e.type,View),e):e}const B_={position:"absolute",zIndex:-1};function z_(e,n){return e?"function"==typeof e?e(n):Array.isArray(e)?e.map((e=>z_(e,n))):function(e){const t=e&&e.type,n=t&&t.defaultProps;return n&&n.mapStyle}(e)?(n.style=B_,(0,t.cloneElement)(e,n)):function(e){const t=e&&e.type;return t&&t.deckGLViewProps}(e)?(0,t.cloneElement)(e,n):e:e}const j_={mixBlendMode:null};function V_(e){e.redrawReason&&(e.deck._drawLayers(e.redrawReason),e.redrawReason=null)}const U_=(0,t.forwardRef)(((e,n)=>{const i=(0,t.useRef)({}).current,[r,s]=(0,t.useState)(0);i.forceUpdate=s;const o=(0,t.useRef)(null),a=(0,t.useRef)(null),l=(0,t.useMemo)((()=>function({children:e,layers:n,views:i}){const r=[],s=[],o={};return t.Children.forEach(F_(e),(e=>{if(e){const t=e.type;if(D_(t,Layer)){const n=function(e,t){const n={},i=e.defaultProps||{};for(const e in t)i[e]!==t[e]&&(n[e]=t[e]);return new e(n)}(t,e.props);s.push(n)}else r.push(e);if(t!==View&&D_(t,View)&&e.props.id){const n=new t(e.props);o[n.id]=n}}})),Object.keys(o).length>0&&(Array.isArray(i)?i.forEach((e=>{o[e.id]=e})):i&&(o[i.id]=i),i=Object.values(o)),{layers:n=s.length>0?[...s,...n]:n,children:r,views:i}}(e)),[e.layers,e.views,e.children]);let c=!0;const u=t=>c&&e.viewState?(i.viewStateUpdateRequested=t,null):(i.viewStateUpdateRequested=null,e.onViewStateChange(t)),d=t=>{c?i.interactionStateUpdateRequested=t:(i.interactionStateUpdateRequested=null,e.onInteractionStateChange(t))},h=(0,t.useMemo)((()=>{const t={...e,style:null,width:"100%",height:"100%",layers:l.layers,views:l.views,onViewStateChange:u,onInteractionStateChange:d};return i.deck&&i.deck.setProps(t),t}),[e]);(0,t.useEffect)((()=>(i.deck=function(e,t){const n=new(t.Deck||Deck)({...t,style:null,width:"100%",height:"100%",_customRender:t=>{e.redrawReason=t;const i=n.viewManager.getViewports();e.lastRenderedViewports!==i?e.forceUpdate((e=>e+1)):V_(e)}});return n}(i,{...h,parent:o.current,canvas:a.current}),()=>i.deck.finalize())),[]),I_((()=>{V_(i);const{viewStateUpdateRequested:e,interactionStateUpdateRequested:t}=i;e&&u(e),t&&d(t)})),(0,t.useImperativeHandle)(n,(()=>function(e){const t={pickObject:t=>e.deck.pickObject(t),pickMultipleObjects:t=>e.deck.pickMultipleObjects(t),pickObjects:t=>e.deck.pickObjects(t)};return Object.defineProperty(t,"deck",{get:()=>e.deck}),t}(i)),[]);const{viewManager:p}=i.deck||{},f=p&&p.getViewports(),{ContextProvider:m,width:g,height:y,id:v,style:b}=e,{containerStyle:w,canvasStyle:x}=(0,t.useMemo)((()=>function({width:e,height:t,style:n}){const i={position:"absolute",zIndex:0,left:0,top:0,width:e,height:t},r={left:0,top:0};if(n)for(const e in n)e in j_?r[e]=n[e]:i[e]=n[e];return{containerStyle:i,canvasStyle:r}}({width:g,height:y,style:b})),[g,y,b]);if(!i.viewStateUpdateRequested&&i.lastRenderedViewports===f||i.version!==r){i.lastRenderedViewports=f,i.version=r;const e=function({children:e,deck:n,ContextProvider:i}){const{viewManager:r}=n||{};if(!r||!r.views.length)return[];const s={},o=r.views[0].id;for(const t of e){let e=o,n=t;D_(t.type,View)&&(e=t.props.id||o,n=t.props.children);const i=r.getViewport(e),a=r.getViewState(e);if(i){const{x:t,y:r,width:o,height:l}=i;n=z_(n,{x:t,y:r,width:o,height:l,viewport:i,viewState:a}),s[e]||(s[e]={viewport:i,children:[]}),s[e].children.push(n)}}return Object.keys(s).map((e=>{const{viewport:r,children:o}=s[e],{x:a,y:l,width:c,height:u}=r,d={position:"absolute",left:a,top:l,width:c,height:u},h="view-".concat(e),p=(0,t.createElement)("div",{key:h,id:h,style:d},...o);if(i){const s={viewport:r,container:n.canvas.offsetParent,eventManager:n.eventManager,onViewStateChange:t=>{t.viewId=e,n._onViewStateChange(t)}};return(0,t.createElement)(i,{key:h,value:s},p)}return p}))}({children:l.children,deck:i.deck,ContextProvider:m}),n=(0,t.createElement)("canvas",{key:"canvas",id:v||"deckgl-overlay",ref:a,style:x});i.control=(0,t.createElement)("div",{id:"".concat(v||"deckgl","-wrapper"),ref:o,style:w},[n,e])}return c=!1,i.control}));U_.propTypes=Deck.getPropTypes(l()),U_.defaultProps=Deck.defaultProps;const H_=U_;class Tile2DHeader{constructor({x:e,y:t,z:n}){this.x=e,this.y=t,this.z=n,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get data(){return this.isLoading?this._loader.then((()=>this.data)):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return Boolean(this._loader)&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||cu.error("byteLength not defined in tile data")(),e}async _loadData({getData:e,requestScheduler:t,onLoad:n,onError:i}){const{x:r,y:s,z:o,bbox:a}=this,l=this._loaderId;this._abortController=new AbortController;const{signal:c}=this._abortController,u=await t.scheduleRequest(this,(e=>e.isSelected?1:-1));if(!u)return void(this._isCancelled=!0);if(this._isCancelled)return void u.done();let d,h=null;try{h=await e({x:r,y:s,z:o,bbox:a,signal:c})}catch(e){d=e||!0}finally{u.done()}l===this._loaderId&&(this._loader=void 0,this.content=h,!this._isCancelled||h?(this._isLoaded=!0,this._isCancelled=!1,d?i(d,this):n(this)):this._isLoaded=!1)}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController.abort())}}let $_;!function(e){e[e.OUTSIDE=-1]="OUTSIDE",e[e.INTERSECTING=0]="INTERSECTING",e[e.INSIDE=1]="INSIDE"}($_||($_={}));const q_=new vector3_Vector3,W_=new vector3_Vector3;class axis_aligned_bounding_box_AxisAlignedBoundingBox{constructor(e=[0,0,0],t=[0,0,0],n){Hc(this,"center",void 0),Hc(this,"halfDiagonal",void 0),Hc(this,"minimum",void 0),Hc(this,"maximum",void 0),n=n||q_.copy(e).add(t).scale(.5),this.center=new vector3_Vector3(n),this.halfDiagonal=new vector3_Vector3(t).subtract(this.center),this.minimum=new vector3_Vector3(e),this.maximum=new vector3_Vector3(t)}clone(){return new axis_aligned_bounding_box_AxisAlignedBoundingBox(this.minimum,this.maximum,this.center)}equals(e){return this===e||Boolean(e)&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:t}=this,n=W_.from(e.normal),i=t.x*Math.abs(n.x)+t.y*Math.abs(n.y)+t.z*Math.abs(n.z),r=this.center.dot(n)+e.distance;return r-i>0?$_.INSIDE:r+i<0?$_.OUTSIDE:$_.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=q_.from(e).subtract(this.center),{halfDiagonal:n}=this;let i,r=0;return i=Math.abs(t.x)-n.x,i>0&&(r+=i*i),i=Math.abs(t.y)-n.y,i>0&&(r+=i*i),i=Math.abs(t.z)-n.z,i>0&&(r+=i*i),r}}const G_=new vector3_Vector3,Y_=new vector3_Vector3;class bounding_sphere_BoundingSphere{constructor(e=[0,0,0],t=0){Hc(this,"center",void 0),Hc(this,"radius",void 0),this.radius=-0,this.center=new vector3_Vector3,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=G_.from(t),this.center=(new vector3_Vector3).from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new bounding_sphere_BoundingSphere(this.center,this.radius)}union(e){const t=this.center,n=this.radius,i=e.center,r=e.radius,s=G_.copy(i).subtract(t),o=s.magnitude();if(n>=o+r)return this.clone();if(r>=o+n)return e.clone();const a=.5*(n+o+r);return Y_.copy(s).scale((-n+a)/o).add(t),this.center.copy(Y_),this.radius=a,this}expand(e){const t=G_.from(e).subtract(this.center).magnitude();return t>this.radius&&(this.radius=t),this}transform(e){this.center.transform(e);const t=Sm(G_,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const t=G_.from(e).subtract(this.center);return Math.max(0,t.len()-this.radius)}intersectPlane(e){const t=this.center,n=this.radius,i=e.normal.dot(t)+e.distance;return i<-n?$_.OUTSIDE:i<n?$_.INTERSECTING:$_.INSIDE}}function X_(e,t,n){var i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=n[0],p=n[1],f=n[2],m=n[3],g=n[4],y=n[5],v=n[6],b=n[7],w=n[8];return e[0]=h*i+p*o+f*c,e[1]=h*r+p*a+f*u,e[2]=h*s+p*l+f*d,e[3]=m*i+g*o+y*c,e[4]=m*r+g*a+y*u,e[5]=m*s+g*l+y*d,e[6]=v*i+b*o+w*c,e[7]=v*r+b*a+w*u,e[8]=v*s+b*l+w*d,e}function K_(e,t,n){var i=n[0],r=n[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}var Z_;!function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"}(Z_||(Z_={}));const J_=Object.freeze([1,0,0,0,1,0,0,0,1]);class Matrix3 extends Matrix{static get IDENTITY(){return function(){eE||(eE=new Matrix3,Object.freeze(eE));return eE}()}static get ZERO(){return function(){Q_||(Q_=new Matrix3([0,0,0,0,0,0,0,0,0]),Object.freeze(Q_));return Q_}()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Z_}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(J_)}fromObject(e){return this.check()}fromQuaternion(e){return function(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],o=n+n,a=i+i,l=r+r,c=n*o,u=i*o,d=i*a,h=r*o,p=r*a,f=r*l,m=s*o,g=s*a,y=s*l;e[0]=1-d-f,e[3]=u-y,e[6]=h+g,e[1]=u+y,e[4]=1-c-f,e[7]=p-m,e[2]=h-g,e[5]=p+m,e[8]=1-c-d}(this,e),this.check()}set(e,t,n,i,r,s,o,a,l){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=r,this[5]=s,this[6]=o,this[7]=a,this[8]=l,this.check()}setRowMajor(e,t,n,i,r,s,o,a,l){return this[0]=e,this[1]=i,this[2]=o,this[3]=t,this[4]=r,this[5]=a,this[6]=n,this[7]=s,this[8]=l,this.check()}determinant(){return function(e){var t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*(c*s-o*l)+n*(-c*r+o*a)+i*(l*r-s*a)}(this)}transpose(){return function(e,t){if(e===t){var n=t[1],i=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=i,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8]}(this,this),this.check()}invert(){return function(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=u*o-a*c,h=-u*s+a*l,p=c*s-o*l,f=n*d+i*h+r*p;f&&(f=1/f,e[0]=d*f,e[1]=(-u*i+r*c)*f,e[2]=(a*i-r*o)*f,e[3]=h*f,e[4]=(u*n-r*l)*f,e[5]=(-a*n+r*s)*f,e[6]=p*f,e[7]=(-c*n+i*l)*f,e[8]=(o*n-i*s)*f)}(this,this),this.check()}multiplyLeft(e){return X_(this,e,this),this.check()}multiplyRight(e){return X_(this,this,e),this.check()}rotate(e){return function(e,t,n){var i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=Math.sin(n),p=Math.cos(n);e[0]=p*i+h*o,e[1]=p*r+h*a,e[2]=p*s+h*l,e[3]=p*o-h*i,e[4]=p*a-h*r,e[5]=p*l-h*s,e[6]=c,e[7]=u,e[8]=d}(this,this,e),this.check()}scale(e){return Array.isArray(e)?K_(this,this,e):K_(this,this,[e,e]),this.check()}translate(e){return function(e,t,n){var i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=n[0],p=n[1];e[0]=i,e[1]=r,e[2]=s,e[3]=o,e[4]=a,e[5]=l,e[6]=h*i+p*o+c,e[7]=h*r+p*a+u,e[8]=h*s+p*l+d}(this,this,e),this.check()}transform(e,t){let n;switch(e.length){case 2:n=function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[3]*r+n[6],e[1]=n[1]*i+n[4]*r+n[7],e}(t||[-0,-0],e,this);break;case 3:n=bh(t||[-0,-0,-0],e,this);break;case 4:n=Ch(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return uh(n,e.length),n}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let Q_,eE,tE;class Vector4 extends Vector{static get ZERO(){return tE||(tE=new Vector4(0,0,0,0),Object.freeze(tE)),tE}constructor(e=0,t=0,n=0,i=0){super(-0,-0,-0,-0),rh(e)&&1===arguments.length?this.copy(e):(nh.debug&&(ch(e),ch(t),ch(n),ch(i)),this[0]=e,this[1]=t,this[2]=n,this[3]=i)}set(e,t,n,i){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return nh.debug&&(ch(e.x),ch(e.y),ch(e.z),ch(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=ch(e)}get w(){return this[3]}set w(e){this[3]=ch(e)}transform(e){return vh(this,this,e),this.check()}transformByMatrix3(e){return Ch(this,this,e),this.check()}transformByMatrix2(e){return function(e,t,n){const i=t[0],r=t[1];e[0]=n[0]*i+n[2]*r,e[1]=n[1]*i+n[3]*r,e[2]=t[2],e[3]=t[3]}(this,this,e),this.check()}transformByQuaternion(e){return wh(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}function nE(){var e=new ph(4);return ph!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function iE(e,t,n){n*=.5;var i=Math.sin(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n),e}function rE(e,t,n){var i=t[0],r=t[1],s=t[2],o=t[3],a=n[0],l=n[1],c=n[2],u=n[3];return e[0]=i*u+o*a+r*c-s*l,e[1]=r*u+o*l+s*a-i*c,e[2]=s*u+o*c+i*l-r*a,e[3]=o*u-i*a-r*l-s*c,e}function sE(e,t,n,i){var r,s,o,a,l,c=t[0],u=t[1],d=t[2],h=t[3],p=n[0],f=n[1],m=n[2],g=n[3];return(s=c*p+u*f+d*m+h*g)<0&&(s=-s,p=-p,f=-f,m=-m,g=-g),1-s>hh?(r=Math.acos(s),o=Math.sin(r),a=Math.sin((1-i)*r)/o,l=Math.sin(i*r)/o):(a=1-i,l=i),e[0]=a*c+l*p,e[1]=a*u+l*f,e[2]=a*d+l*m,e[3]=a*h+l*g,e}function oE(e,t){var n,i=t[0]+t[4]+t[8];if(i>0)n=Math.sqrt(i+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);var s=(r+1)%3,o=(r+2)%3;n=Math.sqrt(t[3*r+r]-t[3*s+s]-t[3*o+o]+1),e[r]=.5*n,n=.5/n,e[3]=(t[3*s+o]-t[3*o+s])*n,e[s]=(t[3*s+r]+t[3*r+s])*n,e[o]=(t[3*o+r]+t[3*r+o])*n}return e}var aE,lE,cE,uE,dE,hE,pE,fE=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},mE=Am,gE=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},yE=function(e,t,n,i){var r=t[0],s=t[1],o=t[2],a=t[3];return e[0]=r+i*(n[0]-r),e[1]=s+i*(n[1]-s),e[2]=o+i*(n[2]-o),e[3]=a+i*(n[3]-a),e},vE=km,bE=Nm,wE=function(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],o=n*n+i*i+r*r+s*s;return o>0&&(o=1/Math.sqrt(o)),e[0]=n*o,e[1]=i*o,e[2]=r*o,e[3]=s*o,e},xE=(aE=fh(),lE=mh(1,0,0),cE=mh(0,1,0),function(e,t,n){var i=gh(t,n);return i<-.999999?(yh(aE,lE,t),Eh(aE)<1e-6&&yh(aE,cE,t),function(e,t){var n=t[0],i=t[1],r=t[2],s=n*n+i*i+r*r;s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s}(aE,aE),iE(e,aE,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(yh(aE,t,n),e[0]=aE[0],e[1]=aE[1],e[2]=aE[2],e[3]=1+i,wE(e,e))});uE=nE(),dE=nE(),hE=new ph(9),ph!=Float32Array&&(hE[1]=0,hE[2]=0,hE[3]=0,hE[5]=0,hE[6]=0,hE[7]=0),hE[0]=1,hE[4]=1,hE[8]=1,pE=hE;const _E=[0,0,0,1];class Quaternion extends MathArray{constructor(e=0,t=0,n=0,i=1){super(-0,-0,-0,-0),Array.isArray(e)&&1===arguments.length?this.copy(e):this.set(e,t,n,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,n,i){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return oE(this,e),this.check()}fromAxisRotation(e,t){return iE(this,e,t),this.check()}identity(){return function(e){e[0]=0,e[1]=0,e[2]=0,e[3]=1}(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=ch(e)}get y(){return this[1]}set y(e){this[1]=ch(e)}get z(){return this[2]}set z(e){this[2]=ch(e)}get w(){return this[3]}set w(e){this[3]=ch(e)}len(){return vE(this)}lengthSquared(){return bE(this)}dot(e){return gE(this,e)}rotationTo(e,t){return xE(this,e,t),this.check()}add(e){return fE(this,this,e),this.check()}calculateW(){return function(e,t){var n=t[0],i=t[1],r=t[2];e[0]=n,e[1]=i,e[2]=r,e[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r))}(this,this),this.check()}conjugate(){return function(e,t){e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3]}(this,this),this.check()}invert(){return function(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],o=n*n+i*i+r*r+s*s,a=o?1/o:0;e[0]=-n*a,e[1]=-i*a,e[2]=-r*a,e[3]=s*a}(this,this),this.check()}lerp(e,t,n){return void 0===n?this.lerp(this,e,t):(yE(this,e,t,n),this.check())}multiplyRight(e){return rE(this,this,e),this.check()}multiplyLeft(e){return rE(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,0===e&&(this[3]=1),this.check()}rotateX(e){return function(e,t,n){n*=.5;var i=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(n),l=Math.cos(n);e[0]=i*l+o*a,e[1]=r*l+s*a,e[2]=s*l-r*a,e[3]=o*l-i*a}(this,this,e),this.check()}rotateY(e){return function(e,t,n){n*=.5;var i=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(n),l=Math.cos(n);e[0]=i*l-s*a,e[1]=r*l+o*a,e[2]=s*l+i*a,e[3]=o*l-r*a}(this,this,e),this.check()}rotateZ(e){return function(e,t,n){n*=.5;var i=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(n),l=Math.cos(n);e[0]=i*l+r*a,e[1]=r*l-i*a,e[2]=s*l+o*a,e[3]=o*l-s*a}(this,this,e),this.check()}scale(e){return mE(this,this,e),this.check()}slerp(e,t,n){let i,r,s;switch(arguments.length){case 1:({start:i=_E,target:r,ratio:s}=e);break;case 2:i=this,r=e,s=t;break;default:i=e,r=t,s=n}return sE(this,i,r,s),this.check()}transformVector4(e,t=new Vector4){return function(e,t,n){var i=t[0],r=t[1],s=t[2],o=n[0],a=n[1],l=n[2],c=n[3],u=c*i+a*s-l*r,d=c*r+l*i-o*s,h=c*s+o*r-a*i,p=-o*i-a*r-l*s;e[0]=u*c+p*-o+d*-l-h*-a,e[1]=d*c+p*-a+h*-o-u*-l,e[2]=h*c+p*-l+u*-a-d*-o,e[3]=t[3]}(t,e,this),uh(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const EE=new vector3_Vector3,SE=new vector3_Vector3,CE=new vector3_Vector3,TE=new vector3_Vector3,AE=new vector3_Vector3,kE=new vector3_Vector3,NE=new vector3_Vector3,ME=0,PE=1,LE=2,OE=3,RE=4,IE=5,DE=6,FE=7,BE=8;class OrientedBoundingBox{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){Hc(this,"center",void 0),Hc(this,"halfAxes",void 0),this.center=(new vector3_Vector3).from(e),this.halfAxes=new Matrix3(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new vector3_Vector3(e).len(),new vector3_Vector3(t).len(),new vector3_Vector3(n).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),i=new vector3_Vector3(e).normalize(),r=new vector3_Vector3(t).normalize(),s=new vector3_Vector3(n).normalize();return(new Quaternion).fromMatrix3(new Matrix3([...i,...r,...s]))}fromCenterHalfSizeQuaternion(e,t,n){const i=new Quaternion(n),r=(new Matrix3).fromQuaternion(i);return r[0]=r[0]*t[0],r[1]=r[1]*t[0],r[2]=r[2]*t[0],r[3]=r[3]*t[1],r[4]=r[4]*t[1],r[5]=r[5]*t[1],r[6]=r[6]*t[2],r[7]=r[7]*t[2],r[8]=r[8]*t[2],this.center=(new vector3_Vector3).from(e),this.halfAxes=r,this}clone(){return new OrientedBoundingBox(this.center,this.halfAxes)}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new bounding_sphere_BoundingSphere){const t=this.halfAxes,n=t.getColumn(0,CE),i=t.getColumn(1,TE),r=t.getColumn(2,AE),s=EE.copy(n).add(i).add(r);return e.center.copy(this.center),e.radius=s.magnitude(),e}intersectPlane(e){const t=this.center,n=e.normal,i=this.halfAxes,r=n.x,s=n.y,o=n.z,a=Math.abs(r*i[ME]+s*i[PE]+o*i[LE])+Math.abs(r*i[OE]+s*i[RE]+o*i[IE])+Math.abs(r*i[DE]+s*i[FE]+o*i[BE]),l=n.dot(t)+e.distance;return l<=-a?$_.OUTSIDE:l>=a?$_.INSIDE:$_.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=SE.from(e).subtract(this.center),n=this.halfAxes,i=n.getColumn(0,CE),r=n.getColumn(1,TE),s=n.getColumn(2,AE),o=i.magnitude(),a=r.magnitude(),l=s.magnitude();i.normalize(),r.normalize(),s.normalize();let c,u=0;return c=Math.abs(t.dot(i))-o,c>0&&(u+=c*c),c=Math.abs(t.dot(r))-a,c>0&&(u+=c*c),c=Math.abs(t.dot(s))-l,c>0&&(u+=c*c),u}computePlaneDistances(e,t,n=[-0,-0]){let i=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;const s=this.center,o=this.halfAxes,a=o.getColumn(0,CE),l=o.getColumn(1,TE),c=o.getColumn(2,AE),u=kE.copy(a).add(l).add(c).add(s),d=NE.copy(u).subtract(e);let h=t.dot(d);return i=Math.min(h,i),r=Math.max(h,r),u.copy(s).add(a).add(l).subtract(c),d.copy(u).subtract(e),h=t.dot(d),i=Math.min(h,i),r=Math.max(h,r),u.copy(s).add(a).subtract(l).add(c),d.copy(u).subtract(e),h=t.dot(d),i=Math.min(h,i),r=Math.max(h,r),u.copy(s).add(a).subtract(l).subtract(c),d.copy(u).subtract(e),h=t.dot(d),i=Math.min(h,i),r=Math.max(h,r),s.copy(u).subtract(a).add(l).add(c),d.copy(u).subtract(e),h=t.dot(d),i=Math.min(h,i),r=Math.max(h,r),s.copy(u).subtract(a).add(l).subtract(c),d.copy(u).subtract(e),h=t.dot(d),i=Math.min(h,i),r=Math.max(h,r),s.copy(u).subtract(a).subtract(l).add(c),d.copy(u).subtract(e),h=t.dot(d),i=Math.min(h,i),r=Math.max(h,r),s.copy(u).subtract(a).subtract(l).subtract(c),d.copy(u).subtract(e),h=t.dot(d),i=Math.min(h,i),r=Math.max(h,r),n[0]=i,n[1]=r,n}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,CE);t.transformAsPoint(e);const n=this.halfAxes.getColumn(1,TE);n.transformAsPoint(e);const i=this.halfAxes.getColumn(2,AE);return i.transformAsPoint(e),this.halfAxes=new Matrix3([...t,...n,...i]),this}getTransform(){throw new Error("not implemented")}}const zE=new vector3_Vector3,jE=new vector3_Vector3;class plane_Plane{constructor(e=[0,0,1],t=0){Hc(this,"normal",void 0),Hc(this,"distance",void 0),this.normal=new vector3_Vector3,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return dh(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=zE.from(e),this.normal.from(t).normalize();const n=-this.normal.dot(e);return this.distance=n,this}fromCoefficients(e,t,n,i){return this.normal.set(e,t,n),dh(ah(this.normal.len(),1)),this.distance=i,this}clone(){return new plane_Plane(this.normal,this.distance)}equals(e){return ah(this.distance,e.distance)&&ah(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=jE.copy(this.normal).transformAsVector(e).normalize(),n=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(n,t)}projectPointOntoPlane(e,t=[0,0,0]){e=zE.from(e);const n=this.getPointDistance(e),i=jE.copy(this.normal).scale(n);return e.subtract(i).to(t)}}const VE=[new vector3_Vector3([1,0,0]),new vector3_Vector3([0,1,0]),new vector3_Vector3([0,0,1])],UE=new vector3_Vector3,HE=new vector3_Vector3;new plane_Plane(new vector3_Vector3(1,0,0),0);class culling_volume_CullingVolume{constructor(e=[]){Hc(this,"planes",void 0),this.planes=e}fromBoundingSphere(e){this.planes.length=2*VE.length;const t=e.center,n=e.radius;let i=0;for(const e of VE){let r=this.planes[i],s=this.planes[i+1];r||(r=this.planes[i]=new plane_Plane),s||(s=this.planes[i+1]=new plane_Plane);const o=UE.copy(e).scale(-n).add(t);e.dot(o);r.fromPointNormal(o,e);const a=UE.copy(e).scale(n).add(t),l=HE.copy(e).negate();l.dot(a);s.fromPointNormal(a,l),i+=2}return this}computeVisibility(e){let t=$_.INSIDE;for(const n of this.planes){switch(e.intersectPlane(n)){case $_.OUTSIDE:return $_.OUTSIDE;case $_.INTERSECTING:t=$_.INTERSECTING}}return t}computeVisibilityWithPlaneMask(e,t){if(dh(Number.isFinite(t),"parentPlaneMask is required."),t===culling_volume_CullingVolume.MASK_OUTSIDE||t===culling_volume_CullingVolume.MASK_INSIDE)return t;let n=culling_volume_CullingVolume.MASK_INSIDE;const i=this.planes;for(let r=0;r<this.planes.length;++r){const s=r<31?1<<r:0;if(r<31&&0==(t&s))continue;const o=i[r],a=e.intersectPlane(o);if(a===$_.OUTSIDE)return culling_volume_CullingVolume.MASK_OUTSIDE;a===$_.INTERSECTING&&(n|=s)}return n}}Hc(culling_volume_CullingVolume,"MASK_OUTSIDE",4294967295),Hc(culling_volume_CullingVolume,"MASK_INSIDE",0),Hc(culling_volume_CullingVolume,"MASK_INDETERMINATE",2147483647);new vector3_Vector3,new vector3_Vector3,new vector3_Vector3,new vector3_Vector3,new vector3_Vector3;new vector3_Vector3,new vector3_Vector3,new vector3_Vector3,new vector3_Vector3,new vector3_Vector3,new vector3_Vector3,new vector3_Vector3,new vector3_Vector3,new vector3_Vector3,new vector3_Vector3,new vector3_Vector3,new vector3_Vector3,Math.PI;const $E=1e-15,qE=1e-20,WE=(Math.PI,Math.PI,Math.PI,Math.PI,new Matrix3),GE=new Matrix3,YE=new Matrix3,XE=new Matrix3,KE=new Matrix3;function ZE(e,t={}){const n=qE;let i=0,r=0;const s=GE,o=YE;s.identity(),o.copy(e);const a=n*function(e){let t=0;for(let n=0;n<9;++n){const i=e[n];t+=i*i}return Math.sqrt(t)}(o);for(;r<10&&eS(o)>a;)tS(o,XE),KE.copy(XE).transpose(),o.multiplyRight(XE),o.multiplyLeft(KE),s.multiplyRight(XE),++i>2&&(++r,i=0);return t.unitary=s.toTarget(t.unitary),t.diagonal=o.toTarget(t.diagonal),t}const JE=[1,0,0],QE=[2,2,1];function eS(e){let t=0;for(let n=0;n<3;++n){const i=e[WE.getElementIndex(QE[n],JE[n])];t+=2*i*i}return Math.sqrt(t)}function tS(e,t){const n=$E;let i=0,r=1;for(let t=0;t<3;++t){const n=Math.abs(e[WE.getElementIndex(QE[t],JE[t])]);n>i&&(r=t,i=n)}const s=JE[r],o=QE[r];let a=1,l=0;if(Math.abs(e[WE.getElementIndex(o,s)])>n){const t=(e[WE.getElementIndex(o,o)]-e[WE.getElementIndex(s,s)])/2/e[WE.getElementIndex(o,s)];let n;n=t<0?-1/(-t+Math.sqrt(1+t*t)):1/(t+Math.sqrt(1+t*t)),a=1/Math.sqrt(1+n*n),l=n*a}return Matrix3.IDENTITY.to(t),t[WE.getElementIndex(s,s)]=t[WE.getElementIndex(o,o)]=a,t[WE.getElementIndex(o,s)]=l,t[WE.getElementIndex(s,o)]=-l,t}const nS=new vector3_Vector3,iS=new vector3_Vector3,rS=new vector3_Vector3,sS=new vector3_Vector3,oS=new vector3_Vector3,aS=new Matrix3,lS={diagonal:new Matrix3,unitary:new Matrix3};const cS=512,uS=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],dS=uS.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),hS=dS.concat([[.25,.5],[.75,.5]]);class OSMNode{constructor(e,t,n){this.x=e,this.y=t,this.z=n}get children(){if(!this._children){const e=2*this.x,t=2*this.y,n=this.z+1;this._children=[new OSMNode(e,t,n),new OSMNode(e,t+1,n),new OSMNode(e+1,t,n),new OSMNode(e+1,t+1,n)]}return this._children}update(e){const{viewport:t,cullingVolume:n,elevationBounds:i,minZ:r,maxZ:s,bounds:o,offset:a,project:l}=e,c=this.getBoundingVolume(i,a,l);if(o&&!this.insideBounds(o))return!1;if(n.computeVisibility(c)<0)return!1;if(!this.childVisible){let{z:e}=this;if(e<s&&e>=r){const n=c.distanceTo(t.cameraPosition)*t.scale/t.height;e+=Math.floor(Math.log2(n))}if(e>=s)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const t of this.children)t.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const t of this._children)t.getSelected(e);return e}insideBounds([e,t,n,i]){const r=Math.pow(2,this.z),s=cS/r;return this.x*s<n&&this.y*s<i&&(this.x+1)*s>e&&(this.y+1)*s>t}getBoundingVolume(e,t,n){if(n){const t=this.z<1?hS:this.z<2?dS:uS,i=[];for(const r of t){const t=vS(this.x+r[0],this.y+r[1],this.z);t[2]=e[0],i.push(n(t)),e[0]!==e[1]&&(t[2]=e[1],i.push(n(t)))}return function(e,t=new OrientedBoundingBox){if(!e||0===e.length)return t.halfAxes=new Matrix3([0,0,0,0,0,0,0,0,0]),t.center=new vector3_Vector3,t;const n=e.length,i=new vector3_Vector3(0,0,0);for(const t of e)i.add(t);const r=1/n;i.multiplyByScalar(r);let s=0,o=0,a=0,l=0,c=0,u=0;for(const t of e){const e=nS.copy(t).subtract(i);s+=e.x*e.x,o+=e.x*e.y,a+=e.x*e.z,l+=e.y*e.y,c+=e.y*e.z,u+=e.z*e.z}s*=r,o*=r,a*=r,l*=r,c*=r,u*=r;const d=aS;d[0]=s,d[1]=o,d[2]=a,d[3]=o,d[4]=l,d[5]=c,d[6]=a,d[7]=c,d[8]=u;const{unitary:h}=ZE(d,lS),p=t.halfAxes.copy(h);let f=p.getColumn(0,rS),m=p.getColumn(1,sS),g=p.getColumn(2,oS),y=-Number.MAX_VALUE,v=-Number.MAX_VALUE,b=-Number.MAX_VALUE,w=Number.MAX_VALUE,x=Number.MAX_VALUE,_=Number.MAX_VALUE;for(const t of e)nS.copy(t),y=Math.max(nS.dot(f),y),v=Math.max(nS.dot(m),v),b=Math.max(nS.dot(g),b),w=Math.min(nS.dot(f),w),x=Math.min(nS.dot(m),x),_=Math.min(nS.dot(g),_);f=f.multiplyByScalar(.5*(w+y)),m=m.multiplyByScalar(.5*(x+v)),g=g.multiplyByScalar(.5*(_+b)),t.center.copy(f).add(m).add(g);const E=iS.set(y-w,v-x,b-_).multiplyByScalar(.5),S=new Matrix3([E[0],0,0,0,E[1],0,0,0,E[2]]);return t.halfAxes.multiplyRight(S),t}(i)}const i=Math.pow(2,this.z),r=cS/i,s=this.x*r+t*cS,o=cS-(this.y+1)*r;return new axis_aligned_bounding_box_AxisAlignedBoundingBox([s,o,e[0]],[s+r,o+r,e[1]])}}const pS=512,fS=[-1/0,-1/0,1/0,1/0],mS={type:"url",value:null,validate:(e,t)=>t.optional&&null===e||"string"==typeof e||Array.isArray(e)&&e.every((e=>"string"==typeof e)),equals:(e,t)=>{if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t))return!1;const n=e.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}};function gS(e,t){const n=[t.transformAsPoint([e[0],e[1]]),t.transformAsPoint([e[2],e[1]]),t.transformAsPoint([e[0],e[3]]),t.transformAsPoint([e[2],e[3]])],i=[Math.min(...n.map((e=>e[0]))),Math.min(...n.map((e=>e[1]))),Math.max(...n.map((e=>e[0]))),Math.max(...n.map((e=>e[1])))];return i}function yS(e,t){return Math.pow(2,e)*pS/t}function vS(e,t,n){const i=yS(n,pS),r=e/i*360-180,s=Math.PI-2*Math.PI*t/i;return[r,180/Math.PI*Math.atan(.5*(Math.exp(s)-Math.exp(-s)))]}function bS(e,t,n,i){const r=yS(n,i);return[e/r*pS,t/r*pS]}function wS(e,t,n,i,r=512){if(e.isGeospatial){const[e,r]=vS(t,n,i),[s,o]=vS(t+1,n+1,i);return{west:e,north:r,east:s,south:o}}const[s,o]=bS(t,n,i,r),[a,l]=bS(t+1,n+1,i,r);return{left:s,top:o,right:a,bottom:l}}function xS(e,t,n,i,r){const s=function(e,t,n){let i;if(t&&2===t.length){const[n,r]=t,s=e.getBounds({z:n}),o=e.getBounds({z:r});i=[Math.min(s[0],o[0]),Math.min(s[1],o[1]),Math.max(s[2],o[2]),Math.max(s[3],o[3])]}else i=e.getBounds();return e.isGeospatial?[Math.max(i[0],n[0]),Math.max(i[1],n[1]),Math.min(i[2],n[2]),Math.min(i[3],n[3])]:[Math.max(Math.min(i[0],n[2]),n[0]),Math.max(Math.min(i[1],n[3]),n[1]),Math.min(Math.max(i[2],n[0]),n[2]),Math.min(Math.max(i[3],n[1]),n[3])]}(e,null,i),o=yS(t,n),[a,l,c,u]=function(e,t,n){if(n){const i=gS(e,n).map((e=>e*t/pS));return i}return e.map((e=>e*t/pS))}(s,o,r),d=[];for(let e=Math.floor(a);e<c;e++)for(let n=Math.floor(l);n<u;n++)d.push({x:e,y:n,z:t});return d}function _S({viewport:e,maxZoom:t,minZoom:n,zRange:i,extent:r,tileSize:s=512,modelMatrix:o,modelMatrixInverse:a,zoomOffset:l=0}){let c=e.isGeospatial?Math.round(e.zoom+Math.log2(pS/s))+l:Math.ceil(e.zoom)+l;if(Number.isFinite(n)&&c<n){if(!r)return[];c=n}Number.isFinite(t)&&c>t&&(c=t);let u=r;return o&&a&&r&&!e.isGeospatial&&(u=gS(r,o)),e.isGeospatial?function(e,t,n,i){const r=e.resolution?e.projectPosition:null,s=Object.values(e.getFrustumPlanes()).map((({normal:e,distance:t})=>new plane_Plane(e.clone().negate(),t))),o=new culling_volume_CullingVolume(s),a=e.distanceScales.unitsPerMeter[2],l=n&&n[0]*a||0,c=n&&n[1]*a||0,u=e.pitch<=60?t:0;if(i){const[e,t,n,r]=i,s=fg([e,r]),o=fg([n,t]);i=[s[0],cS-s[1],o[0],cS-o[1]]}const d=new OSMNode(0,0,0),h={viewport:e,project:r,cullingVolume:o,elevationBounds:[l,c],minZ:u,maxZ:t,bounds:i,offset:0};if(d.update(h),e.subViewports&&e.subViewports.length>1){for(h.offset=-1;d.update(h)&&!(--h.offset<-3););for(h.offset=1;d.update(h)&&!(++h.offset>3););}return d.getSelected()}(e,c,i,r):xS(e,c,s,u||fS,a)}const ES={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class RequestScheduler{constructor(e={}){Hc(this,"props",void 0),Hc(this,"stats",void 0),Hc(this,"activeRequestCount",0),Hc(this,"requestQueue",[]),Hc(this,"requestMap",new Map),Hc(this,"deferredUpdate",null),this.props={...ES,...e},this.stats=new Stats({id:this.props.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever")}scheduleRequest(e,t=(()=>0)){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const n={handle:e,priority:0,getPriority:t},i=new Promise((e=>(n.resolve=e,n)));return this.requestQueue.push(n),this.requestMap.set(e,i),this._issueNewRequests(),i}_issueRequest(e){const{handle:t,resolve:n}=e;let i=!1;const r=()=>{i||(i=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:r}):Promise.resolve({done:r})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout((()=>this._issueNewRequestsAsync()),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==e){this._updateAllRequests();for(let t=0;t<e;++t){const e=this.requestQueue.shift();e&&this._issueRequest(e)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const n=e[t];this._updateRequest(n)||(e.splice(t,1),this.requestMap.delete(n.handle),t--)}e.sort(((e,t)=>e.priority-t.priority))}_updateRequest(e){return e.priority=e.getPriority(e.handle),!(e.priority<0)||(e.resolve(null),!1)}}const SS="best-available",CS={[SS]:function(e){for(const t of e)t.state=0;for(const t of e)t.isSelected&&!TS(t)&&AS(t);for(const t of e)t.isVisible=Boolean(2&t.state)},"no-overlap":function(e){for(const t of e)t.state=0;for(const t of e)t.isSelected&&TS(t);const t=Array.from(e).sort(((e,t)=>e.z-t.z));for(const e of t)if(e.isVisible=Boolean(2&e.state),e.isVisible||1&e.state)for(const t of e.children)t.state=1;else e.isSelected&&AS(e)},never:()=>{}};class Tileset2D{constructor(e){this.opts=e,this.onTileLoad=e=>{this.opts.onTileLoad(e),this.opts.maxCacheByteSize&&(this._cacheByteSize+=e.byteLength,this._resizeCache())},this._requestScheduler=new RequestScheduler({maxRequests:e.maxRequests,throttleRequests:e.maxRequests>0}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new matrix4_Matrix4,this._modelMatrixInverse=new matrix4_Matrix4,this.setOptions(e)}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles.every((e=>e.isLoaded))}get needsReload(){return this._selectedTiles.some((e=>e.needsReload))}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const t=this._cache.get(e);this._selectedTiles.includes(t)?t.setNeedsReload():this._cache.delete(e)}}update(e,{zRange:t,modelMatrix:n}={}){const i=new matrix4_Matrix4(n),r=!i.equals(this._modelMatrix);if(!e.equals(this._viewport)||r){r&&(this._modelMatrixInverse=i.clone().invert(),this._modelMatrix=i),this._viewport=e;const n=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:t,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=n.map((e=>this._getTile(e,!0))),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map((e=>this._getTile({x:e.x,y:e.y,z:e.z}))));const s=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),s&&this._frameNumber++,this._frameNumber}getTileIndices({viewport:e,maxZoom:t,minZoom:n,zRange:i,modelMatrix:r,modelMatrixInverse:s}){const{tileSize:o,extent:a,zoomOffset:l}=this.opts;return _S({viewport:e,maxZoom:t,minZoom:n,zRange:i,tileSize:o,extent:a,modelMatrix:r,modelMatrixInverse:s,zoomOffset:l})}getTileMetadata({x:e,y:t,z:n}){const{tileSize:i}=this.opts;return{bbox:wS(this._viewport,e,t,n,i)}}getParentIndex(e){return e.x=Math.floor(e.x/2),e.y=Math.floor(e.y/2),e.z-=1,e}updateTileStates(){const e=this.opts.refinementStrategy||SS,t=new Array(this._cache.size);let n=0;for(const e of this._cache.values())t[n++]=e.isVisible,e.isSelected=!1,e.isVisible=!1;for(const e of this._selectedTiles)e.isSelected=!0,e.isVisible=!0;("function"==typeof e?e:CS[e])(Array.from(this._cache.values())),n=0;for(const e of this._cache.values())if(t[n++]!==e.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e}=this.opts,t=[];let n=0;for(const e of this._cache.values())e.isLoading&&(n++,e.isSelected||e.isVisible||t.push(e));for(;e>0&&n>e&&t.length>0;){t.shift().abort(),n--}}_rebuildTree(){const{_cache:e}=this;for(const t of e.values())t.parent=null,t.children.length=0;for(const t of e.values()){const e=this._getNearestAncestor(t.x,t.y,t.z);t.parent=e,e&&e.children.push(t)}}_resizeCache(){const{_cache:e,opts:t}=this,n=t.maxCacheSize||(t.maxCacheByteSize?1/0:5*this.selectedTiles.length),i=t.maxCacheByteSize||1/0;if(e.size>n||this._cacheByteSize>i){for(const[r,s]of e)if(s.isVisible||(this._cacheByteSize-=t.maxCacheByteSize?s.byteLength:0,e.delete(r),this.opts.onTileUnload(s)),e.size<=n&&this._cacheByteSize<=i)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort(((e,t)=>e.z-t.z)),this._dirty=!1)}_getTile({x:e,y:t,z:n},i){const r="".concat(e,",").concat(t,",").concat(n);let s=this._cache.get(r),o=!1;return!s&&i?(s=new Tile2DHeader({x:e,y:t,z:n}),Object.assign(s,this.getTileMetadata(s)),o=!0,this._cache.set(r,s),this._dirty=!0):s&&s.needsReload&&(o=!0),o&&s.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),s}_getNearestAncestor(e,t,n){const{_minZoom:i=0}=this;let r={x:e,y:t,z:n};for(;r.z>i;){r=this.getParentIndex(r);const e=this._getTile(r);if(e)return e}return null}}function TS(e){for(;e;){if(e.isLoaded||e.content)return e.state|=2,!0;e=e.parent}return!1}function AS(e){for(const t of e.children)t.isLoaded||t.content?t.state|=2:AS(t)}const kS={data:[],dataComparator:mS.equals,renderSubLayers:{type:"function",value:e=>new GeoJsonLayer(e),compare:!1},getTileData:{type:"function",optional:!0,value:null,compare:!1},onViewportLoad:{type:"function",optional:!0,value:null,compare:!1},onTileLoad:{type:"function",value:e=>{},compare:!1},onTileUnload:{type:"function",value:e=>{},compare:!1},onTileError:{type:"function",value:e=>console.error(e),compare:!1},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:SS,zRange:null,maxRequests:6,zoomOffset:0};class TileLayer extends CompositeLayer{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e;null===(e=this.state.tileset)||void 0===e||e.finalize()}get isLoaded(){const{tileset:e}=this.state;return e.selectedTiles.every((e=>e.isLoaded&&e.layers&&e.layers.every((e=>e.isLoaded))))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,changeFlags:t}){let{tileset:n}=this.state;const i=t.propsOrDataChanged||t.updateTriggersChanged,r=t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getTileData);n?i&&(n.setOptions(this._getTilesetOptions(e)),r?n.reloadAll():this.state.tileset.tiles.forEach((e=>{e.layers=null}))):(n=new Tileset2D(this._getTilesetOptions(e)),this.setState({tileset:n})),this._updateTileset()}_getTilesetOptions(e){const{tileSize:t,maxCacheSize:n,maxCacheByteSize:i,refinementStrategy:r,extent:s,maxZoom:o,minZoom:a,maxRequests:l,zoomOffset:c}=e;return{maxCacheSize:n,maxCacheByteSize:i,maxZoom:o,minZoom:a,tileSize:t,refinementStrategy:r,extent:s,maxRequests:l,zoomOffset:c,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const{tileset:e}=this.state,{zRange:t,modelMatrix:n}=this.props,i=e.update(this.context.viewport,{zRange:t,modelMatrix:n}),{isLoaded:r}=e,s=this.state.isLoaded!==r,o=this.state.frameNumber!==i;r&&(s||o)&&this._onViewportLoad(),o&&this.setState({frameNumber:i}),this.state.isLoaded=r}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:t}=this.props;t&&t(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,t){this.props.onTileError(e),t.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:t,getTileData:n,fetch:i}=this.props,{signal:r}=e;return e.url=function(e,t){if(!e||!e.length)return null;Array.isArray(e)&&(e=e[Math.abs(t.x+t.y)%e.length]);const{x:n,y:i,z:r}=t;return e.replace(/\{x\}/g,n).replace(/\{y\}/g,i).replace(/\{z\}/g,r).replace(/\{-y\}/g,Math.pow(2,r)-i-1)}(t,e),n?n(e):e.url?i(e.url,{propName:"data",layer:this,signal:r}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo({info:e,sourceLayer:t}){return e.tile=t.props.tile,e}_updateAutoHighlight(e){e.sourceLayer&&e.sourceLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map((e=>{const t=this.getSubLayerPropsByTile(e);if(e.isLoaded||e.content)if(e.layers)t&&e.layers[0]&&Object.keys(t).some((n=>e.layers[0].props[n]!==t[n]))&&(e.layers=e.layers.map((e=>e.clone(t))));else{const n=this.renderSubLayers({...this.props,id:"".concat(this.id,"-").concat(e.x,"-").concat(e.y,"-").concat(e.z),data:e.content,_offset:0,tile:e});e.layers=Vh(n,Boolean).map((n=>n.clone({tile:e,...t})))}else;return e.layers}))}filterSubLayer({layer:e}){return e.props.tile.isVisible}}TileLayer.layerName="TileLayer",TileLayer.defaultProps=kS;const NS=new Uint16Array([0,2,1,0,3,2]),MS=new Float32Array([0,1,0,0,1,0,1,1]);function PS(e,t){if(!t)return function(e){const t=new Float64Array(12);for(let n=0;n<e.length;n++)t[3*n+0]=e[n][0],t[3*n+1]=e[n][1],t[3*n+2]=e[n][2]||0;return{vertexCount:6,positions:t,indices:NS,texCoords:MS}}(e);const n=Math.max(Math.abs(e[0][0]-e[3][0]),Math.abs(e[1][0]-e[2][0])),i=Math.max(Math.abs(e[1][1]-e[0][1]),Math.abs(e[2][1]-e[3][1])),r=Math.ceil(n/t)+1,s=Math.ceil(i/t)+1,o=(r-1)*(s-1)*6,a=new Uint32Array(o),l=new Float32Array(r*s*2),c=new Float64Array(r*s*3);let u=0,d=0;for(let t=0;t<r;t++){const n=t/(r-1);for(let i=0;i<s;i++){const r=i/(s-1),o=LS(e,n,r);c[3*u+0]=o[0],c[3*u+1]=o[1],c[3*u+2]=o[2]||0,l[2*u+0]=n,l[2*u+1]=1-r,t>0&&i>0&&(a[d++]=u-s,a[d++]=u-s-1,a[d++]=u-1,a[d++]=u-s,a[d++]=u-1,a[d++]=u),u++}}return{vertexCount:o,positions:c,indices:a,texCoords:l}}function LS(e,t,n){return oh(oh(e[0],e[1],n),oh(e[3],e[2],n),t)}const OS="\n#define SHADER_NAME bitmap-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D bitmapTexture;\n\nvarying vec2 vTexCoord;\nvarying vec2 vTexPos;\n\nuniform float desaturate;\nuniform vec4 transparentColor;\nuniform vec3 tintColor;\nuniform float opacity;\n\nuniform float coordinateConversion;\nuniform vec4 bounds;\n\n/* projection utils */\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / PI / 2.0;\n\n// from degrees to Web Mercator\nvec2 lnglat_to_mercator(vec2 lnglat) {\n  float x = lnglat.x;\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\n// from Web Mercator to degrees\nvec2 mercator_to_lnglat(vec2 xy) {\n  xy /= WORLD_SCALE;\n  return degrees(vec2(\n    xy.x - PI,\n    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5\n  ));\n}\n/* End projection utils */\n\n// apply desaturation\nvec3 color_desaturate(vec3 color) {\n  float luminance = (color.r + color.g + color.b) * 0.333333333;\n  return mix(color, vec3(luminance), desaturate);\n}\n\n// apply tint\nvec3 color_tint(vec3 color) {\n  return color * tintColor;\n}\n\n// blend with background color\nvec4 apply_opacity(vec3 color, float alpha) {\n  return mix(transparentColor, vec4(color, 1.0), alpha);\n}\n\nvec2 getUV(vec2 pos) {\n  return vec2(\n    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),\n    (pos.y - bounds[3]) / (bounds[1] - bounds[3])\n  );\n}\n\n".concat("\nvec3 packUVsIntoRGB(vec2 uv) {\n  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction\n  vec2 uv8bit = floor(uv * 256.);\n\n  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits\n  // Scale and clamp to 0-1 range\n  vec2 uvFraction = fract(uv * 256.);\n  vec2 uvFraction4bit = floor(uvFraction * 16.);\n\n  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates\n  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;\n\n  return vec3(uv8bit, fractions) / 255.;\n}\n","\n\nvoid main(void) {\n  vec2 uv = vTexCoord;\n  if (coordinateConversion < -0.5) {\n    vec2 lnglat = mercator_to_lnglat(vTexPos);\n    uv = getUV(lnglat);\n  } else if (coordinateConversion > 0.5) {\n    vec2 commonPos = lnglat_to_mercator(vTexPos);\n    uv = getUV(commonPos);\n  }\n  vec4 bitmapColor = texture2D(bitmapTexture, uv);\n\n  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);\n\n  geometry.uv = uv;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n\n  if (picking_uActive) {\n    // Since instance information is not used, we can use picking color for pixel index\n    gl_FragColor.rgb = packUVsIntoRGB(uv);\n  }\n}\n"),RS={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:uu.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]}};class BitmapLayer extends Layer{getShaders(){return super.getShaders({vs:"\n#define SHADER_NAME bitmap-layer-vertex-shader\n\nattribute vec2 texCoords;\nattribute vec3 positions;\nattribute vec3 positions64Low;\n\nvarying vec2 vTexCoord;\nvarying vec2 vTexPos;\n\nuniform float coordinateConversion;\n\nconst vec3 pickingColor = vec3(1.0, 0.0, 0.0);\n\nvoid main(void) {\n  geometry.worldPosition = positions;\n  geometry.uv = texCoords;\n  geometry.pickingColor = pickingColor;\n\n  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTexCoord = texCoords;\n\n  if (coordinateConversion < -0.5) {\n    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;\n  } else if (coordinateConversion > 0.5) {\n    vTexPos = geometry.worldPosition.xy;\n  }\n\n  vec4 color = vec4(0.0);\n  DECKGL_FILTER_COLOR(color, geometry);\n}\n",fs:OS,modules:[kv,Pv]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const t=!0;e.add({indices:{size:1,isIndexed:!0,update:e=>e.value=this.state.mesh.indices,noAlloc:t},positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:e=>e.value=this.state.mesh.positions,noAlloc:t},texCoords:{size:2,update:e=>e.value=this.state.mesh.texCoords,noAlloc:t}})}updateState({props:e,oldProps:t,changeFlags:n}){if(n.extensionsChanged){var i;const{gl:e}=this.context;null===(i=this.state.model)||void 0===i||i.delete(),this.state.model=this._getModel(e),this.getAttributeManager().invalidateAll()}const r=this.getAttributeManager();if(e.bounds!==t.bounds){const e=this.state.mesh,t=this._createMesh();this.state.model.setVertexCount(t.vertexCount);for(const n in t)e&&e[n]!==t[n]&&r.invalidate(n);this.setState({mesh:t,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==t._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo({info:e}){const{image:t}=this.props;if(!e.color||!t)return e.bitmap=null,e;const{width:n,height:i}=t;e.index=0;const r=function(e){const[t,n,i]=e;return[(t+(15&i)/16)/256,(n+(240&i)/256)/256]}(e.color),s=[Math.floor(r[0]*n),Math.floor(r[1]*i)];return e.bitmap={size:{width:n,height:i},uv:r,pixel:s},e}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let t=e;return Number.isFinite(e[0])&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),PS(t,this.context.viewport.resolution)}_getModel(e){return e?new Model(e,{...this.getShaders(),id:this.props.id,geometry:new Geometry({drawMode:4,vertexCount:6}),isInstanced:!1}):null}draw(e){const{uniforms:t,moduleParameters:n}=e,{model:i,coordinateConversion:r,bounds:s,disablePicking:o}=this.state,{image:a,desaturate:l,transparentColor:c,tintColor:u}=this.props;n.pickingActive&&o||a&&i&&i.setUniforms(t).setUniforms({bitmapTexture:a,desaturate:l,transparentColor:c.map((e=>e/255)),tintColor:u.slice(0,3).map((e=>e/255)),coordinateConversion:r,bounds:s}).draw()}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:t,DEFAULT:n}=uu;let{_imageCoordinateSystem:i}=this.props;if(i!==n){const{bounds:n}=this.props;if(!Number.isFinite(n[0]))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const r=this.context.viewport.resolution?e:t;if(i=i===e?e:t,i===e&&r===t)return{coordinateConversion:-1,bounds:n};if(i===t&&r===e){const e=fg([n[0],n[1]]),t=fg([n[2],n[3]]);return{coordinateConversion:1,bounds:[e[0],e[1],t[0],t[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}BitmapLayer.layerName="BitmapLayer",BitmapLayer.defaultProps=RS;const IS=["bearing","pitch"],DS={speed:1.2,curve:1.414};class FlyToInterpolator extends TransitionInterpolator{constructor(e={}){super({compare:["longitude","latitude","zoom","bearing","pitch"],extract:["width","height","longitude","latitude","zoom","bearing","pitch"],required:["width","height","latitude","longitude","zoom"]}),this.props={...DS,...e}}interpolateProps(e,t,n){const i=function(e,t,n,i){const{startZoom:r,startCenterXY:s,uDelta:o,w0:a,u1:l,S:c,rho:u,rho2:d,r0:h}=kg(e,t,i);if(l<.01){const i={};for(const r of Tg){const s=e[r],o=t[r];i[r]=eg(s,o,n)}return i}const p=n*c,f=Math.cosh(h)/Math.cosh(h+u*p),m=a*((Math.cosh(h)*Math.tanh(h+u*p)-Math.sinh(h))/d)/l,g=r+pg(1/f),y=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}([],o,m);Bm(y,y,s);const v=mg(y);return{longitude:v[0],latitude:v[1],zoom:g}}(e,t,n,this.props);for(const r of IS)i[r]=oh(e[r]||0,t[r]||0,n);return i}getDuration(e,t){let{transitionDuration:n}=t;return"auto"===n&&(n=function(e,t,n){const i={...Ag,...n},{screenSpeed:r,speed:s,maxDuration:o}=i,{S:a,rho:l}=kg(e,t,i),c=1e3*a;let u;return u=Number.isFinite(r)?c/(r/l):c/s,Number.isFinite(o)&&u>o?0:u}(e,t,this.props)),n}}class Slider extends RTComp{constructor(){super(...arguments),this.state={ready:!1},this.onDeltaCombined=(e,t)=>{}}onMount(){}render(){var e;const{style:n={},className:i="",min:r,max:s,value:o,label:a,onChange:l,step:c}=this.props;return t.createElement("div",{className:"slidecontainer flex-col"+i,style:n},a&&t.createElement("div",{className:"mb-p25 text-gray-400"},a),t.createElement("input",{type:"range",min:r,max:s,value:null!==(e=null!=o?o:r)&&void 0!==e?e:s,step:Math.min(1,null!=c?c:Math.abs(r-s)/60),className:"slider",id:"myRange",onChange:l}))}}"undefined"!=typeof window&&window.devicePixelRatio;class DeckGLMap extends RTComp{constructor(){super(...arguments),this.state={basemap:{opacity:.2,desaturate:0},dataOpacity:.5,initialView:{latitude:51.47,longitude:.45,zoom:4,bearing:0,pitch:0},mouseDown:!1,autoZoom:!1},this.onDelta=(e,t)=>{(null==e?void 0:e.geoJsonLayers)&&this.state.autoZoom&&this.fitBounds(),this.refRoot&&!this.rootResizeObserver&&(this.rootResizeObserver=new ResizeObserver((()=>{this._rootSizeKey!==this.rootSizeKey&&(this.forceUpdate(),this._rootSizeKey=this.rootSizeKey)})),this.rootResizeObserver.observe(this.refRoot))},this._rootSizeKey="",this.fitBounds=async e=>{var t,n,i,r;const s=null===(r=null===(i=null===(n=null===(t=this.ref)||void 0===t?void 0:t.deck)||void 0===n?void 0:n.getViewports)||void 0===i?void 0:i.call(n))||void 0===r?void 0:r[0],o=await this.props.onGetFullExtent();if(s&&o){this.transitioning=!0;try{const e=[[Math.max(o[0][0],-179.9),Math.max(o[0][1],-89.9)],[Math.min(o[1][0],179.9),Math.min(o[1][1],89.9)]],{longitude:t,latitude:n,zoom:i}=s.fitBounds(e,{padding:20});let r={...s,longitude:t,latitude:n,zoom:Math.min(i,15),transitionInterpolator:new FlyToInterpolator({speed:2}),transitionDuration:800,onTransitionEnd:()=>{this.transitioning=!1,this.onViewStateChange(r)}};this.setState({initialView:r})}catch(e){console.error(e),this.transitioning=!1}}},this.isHovering=!1}get rootSizeKey(){var e,t;return`${null===(e=this.refRoot)||void 0===e?void 0:e.offsetWidth}.${null===(t=this.refRoot)||void 0===t?void 0:t.offsetHeight}`}onUnmount(){var e;null===(e=this.rootResizeObserver)||void 0===e||e.unobserve(this.refRoot)}onViewStateChange(e){const{onMapStateChange:t,mapStateChangeDebounce:n}=this.props;!this.transitioning&&t&&e&&(this.viewStateDebounce&&window.clearTimeout(this.viewStateDebounce),this.viewStateDebounce=setTimeout((()=>{const n=new web_mercator_viewport_WebMercatorViewport(e),i=n.unproject([0,0]),r=n.unproject([n.width,n.height]),s=[i[0],r[1]],o=[r[0],i[1]];t({...e,extent:[...s,...o]}),this.viewStateDebounce=null}),n||300))}render(){var e,n;const{geoJsonLayers:i=[],onHover:r,initialState:s={},onLoad:o,onClick:a,tileURLs:l,tileSize:c,tileAttribution:u,options:d,onOptionsChange:h}=this.props,{basemap:p,dataOpacity:f=1,initialView:m,mouseDown:g,autoZoom:y}=this.state;if(!l)return null;const v=i.map((e=>new GeoJsonLayer({id:e.id,data:{type:"FeatureCollection",features:e.features},filled:!0,pointRadiusMinPixels:2,pointRadiusScale:1,getPointRadius:e=>{var t,n;return null!==(n=null===(t=e.properties)||void 0===t?void 0:t.radius)&&void 0!==n?n:1},extruded:Boolean(e.elevation),getElevation:e.elevation||0,getFillColor:t=>{var n;return(null===(n=t.properties)||void 0===n?void 0:n.fillColor)||e.fillColor||[200,0,80,255]},getLineColor:t=>{var n;return(null===(n=t.properties)||void 0===n?void 0:n.lineColor)||e.lineColor||[200,0,80,255]},lineWidthMinPixels:2,widthScale:22,lineWidth:e=>{var t,n;return null!==(n=null===(t=e.properties)||void 0===t?void 0:t.lineWidth)&&void 0!==n?n:1},pickable:!0,autoHighlight:!0,onClick:e.onClick,opacity:f})));let b=[BS({...p,tileURLs:l,tileSize:c}),...v];return t.createElement("div",{className:"relative f-1",ref:e=>{e&&(this.refRoot=e)},style:{overscrollBehavior:"contain"},onMouseDown:()=>{this.setState({mouseDown:!0})},onMouseUp:()=>{this.setState({mouseDown:!1})}},(null==u?void 0:u.title)&&t.createElement("div",{className:"text-ellipsis noselect rounded font-14",style:{position:"absolute",right:0,bottom:0,maxHeight:"1.5em",zIndex:1,backdropFilter:"blur(6px)",padding:"4px"}},t.createElement("a",{href:u.url,target:"_blank"},null==u?void 0:u.title)),t.createElement(H_,{key:`${null===(e=this.refRoot)||void 0===e?void 0:e.offsetWidth}_${null===(n=this.refRoot)||void 0===n?void 0:n.offsetHeight}`,width:"100%",height:"100%",ref:e=>{e&&(this.ref=e)},onLoad:()=>{null==o||o({fitBounds:this.fitBounds,getExtent:()=>{var e,t;const n=new web_mercator_viewport_WebMercatorViewport(null===(t=null===(e=this.ref)||void 0===e?void 0:e.deck)||void 0===t?void 0:t.viewState);return[n.unproject([0,0]),n.unproject([n.width,n.height])]}})},controller:!0,initialViewState:this.transitioning?m:{...m,...s},layers:b,getCursor:({isDragging:e})=>e?"grabbing":this.isHovering?"pointer":"grab",onClick:a,onHover:g?void 0:e=>{const{object:t,x:n,y:i}=e;if(this.refRoot&&r&&JSON.stringify(t||{})!==JSON.stringify(this.currHoverObject||{})){const e=this.refRoot.getBoundingClientRect(),s={x:n,y:i,xScreen:e.x+n,yScreen:e.y+i};this.isHovering=Boolean(t),this.currHoverObject=t?{...t}:t,r(t||void 0,s)}return null},onViewStateChange:({viewState:e})=>{this.onViewStateChange(e)}}),t.createElement("div",{className:"map-controls-right ",style:{position:"absolute",right:0,top:0,bottom:0}},window.isMobileDevice&&t.createElement(Btn,{iconPath:Ce,style:{marginLeft:"-4em"}}),t.createElement(Slider,{label:`Basemap opacity ${p.opacity.toFixed(1)}`,min:0,max:1,value:p.opacity,onChange:e=>{this.setState({basemap:{...p,opacity:+e.target.value}})}}),t.createElement(Slider,{label:`Basemap desaturate ${p.desaturate.toFixed(1)}`,min:-15,max:15,value:p.desaturate,onChange:e=>{this.setState({basemap:{...p,desaturate:+e.target.value}})}}),t.createElement(Slider,{label:"Data opacity",min:0,max:1,value:f,onChange:e=>{this.setState({dataOpacity:+e.target.value})}}),t.createElement("div",{className:"w-full"},t.createElement(Btn,{title:"Zoom to data extent",iconPath:Fe,style:{background:"white"},className:"b b-gray-200 mt-1",disabledInfo:y?"Must disable Auto zoom to data extent":d.filterExtent?"Must disable 'Auto Filter map extent'":void 0,onClick:async e=>{this.fitBounds()}},"Zoom to data extent"),t.createElement(Btn,{title:"Auto zoom to data extent",iconPath:Fe,color:y?"action":void 0,style:{background:"white"},className:"b b-gray-200 mt-1",disabledInfo:d.filterExtent?"Must disable 'Auto Filter map extent'":void 0,onClick:async e=>{this.setState({autoZoom:!y})}},"Auto Zoom to data extent"),t.createElement(Btn,{title:"Auto Filter map extent ",iconPath:"M15,19.88C15.04,20.18 14.94,20.5 14.71,20.71C14.32,21.1 13.69,21.1 13.3,20.71L9.29,16.7C9.06,16.47 8.96,16.16 9,15.87V10.75L4.21,4.62C3.87,4.19 3.95,3.56 4.38,3.22C4.57,3.08 4.78,3 5,3V3H19V3C19.22,3 19.43,3.08 19.62,3.22C20.05,3.56 20.13,4.19 19.79,4.62L15,10.75V19.88M7.04,5L11,10.06V15.58L13,17.58V10.05L16.96,5H7.04Z",color:d.filterExtent?"action":void 0,style:{background:"white"},className:"b b-gray-200 mt-1",disabledInfo:y?"Must disable 'Auto Zoom to data extent'":void 0,onClick:async e=>{h({filterExtent:!d.filterExtent})}},"Auto Filter map extent"))))}}const FS=["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png","https://c.tile.openstreetmap.org/{z}/{x}/{y}.png"];function BS({opacity:e=1,desaturate:t=22,tileURLs:n=FS,onTilesLoad:i,showBorder:r=!1,tileSize:s=256,asMVT:o=!1}={}){return n&&Array.isArray(n)&&n.find((e=>"string"==typeof e))||(n=FS),new TileLayer({opacity:e,desaturate:t,transparentColor:[255,255,255,255],data:n,maxRequests:20,pickable:!0,onViewportLoad:i,autoHighlight:r,highlightColor:[60,60,60,40],minZoom:0,maxZoom:19,tileSize:s,renderSubLayers:e=>{const{bbox:{west:t,south:n,east:i,north:s}}=e.tile;return[new BitmapLayer(e,{data:null,image:e.data,bounds:[t,n,i,s]}),r&&new PathLayer({id:`${e.id}-border`,visible:e.visible,data:[[[t,s],[t,n],[i,n],[i,s],[t,s]]],getPath:e=>e,getColor:[255,0,0],widthMinPixels:4})]}})}class QueryForm extends t.Component{constructor(){super(...arguments),this.state={sql:void 0}}render(){var e;const{running:n,error:i}=this.state,{hint:r,db:s,onSuccess:o}=this.props;if(!this.props.sql)return null;const a=null!==(e=this.state.sql)&&void 0!==e?e:this.props.sql;return t.createElement("div",{className:"flex-col"},t.createElement(FormField,{className:"my-1 f-1",asColumn:!0,label:r||"Prepared query",maxWidth:"",placeholder:" ",value:a,asTextArea:!0,onChange:e=>{this.setState({sql:e})},error:i,hint:r}),t.createElement(Btn,{style:{alignSelf:"flex-start"},size:"small",variant:"outline",iconPath:Ue,title:"Run query",loading:n,onClick:async()=>{var e;try{this.setState({running:!0}),await(null===(e=s.sql)||void 0===e?void 0:e.call(s,a)),this.setState({running:!1,hint:"Success!",error:void 0}),null==o||o()}catch(e){this.setState({error:null==e?void 0:e.err_msg,running:!1})}}},"RUN"))}}class ColumnsMenu extends RTComp{constructor(){super(...arguments),this.state={addColMenu:void 0,query:void 0},this.onDelta=async(e,t,n)=>{const i=this.props.w;i&&i.$cloneSync&&!this.wSub&&(this.wSub=await i.$cloneSync(((e,t)=>{this.setState({w:e})})))}}render(){var e;const{w:n,addColMenu:i,query:r}=this.state,{db:s,tables:o,tableName:a,nestedTable:l,onClose:c,showAddCompute:u}=this.props;if(!n)return null;let d=o.find((e=>e.name===a)),h=ProstglesTable.getFullColumnConfig(o,n),p=e=>{if(l){let t={...n.nested_tables[l]};return t.cols=e,n.$update({nested_tables:{...n.nested_tables,[l]:t}})}return n.$update({columns:e})};if(l&&n.nested_tables[l]&&(d=o.find((e=>e.name===l)),h=null!==(e=n.nested_tables[l].cols)&&void 0!==e?e:ProstglesTable.getFullColumnConfig(o,{table_name:l})),!d)return t.createElement("div",null,"table ",l||a," not found");let f=null;return(i||u)&&(f=t.createElement(AddColMenu,{tableHandler:s[a],columns:d.columns,onAdd:(e,t)=>{var i;if(l){let t={...n.nested_tables[l]};t.cols=t.cols.concat([e]),n.$update({sort:[],nested_tables:{...n.nested_tables,[l]:t}})}else{let r=(null===(i=n.columns)||void 0===i?void 0:i.map((e=>({...e}))))||[];"Start"===t?r.unshift(e):r.push(e),n.$update({sort:[],columns:r})}},anchorEl:i,cols:h,onClose:c})),r?t.createElement("div",{className:"flex-col f-1 min-h-0"},t.createElement(QueryForm,{db:s,...r})):t.createElement("div",{className:"flex-col f-1 min-h-0"},f,t.createElement(SearchList,{id:"cols",onReorder:async e=>{await p(e.map((e=>({...e.data,show:e.checked}))))},limit:200,className:"f-1",multiSelect:!0,items:h.sort(((e,t)=>+Boolean(t.show)-+Boolean(e.show))).map((e=>{var i,r,s,o,a,l,c,u,d;return{key:e.name,label:e.name+((null===(i=e.info)||void 0===i?void 0:i.references)?`    (${null===(r=e.info)||void 0===r?void 0:r.references.ftable})`:""),data:e,title:(null===(s=e.info)||void 0===s?void 0:s.udt_name)||"computed",contentLeft:t.createElement(tt(),{size:1,className:"mr-p5 text-gray-400",path:e.computedConfig?"M12.42,5.29C11.32,5.19 10.35,6 10.25,7.11L10,10H12.82V12H9.82L9.38,17.07C9.18,19.27 7.24,20.9 5.04,20.7C3.79,20.59 2.66,19.9 2,18.83L3.5,17.33C3.83,18.38 4.96,18.97 6,18.63C6.78,18.39 7.33,17.7 7.4,16.89L7.82,12H4.82V10H8L8.27,6.93C8.46,4.73 10.39,3.1 12.6,3.28C13.86,3.39 15,4.09 15.66,5.17L14.16,6.67C13.91,5.9 13.23,5.36 12.42,5.29M22,13.65L20.59,12.24L17.76,15.07L14.93,12.24L13.5,13.65L16.35,16.5L13.5,19.31L14.93,20.72L17.76,17.89L20.59,20.72L22,19.31L19.17,16.5L22,13.65Z":["geometry","geography"].includes(null!==(a=null===(o=e.info)||void 0===o?void 0:o.udt_name)&&void 0!==a?a:"")?"M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z":"Object"===(null===(l=e.info)||void 0===l?void 0:l.tsDataType)?"M5,3H7V5H5V10A2,2 0 0,1 3,12A2,2 0 0,1 5,14V19H7V21H5C3.93,20.73 3,20.1 3,19V15A2,2 0 0,0 1,13H0V11H1A2,2 0 0,0 3,9V5A2,2 0 0,1 5,3M19,3A2,2 0 0,1 21,5V9A2,2 0 0,0 23,11H24V13H23A2,2 0 0,0 21,15V19A2,2 0 0,1 19,21H17V19H19V14A2,2 0 0,1 21,12A2,2 0 0,1 19,10V5H17V3H19M12,15A1,1 0 0,1 13,16A1,1 0 0,1 12,17A1,1 0 0,1 11,16A1,1 0 0,1 12,15M8,15A1,1 0 0,1 9,16A1,1 0 0,1 8,17A1,1 0 0,1 7,16A1,1 0 0,1 8,15M16,15A1,1 0 0,1 17,16A1,1 0 0,1 16,17A1,1 0 0,1 15,16A1,1 0 0,1 16,15Z":"string"===(null===(c=e.info)||void 0===c?void 0:c.tsDataType)?Ie:"Date"===(null===(u=e.info)||void 0===u?void 0:u.tsDataType)?Ee:"number"===(null===(d=e.info)||void 0===d?void 0:d.tsDataType)?"M4,17V9H2V7H6V17H4M22,15C22,16.11 21.1,17 20,17H16V15H20V13H18V11H20V9H16V7H20A2,2 0 0,1 22,9V10.5A1.5,1.5 0 0,1 20.5,12A1.5,1.5 0 0,1 22,13.5V15M14,15V17H8V13C8,11.89 8.9,11 10,11H12V9H8V7H12A2,2 0 0,1 14,9V11C14,12.11 13.1,13 12,13H10V15H14Z":"M6,2C4.89,2 4,2.89 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6M13,3.5L18.5,9H13V3.5M12,11A3,3 0 0,1 15,14C15,15.88 12.75,16.06 12.75,17.75H11.25C11.25,15.31 13.5,15.5 13.5,14A1.5,1.5 0 0,0 12,12.5A1.5,1.5 0 0,0 10.5,14H9A3,3 0 0,1 12,11M11.25,18.5H12.75V20H11.25V18.5Z"}),contentRight:e.computedConfig?t.createElement(Btn,{className:"text-red-700",color:"inherit",title:e.format?"Remove formatting":"Remove computed field",iconPath:Me,onClick:t=>{let i;t.stopPropagation(),i=e.format?n.columns.map((t=>{if(t.name===e.name){let e={...t,computed:!1};return delete e.format,e}return t})):n.columns.filter((t=>t.name!==e.name)),p(i)}}):void 0,onPress:()=>{let t=n.columns.map((t=>(t.name===e.name&&(t.show=!e.show),t)));p(t)},checked:e.show}}))}),t.createElement("div",{className:"flex-col p-1"},t.createElement(Btn,{className:"mt-1",iconPath:He,variant:"outline",size:"small",onClick:e=>{this.setState({addColMenu:e.currentTarget})}},"Add computed column"),t.createElement(Btn,{className:"my-1 ",iconPath:He,variant:"outline",size:"small",onClick:e=>{this.setState({query:{sql:`ALTER TABLE ${(0,Xn.asName)(a)} ADD COLUMN new_colname INTEGER`,hint:"New column will not appear instantly in the menu"}})}},"Create column")))}}const zS=["Function","Aggregate Function"];class AddColMenu extends RTComp{constructor(){super(...arguments),this.state={args:{},addTo:"Start"}}render(){var e,n,i,r,s,o,a,l,c;const{cols:u,onClose:d,onAdd:h,columns:p,tableHandler:f}=this.props,{colType:m="Function",column:g,func:y,args:v,template_string_hint:b,template_string_error:w,addTo:x}=this.state,_=(null===(e=this.state)||void 0===e?void 0:e.name)||((null===(n=null==y?void 0:y.def)||void 0===n?void 0:n.label)?`${null===(i=null==y?void 0:y.def)||void 0===i?void 0:i.label}(${g||""}${(null===(r=null==v?void 0:v.$duration)||void 0===r?void 0:r.otherColumn)?` TO ${null===(s=null==v?void 0:v.$duration)||void 0===s?void 0:s.otherColumn}`:""})`:"")||"col_name";let E=p;y&&(y.def.tsDataTypeCol||y.def.udtDataTypeCol)&&(E=p.filter((e=>"any"===y.def.tsDataTypeCol||"any"===y.def.udtDataTypeCol||(y.def.tsDataTypeCol?y.def.tsDataTypeCol.includes(e.tsDataType):!!y.def.udtDataTypeCol&&y.def.udtDataTypeCol.includes(e.udt_name)))));const S=y&&!(null==y?void 0:y.def.tsDataTypeCol)&&!(null==y?void 0:y.def.udtDataTypeCol),C="$template_string"===(null==y?void 0:y.def.key)?!w:"$duration"===(null===(o=null==y?void 0:y.def)||void 0===o?void 0:o.key)?!!(null===(a=null==v?void 0:v.$duration)||void 0===a?void 0:a.otherColumn):Boolean(y&&(g||S));return t.createElement(Popup,{open:!0,title:"Add computed column",rootStyle:{top:window.isMobileDevice?0:"2em",maxHeight:window.isIOSDevice?"100%":"calc(100vh - 4em)"},footerButtons:[{label:"Add",variant:"filled",size:"small",color:"action",iconPath:He,disabledInfo:C?void 0:"Some function inputs are missing",onClick:()=>{if(_)if(null==u?void 0:u.find((e=>e.name===_)))alert("Column name already in use: "+_);else{if(!y)return void alert("Something went wrong");h({name:_,show:!0,width:130,computedConfig:{funcName:y.key,funcDef:y.def,column:g,...y.def.outType,args:fT(v)?void 0:v}},x),null==d||d()}else alert("Provide a column name")}},{onClickClose:!0,label:"Cancel",variant:"outline"}],onClose:d},t.createElement(Select,{className:"mt-1",label:"Column type",variant:"pill",options:zS,value:m,onChange:e=>{this.setState({colType:e,func:void 0,column:void 0})}}),t.createElement("div",{className:"flex-row  f-1 min-h-0 mt-1"},g?t.createElement("div",{className:"flex-col f-1 min-h-0 mt-1 mr-1"},t.createElement("label",{className:"noselect f-0 text-gray-500 ta-left  mb-p5 "},"Column"),t.createElement(Btn,{variant:"filled",style:{backgroundColor:"rgb(0, 183, 255)"},onClick:()=>{this.setState({column:void 0})}},g)):S?null:t.createElement(SearchList,{id:"cols-elect",className:"mt-1 mr-1 f-1",label:"Column",items:E.map((e=>({key:e.name,label:e.name,subLabel:e.udt_name,onPress:()=>{this.setState({column:e.name})}})))}),y?t.createElement("div",{className:"flex-col mt-1"},t.createElement("label",{className:"noselect f-0 text-gray-500 ta-left  mb-p5 "},"Function"),t.createElement(Btn,{variant:"filled",style:{backgroundColor:"rgb(0, 183, 255)"},onClick:()=>{this.setState({func:void 0})}},y.def.label)):t.createElement(SearchList,{className:"mt-1 f-1",id:"func_type",label:"Function",items:("Aggregate Function"===m?HS.map((e=>({...e,label:e.name,subLabel:e.label}))):VS()).filter((e=>{var t,n;let i=E;return g&&(i=p.filter((e=>e.name===g))),!e.tsDataTypeCol&&!e.udtDataTypeCol||"any"===e.tsDataTypeCol||"any"===e.udtDataTypeCol||Array.isArray(e.udtDataTypeCol)&&(null===(t=e.udtDataTypeCol)||void 0===t?void 0:t.find((e=>i.some((t=>t.udt_name===e)))))||Array.isArray(e.tsDataTypeCol)&&(null===(n=e.tsDataTypeCol)||void 0===n?void 0:n.find((e=>i.some((t=>t.tsDataType===e)))))})).map((e=>({...e,contentLeft:t.createElement(tt(),{size:1.25,path:De}),onPress:()=>{this.setState({func:{def:e,key:e.key,isAgg:"Aggregate Function"===m},args:{}})}})))})),y&&"$template_string"===y.def.key&&t.createElement(t.Fragment,null,t.createElement(FormField,{className:"mt-1",asColumn:!0,value:null!==(l=null==v?void 0:v.$template_string)&&void 0!==l?l:"",label:"Template string",hint:null!=b?b:"Use column names. E.g.: Dear {FirstName} {LastName}",error:w,onChange:async e=>{let t;if(f&&f.find)try{t=await f.find({},{returnType:"value",limit:1,select:{val:{$template_string:[e]}}}),this.setState({args:{$template_string:e},template_string_error:void 0,template_string_hint:t})}catch(e){this.setState({template_string_error:e})}else this.setState({args:{$template_string:e},template_string_error:void 0})}}),t.createElement("div",{className:"flex-row-wrap"},p.map(((e,n)=>t.createElement("div",{key:n,className:"p-p25"},`{${e.name}}`))))),"$duration"===(null==y?void 0:y.key)&&((null===(c=null==v?void 0:v.$duration)||void 0===c?void 0:c.otherColumn)?t.createElement("div",{className:"flex-col mt-1"},t.createElement("label",{className:"noselect f-0 text-gray-500 ta-left  mb-p5 "},"Compare to"),t.createElement(Btn,{variant:"filled",style:{backgroundColor:"rgb(0, 183, 255)"},onClick:()=>{this.setState({args:{}})}},v.$duration.otherColumn)):t.createElement(SearchList,{id:"duration_othercolumn",label:"Compare to column",items:p.filter((e=>e.name!==g&&"Date"===e.tsDataType)).map((e=>({key:e.name,label:e.label,onPress:()=>{this.setState({args:{$duration:{otherColumn:e.name}}})}})))})),C&&t.createElement(t.Fragment,null,t.createElement(FormField,{label:"Name",type:"text",className:"mt-1",asColumn:!0,value:_,onChange:e=>{this.setState({name:e})}}),t.createElement(Select,{className:"mt-1",value:x,label:"Add to",options:["Start","End"],onChange:e=>this.setState({addTo:e})})))}}const jS={string:{tsDataType:"string"},number:{tsDataType:"number"},date:{tsDataType:"Date"},geo:{udt_name:"geography",tsDataType:"Object"}};function VS(){return[...[{key:"$ST_AsText",label:"ST_AsText",subLabel:"Returns the OGC Well-Known Text (WKT) representation of the geometry/geography"},{key:"$ST_AsGeoJSON",label:"ST_AsGeoJSON",subLabel:"Returns a geometry as a GeoJSON 'geometry', or a row as a GeoJSON 'feature'"},{key:"$ST_SnapToGrid",label:"ST_SnapToGrid",subLabel:"Snap all points of the input geometry to the grid defined by its origin and cell size. Remove consecutive points falling on the same cell"}].map((e=>({...e,outType:jS.geo,udtDataTypeCol:["geography","geometry"]}))),...[{key:"$datetime",label:"Date and time",subLabel:"timestamp formated as YYYY-MM-DD HH24:MI"},{key:"$timedate",label:"Time and date",subLabel:"timestamp formated as HH24:MI YYYY-MM-DD"},{key:"$D",label:"Day of week number",subLabel:"timestamp formated as D. Day of the week, Sunday (1) to Saturday (7)"},{key:"$dy",label:"Day name short",subLabel:"timestamp formated as dy. Abbreviated lower case day name (3 chars in English, localized lengths vary)"},{key:"$Dy",label:"Day Name short",subLabel:"timestamp formated as Dy. Abbreviated capitalized day name (3 chars in English, localized lengths vary)"},{key:"$DD",label:"Day of month",subLabel:"timestamp formated as DD. Day of month (01-31)"},{key:"$ID",label:"ISO 8601 day of the week",subLabel:"timestamp formated as ID. Monday (1) to Sunday (7)"},{key:"$MM",label:"Month number",subLabel:"timestamp formated as MM. Month number (01-12)"},{key:"$yy",label:"Year short",subLabel:"timestamp formated as YY. Last 2 digits of year"},{key:"$day",label:"Day name",subLabel:"timestamp formated as day. Full lower case day name"},{key:"$Day",label:"Day Name",subLabel:"timestamp formated as Day. Full capitalized day name"},{key:"$mon",label:"Month name short",subLabel:"timestamp formated as mon. Abbreviated lower case month name (3 chars in English, localized lengths vary)"},{key:"$Mon",label:"Month Name short",subLabel:"timestamp formated as Mon. Abbreviated capitalized month name (3 chars in English, localized lengths vary)"},{key:"$month",label:"Month name",subLabel:"timestamp formated as month. Full lower case month name "},{key:"$Month",label:"Month Name",subLabel:"timestamp formated as Month. Full capitalized month name "},{key:"$date",label:"Date",subLabel:"timestamp formated as YYYY-MM-DD"},{key:"$time",label:"Time",subLabel:"timestamp formated as HH24:MI. 24 Hour time format"},{key:"$yyyy",label:"Year full",subLabel:"timestamp formated as yyyy. Year (4 or more digits)"},{key:"$time12",label:"Time 12H",subLabel:"timestamp formated as HH:MI. 12 Hour time format"},{key:"$timeAM",label:"Time AM/PM",subLabel:"timestamp formated as HH:MI AM. 24 Hour time format with AM/PM meridiem indicators"},{key:"$age",label:"AGE",subLabel:"Age of timestamp compared to today"},{key:"$duration",label:"Duration",subLabel:"Duration between another date field. Expressed as an interval of years, months, days, minutes"}].map((e=>({...e,outType:jS.string,tsDataTypeCol:["Date"]}))),...[{key:"$trim",label:"TRIM",subLabel:"Remove spaces or set of characters from the leading or trailing or both side from a string"},{key:"$upper",label:"Uppercase",subLabel:"Convert all characters to uppercase"},{key:"$lower",label:"Lowercase",subLabel:"Convert all characters to lowercase"},{key:"$length",label:"Length",subLabel:"Number of characters in the string"},{key:"$reverse",label:"Reverse",subLabel:"Arrange a string in reverse order"},{key:"$initcap",label:"Capitalise Initials",subLabel:"Convert the first letter of each word to upper case and the remaining to lower case"},{key:"$unnest_words",label:"Split into words",subLabel:"Split text from a column at spaces"}].map((e=>({...e,outType:jS.string,tsDataTypeCol:["string"]}))),...[{key:"$ceil",label:"Ceil",subLabel:"Smallest integer which is greater than, or equal to, the specified numeric expression"},{key:"$floor",label:"Floor",subLabel:"Smallest integer which is lower than, or equal to, the specified numeric expression"},{key:"$sign",label:"Sign",subLabel:"Returns -1 0 or 1 depending of the column value. Returns null if null is provided"},{key:"$round",label:"Round",subLabel:"Round to nearest integer"}].map((e=>({...e,outType:jS.number,tsDataTypeCol:["number"]}))),...[{key:"$template_string",label:"Template string",subLabel:"Create a string based on column values. E.g.: Dear {FirstName} {LastName}, ..."}].map((e=>({...e,outType:jS.string})))].map((e=>({...e})))}const US=["number","Date"],HS=[{key:"$countAll",name:"COUNT ALL",label:"Count all rows",tsDataTypeCol:void 0,outType:jS.number},{key:"$count",name:"COUNT",label:"Count of rows for which the column value is not null",tsDataTypeCol:"any",outType:jS.number},{key:"$max",name:"MAX",label:"Maximum value",tsDataTypeCol:US,outType:jS.number},{key:"$min",name:"MIN",label:"Minimum value",tsDataTypeCol:US,outType:jS.number},{key:"$avg",name:"AVERAGE",label:"Average value",tsDataTypeCol:US,outType:jS.number},{key:"$sum",name:"SUM",label:"Sum of all non-null input values",tsDataTypeCol:US,outType:jS.number},{key:"$string_agg",name:"AGGREGATE STRING",label:"Non-null string/text values concatenated into a string, separated by delimiter",tsDataTypeCol:["string"],outType:jS.string}];const $S=["Realtime","Interval","None"];class TableMenu extends RTComp{constructor(){super(...arguments),this.state={l1Key:void 0,l2Key:void 0,query:void 0,running:void 0,error:void 0,initError:void 0,hint:void 0,indexes:void 0,columnsConfig:void 0,infoQuery:void 0,autoRefreshSeconds:void 0,tableMeta:void 0},this.d={w:void 0},this.onUnmount=async()=>{this.wSub&&await this.wSub.$unsync()},this.loading=!1,this.onDelta=async(e,t,n)=>{const{db:i,tableName:r,cols:s,dbs:o}=this.props,a=this.d.w||this.props.w;r&&(null==a?void 0:a.$cloneSync)&&!this.loading&&(this.loading=!0,this.wSub=await a.$cloneSync(((e,t)=>{this.setData({w:e},{w:t})})),this.getTableInfo()),t&&"query"in t&&this.setState({error:void 0})}}getTableInfo(){const{db:e,tableName:t}=this.props;t&&async function(e,t){if(!e.sql)throw"db.sql not allowed";try{const n=await e.sql("\n      SELECT conname, pg_get_constraintdef(c.oid) as definition \n      FROM pg_catalog.pg_constraint c\n        INNER JOIN pg_catalog.pg_class rel\n        ON rel.oid = c.conrelid\n        INNER JOIN pg_catalog.pg_namespace nsp\n        ON nsp.oid = connamespace\n        WHERE nsp.nspname = 'public'\n            AND rel.relname = ${tableName};",{tableName:t},{returnType:"rows"}),i=await e.sql("\n      SELECT tablename, indexname, indexdef\n      FROM pg_indexes\n      WHERE schemaname = 'public' AND tablename=${tableName}",{tableName:t},{returnType:"rows"}),r=await e.sql('\n      SELECT\n        relname  as table_name,\n        pg_size_pretty(pg_total_relation_size(relid)) As "Total Size",\n        pg_size_pretty(pg_total_relation_size(relid) - pg_relation_size(relid)) as "Index Size",\n        pg_size_pretty(pg_relation_size(relid)) as "Actual Size",\n        (SELECT COUNT(*) FROM ${tableName:name}) as "Row count"\n      FROM pg_catalog.pg_statio_user_tables \n      WHERE relname=${tableName}\n      ORDER BY pg_total_relation_size(relid) DESC;\n    ',{tableName:t},{returnType:"row"})||{},s=await e.sql("SELECT obj_description(format('%I', $1)::regclass::oid) as c FROM pg_class LIMIT 1",[t],{returnType:"value"});return{constraints:n,indexes:i,sizeInfo:r,comment:s,triggers:await e.sql("\n      SELECT event_object_table\n        ,trigger_name\n        ,event_manipulation\n        ,action_statement\n        ,action_timing\n        ,CASE WHEN pg_catalog.starts_with(action_statement, 'EXECUTE FUNCTION ') THEN pg_get_functiondef(RIGHT(action_statement, -17 )::regprocedure) ELSE '' END as function_def\n      FROM  information_schema.triggers\n      -- WHERE event_object_table = ${tableName}\n      ORDER BY event_object_table\n      ,event_manipulation\n    ",{tableName:t},{returnType:"rows"})}}catch(e){throw console.error(e),e}}(e,t).then((async e=>{this.setState({tableMeta:e})})).catch((e=>{this.setState({initError:e})}))}render(){var e,n,i,r,s,o,a,l,c,u,d,h,p,f,m;const{tableName:g,db:y,cols:v,onAddChart:b,onClose:w,w:x,tables:_}=this.props,{infoQuery:E,l1Key:S,query:C,initError:T,tableMeta:A,linkTablePath:k}=this.state;if(T)return t.createElement("div",{className:"p-1"},t.createElement(ErrorComponent,{error:T}));t.createElement("div",{className:"text-gray-800 noselect flex-row ai-center"},t.createElement(AddChartMenu,{w:x,onAddChart:b}));let N,M=null;if(C&&(M=t.createElement(QueryForm,{db:y,...C,onSuccess:()=>{this.getTableInfo()}})),x.table_name){const v=ProstglesTable.getFullColumnConfig(_,x);N={Columns:{leftIconPath:Qe,content:t.createElement(ColumnsMenu,{w:x,db:y,tableName:g,tables:_,onClose:w})},"Data Refresh":{leftIconPath:"M2 12A10 10 0 1 0 12 2A10 10 0 0 0 2 12M15.6 13.72A4 4 0 0 0 16 12A4 4 0 0 0 12 8V10L8.88 7L12 4V6A6 6 0 0 1 18 12A5.9 5.9 0 0 1 17.07 15.19M6 12A5.9 5.9 0 0 1 6.93 8.81L8.4 10.28A4 4 0 0 0 8 12A4 4 0 0 0 12 16V14L15 17L12 20V18A6 6 0 0 1 6 12Z",style:"None"===((null===(n=null===(e=x.options)||void 0===e?void 0:e.refresh)||void 0===n?void 0:n.type)||"None")?{}:{color:"var(--blue-600)"},content:qS(x)},Triggers:{label:A?"Triggers "+A.triggers.length:void 0,leftIconPath:"M7,2V13H10V22L17,10H13L17,2H7Z",content:A?t.createElement("div",{className:"flex-col  ws-pre"},t.createElement("div",{className:"flex-row ai-center mb-1"},t.createElement(Btn,{iconPath:He,className:"f-0 mr-1 ",size:"small",variant:"outline",onClick:()=>{this.setState({query:{sql:`ALTER TABLE ${(0,Xn.asName)(g)} DISABLE TRIGGER ALL`}})}},"Disable all triggers"),t.createElement(Btn,{iconPath:He,className:"  f-0",size:"small",variant:"outline",onClick:()=>{this.setState({query:{sql:`ALTER TABLE ${(0,Xn.asName)(g)} ENABLE TRIGGER ALL`}})}},"Enable all triggers")),t.createElement("div",{className:"flex-col f-1 min-h-0 o-auto"},A.triggers.map(((e,n)=>t.createElement("div",{key:n,className:"flex-row ai-center"},t.createElement("div",{className:"flex-row mr-1 "},t.createElement(Btn,{iconPath:Me,title:"Drop trigger",onClick:()=>{this.setState({query:{sql:`DROP TRIGGER ${(0,Xn.asName)(e.trigger_name)} ON ${(0,Xn.asName)(g)} ;`}})}}),t.createElement(Btn,{iconPath:De,title:"View trigger function",onClick:()=>{this.setState({query:{sql:e.function_def}})}})),t.createElement(Chip,{variant:"naked",label:e.trigger_name,value:`${e.action_timing} ${e.event_manipulation} ${e.action_statement}`}))))),M):null},Constraints:{label:A?"Constraints "+A.constraints.length:void 0,leftIconPath:"M11.1 19C11.2 19.7 11.4 20.4 11.7 21H5C3.9 21 3 20.1 3 19V5C3 3.9 3.9 3 5 3H17L21 7V11.7C20.4 11.4 19.7 11.2 19 11.1V7.8L16.2 5H5V19H11.1M12 12C10.3 12 9 13.3 9 15C9 16.3 9.8 17.4 11 17.8C11.1 15.6 12.1 13.7 13.7 12.5C13.2 12.2 12.6 12 12 12M15 10V6H6V10H15M22.8 19.6L21.8 21.3C21.7 21.4 21.6 21.4 21.5 21.4L20.3 21C20 21.2 19.8 21.3 19.5 21.5L19.3 22.8C19.3 22.9 19.2 23 19.1 23H17.1C17 23 16.9 22.9 16.8 22.8L16.6 21.5C16.3 21.4 16 21.2 15.8 21L14.6 21.5C14.5 21.5 14.4 21.5 14.3 21.4L13.3 19.7C13.2 19.6 13.3 19.5 13.4 19.4L14.5 18.6V17.6L13.4 16.8C13.3 16.7 13.3 16.6 13.3 16.5L14.3 14.8C14.4 14.7 14.5 14.7 14.6 14.7L15.8 15.2C16.1 15 16.3 14.9 16.6 14.7L16.8 13.4C16.8 13.3 16.9 13.2 17.1 13.2H19.1C19.2 13.2 19.3 13.3 19.3 13.4L19.5 14.7C19.8 14.8 20.1 15 20.4 15.2L21.6 14.7C21.7 14.7 21.9 14.7 21.9 14.8L22.9 16.5C23 16.6 22.9 16.7 22.8 16.8L21.7 17.6V18.6L22.8 19.4C22.9 19.4 22.9 19.5 22.8 19.6M19.5 18C19.5 17.2 18.8 16.5 18 16.5S16.5 17.2 16.5 18 17.2 19.5 18 19.5C18.8 19.5 19.5 18.8 19.5 18Z",content:A?t.createElement("div",{className:"flex-col ai-start o-auto ws-pre"},t.createElement(Btn,{iconPath:He,className:"mb-1 f-0",size:"small",variant:"outline",onClick:()=>{this.setState({query:{sql:`ALTER TABLE ${(0,Xn.asName)(g)} \nADD CONSTRAINT "my_constraint" \nPRIMARY KEY (\n${v.slice(0,2).map((e=>(0,Xn.asName)(e.name))).join(", \n")}\n);`}})}},"Add"),t.createElement("div",{className:"flex-col f-1 min-h-0 o-auto"},A.constraints.map(((e,n)=>t.createElement("div",{key:n,className:"flex-row ai-center"},t.createElement("div",{className:"flex-row mr-1 "},t.createElement(Btn,{iconPath:Me,onClick:()=>{this.setState({query:{sql:`ALTER TABLE ${(0,Xn.asName)(g)} DROP CONSTRAINT ${(0,Xn.asName)(e.conname)};`}})}})),t.createElement(Chip,{label:e.conname,value:e.definition}))))),M):null},Indexes:{label:A?"Indexes "+A.indexes.length:void 0,leftIconPath:"M18.68,12.32C16.92,10.56 14.07,10.57 12.32,12.33C10.56,14.09 10.56,16.94 12.32,18.69C13.81,20.17 16.11,20.43 17.89,19.32L21,22.39L22.39,21L19.3,17.89C20.43,16.12 20.17,13.8 18.68,12.32M17.27,17.27C16.29,18.25 14.71,18.24 13.73,17.27C12.76,16.29 12.76,14.71 13.74,13.73C14.71,12.76 16.29,12.76 17.27,13.73C18.24,14.71 18.24,16.29 17.27,17.27M10.9,20.1C10.25,19.44 9.74,18.65 9.42,17.78C6.27,17.25 4,15.76 4,14V17C4,19.21 7.58,21 12,21V21C11.6,20.74 11.23,20.44 10.9,20.1M4,9V12C4,13.68 6.07,15.12 9,15.7C9,15.63 9,15.57 9,15.5C9,14.57 9.2,13.65 9.58,12.81C6.34,12.3 4,10.79 4,9M12,3C7.58,3 4,4.79 4,7C4,9 7,10.68 10.85,11H10.9C12.1,9.74 13.76,9 15.5,9C16.41,9 17.31,9.19 18.14,9.56C19.17,9.09 19.87,8.12 20,7C20,4.79 16.42,3 12,3Z",content:A?t.createElement("div",{className:"flex-col ws-pre"},t.createElement("div",{className:"flex-row ai-center mb-1 f-0"},t.createElement(Btn,{iconPath:He,className:"mr-1",size:"small",variant:"outline",onClick:()=>{this.setState({query:{sql:`CREATE INDEX ON public.${(0,Xn.asName)(g)} (${v.map((e=>e.name)).join(", ")})`,hint:"Add new index"}})}},"Add"),t.createElement(Btn,{iconPath:Ne,size:"small",variant:"outline",onClick:()=>{this.setState({query:{sql:`REINDEX TABLE  ${(0,Xn.asName)(g)}`,hint:"REINDEX is similar to a drop and recreate of the index in that the index contents are rebuilt from scratch"}})}},"Reindex table")),t.createElement("div",{className:"flex-col f-1 min-h-0 o-auto"},A.indexes.map(((e,n)=>t.createElement("div",{key:n,className:"flex-row ai-center"},t.createElement("div",{className:"flex-row mr-1 "},t.createElement(Btn,{iconPath:Me,onClick:()=>{this.setState({query:{sql:`DROP INDEX ${(0,Xn.asName)(e.indexname)}`}})}}),t.createElement(Btn,{iconPath:Ne,onClick:()=>{this.setState({query:{sql:`REINDEX INDEX  ${(0,Xn.asName)(e.indexname)}`,hint:"REINDEX is similar to a drop and recreate of the index in that the index contents are rebuilt from scratch"}})}})),t.createElement(Chip,{variant:"naked",value:e.indexdef}))))),M):null},"Table info":{leftIconPath:Be,content:A?t.createElement("div",{className:"flex-col ai-start o-auto"},t.createElement("div",{className:"flex-row mr-1 ai-center"},t.createElement(Chip,{className:" ",variant:"naked",label:"Name",value:g}),t.createElement(Btn,{iconPath:je,variant:"outline",onClick:()=>{this.setState({query:{sql:`ALTER TABLE ${(0,Xn.asName)(g)} \nRENAME TO new_table_name`}})}})),t.createElement(Chip,{className:" ",variant:"naked",label:"OID",value:null==x?void 0:x.table_oid}),t.createElement("div",{className:"flex-row mr-1 ai-center"},t.createElement(Chip,{className:" ",variant:"naked",label:"Comment",value:null==A?void 0:A.comment}),t.createElement(Btn,{iconPath:je,variant:"outline",onClick:()=>{this.setState({query:{sql:`COMMENT ON TABLE ${(0,Xn.asName)(g)} IS 'My comment';`}})}})),t.createElement("h4",{className:""},"Size on disk"),t.createElement(Chip,{className:"mb-p5",variant:"naked",label:"Actual Size",value:null===(i=A.sizeInfo)||void 0===i?void 0:i["Actual Size"]}),t.createElement(Chip,{className:"mb-p5",variant:"naked",label:"Index Size",value:null===(r=A.sizeInfo)||void 0===r?void 0:r["Index Size"]}),t.createElement(Chip,{className:"mb-p5",variant:"naked",label:"Total Size",value:null===(s=A.sizeInfo)||void 0===s?void 0:s["Total Size"]}),t.createElement(Chip,{className:"mb-p5",variant:"naked",label:"Row count",value:(+((null===(o=A.sizeInfo)||void 0===o?void 0:o["Row count"])||0)).toLocaleString()}),t.createElement("div",{className:"flex-row mr-1 ai-center mt-1 "},t.createElement(Btn,{className:"mr-1",iconPath:Ne,size:"small",variant:"outline",onClick:()=>{this.setState({query:{sql:`VACUUM ${(0,Xn.asName)(g)} `,hint:"Garbage-collect and optionally analyze a database"}})}},"Vacuum"),t.createElement(Btn,{className:"mr-1",iconPath:Ne,size:"small",variant:"outline",onClick:()=>{this.setState({query:{sql:`VACUUM FULL ${(0,Xn.asName)(g)} `,hint:'Selects "full" vacuum, which can reclaim more space, but takes much longer and exclusively locks the table'}})}},"Vacuum Full"),t.createElement(Btn,{iconPath:"M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19M8,9H16V19H8V9M15.5,4L14.5,3H9.5L8.5,4H5V6H19V4H15.5Z",size:"small",color:"danger",variant:"outline",onClick:()=>{this.setState({query:{sql:`-DROP TABLE ${(0,Xn.asName)(g)} `,hint:'Table will be deleted from the database. Remove "-" and then run the query'}})}},"Drop")),M):null},Options:{leftIconPath:ke,content:t.createElement("div",{className:"flex-col ai-start mb-1 f-1 o-auto"},t.createElement(FormField,{className:"mt-1 w-fit f-0",asColumn:!0,type:"checkbox",label:"View as card",value:!!(null==x?void 0:x.options.viewAsCard),onChange:e=>{var t,n,i,r;x.$update({options:{viewAsCard:e,maxCardWidth:null!==(n=null===(t=this.d.w)||void 0===t?void 0:t.options.maxCardWidth)&&void 0!==n?n:"700px",hideEmptyCardCells:null===(r=null===(i=this.d.w)||void 0===i?void 0:i.options.hideEmptyCardCells)||void 0===r||r}},{deepMerge:!0})}}),(null==x?void 0:x.options.viewAsCard)&&t.createElement(FormField,{className:"mt-1 w-fit f-0",asColumn:!0,type:"number",label:"Cards per row",inputProps:{step:1,min:1,max:8},value:(null==x?void 0:x.options.cardRows)||1,onChange:e=>{x.$update({options:{cardRows:Math.round(+e)}},{deepMerge:!0})}}),(null==x?void 0:x.options.viewAsCard)&&t.createElement(FormField,{className:"mt-1 w-fit f-0",asColumn:!0,type:"checkbox",label:"Hide card column names",value:!!(null==x?void 0:x.options.hideCardFieldNames),onChange:e=>{x.$update({options:{hideCardFieldNames:e}},{deepMerge:!0})}}),t.createElement(FormField,{className:"mt-1 w-fit f-0",asColumn:!0,type:"checkbox",label:"Hide edit row button",value:!!(null==x?void 0:x.options.hideEditRow),onChange:e=>{x.$update({options:{hideEditRow:e}},{deepMerge:!0})}}),t.createElement(FormField,{className:"mt-2 w-fit f-0",asColumn:!0,type:"checkbox",label:"Hide top count",value:!!(null==x?void 0:x.options.hideCount),onChange:e=>{x.$update({options:{hideCount:e}},{deepMerge:!0})},hint:"Will improve performance"}),t.createElement(FormField,{className:"mt-2 w-fit f-0",asColumn:!0,type:"checkbox",label:"Show data type sub headers",value:!!(null==x?void 0:x.options.showSubLabel),onChange:e=>{x.$update({options:{showSubLabel:e}},{deepMerge:!0})}}),t.createElement(FormField,{className:"mt-1 w-fit f-0",asColumn:!0,type:"number",label:"Maximum number of characters per column",value:null!==(a=!!(null==x?void 0:x.options.maxCellChars))&&void 0!==a?a:500,onChange:e=>{x.$update({options:{maxCellChars:e}},{deepMerge:!0})}}),t.createElement(Select,{label:"Max table row height in pixels",className:"mt-1 w-fit f-0",value:null!==(c=null===(l=x.options)||void 0===l?void 0:l.maxRowHeight)&&void 0!==c?c:100,variant:"div",options:[25,50,100,150,200,300,400,500,600,700,800],onChange:e=>{x.$update({options:{maxRowHeight:e}},{deepMerge:!0})}}),t.createElement(Select,{label:"Max card cell height in pixels",className:"mt-1 w-fit f-0",value:null!==(d=null===(u=x.options)||void 0===u?void 0:u.maxCardRowHeight)&&void 0!==d?d:800,variant:"div",options:[25,50,100,150,200,300,400,500,600,700,800],onChange:e=>{x.$update({options:{maxCardRowHeight:e}},{deepMerge:!0})}}),t.createElement(Select,{label:"Max card width",className:"mt-1 w-fit f-0",value:null!==(p=null===(h=x.options)||void 0===h?void 0:h.maxCardWidth)&&void 0!==p?p:"100%",variant:"div",options:["100%","100px","200px","300px","600px","700px","900px"],onChange:e=>{x.$update({options:{maxCardWidth:e}},{deepMerge:!0})}}),t.createElement(Select,{label:"Card cell min width",className:"mt-1 w-fit f-0",value:null!==(m=null===(f=x.options)||void 0===f?void 0:f.cardCellMinWidth)&&void 0!==m?m:"",variant:"div",options:["",...[10,20,25,30,33,40,50,60,70,80,90,100].map((e=>e+"%"))],onChange:e=>{x.$update({options:{cardCellMinWidth:e}},{deepMerge:!0})}}),t.createElement(FormField,{className:"mt-2 w-fit f-0",asColumn:!0,type:"checkbox",label:"Hide empty card cells",value:!!(null==x?void 0:x.options.hideEmptyCardCells),onChange:e=>{x.$update({options:{hideEmptyCardCells:e}},{deepMerge:!0})}}))}}}return t.createElement("div",{className:"table-menu c-s-fit flex-col",style:{maxHeight:"calc(100vh - 65px)",maxWidth:"100vw"}},t.createElement(Tabs,{variant:"vertical",contentClass:" min-h-0 max-h-100v flex-col  "+("Alter"===S?" ":" p-1")+" ",items:null!=N?N:{},compactMode:!0,activeKey:S,onChange:async e=>{var t,n;if(this.setState({l1Key:e,query:void 0,infoQuery:void 0}),this.d.w)if("View as card"===e)this.d.w.$update({options:{viewAsCard:!0,maxCardWidth:null!==(n=null===(t=this.d.w)||void 0===t?void 0:t.options.maxCardWidth)&&void 0!==n?n:"700px"}},{deepMerge:!0});else if("Columns"===e){const e=await TableMenu.getWCols(y[g],x,!0);this.setState({columnsConfig:e})}else if("Filter"===e){let e={show_menu:!1};this.d.w.filter||(e.filter=[]),this.d.w.$update(e)}}}),"Columns"!==S?null:t.createElement("div",{className:"flex-col o-auto p-1"},g&&y.sql?t.createElement(t.Fragment,null,E?t.createElement(t.Fragment,null,t.createElement(FormField,{className:"mb-1",asColumn:!0,label:E.label,readOnly:!0,asTextArea:!0,value:E.query})):null):null))}}function qS(e){const{refresh:n}=e.options||{},{type:i="None",intervalSeconds:r=3,throttleSeconds:s=0}=n||{},o=t=>{e.$update({options:{...e.options,refresh:{...n,...t}}})};return t.createElement("div",{className:"flex-col ai-start"},t.createElement(ButtonGroup,{variant:"dense",options:$S,value:i,style:{marginRight:"40px",marginBottom:"1em"},onChange:e=>{o({type:e,throttleSeconds:0,intervalSeconds:3})}}),t.createElement("p",{className:"text-gray-600 noselect mt-0"},"Realtime"===i?"Changes shown as received from database. Needs super user to create triggers":"Interval"===i?"Run the query every N seconds":"Data will not be refreshed"),"Interval"===i&&t.createElement(FormField,{label:"Seconds",type:"number",value:r,asColumn:!0,hint:"0 to disable",onChange:e=>{const t=+e;o(!t||e<0?{type:"None"}:{intervalSeconds:t})}}),"Realtime"===i&&t.createElement(FormField,{label:"Throttle seconds",type:"number",asColumn:!0,value:s,onChange:e=>{o({throttleSeconds:e})}}))}TableMenu.getWCols=async(e,t,n=!1)=>{if(!e||!e.getColumns)return[];let i=(await e.getColumns()).map((e=>({name:e.name,show:!0,tsDataType:e.tsDataType,computed:!1}))),r=i;if((null==t?void 0:t.columns)&&Array.isArray(t.columns)){if(t.columns.map((e=>e.name)).sort().join()!==i.map((e=>e.name)).sort().join()){let e=t.columns.map((e=>({...e}))).filter((e=>i.find((t=>t.name===e.name))));const s=i.filter((t=>!e.find((e=>e.name===t.name)))).map((e=>({name:e.name,show:!0})));e=e.concat(s),n&&await t.$update({columns:e}),r=e}}else t&&n&&await t.$update({columns:i});return r};const GS=Math.round;function YS(e){const t=e.length,n={};return"rgb"===e.slice(0,3).toLowerCase()?(e=e.replace(" ","").split(","),n[0]=parseInt(e[0].slice("a"===e[3].toLowerCase()?5:4),10),n[1]=parseInt(e[1],10),n[2]=parseInt(e[2],10),n[3]=e[3]?parseFloat(e[3]):-1):(e=t<6?parseInt(String(e[1])+e[1]+e[2]+e[2]+e[3]+e[3]+(t>4?String(e[4])+e[4]:""),16):parseInt(e.slice(1),16),n[0]=e>>16&255,n[1]=e>>8&255,n[2]=255&e,n[3]=9===t||5===t?GS((e>>24&255)/255*1e4)/1e4:-1),n}function XS(e,t,n=.5){e=e.trim(),t=t.trim();n=n<0?-1*n:n;const i=YS(e),r=YS(t);if("r"===t[0]){const e=i[3]>-1&&r[3]>-1?GS(1e4*((r[3]-i[3])*n+i[3]))/1e4:r[3]<0?i[3]:r[3];return"rgb"+("a"===t[3]?"a(":"(")+GS((r[0]-i[0])*n+i[0])+","+GS((r[1]-i[1])*n+i[1])+","+GS((r[2]-i[2])*n+i[2])+(i[3]<0&&r[3]<0?"":","+e)+")"}return"#"+(4294967296+16777216*(i[3]>-1&&r[3]>-1?GS(255*((r[3]-i[3])*n+i[3])):r[3]>-1?GS(255*r[3]):i[3]>-1?GS(255*i[3]):255)+65536*GS((r[0]-i[0])*n+i[0])+256*GS((r[1]-i[1])*n+i[1])+GS((r[2]-i[2])*n+i[2])).toString(16).slice(i[3]>-1||r[3]>-1?1:3)}const KS=["=","<=","<",">",">=","!=","in","not in","contains","not null","null"];class StyleColumn extends RTComp{constructor(){super(...arguments),this.state={minValue:void 0,maxValue:void 0}}render(){const{column:e,onUpdate:n,tsDataType:i}=this.props;let r=["None","Fixed","Conditional"];const{style:s={type:"None",textColor:"",chipColor:"",cellColor:""}}=e;e&&["number","Date"].includes(i)&&(r.push("Scale"),r.push("Barchart"));const o=s.type||"None",a=e=>{if(e.type&&e.type!==s.type){let t={...e};"Barchart"===e.type&&(t={barColor:"rgba(0,246,96,1)",textColor:"black",...t}),n({style:t})}else n({style:{...s,...e}})},l=hT(s,"conditions")||[],c=(e,t,n)=>{let i=l.map((e=>({...e})));"remove"===n?i=i.filter(((e,n)=>n!==t)):"add"===n?i.push({color:"red",operator:"=",condition:""}):i=l.map(((n,i)=>i===t?{...n,...e}:n)),a({conditions:i})};return t.createElement("div",{className:"flex-col p-p5"},t.createElement(Select,{label:"Style mode",value:o,variant:"div",options:r,onChange:e=>{a({type:e})}}),"Fixed"===s.type?t.createElement(t.Fragment,null,t.createElement(ColorPicker,{label:"Text",className:"m-p5",value:s.textColor||"black",onChange:e=>{a({textColor:e})}}),t.createElement(ColorPicker,{label:"Chip",className:"m-p5",value:s.chipColor,onChange:e=>{a({chipColor:e})}}),t.createElement(ColorPicker,{label:"Cell",className:"m-p5",value:s.cellColor||"white",onChange:e=>{a({cellColor:e})}})):"Conditional"===s.type?t.createElement("div",null,t.createElement("div",{className:"flex-row p-p5 ai-center"},t.createElement("div",{className:"mr-p5 mt-p5"},"Text: "),t.createElement(ColorPicker,{className:"mr-p5",value:s.textColor,onChange:e=>{a({textColor:e})}})),(l||[]).map(((e,n)=>t.createElement("div",{key:n,className:"flex-row p-p5 ai-center"},t.createElement(ColorPicker,{className:"mr-p5",value:e.color,onChange:e=>{c({color:e},n)}}),t.createElement(Select,{className:"mr-p5",value:e.operator,variant:"div",options:KS,onChange:e=>c({operator:e},n)}),t.createElement(FormField,{className:"mr-p5",placeholder:"Value",inputStyle:{padding:"4px 6px"},value:e.condition||"",onChange:e=>{c({condition:e},n)}}),t.createElement(Btn,{title:"Remove style",iconPath:Ae,onClick:e=>{c(null,n,"remove")}})))),t.createElement(Btn,{title:"Add condition style",className:"w-fit h-fit",iconPath:He,onClick:()=>{c(null,null,"add")}}),t.createElement("div",{className:"flex-row p-p5 ai-center"},t.createElement(ColorPicker,{label:"Default",className:"mr-p5",value:hT(s,"defaultStyle.color"),onChange:e=>{a({defaultStyle:{color:e}})}}))):"Scale"===s.type?t.createElement(t.Fragment,null,t.createElement(ColorPicker,{className:"mr-p5",label:"Min color",value:s.minColor,onChange:e=>{a({minColor:e})}}),t.createElement(ColorPicker,{className:"mr-p5",label:"Max color",value:s.maxColor,onChange:e=>{a({maxColor:e})}})):"Barchart"===s.type?t.createElement(t.Fragment,null,t.createElement("div",{className:"flex-col p-p5 ai-center"},t.createElement(ColorPicker,{label:"Bar",className:"m-p5",value:s.barColor,onChange:e=>{a({barColor:e})}}),t.createElement(ColorPicker,{label:"Text",className:"m-p5",value:s.textColor,onChange:e=>{a({textColor:e})}}))):null)}}StyleColumn.getStyle=(e,t,n,i)=>{const{style:r,name:s}=e;let o={};if(r&&r.type){if("Fixed"===r.type)o={textColor:r.textColor,chipColor:r.chipColor,cellColor:r.cellColor};else if("Conditional"===r.type){let i=n[e.name];const s=(r.conditions||[]).find((({operator:e,condition:n})=>{let r="number"===t?+n:n;if("contains"===e)return i&&`${JSON.stringify(i)}`.includes(r+"");if("="===e)return i==r;if(">"===e)return i>r;if(">="===e)return i>=r;if("<="===e)return i<=r;if("<"===e)return i<r;if("!="===e)return i!=r;if(["in","not in"].includes(e)){const r=n.split(",").map((e=>"number"===t?+e.trim():e.trim())).includes(i);return"in"===e?r:!r}})),a=hT(r,"defaultStyle.color");!s&&a&&(o={textColor:r.textColor,chipColor:a}),s&&(o={textColor:r.textColor,chipColor:s.color})}else if("Barchart"===r.type){const{minValue:i,maxValue:s,barColor:a="rgba(0,246,96,1)",textColor:l="black"}=r,c="Date"===t?+new Date(n[e.name]):+n[e.name];if(![c,i,s].find((e=>"number"!=typeof e||isNaN(e)))){const e=Math.round(100*(c-i)/(s-i));o={textColor:l,cellColor:`linear-gradient(90deg, ${a} 0%, ${a} ${e}%, rgba(0,0,0,0) ${e}%)`}}}else if("Scale"===r.type){const{minValue:i,maxValue:s,textColor:a="black",minColor:l="#63f717",maxColor:c="#46b5d5"}=r,u="Date"===t?+new Date(n[e.name]):+n[e.name];if(![u,i,s].find((e=>"number"!=typeof e||isNaN(e)))){o={textColor:a,cellColor:XS(l,c,(u-i)/(s-i))}}}}else o={};return o};class ColorPicker extends t.Component{constructor(){super(...arguments),this.state={anchorEl:null},this.asRGB=e=>[parseInt(e.substr(1,2),16),parseInt(e.substr(3,2),16),parseInt(e.substr(5,2),16)],this.lastChanged=Date.now(),this.onChange=e=>{this.color=e;const{onChange:t}=this.props,n=Date.now();this.willChange||n-this.lastChanged<500?(clearTimeout(this.willChange),this.willChange=setTimeout((()=>{this.willChange=null,this.onChange(this.color)}),500)):(t(this.color,this.asRGB(this.color)),this.lastChanged=n)}}render(){const{anchorEl:e}=this.state,{value:n,style:i={},className:r="",onChange:s,label:o}=this.props;return t.createElement("div",{className:"flex-row ai-center "+r,style:i},o?t.createElement("div",{className:"mr-1 noselect f-1"},o):null,t.createElement("div",{className:"round pointer shadow ",style:{width:"24px",height:"24px",backgroundColor:n},onClick:e=>{this.setState({anchorEl:e.currentTarget})}}),e?t.createElement(Popup,{open:!0,anchorEl:e,positioning:"beneath-left",onClose:()=>this.setState({anchorEl:null}),contentClassName:"p-1"},t.createElement("div",{className:"flex-row-wrap"},["#ffffff","#174CFA","#7430F0","#0AA1FA","#CB11F0","#F79800","#36E00B"].map(((e,n)=>t.createElement("div",{key:n,className:"round pointer mr-1 mb-1 shadow",style:{width:"24px",height:"24px",backgroundColor:e},onClick:t=>{s(e,this.asRGB(e)),this.setState({anchorEl:null})}})))),t.createElement(FormField,{className:"mt-1",label:"Other",type:"color",value:n,onChange:e=>this.onChange(e)}),t.createElement(Btn,{className:"mt-1",onClick:()=>{this.onChange("")}},"None")):null)}}class ProstglesMap extends RTComp{constructor(){super(...arguments),this.state={loadingLayers:!1,loading:!1,wSync:null,minimised:!1,lqs:[],error:null,showError:!1,hoverObj:void 0,hoverCoords:void 0,hovData:void 0,layerExtras:{},bytesPerSec:0},this.goToDataExtent=async()=>{var e,t,n;let i;try{i=await this.getDataExtent(),i&&(null===(e=this.d.w)||void 0===e||e.$update({options:{extent:i.flat()}},{deepMerge:!0}),null===(t=this.map)||void 0===t||t.fitBounds(i))}catch(e){return(null===(n=this.state.error)||void 0===n?void 0:n.toString())!==e.toString()&&this.setState({error:e,showError:!0}),void console.error(e)}},this.gettingExtent=!1,this.onDelta=async(e,t,n)=>{var i,r,s,o,a;const l={...e,...t,...n};let c={};if(this.d.w){this.gettingExtent||(null===(i=this.d.w.options)||void 0===i?void 0:i.extent)||!(null===(r=this.props.layerQueries)||void 0===r?void 0:r.length)||(this.gettingExtent=!0,setTimeout((()=>{this.mounted&&(this.goToDataExtent(),this.gettingExtent=!1)}),600));const e=null!==(o=null===(s=l.w)||void 0===s?void 0:s.options)&&void 0!==o?o:{},t=Object.keys(e||{});Object.keys(l.w||{});if(l&&((null==l?void 0:l.layerExtras)||l.layerQueries||l.joinFilter||t.length||t.includes("refresh"))&&(this.setLayerData(),t.includes("refresh"))){const{refresh:e}=this.d.w.options;this.autoRefreshInterval&&(clearInterval(this.autoRefreshInterval),this.autoRefreshInterval=void 0),"Interval"===(null==e?void 0:e.type)&&(null==e?void 0:e.intervalSeconds)&&(this.autoRefreshInterval=setInterval((()=>{this.setLayerData()}),1e3*e.intervalSeconds))}((null===(a=this.d.w.options)||void 0===a?void 0:a.filterExtent)&&t.includes("extent")||t.includes("filterExtent"))&&this.props.onFilter()}dC(c)||this.setState(c)},this.layerSubs=[],this.getFilter=(e,t)=>{const{geomColumn:n,tableFilter:i,joinFilter:r,externalFilters:s}=e,o={$and:[i,...s].filter(vT)},a=ProstglesMap.extentToFilter(t,n);return{finalFilter:{$and:[...o.$and,r||a].filter(vT)},finalFilterWOextent:o}},this.getSQL=(e,t,n=1e3)=>{var i;if(!e.sql)throw"No SQL";let r=(null===(i=e.sql)||void 0===i?void 0:i.trim())+"";return r.endsWith(";")&&(r=r.slice(0,r.length-1)),r=`SELECT ${t} FROM ( \n  ${r} \n ) t LIMIT ${n}`,{sql:r,args:{...e.parameters,geomColumn:e.geomColumn}}},this.getDataExtent=async(e=!1)=>{var t,n,i,r,s,o,a;const{db:l,layerQueries:c=[]}=this.props;let u,d,h,p,f;for await(const m of c){if("tableName"in m){const{tableName:e,geomColumn:s}=m,{finalFilterWOextent:o}=this.getFilter(m,[]);if(!(null===(t=l[e])||void 0===t?void 0:t.findOne))throw`db.${e}.find not allowed`;f=null!==(r=await(null===(i=(n=l[e]).findOne)||void 0===i?void 0:i.call(n,o,{select:{e:{$ST_Extent:[s]}}})))&&void 0!==r?r:[]}else{if(!l.sql)throw"SQL not allowed";const e=this.getSQL(m,"ST_Extent(${geomColumn:name}::geometry) as e");try{f=null!==(s=await l.sql(e.sql,e.args,{returnType:"row"}))&&void 0!==s?s:void 0}catch(e){console.error(e)}}if(!(null==f?void 0:f.e))return void(e&&alert("No data to zoom to"));const[[c,g],[y,v]]=null===(a=null===(o=null==f?void 0:f.e)||void 0===o?void 0:o.slice(4,-1))||void 0===a?void 0:a.split(",").map((e=>e.split(" ").map((e=>+e))));u=Math.min(null!=u?u:c,c),h=Math.max(null!=h?h:y,y),d=Math.min(null!=d?d:g,g),p=Math.max(null!=p?p:v,v)}if(void 0!==u)return[[u,d],[h,p]]},this.dataSignature="",this.lastDataRequest=Date.now(),this.loadAgain=!1,this.setLayerData=async(e=!1)=>{var t,n;const{db:i,layerQueries:r=[],tables:s}=this.props,{w:o}=this.d;let a,l=(null===(t=null==o?void 0:o.options)||void 0===t?void 0:t.extent)||[-180,-90,180,90],c={};const u=1e5;let{bytesPerSec:d}=this.state;if(this.state.loadingLayers)this.loadAgain=!0;else{if(i&&o&&(null===(n=null==o?void 0:o.options)||void 0===n?void 0:n.extent))try{this.setState({loadingLayers:!0}),this.lastDataRequest=Date.now(),this.layerSubs.filter((e=>!r.find((t=>"tableName"in t&&t.tableName===e.tableName)))).map((e=>{e.sub.unsubscribe()}));const e=[];await Promise.all(r.map((async(t,n)=>{var r,a,c,h,p,f,m,g,y,v,b,w,x,_,E,S;let C,T,A,k,N="",M={},P={},{geomColumn:L,sourceW:O}=t,R=!1,I="l";if("tableName"in t){const{tableName:n,geomColumn:_}={...t};A=n,k=_;if(!(null===(r=s.find((e=>e.name===n)))||void 0===r?void 0:r.columns))return void this.setState({error:"Could not find columns for table: "+n});const E=i[n];if(!(null==E?void 0:E.find)||!E.findOne||!E.size)throw`db.${n} handler is missing one of the required permissions: find, findOne, size`;const S=(null===(a=null==o?void 0:o.options)||void 0===a?void 0:a.zoom)||1,L=this.getFilter(t,l);M=L.finalFilter;const O=Date.now();let D=[];D.length||(D=["$rowhash"]);let F={};D.forEach((e=>{F[e]=1,I===e&&(I=D.at(-1)+"_")}));const B=await E.findOne(L.finalFilter,{select:{[I]:{$ST_AsGeoJSON:[_]}}}),z=(Date.now()-O)/1e3;if(d=4*JSON.stringify(B||{}).length/z,P={select:{...F,[I]:{$ST_AsGeoJSON:[_]}},limit:u},!B||!this.ref)return void e.push({dataSignature:N,id:"tbl"+Date.now(),features:[],pickable:!0,stroked:!0,filled:!0});const j=Math.abs(l[0]-l[2]),V=Math.abs(l[1]-l[3]),U=this.ref.offsetWidth,H=this.ref.offsetHeight,$=(Math.min(U,H),Math.min(j,V));if(!(null===(c=null==B?void 0:B.c)||void 0===c?void 0:c.type.endsWith("Point"))){const e=(S>7?oc().range([0,.005]).domain([9,7]).clamp(!0):oc().range([.005,.05]).domain([7,1]).clamp(!0))(S);e>0&&(P={select:{...F,[I]:{$ST_Simplify:[_,e]}},limit:u})}const q=this.getDataSignature({filter:L.finalFilter,...P});if(N=q.signature,q.cachedLayer)return void e.push(q.cachedLayer);console.log(N);const W=+await E.size(L.finalFilter)/1e3/d;if(R="Point"===(null===(h=null==B?void 0:B.c)||void 0===h?void 0:h.type)&&W>(null!==(g=null===(m=null===(f=null===(p=this.d)||void 0===p?void 0:p.w)||void 0===f?void 0:f.options)||void 0===m?void 0:m.secondWaitTime)&&void 0!==g?g:2),R){const e=oc().range([20,300]).domain([.001,.1]),t=oc().range([.07,5e-4]).domain([.886,.007166])($);let n,i;I="l",P={select:{c:{$countAll:[]},[I]:{$ST_SnapToGrid:[_,t]}},limit:u},T=await E.find(L.finalFilter,P),null==T||T.forEach((({c:e})=>{n=Math.min(null!=n?n:+e,+e),i=Math.max(null!=i?i:+e,+e)}));const r=e($),s=oc().range([1,r]).domain([n,i]);T=null==T?void 0:T.map((e=>({...e,radius:s(+e.c)})))}else{const e=oc().range([1,10,80,100]).domain([20,14,10,1]).clamp(!0);console.log({size:await E.size(L.finalFilter,P)}),C=await E.find(L.finalFilter,P);const t=e(S);C=null==C?void 0:C.map((e=>({...e,radius:t})))}T&&(T=T.filter((e=>{var t,n;return null===(n=null===(t=e[I])||void 0===t?void 0:t.coordinates)||void 0===n?void 0:n.length}))),C&&(C=C.filter((e=>{var t,n;return null===(n=null===(t=e[I])||void 0===t?void 0:t.coordinates)||void 0===n?void 0:n.length})));const G=M,Y=JSON.stringify(G);if(E.subscribe&&"Realtime"===(null===(v=null===(y=o.options)||void 0===y?void 0:y.refresh)||void 0===v?void 0:v.type)&&!this.layerSubs.find((e=>e.filter===Y&&e.tableName===n)))try{const e=await E.subscribe(G,{limit:2,throttle:1e3*(null!==(x=null===(w=null===(b=o.options)||void 0===b?void 0:b.refresh)||void 0===w?void 0:w.throttleSeconds)&&void 0!==x?x:0)},(()=>{this.setLayerData()}));this.layerSubs.push({tableName:n,filter:Y,sub:e})}catch(e){console.error(e),alert("Could not subscribe. Check logs ")}}else if("sql"in t){if(I="l",!i.sql)return console.error("Not enough privileges to run query"),void alert("Could not show data: sql privilege not allowed for current user");const{sql:n,parameters:r}=t,s=this.getDataSignature({sql:n});if(N=s.signature,s.cachedLayer)return void e.push(s.cachedLayer);let o=n.trim()+"";o.endsWith(";")&&(o=o.slice(0,o.length-1));const a='SELECT md5(((t.*))::text) as "$rowhash", ST_AsGeoJSON(ST_SetSRID(${geomColumn:name}, 4326))::json as l FROM ( \n'+o+"\n ) t LIMIT "+u;C=await i.sql(a,{...r,geomColumn:L},{returnType:"rows"})}let D=C||T||[];D=D.filter((e=>e[I]));const F=D.find((e=>"object"!=typeof e[I]));F&&(console.error("Bad GeoJSON data. Expecting type object but got -> "+typeof F.l,F),D=[]);const{layerExtras:B}=this.state,z=(null===(_=null==B?void 0:B[t.wid])||void 0===_?void 0:_.color)||t.fillColor,j=(null===(E=null==B?void 0:B[t.wid])||void 0===E?void 0:E.color)||t.lineColor,V=(null===(S=null==B?void 0:B[t.wid])||void 0===S?void 0:S.color)||t.lineColor;e.push({id:"sql"+Date.now(),dataSignature:N,features:D.map((e=>({type:"Feature",geometry:e[I],properties:{radius:+e.radius||1,...e,tableName:A,geomColumn:k,fillColor:(()=>{var t,n;if(!R&&O.table_name&&O.columns){O.columns.filter((e=>{var t,n;return(null===(t=e.style)||void 0===t?void 0:t.type)&&"None"!==(null===(n=e.style)||void 0===n?void 0:n.type)}))}const{clickedItem:i}=this.state;return(null===(n=null===(t=e[I])||void 0===t?void 0:t.type)||void 0===n?void 0:n.includes("Polygon"))?null==z?void 0:z.slice(0,3).concat([200]):z})()}}))),pickable:!0,stroked:!0,filled:!0,elevation:t.elevation,fillColor:z,lineColor:j,getLineWidth:e=>1211,layerColor:V,lineWidth:1222})}))),c={layers:e}}catch(e){a=e}(null==c?void 0:c.layers)||delete c.layers,this.loadAgain&&(this.loadAgain=!1,setTimeout((()=>this.setLayerData()),0)),this.setState({...c,loadingLayers:!1,error:a,bytesPerSec:d})}},this.onHover=async(e,t)=>{const{db:n,tables:i}=this.props;this.hoveredObj=e;const r=JSON.stringify(e);if(this.hovering){if(this.hovering.hoverObjStr===r)return;clearTimeout(this.hovering.timeout)}e?this.hovering={hoverObj:{...e},hoverObjStr:r,timeout:setTimeout((async()=>{var s,o,a;if((null===(s=this.hovering)||void 0===s?void 0:s.hoverObjStr)===r){const{tableName:r,$rowhash:s,sql:l,c}=e.properties;let u;if(c)u={Count:c};else if(r){const e=i.find((e=>e.name===r));if(e){const t=e.columns.filter((e=>["geography","geometry"].includes(e.udt_name))).reduce(((e,t)=>({...e,[t.name]:0})),{});u=await(null===(a=(o=n[r]).findOne)||void 0===a?void 0:a.call(o,{$rowhash:s},{select:t}))}}this.hovering=void 0,this.setState({hoverObj:e,hoverCoords:t,hovData:u})}}),300)}:(this.hovering=void 0,this.setState({hoverObj:e,hoverCoords:t,hovData:void 0}))},this.getMenu=e=>{var n,i,r,s,o,a,l,c,u,d,h;const{layerQueries:p=[]}=this.props,{tileURL:f,bytesPerSec:m}=this.state;let g=[];Array.isArray(e.columns)&&(g=e.columns.filter((e=>{var t;return"None"!==(null===(t=e.style)||void 0===t?void 0:t.type)})));let y={};g.length&&(y={Color:{leftIconPath:"M17.5,12A1.5,1.5 0 0,1 16,10.5A1.5,1.5 0 0,1 17.5,9A1.5,1.5 0 0,1 19,10.5A1.5,1.5 0 0,1 17.5,12M14.5,8A1.5,1.5 0 0,1 13,6.5A1.5,1.5 0 0,1 14.5,5A1.5,1.5 0 0,1 16,6.5A1.5,1.5 0 0,1 14.5,8M9.5,8A1.5,1.5 0 0,1 8,6.5A1.5,1.5 0 0,1 9.5,5A1.5,1.5 0 0,1 11,6.5A1.5,1.5 0 0,1 9.5,8M6.5,12A1.5,1.5 0 0,1 5,10.5A1.5,1.5 0 0,1 6.5,9A1.5,1.5 0 0,1 8,10.5A1.5,1.5 0 0,1 6.5,12M12,3A9,9 0 0,0 3,12A9,9 0 0,0 12,21A1.5,1.5 0 0,0 13.5,19.5C13.5,19.11 13.35,18.76 13.11,18.5C12.88,18.23 12.73,17.88 12.73,17.5A1.5,1.5 0 0,1 14.23,16H16A5,5 0 0,0 21,11C21,6.58 16.97,3 12,3Z",content:t.createElement(Select,{label:"Bin size",variant:"div",className:"w-fit b b-gray-300 mb-1",options:g.map((({name:e})=>e)),value:null===(n=this.d.w.options)||void 0===n?void 0:n.colorField,onChange:e=>{var t;null===(t=this.d.w)||void 0===t||t.$update({options:{colorField:e}},{deepMerge:!0})}})}});const v=(null===(r=null===(i=e.options)||void 0===i?void 0:i.tileURLs)||void 0===r?void 0:r.length)?null===(s=e.options)||void 0===s?void 0:s.tileURLs:FS;return t.createElement(Tabs,{variant:"vertical",compactMode:!0,contentClass:"p-1",items:{"Auto Refresh":{leftIconPath:"M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z",content:qS(e)},Basemap:{leftIconPath:ze,content:t.createElement("div",{className:"flex-col"},t.createElement(FormField,{type:"text",label:"Attribution",autoComplete:"off",asColumn:!0,value:null===(a=null===(o=null==e?void 0:e.options)||void 0===o?void 0:o.tileAttribution)||void 0===a?void 0:a.title,onChange:t=>{var n;e.$update({options:{tileAttribution:{...(null===(n=null==e?void 0:e.options)||void 0===n?void 0:n.tileAttribution)||{},title:t}}},{deepMerge:!0})}}),t.createElement(FormField,{type:"url",label:"Attribution URL",autoComplete:"off",asColumn:!0,value:null===(c=null===(l=null==e?void 0:e.options)||void 0===l?void 0:l.tileAttribution)||void 0===c?void 0:c.url,onChange:t=>{var n;e.$update({options:{tileAttribution:{...(null===(n=null==e?void 0:e.options)||void 0===n?void 0:n.tileAttribution)||{},url:t}}},{deepMerge:!0})}}),t.createElement("div",{className:"ta-left text-gray-600 font-medium mt-1"},"Tile URLs"),v.map(((n,i)=>t.createElement("div",{key:i,className:"flex-row ai-center py-p5 o-auto"},t.createElement(Btn,{iconPath:Me,color:"danger",onClick:()=>{e.$update({options:{tileURLs:v.filter((e=>e!==n))}},{deepMerge:!0})}}),t.createElement(Chip,{variant:"naked",value:n})))),t.createElement("div",{className:"ta-left text-gray-400"},"Delete all tiles to restore default"),t.createElement("div",{className:"flex-row mt-1"},t.createElement(FormField,{type:"text",asTextArea:!0,value:f,onChange:e=>{this.setState({tileURL:e})}}),t.createElement(Btn,{iconPath:He,color:"action",onClick:()=>{const t=Array.from(new Set([...v,f])).filter(vT);e.$update({options:{tileURLs:t}},{deepMerge:!0}),this.setState({tileURL:""})}})),t.createElement(FormField,{className:" mt-1",label:"Tile size",asColumn:!0,value:(null===(u=null==e?void 0:e.options)||void 0===u?void 0:u.tileSize)||256,options:[16,32,64,128,256,512,1024],onChange:t=>{e.$update({options:{tileSize:t}},{deepMerge:!0})}}))},Layers:{leftIconPath:"M12,18.54L19.37,12.8L21,14.07L12,21.07L3,14.07L4.62,12.81L12,18.54M12,16L3,9L12,2L21,9L12,16M12,4.53L6.26,9L12,13.47L17.74,9L12,4.53Z",content:t.createElement("div",{className:"flex-col"},p.map(((e,n)=>{var i,r,s;let o;return"sql"in e&&e.sql?o=t.createElement(t.Fragment,null,t.createElement(Chip,{className:"mt-p25",variant:"naked",label:"SQL",value:e.sql}),t.createElement(Chip,{className:"mt-p25",variant:"naked",label:"Column",value:e.geomColumn})):"tableName"in e&&(o=t.createElement(t.Fragment,null,t.createElement(Chip,{className:"mt-p25",variant:"naked",label:"Table",value:e.tableName}),t.createElement(Chip,{className:"mt-p25",variant:"naked",label:"Column",value:e.geomColumn}))),t.createElement("div",{key:n,className:"flex-col ta-left p-1 b b-gray-300 rounded m-1"},t.createElement(Chip,{className:"mt-p25",variant:"naked",label:"ID",value:e.wid}),o,t.createElement(ColorPicker,{style:{flex:"none"},label:"Layer color",className:"w-fit mt-p5",value:null!==(s=null===(r=null===(i=this.state.layerExtras)||void 0===i?void 0:i[e.wid])||void 0===r?void 0:r.colorStr)&&void 0!==s?s:e.color,onChange:(t,n)=>{this.setState({layerExtras:{...this.state.layerExtras,[e.wid]:{color:n,colorStr:t}}})}}))})))},...y,Settings:{leftIconPath:ke,content:t.createElement("div",null,t.createElement(Chip,{className:"w-fit",variant:"naked",label:"Approx speed (MB/s)",value:(m/1e3).toFixed(1)}),t.createElement(FormField,{className:"mt-1",asColumn:!0,type:"number",label:"Wait time in seconds",hint:"Will aggregate/simplify if data load takes longer than this",value:null!==(h=null===(d=null==e?void 0:e.options)||void 0===d?void 0:d.secondWaitTime)&&void 0!==h?h:2,inputProps:{min:0},onChange:e=>{var t,n;null===(n=null===(t=this.d)||void 0===t?void 0:t.w)||void 0===n||n.$update({options:{secondWaitTime:e}},{deepMerge:!0})}}))}}})}}getDataSignature(e){var t;const n=ProstglesTable.getDataRequestSignature(e);let i;return i=null===(t=this.state.layers)||void 0===t?void 0:t.find((e=>e.dataSignature===n)),{signature:n,cachedLayer:i}}onMount(){var e;const{db:t,w:n}=this.props;if(t&&!this.state.wSync){let t=null===(e=n.$cloneSync)||void 0===e?void 0:e.call(n,((e,t)=>{this.setData({w:e},{w:t})}));this.setState({wSync:t})}}onUnmount(){var e,t;null===(t=null===(e=this.state.wSync)||void 0===e?void 0:e.$unsync)||void 0===t||t.call(e),this.layerSubs.map((e=>{e.sub.unsubscribe()}))}render(){var e,n,i,r;const{minimised:s=!1,layers:o=[],loadingLayers:a,error:l,showError:c,clickedItem:u,hoverCoords:d,hovData:h}=this.state,{w:p}=this.d,{onClickRow:f}=this.props;if(!p)return null;let m;c&&(m=t.createElement(Popup,{open:!0,onClose:()=>{this.setState({showError:!1})}},t.createElement("div",{className:"bg-white"},t.createElement(ErrorComponent,{error:l}))));let g,y=null;if(h&&d){const{xScreen:e,yScreen:n}=d;y=t.createElement(Popup,{open:!0,clickCatchStyle:{display:"none"},anchorXY:{x:e,y:n},positioning:"tooltip",contentClassName:"p-p5"},t.createElement("div",{className:"bg-white o-auto flex-col"},Object.keys(h).map((e=>{let n=["string","number"].includes(typeof h[e])?`${h[e]}`:JSON.stringify(h[e],null,2);return n.length>20&&(n=n.slice(0,30)+"..."),t.createElement("div",{key:e,className:"flex-row ai-center",style:{marginBottom:"4px"}},t.createElement("div",{className:"text-medium text-gray font-12",style:{color:"var(--gray-400)",fontWeight:"bold"}},e,":"),t.createElement("div",{className:"ml-p5"},n))}))))}(a||l)&&(g=t.createElement("div",{className:"flex-row relative",style:{position:"absolute",top:"1em",left:"1em",zIndex:22}},a?t.createElement(Loading,{delay:100}):null,l?t.createElement(Btn,{className:"text-red-500",iconPath:we,onClick:()=>{this.setState({showError:!0})}}):null));let v=o||[];v=v.map((e=>(e.features=e.features.map((t=>{var n,i;return(null===(n=null==u?void 0:u.properties)||void 0===n?void 0:n.$rowhash)&&t.properties.$rowhash===(null===(i=null==u?void 0:u.properties)||void 0===i?void 0:i.$rowhash)?(t.properties.fillColor=[0,0,0,255],t.properties.lineColor=[0,0,0,255]):(t.properties.fillColor=e.layerColor,t.properties.lineColor=e.layerColor),t})),e)));let b=t.createElement(t.Fragment,null,y,m,s?null:t.createElement("div",{className:"relative f-1 flex-col o-hidden",ref:e=>{e&&(this.ref=e)},onPointerLeave:()=>{this.ref.style.cursor="default",this.onHover()}},g,t.createElement(DeckGLMap,{onLoad:e=>{this.setLayerData(),this.map=e},onClick:e=>{var t,n,i,r;const s=null===(n=null===(t=null==e?void 0:e.object)||void 0===t?void 0:t.properties)||void 0===n?void 0:n.$rowhash;f(s?{$rowhash:s}:void 0,null===(r=null===(i=null==e?void 0:e.object)||void 0===i?void 0:i.properties)||void 0===r?void 0:r.tableName),this.setState({clickedItem:null==e?void 0:e.object})},tileURLs:((null===(e=null==p?void 0:p.options)||void 0===e?void 0:e.tileURLs)||[]).map((e=>e.replaceAll("{Z}","{z}").replaceAll("{X}","{x}").replaceAll("{Y}","{y}"))),tileSize:(null===(n=null==p?void 0:p.options)||void 0===n?void 0:n.tileSize)||256,tileAttribution:null===(i=null==p?void 0:p.options)||void 0===i?void 0:i.tileAttribution,initialState:(null==p?void 0:p.options)||{},geoJsonLayers:v,options:{filterExtent:null===(r=null==p?void 0:p.options)||void 0===r?void 0:r.filterExtent},onOptionsChange:e=>{p.$update({options:e},{deepMerge:!0})},onMapStateChange:({extent:e,latitude:t,longitude:n,zoom:i,pitch:r,bearing:s})=>{var o;(null===(o=null==p?void 0:p.options)||void 0===o?void 0:o.extent)&&p.$update({options:{extent:e,latitude:t,longitude:n,zoom:i,pitch:r,bearing:s}},{deepMerge:!0})},onHover:this.onHover,onGetFullExtent:this.getDataExtent})));return t.createElement(Window,{w:p,getMenu:this.getMenu},b)}}ProstglesMap.extentToFilter=(e,t)=>({[`${t}.&&.st_makeenvelope`]:e});const ZS=(e,t,n)=>{const i=t[t.length-1],r=t.length>1?t.slice(-1).map((e=>[e.w1_id,e.w2_id])).flat():[];return e.filter((e=>[e.w1_id,e.w2_id].some((e=>[i.w1_id,i.w2_id].filter((e=>!r.includes(e))).includes(e)))&&!t.some((t=>t.id===e.id))&&!n.some((t=>t.id===e.id))))},JS=(e,t,n,i)=>{if(e.id===t.wid)return[];const r=i.filter((e=>!e.closed&&"table"===e.type)),s=n.filter((e=>![e.w1_id,e.w2_id].find((e=>!r.some((t=>t.id===e)))))),o=((e,t)=>{const n=e.filter((e=>[e.w1_id,e.w2_id].includes(t.id)));let i=n.map((e=>[e])),r=!1,s=20;do{let t=!1,o=[];const a=i.length;for(let r=0;r<a;r++){let s=i[r];const a=ZS(e,s,n);t=t||Boolean(a.length),a.length>1&&a.slice(1).map((e=>{o.push([...s,e])})),a.length&&(i[r]=[...s,a[0]])}i=i.concat(o),r=!t,s--}while(!r&&s);return i})(s,e),a=o.map((t=>((e,t,n)=>{let i=[];return t.map(((r,s)=>{const o=n.find((e=>r.w1_id===e.id)),a=n.find((e=>r.w2_id===e.id)),l=s===t.length-1;if(!(null==o?void 0:o.table_name)||!(null==a?void 0:a.table_name))return;let c=Boolean(!s&&r.w1_id===e.id||s&&[t[s-1].w1_id,t[s-1].w2_id].includes(r.w1_id)),u=[];"tablePath"in r.options&&r.options.tablePath&&(u=[...r.options.tablePath.slice(0)],c||u.reverse()),u=u.filter((e=>![o.table_name,a.table_name].includes(e))),i=[...i,c?o.table_name:a.table_name,...u],l&&(i=[...i,c?a.table_name:o.table_name])})),i})(e,t,r))),l=o.map((e=>e.flatMap((e=>[e.w1_id,e.w2_id])))).findIndex((n=>n.includes(e.id)&&n.includes(t.wid)));if(l>-1){const n=a[l].slice(1,a[l].lastIndexOf(t.table_name)+1);return 1===n.length&&n[0]===e.table_name?[]:n}},QS=(e,t,n)=>{let i=[];if("table"!==e.type)throw"Must be table";return n.map((n=>{var r;if(uC(n,"map")||uC(n,"timechart")){const s=t.find((t=>[t.w1_id,t.w2_id].sort().join()===[e.id,n.id].sort().join()));if(s){let e;uC(n,"map")&&(null===(r=n.options)||void 0===r?void 0:r.filterExtent)&&n.options.extent&&(e=ProstglesMap.extentToFilter(n.options.extent,s.options.geomColumn)),i.push({chart:n,link:s,filter:e})}}})),i},eC=(e,t,n,i,r)=>{const s=i.map((e=>e.$get()));let o,a=[];if(uC(e,"table")){const i=QS(e,n,s),l=i.map((e=>e.filter));a=s.filter((t=>uC(t,"table")&&t.id!==e.id)).map((t=>{if(!uC(t,"table"))throw 1;const i=QS(t,n,s).map((e=>e.filter)).filter(vT),r=lT(t.filter||[],{filters:i});return tC(e,{window_id:t.id,table_name:t.table_name,row_filter:r},n,s)})).concat(l).filter(vT),o=!r&&t&&i.find((e=>e.chart.id===t.window_id))&&e.table_name===t.table_name||r&&(null==t?void 0:t.window_id)===e.id?t.row_filter:tC(e,t,n,s)}else console.error("Not implemented");return{activeRowFilter:o,crossFilters:a,all:[o,...a].filter(vT)}},tC=(e,t,n,i)=>{if(e.id!==(null==t?void 0:t.window_id)&&t){const r=JS(e,{wid:t.window_id,table_name:t.table_name},n,i);if(e.id===(null==t?void 0:t.window_id)||0===(null==r?void 0:r.length))return t.row_filter;if(r)return{$existsJoined:{[r.join(".")]:t.row_filter}}}};class JoinTableMenu extends RTComp{constructor(){super(...arguments),this.state={},this.d={}}render(){const{onLinkTable:e,w:n,tables:i}=this.props,{linkTablePath:r}=this.state;null==r||r[r.length-1];return t.createElement("div",{className:"flex-col ai-start"},t.createElement(JoinPathSelector,{className:"w-full",tableName:n.table_name,tables:i,onLinkTable:e,onSelect:e=>{this.setState({linkTablePath:e})}}))}}class LinkMenu extends RTComp{constructor(){super(...arguments),this.state={loading:!0,shapes:[],chartRef:void 0},this.onDelta=async(e,t,n)=>{var i,r;null===(r=null===(i=this.state.chartRef)||void 0===i?void 0:i.render)||void 0===r||r.call(i,this.state.shapes||[])}}async onMount(){var e,t;const{w:n,db:i,links:r,gridRef:s,windows:o,tables:a}=this.props;let l=[];if(n.table_name){const e=LinkMenu.getMyLinks(r,n,o),t=(o.filter((t=>!t.closed&&!t.deleted&&e.some((e=>[e.w1_id,e.w2_id].includes(t.id))))),a.find((e=>e.name===n.table_name)),[]);let i;s.querySelectorAll("[data-box-id][data-box-type='item']").forEach((e=>{const n=e.dataset.boxId,i=e.getBoundingClientRect(),r=o.find((e=>e.id===n));t.push({id:n,rect:i,w:r})}));const c=e.find((e=>{var t;return null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.color}));if(c){const e=aC[c.options.colorKey];e&&(i=e)}e.forEach((e=>{var n,s,c,u,d;const h=t.find((t=>t.id===e.w1_id)),p=t.find((t=>t.id===e.w2_id)),f=e=>[e.rect.x+e.rect.width/2,e.rect.y+e.rect.height/2];if(h&&p){const t=t=>{var n,i;return t?uC(t,"table")?t.table_name:uC(t,"map")?`(${null===(n=null==e?void 0:e.options)||void 0===n?void 0:n.geomColumn})`:uC(t,"timechart")?`(${null===(i=null==e?void 0:e.options)||void 0===i?void 0:i.dateColumn})`:"":""},m={font:"20px Arial",textAlign:"center",elevation:12,background:{fillStyle:"white",borderRadius:12,padding:12}};l.push({type:"multiline",coords:[f(h),f(p)],lineWidth:6,strokeStyle:i.get(1)}),l.push({id:1,type:"text",coords:f(h),fillStyle:"black",text:t(h.w),...m}),l.push({id:3,type:"text",coords:f(p),fillStyle:"black",text:t(p.w),...m});let g=[];const y=o.find((e=>e.id===h.id)),v=o.find((e=>e.id===p.id));if(!y||!v)return;const b=null===(n=window.document.body.querySelector(`[data-box-id='${y.id}']`))||void 0===n?void 0:n.getBoundingClientRect(),w=null===(s=window.document.body.querySelector(`[data-box-id='${v.id}']`))||void 0===s?void 0:s.getBoundingClientRect();if(!b||!w)return;const x=Boolean(b&&w&&b.y<w.y),_=Boolean(b&&w&&b.x>w.x),E=Math.abs(b.y-w.y)>Math.abs(b.x-w.x)?"y":"x";let S=[];uC(y,"table")&&uC(v,"table")?(S=null!==(c=JS(y,{wid:v.id,table_name:v.table_name},r,o))&&void 0!==c?c:[],(null==S?void 0:S.length)||(S=null!==(d=null===(u=JS(v,{wid:y.id,table_name:y.table_name},r,o))||void 0===u?void 0:u.slice(0).reverse())&&void 0!==d?d:[]),y.table_name&&(S=[y.table_name,...S]),g=S.flatMap(((e,t)=>{if(S&&t<S.length-1){const n=a.find((t=>t.name===e));if(n){const i=n.joins.find((e=>e.tableName===(null==S?void 0:S[t+1])));if(i){const n={text:"("+i.on.join(", ")+")",color:"blue"},r={text:e,color:"black"};return S.length>2&&t?[r,n]:n}}}})).filter(vT)):S=[];let C=!1;if(x||"y"!==E?_&&"x"===E&&(g=g.slice(0).reverse()):C=!0,C&&(g=g.slice(0).reverse()),null==g?void 0:g.length){const e=f(h),t=f(p),n=16;g.map((({text:i,color:r},s)=>{l.push({id:22+s,type:"text",coords:[Math.round((e[0]+t[0])/2),Math.round((e[1]+t[1])/2+2.5*s*n)],fillStyle:r,font:n+"px Arial",textAlign:"center",elevation:12,background:{fillStyle:"white",borderRadius:12,padding:10,strokeStyle:null!=r?r:"gray",lineWidth:1},text:i})}))}}}))}null===(t=null===(e=this.chartRef)||void 0===e?void 0:e.render)||void 0===t||t.call(e,l),this.setState({loading:!1,shapes:l})}render(){const{loading:e,shapes:n}=this.state,{onClose:i,anchorEl:r,onLinkTable:s,tables:o,w:a}=this.props;if(e)return t.createElement(Loading,null);const l=o.some((e=>e.name===a.table_name&&e.joins.length));return t.createElement(t.Fragment,null,t.createElement(Popup,{open:!0,onClose:i,title:l?"Add referenced table":void 0,collapsible:!0,anchorEl:r,clickCatchStyle:{opacity:0,zIndex:14},contentStyle:l?{paddingTop:0}:{display:"none"},rootStyle:{zIndex:14}},l&&t.createElement(JoinTableMenu,{w:a,tables:o,onLinkTable:(e,t)=>{s(e,t),i()}})),t.createElement(Chart,{className:"h-full w-full",style:{position:"absolute",inset:0,zIndex:14,backdropFilter:"blur(1px)",backgroundColor:"#80808030"},setRef:e=>{this.chartRef=e,this.setState({chartRef:e})}}))}}LinkMenu.getMyLinks=(e,t,n)=>{const i=(e,t)=>t.filter((t=>[t.w1_id,t.w2_id].some((t=>e.some((e=>[e.w1_id,e.w2_id].includes(t))))))),r=e.filter((e=>[e.w1_id,e.w2_id].every((e=>n.some((t=>e===t.id&&!t.closed&&!t.deleted))))));let s=r.filter((e=>[e.w1_id,e.w2_id].includes(t.id))),o=s,a=[...s];do{s=i(o,r.filter((e=>!a.find((t=>t.id===e.id))))),o=s,a=a.concat(s)}while(s.length);return a};const nC=(e=[],n)=>{let i=n;if(n&&e){i=n.slice(0);const t=i.findIndex((e=>"*"===e));t>-1&&i.splice(t,0,...e.map((e=>e.name)));const r=i.findIndex((e=>"**"===e));r>-1&&i.splice(r,0,...e.filter((e=>{var t;return null===(t=e.references)||void 0===t?void 0:t.ftable})).map((e=>({name:e.references.ftable,fieldConfigs:["*"]})))),i=i.filter((e=>!["*","**"].includes(e)))}const r=e=>({name:e.name,label:e.label,renderValue:"uuid"===e.udt_name?e=>t.createElement("div",{className:"pointer",title:"Click to copy ID",onClick:()=>{navigator.clipboard.writeText(e)}},e?e.slice(0,5):e,"..."):["postcode","post_code"].includes(e.name)?n=>n?t.createElement("a",{className:"flex-col",target:"_blank",href:`https://www.google.com/maps/search/${n}`},t.createElement("span",null,SmartFormField.renderValue(e,n))):SmartFormField.renderValue(e,n):"boolean"===e.tsDataType?e=>t.createElement(Checkbox,{title:(e||"NULL").toString(),checked:!!e,className:"no-pointer-events",readOnly:!0}):void 0});let s=i?i.map((t=>{if("string"!=typeof t)return t;{const n=e.find((e=>e.name===t));if(n)return r(n);console.error(`Could not find column ${t}. Incorrect name or not allowed`)}})).filter((e=>e)):e.map((e=>r(e)));return s};class SmartCard extends RTComp{constructor(){super(...arguments),this.state={editMode:!1,columns:void 0,variant:void 0},this.onDelta=async()=>{var e;const{tableName:t,db:n,columns:i,rowFilter:r}=this.props,s=n[t];if(!this.state.columns){let t=i;i?this.setState({columns:i}):t=await(null===(e=s.getColumns)||void 0===e?void 0:e.call(s)),this.setState({columns:t})}if(r&&JSON.stringify(r!==this._rowFilter)&&s.find){const e=await s.find(r,{limit:2});1!==e.length?console.error("Expected exactly one item"):this.setState({item:e[0]})}}}render(){var e;const{tableName:n,db:i,onChange:r,className:s="",style:o={},disableVariantToggle:a=!1,hideColumns:l,fieldConfigs:c,footer:u=null,enableInsert:d=!1,includeMedia:h,title:p,smartFormProps:f={},excludeNulls:m,tables:g,onChanged:y,popupFixedStyle:v}=this.props,{columns:b,editMode:w,item:x}=this.state,_=null!==(e=this.props.defaultData)&&void 0!==e?e:this.state.item,E="row-wrap",S=this.state.variant||this.props.variant||E;if(!b)return t.createElement(Loading,null);let C=this.props.rowFilter;const T=b.find((e=>e.is_pkey&&_[e.name]));!C&&T&&_[T.name]&&(C=[{fieldName:T.name,value:_[T.name]}]);const A=null==i?void 0:i[n];let k=Boolean((null==A?void 0:A.find)&&C),N=Boolean((null==A?void 0:A.delete)&&C),M=Boolean(r)||Boolean((null==A?void 0:A.update)&&C);Boolean(null==A?void 0:A.insert);const P="row-wrap"===S?"flex-row-wrap ai-center":"row"===S?"flex-row ai-center":"flex-col ai-start ";let L;w&&(L=t.createElement(SmartForm,{db:i,asPopup:!0,tables:g,tableName:n,onChange:r,rowFilter:C,confirmUpdates:!0,hideChangesOptions:!0,enableInsert:d,includeMedia:h,onSuccess:y,...f,onClose:()=>{this.setState({editMode:!1})}}));let O=l?b.filter((e=>l.includes(e.name))):b;const R=(SmartCard.parseFieldConfigs(c)||nC(O||this.props.columns)).filter((e=>!e.hide)).map((e=>({name:e.name,col:O.find((t=>e.name===t.name)),fc:e}))),I=R.filter((({name:e,fc:t})=>(null==t?void 0:t.render)||!m||null!==_[e])).map((({name:e,fc:n,col:i},r)=>{var s,o,a;return t.createElement("div",{key:r,className:"flex-col mr-p5 mt-p5 p-p5 o-auto "+((null==n?void 0:n.className)||""),style:null==n?void 0:n.style},t.createElement("div",{className:"font-12 text-gray-400 noselect",title:(null==i?void 0:i.udt_name)||""},(null==n?void 0:n.label)||(null==i?void 0:i.label)),(null===(s=null==n?void 0:n.render)||void 0===s?void 0:s.call(n,_[e],_))||t.createElement("div",{className:"font-16 text-gray-800 mt-p5"},null!==(a=null===(o=null==n?void 0:n.renderValue)||void 0===o?void 0:o.call(n,_[e],_))&&void 0!==a?a:i&&SmartFormField.renderValue(i,_[e])))}));return t.createElement(t.Fragment,null,L,t.createElement("div",{className:"card bg-white relative "+P+` ${s} `+(a?"":" pointer "),style:{padding:window.isMobileDevice?".25em":"1em",...o},onClick:a?void 0:()=>{const e=this.state.variant||"row";this.setState({variant:"row"===e?"col":"col"===e?E:"row"})}},M||N||k?t.createElement(Btn,{className:"f-0 absolute ",style:{top:"0.25em",right:"0.25em"},iconPath:M||N?je:Pe,onClick:e=>{e.preventDefault(),e.stopPropagation(),this.setState({editMode:!0})}}):null,t.createElement("div",{className:"flex-col min-w-0 min-h-0 f-1"},t.createElement("div",{className:"f-0"},p),t.createElement("div",{className:"o-auto f-1 min-w-0 min-h-0 "+P},I),null==u?void 0:u(_))))}}SmartCard.parseFieldConfigs=(e,t)=>{if(e){if("*"===e&&(e=["*"]),!Array.isArray(e))throw"Expecting an array of fieldConfigs";let n=[];e.slice(0).forEach((e=>{"string"==typeof e?t?n=n.concat(nC(t,[e])):n.push({name:e}):n.push(e)}));const i=n.find(((e,t)=>n.find(((n,i)=>e.name===n.name&&t!==i))));return i&&console.log("Duplicate field config name found: "+i.name),n}};class FileInput extends RTComp{constructor(){super(...arguments),this.state={focusedFile:void 0,isOverflowing:!1},this.onDelta=()=>{this.isViewerMode()?this.resizeObserver||(this.resizeObserver=new ResizeObserver((e=>{const t=this.refWrapper.scrollWidth>this.refWrapper.offsetWidth;this.state.isOverflowing!==t&&this.setState({isOverflowing:t})})),this.resizeObserver.observe(this.refWrapper)):this.resizeObserver&&this.resizeObserver.unobserve(this.refWrapper)},this.renderMedia=e=>{const{file:n,i,onDelete:r,style:s={},onClick:o}=e;let a="url"in n?{...n,type:n.content_type}:{name:n.name,type:n.data.type,url:URL.createObjectURL(n.data)};const{type:l,url:c,name:u}=a;let d=null;if(c){const e={maxWidth:"100%",maxHeight:"100%"};l.startsWith("image")?d=t.createElement("img",{loading:"lazy",src:c,style:e}):l.startsWith("video")?d=t.createElement("video",{style:e,controls:!0,src:c}):l.startsWith("audio")&&(d=t.createElement("audio",{style:e,controls:!0,src:c}))}return t.createElement("div",{key:i,className:" relative flex-col ",style:{width:"150px",height:"150px",...s}},t.createElement("div",{className:" relative flex-col f-1"},o?t.createElement("div",{className:"absolute w-full h-full pointer",style:{zIndex:1},onClick:e=>{e.stopPropagation(),e.preventDefault(),o()}}):null,r?t.createElement(Btn,{style:{position:"absolute",top:"10px",right:"10px",zIndex:2,backgroundColor:"white"},className:"shadow",iconPath:Ae,title:"Remove file",onClick:()=>{r()}}):null,t.createElement("div",{className:"f-1 min-w-0 min-h-0 flex-row ai-center"},d)),u?t.createElement("div",{className:"f-0 noselect p-p5 text-gray-500 font-14 absolute w-full f-0",style:{position:"absolute",zIndex:1,bottom:0,color:"white",background:"linear-gradient(to bottom, rgb(255 255 255 / 0%) 0%,#00000075 70%)"}},u):t.createElement("a",{href:c,target:"_blank",className:"p-5 f-0"},c))},this.isViewerMode=()=>{const{onAdd:e,onDelete:t}=this.props;return Boolean(!e&&!t)}}render(){var e,n;const{className:i="",style:r={},label:s,maxFileCount:o=100,accept:a,id:l="file-input-comp",onAdd:c,media:u=[],onDelete:d,minSize:h=150}=this.props,{focusedFile:p,isOverflowing:f}=this.state,m=this.isViewerMode();let g;if(p){let e="data"in p.file?p.file.data.type:p.file.content_type;g=t.createElement(Popup,{open:!0,rootStyle:{padding:0},contentClassName:"",onClose:()=>{this.setState({focusedFile:void 0})},title:p.file.name,onKeyDown:m?e=>{if("ArrowRight"===e.key){const e=p.index<u.length-1?p.index+1:0;this.setState({focusedFile:{file:u[e],index:e}})}else if("ArrowLeft"===e.key){const e=p.index?p.index-1:u.length-1;this.setState({focusedFile:{file:u[e],index:e}})}}:void 0},this.renderMedia({file:p.file,i:"focused",style:{width:"fit-content",height:"fit-content",border:"unset"},onClick:e.startsWith("image")?()=>{this.setState({focusedFile:void 0})}:void 0,focused:!0}))}const y=o<=u.length||!c?null:t.createElement("label",{htmlFor:l,className:"f-1 flex-row pl-1 "},t.createElement(tt(),{path:He,size:1.25,title:"Add files",className:"shadow bg-white pointer round text-blue-500"}),t.createElement("input",{id:l,style:{width:0,height:0},type:"file",accept:a,multiple:o>1,onChange:e=>{let t=Array.from(e.target.files).map((e=>({data:e,name:e.name})));c(t)}})),v=f&&m,b=Boolean(v&&(null===(e=this.refWrapper)||void 0===e?void 0:e.scrollLeft)),w=Boolean(v&&(!(null===(n=this.refWrapper)||void 0===n?void 0:n.scrollLeft)||this.refWrapper.scrollWidth-20>this.refWrapper.scrollLeft+this.refWrapper.clientWidth)),x=e=>{var t,n;if(this.refWrapper){const i=(null===(n=null===(t=this.refWrapper.children)||void 0===t?void 0:t[1])||void 0===n?void 0:n.offsetWidth)||h;this.refWrapper.scrollLeft+=e*i,this.forceUpdate()}},_="absolute h-full w-fit flex-row ai-center pointer noselect",E={zIndex:2,top:0,bottom:0};return t.createElement("div",{ref:e=>{e&&(this.ref=e)},className:"flex-col f-1 min-w-0 min-h-0 "+i,style:{...r}},g,t.createElement("div",{className:"relative flex-col min-w-0 min-h-0 ",style:{}},y||s?t.createElement("div",{className:"flex-row-wrap ai-center f-0 ",style:{}},t.createElement("div",{className:"py-1 noselect",style:{textAlign:"start",color:"#374151",flex:.5}},s),y):null,t.createElement("div",{className:m?" f-1 flex-row o-auto min-w-0 min-h-0 o-auto ":" p-1  flex-row-wrap ",ref:e=>{e&&(this.refWrapper=e)},onScroll:e=>{const t=window;(!t.__lastMediaScroll||t.__lastMediaScroll<Date.now()-100)&&(this.forceUpdate(),t.__lastMediaScroll=Date.now())}},b&&t.createElement("div",{className:_,style:{...E,left:0,background:"linear-gradient( -90deg, transparent, white)"},onClick:()=>x(-1)},t.createElement(tt(),{size:1.5,path:Ce})),u.map(((e,t)=>this.renderMedia({file:e,i:t+"media",onDelete:d?()=>{d(e)}:void 0,onClick:()=>{this.setState({focusedFile:{file:e,index:t}})},style:m?{width:"250px",height:"250px",minWidth:`${h}px`,minHeight:`${h}px`,margin:0}:{}}))),w&&t.createElement("div",{className:_,style:{...E,right:0,background:"linear-gradient( 90deg, transparent, white)"},onClick:()=>x(1)},t.createElement(tt(),{size:1.5,path:Te})))))}}class SmartCardView extends RTComp{constructor(){super(...arguments),this.state={items:[],tableInfo:void 0,joinedInfo:{},tableColumns:void 0,insertMode:!1,detailedFilter:[]},this.loaded=!1,this.onDataChanged=()=>{this.setData()},this.setData=async(e=this.state.fieldConfigs,t=this.state.tableInfo,n=this.state.tableColumns)=>{var i,r,s;if(!e)return;const{tableName:o,db:a,dataItems:l,select:c,limit:u,disableSubscribe:d}=this.props,{detailedFilter:h=[]}=this.state,{orderByKey:p,orderAsc:f}=this.getSort(),m=lT((null===(i=this.props.detailedFilter)||void 0===i?void 0:i.value)||h);if(!l&&(null==a?void 0:a[o])){const i=JSON.stringify(m),l=JSON.stringify({orderByKey:p,orderAsc:f});this.dataRequest={filterStr:i,orderByStr:l};let h=c;const g=async(e,n,i)=>{var r,s,o,l,c;let u=e.slice(0),d={};for await(const e of u)if("fieldConfigs"in e){if(e.name===t.media_table_name)d[e.name]={id:1,name:1,url:1,content_type:1};else if(d[e.name]=e.select,!e.select){const t=await(null===(r=a[e.name])||void 0===r?void 0:r.getColumns());d[e.name]=await g(SmartCard.parseFieldConfigs(e.fieldConfigs,t),t,e.name)}}else e.select?d[e.name]=e.select:n.find((t=>t.name===e.name&&t.select))&&(d[e.name]=1);if((null===(s=a[i])||void 0===s?void 0:s.update)||(null===(o=a[i])||void 0===o?void 0:o.insert)||(null===(l=a[i])||void 0===l?void 0:l.delete)||(null===(c=a[i])||void 0===c?void 0:c.find)){const e=n.filter((e=>e.is_pkey));e.map((e=>{e.is_pkey&&!d[e.name]&&(d[e.name]=1)}))}return d};let y={};p&&(y={orderBy:{[p]:Boolean(f)}}),Number.isFinite(u)&&u>0&&(y={...y,limit:u}),!h&&e&&(h=await g(e,n,o));const v=e=>{this.dataRequest.filterStr===i&&this.dataRequest.orderByStr===l&&this.setState({items:e})};if(!d&&a[o].subscribe)this.setState({loadingData:!0}),(null===(r=this.itemsSub)||void 0===r?void 0:r[o])&&await(null===(s=this.itemsSub)||void 0===s?void 0:s[o].unsubscribe()),this.itemsSub[o]=await a[o].subscribe(m,{select:h,...y},(e=>{v(e),this.setState({loadingData:!1})})),await Promise.all(e.map((async e=>{var t;"fieldConfigs"in e&&e.fieldConfigs&&!(null===(t=this.itemsSub)||void 0===t?void 0:t[e.name])&&(this.itemsSub[e.name]=await a[e.name].subscribe({},{limit:0},(()=>{this.setData(),this.setState({loadingData:!1})})))})));else{this.setState({loadingData:!0});const e=await a[o].find(m,{select:h,...y});this.setState({items:e,loadingData:!1})}}else l&&this.setState({items:l})},this.itemsSub={},this.onDelta=async(e,t,n)=>{const{tableName:i,db:r,dataItems:s,fieldConfigs:o,detailedFilter:a}=this.props;if(i&&r&&!r[i]&&console.error("Invalid/Dissallowed tableName given to SmartCardView -> "+i),this.loaded&&(e&&"detailedFilter"in e||e&&"fieldConfigs"in e||(null==e?void 0:e.dataItems)||(null==e?void 0:e.select)||t&&("orderByKey"in t||"orderAsc"in t||"filter"in t||"detailedFilter"in t)))this.setData();else if((null==r?void 0:r[i])&&!this.loaded){let e=this.props.tableInfo||this.state.tableInfo,t={},n=this.state.tableColumns;if(!this.loaded){this.loaded=!0,e=e||await r[i].getInfo(),n=this.props.columns||await r[i].getColumns();let s={};const a=SmartCard.parseFieldConfigs(o||["*"],n);a&&await Promise.all(a.map((async e=>{var t,n;if("fieldConfigs"in e){const i=await(null===(t=r[e.name])||void 0===t?void 0:t.getInfo()),o=await(null===(n=r[e.name])||void 0===n?void 0:n.getColumns());s={...s,[e.name]:{tableInfo:i,tableColumns:o}}}}))),this.setData(a,e,n),t={tableInfo:e,tableColumns:n,joinedInfo:s,fieldConfigs:a},this.setState(t)}}},this.renderMedia=e=>{const{file:n,i,onDelete:r,style:s={},onClick:o}=e,{type:a="",url:l,name:c}=n;let u=null;if(l){const e={maxWidth:"100%",maxHeight:"100%"};a.startsWith("image")?u=t.createElement("img",{loading:"lazy",src:l,style:e}):a.startsWith("video")?u=t.createElement("video",{style:e,controls:!0,src:l}):a.startsWith("audio")&&(u=t.createElement("audio",{style:e,controls:!0,src:l}))}return t.createElement("div",{key:i,className:"m-p5 relative flex-col b b-gray-300 ",style:{width:"150px",height:"150px",...s}},o?t.createElement("div",{className:"absolute w-full h-full pointer",style:{zIndex:1},onClick:e=>{e.stopPropagation(),e.preventDefault(),o()}}):null,r?t.createElement(Btn,{style:{position:"absolute",top:"10px",right:"10px",zIndex:2,backgroundColor:"white"},className:"shadow",iconPath:Ae,title:"Remove file",onClick:()=>{r()}}):null,t.createElement("div",{className:"f-1 min-w-0 min-h-0 flex-row ai-center"},u),c?t.createElement("div",{className:"f-0 noselect p-p5 text-gray-500 font-14 absolute w-full",style:{position:"absolute",zIndex:1,bottom:0,color:"white",background:"linear-gradient(to bottom, rgb(255 255 255 / 0%) 0%,#00000075 70%)"}},c):null)},this.getSort=()=>{const{fieldConfigs:e}=this.state,{sortableFields:t}=this.props,{orderByKey:n=(null==t?void 0:t[0]),orderAsc:i=!0}=this.state;return e?n&&!(null==e?void 0:e.find((e=>e.name===n)))?{}:{orderByKey:n,orderAsc:i}:{}}}onUnmount(){Object.values(this.itemsSub).map((e=>null==e?void 0:e.unsubscribe()))}render(){var e,n;const{tableName:i,depth:r=0,footer:s,db:o,includeMedia:a,title:l,smartFormProps:c={},variant:u="row-wrap",sortableFields:d,smartCardProps:h,filterFields:p,tables:f,w:m}=this.props,{items:g,joinedInfo:y,tableInfo:v,tableColumns:b,insertMode:w,fieldConfigs:x,loadingData:_}=this.state,E=(null===(e=this.props.detailedFilter)||void 0===e?void 0:e.value)||this.state.detailedFilter||[],{orderByKey:S,orderAsc:C}=this.getSort();if(!v||!x)return null;const T=b.find((e=>e.is_pkey&&x.find((t=>t.name===e.name&&!t.select)))),A=e=>({...e,id:e.id,url:e.url,content_type:e.content_type,name:e.original_name});if(null==v?void 0:v.is_media)return t.createElement(t.Fragment,null,undefined,t.createElement("div",{className:"flex-row f-1 o-auto min-w-0 min-h-o",style:{maxHeight:"500px"}},t.createElement(FileInput,{media:g.map(A)})));const k=((e={},t={})=>r?{...e,boxShadow:"unset",borderRadius:"unset",...t}:e)(this.props.style,{border:"unset"});let N;if(w&&(null==c?void 0:c.enableInsert)){let e;N=t.createElement(SmartForm,{asPopup:!0,db:o,tables:f,tableName:i,hideChangesOptions:!0,defaultData:e,includeMedia:a,...c,onClose:e=>{var t;e&&((null===(t=this.props)||void 0===t?void 0:t.onDataChanged)?this.props.onDataChanged():this.setData()),this.setState({insertMode:!1})}})}const M=[];x.forEach((e=>{const t=null==d?void 0:d.includes(e.name);return t&&"fieldConfigs"in e?(console.error("Cannot sort by a joined table field: "+e.name),!1):(t&&M.push({name:e.name,label:e.label}),t)})),b.map((e=>{(null==d?void 0:d.includes(e.name))&&!M.some((t=>t.name===e.name))&&M.push({name:e.name,label:e.label})}));let P=(null==c?void 0:c.enableInsert)&&(null===(n=null==o?void 0:o[i])||void 0===n?void 0:n.insert)?t.createElement(Btn,{className:"f-0 mr-2 shadow mt-p5 absolute b b-active",style:{backgroundColor:"white",right:"1em",bottom:"1em",zIndex:2},iconPath:He,onClick:()=>{this.setState({insertMode:!0})},variant:"outline",color:"action"}):null,L=M.length?t.createElement("div",{className:"ml-auto flex-row min-h-0 f-0 relative ai-center pl-p5"},t.createElement(Select,{id:"orderbycomp",buttonClassName:"shadow bg-white",label:"Sort by",asRow:!0,value:S,fullOptions:M.map((e=>({key:e.name,label:e.label||e.name}))),onChange:e=>{this.setState({orderByKey:e})}}),t.createElement(Btn,{iconPath:C?We:Ge,onClick:()=>{this.setState({orderAsc:!C})}})):null;const O=(x||[]).filter((e=>!("fieldConfigs"in e)||e.render)),R=(x||[]).filter((e=>"fieldConfigs"in e&&!e.render));return t.createElement("div",{className:"flex-col min-h-0 f-1 relative  ",style:{}},t.createElement(SmartFilterBar,{table_name:i,db:o,onChange:e=>{this.setState({detailedFilter:e})},filter:E,tables:f,leftContent:N,rightContent:L}),P,t.createElement("div",{className:"flex-col o-auto f-1 relative p-1 pt-0 min-h-0"},_&&t.createElement(Loading,{variant:"cover",delay:1}),g.length&&r?t.createElement("div",{className:"bottom-fader"}):null,g.map(((e,n)=>t.createElement("div",{key:T&&e[T.name]||n,className:"flex-col "+(n?" mt-1 ":"")+(parent?"":" card ")+(r?" b b-gray-300 ":""),style:{}},t.createElement(SmartCard,{tables:f,db:o,tableName:i,style:k,defaultData:e,variant:u,disableVariantToggle:!0,includeMedia:a,title:l&&l(e,b),fieldConfigs:O,...h,smartFormProps:c,footer:()=>{var n;return t.createElement("div",{className:"flex-col "},R.map(((n,i)=>{var s,l,c;return t.createElement("div",{key:"j"+i,className:"flex-col mt-p5 "+(parent?"":"p-1")},t.createElement("div",{className:"mb-p25 mt-p5 p-p5 font-bold noselect"},n.label||n.name),t.createElement(SmartCardView,{db:o,tableName:n.name,style:{border:"unset",padding:0},dataItems:e[n.name],fieldConfigs:n.fieldConfigs,columns:null===(s=null==y?void 0:y[n.name])||void 0===s?void 0:s.tableColumns,depth:r+1,includeMedia:a,smartFormProps:n.smartFormProps,excludeNulls:null===(l=null==n?void 0:n.smartCardProps)||void 0===l?void 0:l.excludeNulls,smartCardProps:null==n?void 0:n.smartCardProps,onDataChanged:(null===(c=this.props)||void 0===c?void 0:c.onDataChanged)||this.onDataChanged}))})),null===(n=null==h?void 0:h.footer)||void 0===n?void 0:n.call(h,e))}}),null==s?void 0:s(e,b))))))}}class ProstglesCard extends RTComp{constructor(){super(...arguments),this.state={loading:!1,wSync:null,error:null,showError:!1},this.onDelta=async(e,t,n)=>{const i={...e,...t,...n};console.log(i);const{db:r,w:s}=this.props;if(r&&!this.state.wSync){let e=s.$cloneSync(((e,t)=>{this.d.w;this.setData({w:e},{w:t}),this.setState({w:e})}));this.setState({wSync:e})}},this.getMenu=e=>{const{db:n,table:i,tables:r,dbs:s}=this.props,{nested_tables:o}=e;let a;return o&&(a={},Object.entries(o).map((([i,s])=>{a[i]={content:t.createElement("div",{className:"flex-col p-1"},t.createElement("div",{className:"flex-col p-p5 text-gray-400 ta-left"},"Nested table (",i,")"),t.createElement(Btn,{onClick:()=>{const t={...e.nested_tables};delete t[i],e.$update({nested_tables:{...t}})}}),t.createElement(ColumnsMenu,{w:e,db:n,tableName:e.table_name,tables:r,nestedTable:i,onClose:()=>{}}))}}))),t.createElement(Tabs,{compactMode:!0,variant:"vertical",items:{Title:{content:t.createElement("div",{className:"flex-col p-1"},t.createElement(FormField,{value:e.name,onChange:t=>{e.$update({name:t})}}))},Columns:{content:t.createElement("div",{className:"flex-col p-1"},t.createElement("div",{className:"flex-col p-p5 text-gray-400 ta-left"},"Root table (",e.table_name,")"),t.createElement(ColumnsMenu,{w:e,db:n,tableName:e.table_name,tables:r,onClose:()=>{}}))}}})}}onMount(){}onUnmount(){var e,t;null===(t=null===(e=this.state.wSync)||void 0===e?void 0:e.$unsync)||void 0===t||t.call(e)}render(){const{loading:e,error:n,showError:i}=this.state,{w:r}=this.state,{db:s,table:o,tables:a,dbs:l}=this.props;if(!r)return t.createElement("div",{className:"relative"},t.createElement(Loading,{variant:"cover"}));let c,u;n&&(c=t.createElement("div",{className:"flex-row relative",style:{position:"absolute",top:"1em",left:"1em",zIndex:22}},n?t.createElement(Btn,{className:"text-red-500",iconPath:we,onClick:()=>{this.setState({showError:!0})}}):null)),i&&(u=t.createElement(Popup,{open:!0,onClose:()=>{this.setState({showError:!1})}},t.createElement("div",{className:"bg-white"},t.createElement(ErrorComponent,{error:n}))));const d=(r.columns||[]).filter((e=>e.show)).map((e=>e.computedConfig?{name:e.computedConfig.column,label:e.name,select:{[e.computedConfig.funcName]:[e.computedConfig.column]},renderValue:e=>e}:e.name)),h=Object.keys(r.nested_tables||{}).map((e=>{const t=a.find((t=>t.name===e));return{name:e,tableInfo:t.info,tableColumns:t.columns,fieldConfigs:r.nested_tables[e].cols.map((e=>e.computedConfig?{name:e.computedConfig.column,label:e.name,select:{[e.computedConfig.funcName]:[e.computedConfig.column]},renderValue:e=>e}:e.name))}}));let p=t.createElement(t.Fragment,null,u,t.createElement("div",{className:"relative f-1 flex-col min-h-0 min-w-0 o-auto bg-gray-200",ref:e=>{e&&(this.ref=e)}},c,t.createElement(SmartCardView,{db:s,w:r,tableName:r.table_name,tables:a,style:{padding:"1em"},fieldConfigs:[...d,...h],sortableFields:o.columns.map((e=>e.name)),filterFields:o.columns.map((e=>e.name)),smartFormProps:{enableInsert:!0},detailedFilter:{value:r.filter||[],onChange:e=>{var t;null===(t=this.d.w)||void 0===t||t.$update({filter:e})}}})));return t.createElement(Window,{w:r,getMenu:this.getMenu},p)}}const iC=[{key:"auto",label:"Auto"},{key:"year",label:"1 Year"},{key:"month",label:"1 Month"},{key:"week",label:"1 Week"},{key:"day",label:"1 Day"},{key:"8hour",label:"8 Hours"},{key:"4hour",label:"4 Hours"},{key:"2hour",label:"2 Hours"},{key:"hour",label:"1 Hour"},{key:"30minute",label:"30 Minutes"},{key:"15minute",label:"15 Minutes"},{key:"5minute",label:"5 Minutes"},{key:"minute",label:"1 Minute"},{key:"30second",label:"30 Seconds"},{key:"15second",label:"15 Seconds"},{key:"5second",label:"5 Seconds"},{key:"second",label:"1 Second"},{key:"millisecond",label:"1 Millisecond"},{key:"5millisecond",label:"5 Milliseconds"},{key:"10millisecond",label:"10 Milliseconds"},{key:"100millisecond",label:"100 Milliseconds"},{key:"250millisecond",label:"250 Milliseconds"},{key:"500millisecond",label:"500 Milliseconds"}],rC=[{label:"Count All",func:"$countAll"},{label:"Min",func:"$min"},{label:"Max",func:"$max"},{label:"Sum",func:"$sum"},{label:"Avg",func:"$avg"}];class ProstglesTimeChart extends RTComp{constructor(){super(...arguments),this.state={resetExtent:0,xExtent:void 0,extent:void 0,loadingLayers:!1,loading:!1,wSync:null,layers:[],error:null,columns:[]},this.onDelta=async(e,t,n)=>{var i,r;const s=Object.keys({...e,...t,...n});let o={};((null===(r=null===(i=null==n?void 0:n.w)||void 0===i?void 0:i.options)||void 0===r?void 0:r.binSize)||s&&["layerQueries","joinFilter","w","statType","statColumn","resetExtent","extent","db","dataAge"].find((e=>s.includes(e))))&&this.setLayerData(s),dC(o)||this.setState(o)},this.getBin=(e,t)=>{const n=+new Date(t)-+new Date(e),i=n/31536e6,r=365*i,s=24*r,o=60*s,a=60*o,l=1e3*a,c={year:i,month:12*i,week:52*i,day:r,"8hour":s/8,"4hour":s/4,"2hour":s/2,hour:s,"30minute":o/30,"15minute":o/15,"5minute":o/5,minute:o,"30second":a/30,"15second":a/15,"5second":a/5,second:a,millisecond:l,"5millisecond":l/5,"10millisecond":l/10,"100millisecond":l/100,"250millisecond":l/250,"500millisecond":l/500},u=Object.keys(c).map((e=>({key:e,delta:c[e]-900,absDelta:Math.abs(c[e]-900)}))).filter((e=>e.delta<0)).sort(((e,t)=>e.absDelta-t.absDelta));let d="hour";return u.length&&(d=u[0].key),n<=0&&(d="millisecond"),d},this.d={lCols:{},w:void 0,extent:void 0,dataAge:0},this.setDataAge=e=>{this.dataAge=e,this.settingDataAge||(this.settingDataAge=setTimeout((()=>{this.setData({dataAge:this.dataAge}),this.settingDataAge=null}),300))},this.setLayerData=async(e=[])=>{var t;const{db:n,layerQueries:i=[]}=this.props,{extent:r}=this.state,{w:s}=this.d;if(!s||!n)return;if(!(null===(t=s.options)||void 0===t?void 0:t.statType))return void s.$update({options:{statType:"Count All"}},{deepMerge:!0});const{statType:o}=s.options;let a,l,c={};try{this.setState({loadingLayers:!0});const e=(await Promise.all(i.map((async e=>{var t,i,s,l,c,u,d;let h=[],p=[],{dateColumn:f,tableName:m,sql:g,externalFilters:y,statColumn:v,tableFilter:b}=e;if(m){let e,a={$countAll:[]};if(v&&o&&"Count All"!==o){const e=rC.find((e=>e.label===o));e&&(a={[e.func]:[v]})}const c=36e5;if(r){const{leftDate:t,rightDate:n}=r;e={$and:[{[f]:{$gte:new Date(+t-c)}},{[f]:{$lte:new Date(+n+c)}}]}}const u=n[m];if(!u.findOne||!u.find)throw`Cannot query table ${m}: Missing or disallowed`;const d=JSON.stringify(y);let g={$and:[...y,b].filter(vT)};!u.subscribe||this.dataSub&&this.dataSubFilter===d||(this.dataSubFilter=d,this.dataSub&&await this.dataSub.unsubscribe(),this.dataSub=await u.subscribe(g||{},{select:"",throttle:500},(()=>{this.setDataAge(Date.now())})));const w={$and:[g,e].filter((e=>e))},{min:x,max:_}=await u.findOne(w,{select:{min:{$min:[f]},max:{$max:[f]}}}).catch(console.error),E=null===(s=null===(i=null===(t=this.d)||void 0===t?void 0:t.w)||void 0===i?void 0:i.options)||void 0===s?void 0:s.binSize,S=E?1e3:void 0,C={value:a,date:{["$date_trunc_"+(E||(r?this.getBin(r.leftDate,r.rightDate):this.getBin(x,_)))]:[f]}},T=await u.findOne(g,{select:C,orderBy:{date:1}}).catch(console.error),A=await u.findOne(g,{select:C,orderBy:{date:-1}}).catch(console.error);if(h=await u.find(w,{select:C,orderBy:{date:1},limit:null!=S?S:905}),h.length){const e=h[0],t=h[h.length-1];T&&e.date!==T[f]&&(T.value=e.value,h.unshift(T)),A&&t.date!==A[f]&&(A.value=t.value,h.push(A))}h.map((e=>({...e,value:+e.value})));const k=null===(l=this.props.tables.find((e=>e.name===m)))||void 0===l?void 0:l.columns;if(!k)throw`Columns not found for table ${m}`;p=k}else if(g){if(!n.sql)return void console.error("Not enough privileges to run query");let e="",t=null===(d=null===(u=null===(c=this.d)||void 0===c?void 0:c.w)||void 0===u?void 0:u.options)||void 0===d?void 0:d.binSize,i=g.trim()+"";i.endsWith(";")&&(i=i.slice(0,i.length-1));let r=(0,Xn.asName)(f);if(!t){const e=`SELECT MIN(${r}) as min, MAX(${r}) as max FROM (\n`+i+"\n ) t",s=await n.sql(e,{dateColumn:f},{returnType:"rows"}),{min:o,max:l}=s[0];a=[new Date(o),new Date(l)],t=this.getBin(new Date(o),new Date(l))}let s="COUNT(*)";if(v&&o&&"Count All"!==o){const e=rC.find((e=>e.label===o));e&&(s=e.label+(0,Xn.asName)(v))}t=(t||"day").replace(/[0-9]/g,"");p=(await n.sql(" SELECT * FROM (\n"+i+"\n ) t LIMIT 0 ")).fields.map((e=>({...e,key:e.name,label:e.name,subLabel:e.dataType,udt_name:e.dataType})));const l=`SELECT date_trunc(\${bin}, ${r}) as date, ${s} as value FROM (\n`+i+"\n ) t \n"+e+"\nGROUP BY date_trunc(${bin}, "+r+" ) \n ORDER BY date ";console.log(await n.sql(l,{dateColumn:f,bin:t,statField:s},{returnType:"statement"})),h=await n.sql(l,{dateColumn:f,bin:t,statField:s},{returnType:"rows"}),console.log(h.length)}return{color:e.color||"red",getYLabel:({value:e,min:t,max:n})=>t===n?`${e}`:`${e.toFixed(Math.max(2,2-Math.round(Math.log10(Math.abs(n-t)))))}`,data:h,cols:p}})))).filter(vT);c={layers:e}}catch(e){l=e,console.error(e)}this.setState({...c,xExtent:a,loadingLayers:!1,error:l})},this.getMenu=e=>{const{statType:n,binSize:i="auto",groupByColumn:r}=e.options||{},{layers:s=[]}=this.state,{layerQueries:o=[]}=this.props;return t.createElement("div",{className:"flex-col w-full f-1 p-1"},o.map(((e,o)=>{let a,l=(s&&s[o]?s[o].cols:[]).map((e=>({...e,label:e.name})));l=l.filter((t=>t.label!==e.dateColumn&&"number"===t.tsDataType)),l&&l.length&&"Count All"!==n&&(a=t.createElement(Select,{label:"Numeric field",variant:"div",className:"w-fit mb-1  mt-1",options:l.map((e=>e.label)),value:e.statColumn,onChange:t=>{console.log(t),e.updateOptions({statColumn:t})}}));let c,u=l.filter((t=>t.name!==e.statColumn&&t.name!==e.dateColumn&&["string","boolean","number"].includes(t.tsDataType)));return u.length&&(c=t.createElement(Select,{label:"Group by field",variant:"div",className:"w-fit mb-1  mt-1",options:u.map((e=>e.label)),value:r,onChange:t=>{console.log(c),console.log("This should update the link"),e.updateOptions({groupByColumn:t})}})),t.createElement("div",{key:o,className:"flex-col"},t.createElement(Select,{label:"Bin size",variant:"div",className:"w-fit  ",fullOptions:iC,value:i,onChange:e=>{var t;null===(t=this.d.w)||void 0===t||t.$update({options:{binSize:e}},{deepMerge:!0})}}),t.createElement(Select,{label:"Aggregation type",variant:"div",className:"w-fit mt-1",options:rC.filter((e=>l.length||"$countAll"===e.func)).map((e=>e.label)),value:n,onChange:e=>{var t;let n={options:{statType:e}};null===(t=this.d.w)||void 0===t||t.$update(n,{deepMerge:!0})}}),a,c)})))},this.chartRef={}}async onMount(){const{db:e,dbs:t,w:n}=this.props;if(e&&!this.state.wSync){const e=await n.$cloneSync(((e,t)=>{this.setData({w:e},{w:t})}));this.setState({wSync:e})}}onUnmount(){var e,t;null===(t=null===(e=this.state.wSync)||void 0===e?void 0:e.$unsync)||void 0===t||t.call(e)}setExt(e){this.ext=e,this.settingExtent&&clearTimeout(this.settingExtent),this.settingExtent=setTimeout((()=>{this.setState({extent:this.ext}),this.settingExtent=null}),500)}render(){const{layers:e=[],loadingLayers:n,error:i,xExtent:r,extent:s}=this.state,{onClose:o,titleIcon:a,layerQueries:l,dbs:c}=this.props,{w:u}=this.d;if(!u)return t.createElement(Loading,{className:"m-auto f-1"});let d,h;i&&(d=t.createElement(st,{button:t.createElement(Btn,{className:"text-red-500",iconPath:we}),open:!0,onClose:()=>{this.setState({showError:!1})}},t.createElement("div",{className:"bg-white"},t.createElement(ErrorComponent,{error:i})))),(n||i)&&(h=t.createElement("div",{className:"flex-row relative f-1 m-auto ",style:{position:"absolute",top:"1em",left:"1em",zIndex:22}},n?t.createElement(Loading,{className:"m-auto f-1",delay:100}):null,d));const p=Boolean(s&&r&&Object.values(s).join()!==r.join()),f=t.createElement(t.Fragment,null,t.createElement("div",{ref:e=>{e&&(this.menuAnchor=e)},style:{width:"1px",height:"1px"}}),t.createElement("div",{className:"relative f-1 flex-col min-h-0 min-w-0 noselect "},h,p?t.createElement(Btn,{title:"Zoom out to data extent",style:{position:"absolute",right:0,top:0,zIndex:1},iconPath:"M20,2H4C2.89,2 2,2.89 2,4V20C2,21.11 2.89,22 4,22H20C21.11,22 22,21.11 22,20V4C22,2.89 21.11,2 20,2M20,20H4V4H20M13,8V10H11V8H9L12,5L15,8M16,15V13H14V11H16V9L19,12M10,13H8V15L5,12L8,9V11H10M15,16L12,19L9,16H11V14H13V16",onClick:()=>{this.chartRef&&(this.chartRef.setView({xO:0,xScale:1,yO:0,yScale:1}),this.setState({extent:void 0}))}}):null,t.createElement(TimeChart,{layers:e,chartRef:e=>{this.chartRef=e},onExtentChange:e=>{this.setExt(e)}})));return t.createElement(Window,{w:u,getMenu:this.getMenu},f)}}const sC=(e,t)=>{let n=null;for(let i in e){(null===n||e[i]<e[n])&&!t.includes(i)&&(n=i)}return n};class TreeBuilder{constructor(e,t){this.onChange=e=>{},this.makeTree=(e,t)=>{let n=e;return t?(delete n.isRoot,n.parent=t):n.isRoot=!0,e.items&&e.items.map((e=>{this.makeTree(e,n)})),n},this.remove=(e,t=!1)=>{this._filter((t=>t.id===e&&t.parent)).map((e=>{e.parent.items=e.parent.items.filter((t=>t!==e))})),t||this.onChange(this.getLayout())},this.getLayout=()=>{const e=t=>(delete t.parent,t.items&&(t.items=t.items.map(e)),t);let t=e({...this.tree});return this.build(JSON.parse(JSON.stringify(t))),JSON.parse(JSON.stringify(t))},this._filter=e=>{const t=n=>{let i=[];return e(n)&&i.push(n),n.items&&n.items.map((e=>{i=i.concat(t(e))})),i};return t(this.tree)},this.refresh=(e=!1)=>{this.build(this.getLayout());let t=this._filter((e=>"item"===e.type));t.concat(t.map((e=>e.parent))).filter(vT).map((e=>{let t={...e};for(;t.parent&&!t.parent.isRoot&&t.parent.items&&1===t.parent.items.length;)t=t.parent;t.parent&&(t.parent.items=t.parent.items.map((n=>n===t?e:n)))}));const n=this.getLayout();this.build(n);const i=()=>this._filter((e=>Boolean(e.parent&&e.parent.type===e.type)));for(;i().length;)i().map((e=>{if(e.parent&&e.parent.type===e.type){const t=e.parent.items.findIndex((t=>t===e));e.parent.items.splice(t,1,...e.items)}this.build(this.getLayout())}));const r=()=>this._filter((e=>"item"!==e.type&&e.parent&&e.items&&0===e.items.length));for(;r().length;){r().map((e=>{e.parent.items=e.parent.items.filter((t=>t.id!=e.id))}));const e=this.getLayout();this.build(e)}e||this.onChange(this.getLayout())},this.update=e=>{e.map((e=>{let t=this._filter((t=>t.id==e.id)),n=t[0];1===t.length?Object.keys(e).map((t=>{n[t]=e[t]})):console.log("Found duplicate items. will not update")})),this.onChange(this.getLayout())},this.find=e=>this._filter((t=>t.id==e))[0],this.getLeafs=(e=(()=>!0))=>this._filter((e=>!("items"in e)||!e.items.length&&e.parent)).filter(e),this.findFunc=e=>this._filter(e)[0],this.moveTo=(e,t,n,i)=>{let r=this.find(e);this.build(this.getLayout()),this.remove(e,!0);let s=this.find(t);if(r&&s)if(s.parent){const e=s.parent.items.findIndex((e=>e.id==t));s.parent.type===n?(s.parent.items.splice(i?e:e+1,0,r),s.parent.items=s.parent.items.map((e=>(e.size=100/Math.max(1,s.parent.items.length),e)))):(r.size=50,s.size=50,s.parent.items[e]={id:Date.now(),type:n,size:Math.min(...s.parent.items.map((e=>e.size)))||50,items:i?[r,s]:[s,r]},s={id:Date.now(),size:s.size||50,type:n,items:i?[r,s]:[s,r]})}else s.type===n&&s.items?(r.size=s&&s.items&&s.items.length?s.items[0].size:50,i?s.items.unshift(r):s.items.push(r)):(r.size=50,s.size=50,s.isRoot=!1,s={id:Date.now(),size:100,isRoot:!0,type:n,items:i?[r,s]:[s,r]},this.layout=s,this.tree=this.makeTree(s));this.refresh()},this.build(e),this.onChange=t}build(e){let t=JSON.parse(JSON.stringify({...e}));this.layout=t,this.tree=this.makeTree(t)}}class SilverGridReact extends RTComp{constructor(){super(...arguments),this.state={layout:void 0,targetStyle:{display:"none"}},this.onDelta=e=>{const{layout:t,children:n=[]}=this.props;if(e&&("layout"in e||"children"in e)){if(t&&(this.treeLayout=new TreeBuilder({...t},this.onChange)),(!t||t.items&&0===t.items.length)&&n.length)return setTimeout((()=>{this.onChange({id:1,type:"col",size:100,items:n.map(((e,t)=>({id:e.props["data-key"]||t,title:e.props["data-title"],type:"item",size:20})))})}),0),null;const e=this.getItems(t).map((e=>e.id)),i=n.filter((t=>!e.includes(t.props["data-key"]))),r=Array.from(new Set(e.filter((e=>!n.find((t=>t.props["data-key"]==e))))));if(t&&"items"in t&&this.treeLayout){const e=this.treeLayout.getLeafs((e=>"items"in e&&!e.items.length));if(e.length)return void e.map((e=>{var t;let n=e;for(;n;){let e=n.parent;null===(t=this.treeLayout)||void 0===t||t.remove(n.id),n=e&&"items"in e&&!e.items.length&&!e.isRoot?e:void 0}}))}if(t&&i.length&&setTimeout((()=>{let e={...t};if("col"===e.type){const t=e.items.reduce(((e,t)=>e+t.size),0);e.items=[...i.map(((e,n)=>({id:e.props["data-key"]||n,title:e.props["data-title"],type:"item",size:t/i.length}))),...e.items]}else e.size=50,e={id:1,type:"col",size:100,isRoot:!0,items:i.map(((e,t)=>({id:e.props["data-key"]||t,title:e.props["data-title"],type:"item",size:50/i.length}))).concat(e)};this.onChange(e)}),0),t&&n.length&&r.length&&this.treeLayout)return void r.map((e=>{var t;null===(t=this.treeLayout)||void 0===t||t.remove(e)}))}},this.setTarget=e=>{this.setState({targetStyle:e})},this.getRoot=()=>{if(!this.ref)throw"Unexpected";return this.ref},this.onChange=(e,t=!1)=>{const{onChange:n}=this.props;n&&!t?(n({...e}),this.setState({layout:void 0})):this.setState({layout:e})},this.getItems=(e=this.state.layout)=>{let t=[];if(e){if("item"===e.type)return[e];t=t.concat(...e.items.map(this.getItems))}else;return t},this.renderGrid=(e,n=0)=>{const{children:i,header:r,headerIcons:s=[],layout:o,onClose:a,_ref:l}=this.props,c=t.Children.toArray(i);let u=null;if(!(e=e||o)||!c.length)return null;if("item"===e.type){const i=c.find((t=>t.props["data-key"]==e.id)),o=c.find((t=>t.props["data-key"]==e.id&&"header-icons"===t.props["data-type"]))||s.find((t=>t.props["data-key"]==e.id));return t.createElement(SilverGridChild,{key:n,title:i?i.props["data-title"]:"",layout:e,header:r,headerIcon:o,setTarget:this.setTarget,getRoot:this.getRoot,onClose:a,moveTo:(e,t,n,i)=>{var r;null===(r=this.treeLayout)||void 0===r||r.moveTo(e,t,n,i)},onChange:e=>{this.onChange(e)},hasSiblings:c.some((t=>t.props["data-key"]!=(null==e?void 0:e.id)))},i)}{let i=e.items.map(((e,t)=>this.renderGrid(e,t)));if(u=[],"tab"===e.type){let i=e;i.items[0]||(u=null);const o=i.items;if(!o||!o.length)return null;const l=o[0].id,d=c.find((e=>e.props["data-key"]==l)),h=s.find((e=>e.props["data-key"]==l));d||(u=null);const p=i.items.filter((e=>e.id!=l));u=t.createElement(SilverGridChild,{key:n,title:d?d.props["data-title"]:"",headerIcon:h,siblingTabs:p,onClickSibling:t=>{var n;null===(n=this.treeLayout)||void 0===n||n.moveTo(t,e.id,"tab",!0)},hasSiblings:c.some((t=>t.props["data-key"]!=e.id)),layout:e.items[0],header:r,setTarget:this.setTarget,getRoot:this.getRoot,onClose:a,moveTo:(e,t,n,i)=>{var r;null===(r=this.treeLayout)||void 0===r||r.moveTo(e,t,n,i)},onChange:e=>{this.onChange(e)}},d)}else i.map(((n,r)=>{u.push(n),r<i.length-1&&u.push(t.createElement(SilverGridResizer,{key:"resizer"+r,type:e.type,onChange:(e,t)=>{var n;null===(n=this.treeLayout)||void 0===n||n.update([e,t])}}))}))}return t.createElement("div",{ref:e=>{e&&(this.ref=e,l&&l(e))},key:n,"data-box-type":e.type,"data-box-id":e.id,className:" flex-"+e.type+" silver-grid-box min-w-0 min-h-0",style:{flex:e.size,display:"flex"}},u)}}render(){const{targetStyle:e}=this.state,{style:n={},className:i="",overlay:r}=this.props;return t.createElement("div",{ref:e=>{e&&(this.ref=e)},className:"silver-grid-component relative  "+i,style:{display:"flex",flex:1,height:"100%",width:"100%",...n}},this.renderGrid(),t.createElement("div",{key:"silver-grid-target",ref:e=>{e&&(this.refTarget=e)},className:" absolute silver-grid-target b",style:{...e,zIndex:232,transition:".2s all ease-in-out",background:"#dcffffb3"}}),r)}}class SilverGridResizer extends RTComp{onDelta(){const{onChange:e}=this.props,t=this.ref;t&&!(null==t?void 0:t._hasListeners)&&(t._hasListeners=!0,PC(this.ref,{onPanEnd:()=>{const{prev:t,next:n}=this.sizes;e(t,n),this.sizes=void 0},onPanStart:()=>{},onRelease:()=>{this.ref.style.background="transparent"},onPress:()=>{this.ref.style.background="#00e1cc",cC(15)},onPan:e=>{if(!this.ref)throw"ref missing";const{type:t}=this.props,{nextElementSibling:n,previousElementSibling:i,parentElement:r}=this.ref,s=n,o=i,a=o.getBoundingClientRect(),l=s.getBoundingClientRect(),c=a.x,u=(l.x,l.width,a.y);l.y,l.height;let d,h;const p=this.ref.getBoundingClientRect().width/2,f=this.ref.getBoundingClientRect().height/2,m=+getComputedStyle(o).flexGrow+ +getComputedStyle(s).flexGrow;if("row"===t){const t=(a.width+l.width)/m;d=(e.x-c-p)/t,h=m-d}else{const t=(a.height+l.height)/m;d=(e.y-u-f)/t,h=m-d}o.style.flex=`${d}`,s.style.flex=`${h}`,this.sizes={prev:{id:o.dataset.boxId,size:d},next:{id:s.dataset.boxId,size:h}}}}))}render(){const e=oC()?"20px":"4px",{type:n}=this.props,i={width:"col"===n?"100%":e,height:"col"===n?e:"100%",cursor:"col"===n?"ns-resize":"ew-resize",opacity:.4,zIndex:2,margin:oC()?"col"!==n?"0 -8px":"-8px 0":""};return t.createElement("div",{ref:e=>{e&&(this.ref=e)},style:i,className:"silver-grid-resizer noselect "})}}function oC(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}class SilverGridChild extends RTComp{constructor(){super(...arguments),this.state={zIndex:1,fullscreen:!1},this.loaded=!1,this.close=async()=>{const{onClose:e,layout:t}=this.props;e&&await e(t.id)},this.hasSiblingFullScreened=()=>{const{getRoot:e}=this.props;return Boolean(this.ref&&e()&&e().querySelector('[data-box-type="item"].fullscreen')&&e().querySelector('[data-box-type="item"].fullscreen')!==this.ref)},this.minimise=()=>{},this.getSiblingTabs=()=>{const{siblingTabs:e,onClickSibling:n}=this.props;return n&&e&&e.length?t.createElement("div",{className:"f-1 flex-row o-auto no-scroll-bar",onWheel:e=>{e.currentTarget.scrollLeft+=e.deltaY}},e.map(((e,i)=>{const r=e.title||e.id;return t.createElement("div",{key:i,onClick:()=>{n(e.id)},style:{height:"37px",marginTop:"4px",padding:".5em .75em",lineHeight:"24px",maxWidth:"40%"},title:r+"",className:"f-0 min-w-0 ws-nowrap text-ellipsis bg-gray-200 p-p5  "},r)}))):null}}onUpdated(){var e;const{header:t,setTarget:n,moveTo:i}=this.props,r=null===(e=this.ref)||void 0===e?void 0:e.closest(".silver-grid-component");if(this.loaded||!r||!this.ref)return;this.loaded=!0;const s=this.refHeader||this.ref.querySelector("."+(null==t?void 0:t.move));if(!s)throw"Header missing";PC(s,{onPress:()=>{this.props.hasSiblings&&cC(15)},onPanStart:()=>{this.props.hasSiblings&&(this.ref.style.display="none")},onPanEnd:()=>{if(this.props.hasSiblings){try{this.ref.style.display="flex",n({display:"none"}),this.ref.style.opacity="";const{position:e,node:t}=this.target;let r="col",s=!0;"tabDist"===e?(r="tab",s=!0):"leftDist"===e?(r="row",s=!0):"rightDist"===e?(r="row",s=!1):"topDist"===e?(r="col",s=!0):"bottomDist"===e&&(r="col",s=!1);const o=t.dataset.boxId;i(this.props.layout.id,o,r,s)}catch(e){console.error(e)}this.target=void 0}},onPan:e=>{if(!this.props.hasSiblings)return;const{x:t,y:i}=e,s=Array.from(r.querySelectorAll("[data-box-type]")).map((e=>{var n;const r=e.getBoundingClientRect();let s,o=1/0;e.classList.contains("silver-grid-item")&&(s=null===(n=e.querySelector(":scope > .silver-grid-item-header"))||void 0===n?void 0:n.getBoundingClientRect(),o=Math.hypot(t-(s.x+s.width/2),i-(s.y+s.height/2)));const a=Math.hypot(t-(r.x+.25*r.width),i-(r.y+.5*r.height)),l=Math.hypot(t-(r.x+.75*r.width),i-(r.y+.5*r.height)),c=Math.hypot(t-(r.x+.5*r.width),i-(r.y+.25*r.height)),u=Math.hypot(t-(r.x+.5*r.width),i-(r.y+.75*r.height));return{node:e,rect:r,hr:s,tabDist:o,leftDist:a,rightDist:l,topDist:c,bottomDist:u,minDist:Math.min(o,a,l,c,u)}})).sort(((e,t)=>e.minDist-t.minDist));this.ref.style.opacity="0.3";const o=r.getBoundingClientRect(),a=s[0],l=a.rect;let c=l.x-o.x,u=l.y-o.y,d=l.width/2,h=l.height;this.target={node:a.node,position:"leftDist"},a.leftDist===a.minDist?(c=l.x-o.x,u=l.y-o.y,d=l.width/2,h=l.height,this.target.position="leftDist"):a.rightDist===a.minDist?(c=l.x-o.x+l.width/2,u=l.y-o.y,d=l.width/2,h=l.height,this.target.position="rightDist"):a.topDist===a.minDist?(c=l.x-o.x,u=l.y-o.y,d=l.width,h=l.height/2,this.target.position="topDist"):a.bottomDist===a.minDist?(c=l.x-o.x,u=l.y-o.y+l.height/2,d=l.width,h=l.height/2,this.target.position="bottomDist"):a.tabDist===a.minDist&&(c=a.hr.x-o.x,u=a.hr.y-o.y,d=a.hr.width,h=a.hr.height,this.target.position="tabDist");const p=this.ref.getBoundingClientRect();a.node===this.ref||c-2>=p.x-o.x&&c+d+2<=p.x-o.x+p.width&&u-2>=p.y-o.y&&u+h+2<=p.y-o.y+p.height||n({display:"block",width:`${d}px`,height:`${h}px`,transform:`translate(${c}px, ${u}px)`,border:"2px dashed #2d81ff"})}})}render(){const{children:e,header:n,layout:i,headerIcon:r,title:s}=this.props,{zIndex:o,fullscreen:a}=this.state;let l=e;return l?(n||(l=t.createElement(t.Fragment,null,t.createElement("div",{className:"silver-grid-item-header flex-row b b-gray-100 bg-gray-100 pointer f-0 noselect relative ai-center"},t.createElement("div",{className:"silver-grid-item-header--icon flex-row f-0 o-hidden"},r),t.createElement("div",{className:" flex-row f-1 min-w-0 ws-nowrap ai-center"},t.createElement("div",{ref:e=>{e&&(this.refHeader=e)},className:"silver-grid-item-header--title p-p5 f-0 text-ellipsis bg-white noselect ",style:{height:window.isMobileDevice?"32px":"40px",marginTop:"2px",maxWidth:"60%"}}),this.getSiblingTabs()),t.createElement(Btn,{className:"f-0",iconPath:a?"M14,14H19V16H16V19H14V14M5,14H10V19H8V16H5V14M8,5H10V10H5V8H8V5M19,8V10H14V5H16V8H19Z":"M5,5H10V7H7V10H5V5M14,5H19V10H17V7H14V5M17,14H19V19H14V17H17V14M10,17V19H5V14H7V17H10Z",onClick:e=>{this.setState({fullscreen:!a})}}),t.createElement(Btn,{className:"f-0",iconPath:Ae,onClick:this.close})),e)),t.createElement("div",{ref:e=>{e&&(this.ref=e)},className:"silver-grid-box silver-grid-item bg-white f-1 flex-col min-w-0 min-h-0 "+(a?" fullscreen ":" "),"data-box-id":i.id,"data-box-type":"item",onMouseEnter:()=>{this.hasSiblingFullScreened()||this.setState({zIndex:2})},onMouseLeave:()=>{this.hasSiblingFullScreened()||this.setState({zIndex:1})},style:{flex:i.size,overflow:"hidden",zIndex:a?3:o}},l)):null}}class ViewRenderer extends RTComp{constructor(){super(...arguments),this.state={},this.getTableChain=(e,t)=>{const n=this.getLinkChain(e,t);if(n){const{windows:e}=this.props;let t=n.map((t=>{var n;return null===(n=e.find((e=>e.id===t)))||void 0===n?void 0:n.table_name}));if(t.every(Xn.isDefined))return t}}}getLinkChain(e,t){const{links:n}=this.d,i=((e,t,n)=>{let i={};i[n]="Infinity",i=Object.assign(i,e[t]);let r={endNode:null};for(let n in e[t])r[n]=t;let s=[],o=sC(i,s);for(;o;){let n=i[o],a=e[o];for(let e in a)if(String(e)!==String(t)){let t=n+a[e];(!i[e]||i[e]>t)&&(i[e]=t,r[e]=o)}s.push(o),o=sC(i,s)}let a=[n],l=r[n];for(;l;)a.push(l),l=r[l];return a.reverse(),{distance:i[n],path:a}})((e=>{let t={};return e.map((([e,n])=>{t[e]=t[e]||{},t[e][n]=1,t[n]=t[n]||{},t[n][e]=1})),t})(n.map((e=>[e.w1_id,e.w2_id]))),e,t);return i.distance<1/0?i.path:void 0}getLinksAndWindows(){const e=this.props.windows.filter((e=>!e.deleted&&!e.closed));return{links:this.props.links.filter((t=>[t.w1_id,t.w2_id].every((t=>e.some((e=>e.id===t)))))),windows:e}}render(){const{workspace:e,db:n,dbs:i,tables:r,suggestions:s}=this.props,{links:o,windows:a}=this.getLinksAndWindows(),{linkMenuWindow:l}=this.state;if(!e||!r)return;const c=(t,n=[])=>{const{type:r,table_name:s,options:o={},name:a}=t;return i.windows.insert({name:a,type:r,table_name:s,options:o,filter:n,layout:lC("111"),fullscreen:!1,workspace_id:e.id},{returning:"*"})},u=t=>{var r,s,o,a,l,c;const{links:u,windows:d}=this.getLinksAndWindows(),{w1_id:h,w2_id:p,linkOpts:f}=t,{geomColumn:m,dateColumn:g,fromSelected:y,tablePath:v,sql:b}=f,w=u.filter((e=>d.find((t=>[e.w1_id,e.w2_id].includes(t.id))))),x=(E=[...Object.keys(aC).sort((()=>.5-Math.random())),...w.map((e=>hT(e,"options.colorKey"))).filter((e=>e))],E.reduce(((e,t)=>({...e,[t]:(e[t]||0)+1})),{})),_=Object.keys(x).pop();var E;const S=u.filter((e=>[e.w1_id,e.w2_id].find((e=>[h,p].includes(e))))),C=S.find((e=>hT(e,"options.color")));let T;C&&(T={color:null===(r=null==C?void 0:C.options)||void 0===r?void 0:r.color,colorKey:null===(s=null==C?void 0:C.options)||void 0===s?void 0:s.colorKey});let A={colorKey:null!==(o=null==T?void 0:T.colorKey)&&void 0!==o?o:_,color:null!==(a=null==T?void 0:T.color)&&void 0!==a?a:aC[_].get(),tablePath:v,sql:b};if(m&&(A={...A,geomColumn:m}),g&&(A={...A,dateColumn:g,fromSelected:y}),!e||!n)throw"no workspace or db";return null===(c=(l=i.links).insert)||void 0===c?void 0:c.call(l,{w1_id:h,w2_id:p,workspace_id:e.id,options:A},{returning:"*"})},d=(e,t=!1)=>{let n;const{active_row:i}=this.state;if(i){const r=i.row_filter;t&&i.window_id===e&&(n={tablePath:[i.table_name],filter:r});const s=this.getTableChain(e,i.window_id);s&&(n={tablePath:s.slice(1),filter:r})}return n},h=async(e,t,n)=>{const i=await this.props.loadTable({type:"table",table:t,fullscreen:!1});await u({w1_id:e.id,w2_id:i,linkOpts:{tablePath:n}}),e.fullscreen&&e.$update({fullscreen:!1})},p=async(e,t)=>{const{type:n,name:i,linkOpts:r}=e;let s={};"map"===n&&(s={options:{tileAttribution:{title:"© OpenStreetMap",url:"https://www.openstreetmap.org/"}}});const o=await c({name:i,type:n,...s});u({w1_id:t.id,w2_id:o.id,linkOpts:r})},f=async(e,t,n)=>{var i,s,l,c;if(!e||!t||this.state.active_row&&(null===(i=this.state.active_row)||void 0===i?void 0:i.window_id)!==n)return void(this.state.active_row&&this.setState({active_row:void 0}));let u={};const d=null!==(l=null===(s=r.find((e=>e.name===t)))||void 0===s?void 0:s.columns)&&void 0!==l?l:[],h=d.filter((e=>e.is_pkey));h.length&&h.every((t=>t.name in e))?h.map((t=>{u[t.name]=e[t.name]})):"$rowhash"in e?u.$rowhash=e.$rowhash:d.map((t=>{("number"===t.tsDataType||"string"===t.tsDataType||t.is_pkey)&&(u[t.name]=e[t.name])}));const p=o.filter((e=>[e.w1_id,e.w2_id].includes(n)&&a.filter((e=>e.id!==n)).find((t=>[e.w1_id,e.w2_id].includes(t.id)))));let f=e&&p.length?{window_id:n,table_name:t,row_filter:u}:void 0;e&&f&&!dC(this.state.active_row)&&(null===(c=this.state.active_row)||void 0===c?void 0:c.window_id)===f.window_id&&JC(this.state.active_row.row_filter,f.row_filter)&&(f=void 0),this.state.active_row!==f&&this.setState({active_row:f})},m=a.map(((l,u)=>{const m=async()=>{var e,t,n;(null==(l=l.$get())?void 0:l.$get)||console.error(this.d.windows),this.setState({active_row:void 0}),"sql"===l.type&&(null===(e=l.options)||void 0===e?void 0:e.sqlWasSaved)?await l.$update({closed:!0}):(null===(t=l.sql)||void 0===t?void 0:t.trim().length)&&"sql"===l.type&&!(null===(n=l.options)||void 0===n?void 0:n.sqlWasSaved)?qn.some((e=>e.sql.trim()===l.sql.trim()))?await l.$update({closed:!0,deleted:!0}):this.props.onCloseUnsavedSQL(l):(await l.$update({closed:!0,deleted:!0}),await i.links.update({$or:[{w1_id:l.id},{w2_id:l.id}]},{closed:!0,deleted:!0}))},g={key:l.id+l.fullscreen,"data-key":l.id,w:l,db:n,dbs:i,tables:r,onClose:m,onFilter:()=>{o.find((e=>a.find((t=>!t.closed&&t.id!==l.id&&[e.w1_id,e.w2_id].sort().join()===[l.id,t.id].sort().join()))))&&setTimeout((()=>this.forceUpdate()),1)}};let y=null,v=null;if("sql"===l.type)y=t.createElement(ProstglesSQL,{titleIcon:v,suggestions:s,onAddChart:e=>p(e,l),setLinkMenu:e=>this.setState({linkMenuWindow:e}),...g});else if("card"===l.type)y=t.createElement(ProstglesCard,{table:r.find((e=>e.name===l.table_name)),titleIcon:v,...g});else{const{links:n,windows:i}=this.getLinksAndWindows(),r=n.filter((e=>[e.w1_id,e.w2_id].includes(l.id)));let s;const o=r.find((e=>hT(e,"options.color")));if(o){const e=aC[o.options.colorKey];e&&(s=e)}if("map"===l.type){let e=[];n&&(e=r.map((e=>{const t=i.find((t=>uC(t,"table")&&t.id!==l.id&&[e.w1_id,e.w2_id].includes(t.id)));if(!("geomColumn"in e.options)||!e.options.geomColumn)throw"geomColumn missing from link";if(null==t?void 0:t.table_name){const r=eC(t,this.state.active_row,n,i,l),s=aC[e.options.colorKey];return{wid:t.id,tableName:t.table_name,geomColumn:e.options.geomColumn,externalFilters:r.all,tableFilter:lT(t.filter||[]),...e.options,joinFilter:r.activeRowFilter,fillColor:s.get(1,"deck"),lineColor:s.get(1,"deck"),color:s.get(1,"css"),sourceW:t}}if("sql"===(null==t?void 0:t.type)){const n=aC.c5,i={wid:t.id,geomColumn:e.options.geomColumn,...e.options,sql:e.options.sql,fillColor:n.get(1,"deck"),lineColor:n.get(1,"deck"),color:n.get(1,"css"),sourceW:t};if(!i.sql)return;return i}console.error("Why tbl is missing?")})).filter(Xn.isDefined));const{active_row:s}=this.state;y=t.createElement(ProstglesMap,{activeRow:s,titleIcon:v,layerQueries:e,onClickRow:(e,t)=>f(e,t,l.id),...g})}else if("timechart"===l.type){let e=[];n&&(e=r.map((e=>{const t=e,r=i.find((e=>"table"===e.type&&e.id!==l.id&&[t.w1_id,t.w2_id].includes(e.id)));if(r){const e=d(l.id),s=eC(r,this.state.active_row,n,i,l);const o=aC[t.options.colorKey]||aC.c1;return{sql:t.options.fromSelected?r.selected_sql:r.sql,tableName:r.table_name,...t.options,updateOptions:e=>t.$update({options:{...t.options,...e}}),activeRowFilter:e,tableFilter:lT(r.filter||[]),externalFilters:s.all,color:o.get(1,"css")}}console.log("Why tbl is missing?")})).filter(Xn.isDefined)),y=t.createElement(ProstglesTimeChart,{layerQueries:e,...g})}else if("table"===l.type){const r=this.state.active_row;let o=eC(l,r,n,i);console.log({active_row:r}),y=t.createElement(ProstglesTable,{workspace:e,setLinkMenu:e=>this.setState({linkMenuWindow:e}),activeRowColor:s?s.get(.2):void 0,activeRow:(null==r?void 0:r.window_id)===l.id?r:void 0,onAddChart:e=>p(e,l),onAddTable:(e,t)=>c({...e,type:"table"},t),onLinkTable:async(e,t)=>{h(l,e,t)},joinFilter:o.activeRowFilter,externalFilters:o.all,onClickRow:e=>f(e,l.table_name,l.id),...g})}}return{id:l.id,title:l.name||l.table_name||l.id,linkIcon:v,onClose:m,q:l,elem:y}})).filter(Xn.isDefined);return t.createElement("div",{className:"min-h-0 f-1 flex-row relative",ref:e=>{e&&(this.gridWrapperRef=e)}},l&&this.gridWrapperRef&&t.createElement(LinkMenu,{w:l.w,tables:r,links:o,windows:a,anchorEl:l.anchorEl,db:n,dbs:i,onClose:()=>this.setState({linkMenuWindow:void 0}),gridRef:this.gridWrapperRef,onLinkTable:(e,t)=>h(l.w,e,t)}),t.createElement(SilverGridReact,{_ref:e=>{e&&(this.gridRef=e)},className:"min-h-0 relative",layout:e.layout,onChange:t=>{JSON.stringify(t)!==JSON.stringify(e.layout)&&e.$update({layout:t})},onClose:async e=>{const t=m.find((t=>t.id===e));return t&&await t.onClose(),1}},m.map((e=>e.elem))))}}const aC={c1:{get:(e=1,t="css")=>{const n=[0,129,167,"css"===t?e:Math.round(255*e)];return"deck"===t?n:`rgba(${n.join(", ")})`}},c2:{get:(e=1,t="css")=>{const n=[240,113,103,"css"===t?e:Math.round(255*e)];return"deck"===t?n:`rgba(${n.join(", ")})`}},c3:{get:(e=1,t="css")=>{const n=[58,134,255,"css"===t?e:Math.round(255*e)];return"deck"===t?n:`rgba(${n.join(", ")})`}},c4:{get:(e=1,t="css")=>{const n=[131,56,236,"css"===t?e:Math.round(255*e)];return"deck"===t?n:`rgba(${n.join(", ")})`}},c5:{get:(e=1,t="css")=>{const n=[203,149,0,"css"===t?e:Math.round(255*e)];return"deck"===t?n:`rgba(${n.join(", ")})`}}};function lC(e){return{i:e,x:1,y:0,w:4,h:2}}const cC=(e=15)=>{try{navigator.vibrate(e)}catch(e){console.error(e)}},uC=(e,t)=>e.type===t;class Dashboard extends RTComp{constructor(){super(...arguments),this.state={loading:!0,minimised:!1,imported:0},this.d={closedWindows:[],allWindows:[],windows:[],links:[],linksSync:null},this.loadingSuggestions=!1,this.loadingTables=!1,this.syncsSet=!1,this.onDelta=async(e,t,n)=>{var i,r,s,o,a,l;const c={...e,...t,...n},{db:u,dbs:d,workspaceId:h,connectionId:p,dbSchemaTables:f}=this.props,{workspace:m}=this.d,{tables:g}=this.state;let y={};const v=d.workspaces;if(u&&(null==v?void 0:v.syncOne)&&!this.syncsSet&&p){this.syncsSet=!0;const e={connection_id:p,deleted:!1};if(!+await v.count(e)){const e=+await v.count({connection_id:p,name:"default",deleted:!0});await v.insert({connection_id:p,name:e?`default ${Date.now()}`:"default",options:{hideCounts:!0}},{returning:"*"}),window.location.reload()}let t;try{t=await v.findOne(h?{id:h,...e}:e)}catch(e){return void this.setState({wspError:e})}if(!t)return void this.setState({wspError:!0});window.document.title=`Prostgles UI - ${null!==(i=t.name)&&void 0!==i?i:t.id}`;const n=await v.syncOne({id:t.id,deleted:!1},{handlesOnData:!0},((e,t)=>{this.mounted&&this.setData({workspace:e},{workspace:t})})),l=await(null===(s=(r=d.links).sync)||void 0===s?void 0:s.call(r,{workspace_id:t.id},{handlesOnData:!0},((e,t)=>{this.mounted&&this.setData({links:e},{links:t})}))),c=await(null===(a=(o=d.windows).sync)||void 0===a?void 0:a.call(o,{workspace_id:t.id},{handlesOnData:!0,select:"*",patchText:!1},((e,t)=>{const n=e;if(!this.mounted)return;let i=n.sort(((e,t)=>+e.last_updated-+t.last_updated));const r=i.filter((e=>e.closed&&!e.table_name&&e.name)),s=i.filter((e=>!e.closed));if(this.d.windows){const e=e=>`${e.id} ${e.type} ${e.fullscreen} ${JSON.stringify(e.filter||{})} `;if(this.d.windows.map(e).sort().join()===s.map(e).sort().join())return}this.setData({allWindows:i,windows:s,closedWindows:r},{windows:t})})));this.setData({windowsSync:c,workspaceSync:n,linksSync:l},{windowsSync:c,workspaceSync:n,linksSync:l})}if(u&&m&&(c.workspace&&"hideCounts"in c.workspace||c.db||c.imported||!g)){let e;if(y={tables:await Dashboard.getTables(f,m,u),loading:!1},!this.loadingSuggestions&&(null==u?void 0:u.sql)&&(!(null===(l=this.state)||void 0===l?void 0:l.suggestions)||c.db)){try{this.loadingSuggestions=!0,e=await Fn(u)}catch(e){console.error("Issue with getSuggestions:",e)}this.loadingSuggestions=!1,y.suggestions=e,y.searchAll=null==e?void 0:e.suggestions.filter((e=>["table","function"].includes(e.type)))}}n&&(["windows","workspace","links"].map((e=>{n[e]&&(y[e]={...n[e]})})),dC(y)&&n.windowsSync&&(y={reRender:Date.now()})),dC(y)||this.setState(y)},this.loadTable=async e=>{const{db:t,dbs:n}=this.props,{workspace:i}=this.d,{type:r,table:s=null,fullscreen:o=!0,filter:a=null,sql:l="",name:c}=e;let u;if(s&&t){if(!t[s]||!t[s].find){const e="Table not found";throw alert(e),e}if("getInfo"in t[s]){u=(await t[s].getInfo()).oid}}return(await n.windows.insert({sql:l,filter:a,options:{hideTable:!0},type:r,table_name:s,table_oid:u,name:c,layout:lC("111"),fullscreen:!1,workspace_id:null==i?void 0:i.id},{returning:"*"})).id}}onUnmount(){const{workspaceSync:e,windowsSync:t,linksSync:n}=this.d;[e,t,n].map((e=>{e&&e.unsync&&e.unsync()}))}getNamePopupWindow(){const e=this.state.namePopupWindow,n=e?this.d.windows.find((t=>t.id===e.id)):null;if(n){const e=()=>this.setState({namePopupWindow:void 0});return{title:"Save query?",onClose:e,content:t.createElement("div",{className:"flex-col"},t.createElement(FormField,{type:"text",asColumn:!0,label:"Name",defaultValue:n.name,required:!0,onChange:e=>{n.$update({name:e,options:{...n.options||{},sqlWasSaved:!0}})}}),t.createElement("div",{className:"flex-row w-full mt-2"},t.createElement(Btn,{className:"mr-2",variant:"outline",color:"danger",size:"large",onClick:async()=>{n.$update({closed:!0}),e()}},"Delete and close"),t.createElement(Btn,{variant:"outline",color:"action",size:"large",onClick:()=>{n.name?n.$update({closed:!0,deleted:!1,options:{...n.options||{},sqlWasSaved:!0}}):alert("Cannot have an empty name"),setTimeout((()=>{e()}),500)}},"Save and close")))}}}render(){const{db:e,dbs:n,topRightControls:i,connectionId:r,dbsTables:s,showAccessManagement:o}=this.props,{tables:a=[],loading:l,namePopupWindow:c,suggestions:u,searchAll:d=[],wspError:h}=this.state;if(h)return t.createElement("div",{className:"flex-col p-1 text-white"},"Workspace not found ",t.createElement("a",{className:"text-white",href:`/connections/${this.props.connectionId}`},"Go back"));const{windowsSync:p,workspace:f}=this.d;if(!p||!f)return t.createElement(Loading,{className:"mt-4 mx-auto"});let m;m=o&&r?t.createElement(AccessControl,{className:"min-h-0",connectionId:r,db:e,dbs:n,tables:a,dbsTables:s,onClose:()=>{this.setState({showAccessControl:!1})}}):t.createElement(ViewRenderer,{db:e,dbs:n,workspace:f,loadTable:this.loadTable,links:this.d.links,windows:this.d.windows,tables:a,onCloseUnsavedSQL:e=>{this.setState({namePopupWindow:e})},suggestions:u});let g=this.getNamePopupWindow();return t.createElement("div",{className:"flex-col f-1 min-w-0 min-h-0 w-full "+(window.isMobileDevice?" p-p25 ":" p-p5 "),style:{maxWidth:"100vw"}},t.createElement("div",{className:"f-0 flex-row  min-h-0 min-w-0 o-hidden"},o?t.createElement("h4",{className:"text-white ai-center m-0 p-1"},"Access Control"):t.createElement(t.Fragment,null,t.createElement(DashboardMenu,{db:e,dbs:n,searchAll:d,loadTable:this.loadTable,tables:a,workspace:f}),t.createElement(WorkspaceMenu,{dbs:n,workspace:f})),i),g&&t.createElement(Popup,{open:!0,onClose:g.onClose,title:g.title,anchorEl:g.anchorEl,clickCatchStyle:g.clickCatchStyle},g.content),m,l?t.createElement(Loading,{className:"p-2"}):null)}}function dC(e){for(const t in e)return!1;return!0}Dashboard.getTables=(e,t,n)=>Promise.all(e.map((async i=>{var r,s,o,a;return{...i,count:!(null===(r=null==t?void 0:t.options)||void 0===r?void 0:r.hideCounts)&&(null==n?void 0:n[i.name].count)&&null!==(a=await(null===(o=(s=n[i.name]).count)||void 0===o?void 0:o.call(s)))&&void 0!==a?a:"",joins:ProstglesTable.getJoinedTables(e,i.name,n)}})));const hC=1e3,pC=6e4,fC=36e5,mC=24*fC,gC=30*mC,yC=365*mC;function vC(e,t,n){var i;let r=window.devicePixelRatio;const s=Math.max(30,t),o=Math.max(30,n);return e.width=s*r,e.height=o*r,e.style.width=s+"px",e.style.height=o+"px",r>1&&(null===(i=e.getContext("2d"))||void 0===i||i.scale(r,r)),e}const bC={},wC=(e=new Date,t)=>{const n=JSON.stringify({d:Math.round(+e),opts:t});return bC[n]||(bC[n]=e.toLocaleString(navigator.language,t)),bC[n]},xC={second:"2-digit",hour:"2-digit",minute:"2-digit"},_C=function e(){var t=vn();return t.copy=function(){return gn(t,e())},bn.apply(t,arguments),Dn(t)};class TimeChart extends RTComp{constructor(){super(...arguments),this.d={},this.getMargins=()=>{const{w:e,h:t}=this.chart.getWH();return{xMin:50,xMax:e-10,yMin:60,yMax:t-50,xForYLabels:6}},this.parseData=()=>{var e;const{w:t,h:n}=this.chart.getWH(),{layers:i,xExtent:r}=this.props;if(!i.length)return;let s=null,o=null,a=null,l=null;r&&(s=+r[0],o=+r[1]);let c=[];const{xMin:u,xMax:d,yMin:h,yMax:p,xForYLabels:f}=this.getMargins();let m=i.map(((e,t)=>{const n=e.data.map((e=>{const t=+new Date(e.date),n=+e.value;return{...e,date:t,value:n,x:0,y:0}})).sort(((e,t)=>+e.date-+t.date));return e._data=n,n.length&&n.map(((e,t)=>{r||(null!=s||(s=e.date),null!=o||(o=e.date),s=Math.min(s,e.date),o=Math.max(o,e.date)),null!=a||(a=e.value),null!=l||(l=e.value),a=Math.min(a,e.value),l=Math.max(l,e.value)})),e}));if(null===s||null===o||null===l||null===a)throw"Null vals";const g=_C().domain([s,o]).range([u,d]).clamp(!0),y=_C().domain([s,o]).range([f,d]).clamp(!0),v=_C().domain([l,a]).range([h,p]).clamp(!0);if(m=m.map((e=>{var t;return e._data=null===(t=e._data)||void 0===t?void 0:t.map((e=>{const t=g(e.date);return c.find((e=>e.v===+e.date))||c.push({x:t,v:e.date,date:new Date(e.date)}),{...e,x:t,y:v(e.value)}})),e})),null===(e=this.chart)||void 0===e?void 0:e.opts){const e=(+o-+s)/1e3,n=70;this.chart.opts.maxXScale=n/(t/e)}this.data={layers:m,dates:c,xScale:g,yScale:v,xScaleYLabels:y,minDate:s,maxDate:o,minVal:a,maxVal:l}},this.mainShapes=[],this.tooltipShapes=[],this.panning=!1}onMount(){}getIntersections(e){var t;let n,i=[];if(!this.chart)return;const[r]=this.chart.getDataXY(e,0);return null===(t=this.lineLayers)||void 0===t||t.map((t=>{t.coords.find((([s,o],a)=>{let l=!0;if(a<t.coords.length-1){const[c,u]=t.coords[a+1];if(!this.chart)return;const[d]=this.chart.getScreenXY(s),[h]=this.chart.getScreenXY(c),p=Math.abs(e-d),f=Math.abs(e-h);if(p<=2)n=s,i.push({...t,y:o,snapped_data:t.data[a]});else if(f<=2)n=c,i.push({...t,y:u,snapped_data:t.data[a+1]});else if(r>=s&&r<c||r>=c&&r<s){const e=u-o,n=(r-s)/(c-s);i.push({...t,y:o+n*e})}else l=!1}return l}))})),{layers:i,snapped_x:n}}onDelta(e,t,n){var i;const r={...e,...t,...n};if(this.ref&&!this.chart&&this.canv){const{onExtentChange:e,chartRef:t}=this.props;this.chart=new CanvasChart({node:this.ref,canvas:this.canv,yScaleLocked:!0,yPanLocked:!0,minXScale:1,events:{onExtentChange:t=>{e&&this.data&&e({leftDate:new Date(this.data.xScale.invert(t.leftX)),rightDate:new Date(this.data.xScale.invert(t.rightX))}),this.setData({extent:t})},onPan:()=>{this.panning=!0},onPanEnd:()=>{this.panning=!1}}}),t&&t(this.chart)}if(!this.chart)return;let s=!1;const{w:o,h:a}=this.chart.getWH(),{xMin:l,xMax:c,yMin:u,yMax:d}=this.getMargins();if(r&&r.layers){if(s=!0,this.mainShapes=[],this.lineLayers=[],this.parseData(),!this.data)return;const{layers:e}=this.data;e.map(((e,t)=>{var n;const{_data:i}=e;if(null==i?void 0:i.length){const t=i.filter((e=>{const[t,n]=this.chart.getScreenXY(e.x,e.y);return t>=l&&t<=c&&n>=u&&n<=d})).map(((t,n)=>({id:n,type:"circle",coords:[t.x,t.y],fillStyle:e.color,strokeStyle:e.color,lineWidth:0,r:3,data:t}))),r=t.map((e=>e.coords)),s=[{id:1,type:"multiline",strokeStyle:e.color,lineWidth:2,coords:r}];null===(n=this.lineLayers)||void 0===n||n.push({...e,coords:r});let o=0;r.map(((e,t)=>{t&&(o+=Math.hypot(e[0]-r[t-1][0],e[1]-r[t-1][1]))}));let a=o<4?t:s;this.mainShapes=this.mainShapes.concat([...a])}}))}if(n||"layers"in r){s=!0;const{xCursor:e,yCursor:t}=this.d;if(!e||this.panning||(null!=t?t:0)>d-14)this.tooltipShapes=[];else{let[n]=this.chart.getDataXY(e,null!=t?t:0);const{layers:r,snapped_x:s}=null!==(i=this.getIntersections(e))&&void 0!==i?i:{};if(!(null==r?void 0:r.length)||!this.data)return[];s&&(n=s);const o=new Date(this.data.xScale.invert(n));let l;const{leftX:c,rightX:h}=this.chart.getExtent(),p=this.data.xScale.invert(h)-this.data.xScale.invert(c);l=p<hC?wC(o,xC)+"."+o.getMilliseconds():wC(o,p<mC?xC:p<gC?{hour:"2-digit",minute:"2-digit",day:"numeric",month:"short",year:"2-digit"}:{day:"numeric",month:"short",year:"2-digit"});let f={id:"2111r",type:"text",fillStyle:"black",textAlign:"center",text:l,background:{fillStyle:"white",strokeStyle:"#cecece",lineWidth:1,padding:6,borderRadius:3},coords:[n,a-10]};const m=this.chart.measureText(f),{xMin:g,xMax:y}=this.getMargins();e-m.width/2<g+5?f.textAlign="start":e+m.width/2>y-5&&(f.textAlign="end");const v=e+14;let b,w,x=r.map((e=>{var t,n;return{id:"2111r"+Date.now(),type:"text",fillStyle:"black",text:e.getYLabel&&this.data?e.getYLabel({value:+(null!==(n=null===(t=e.snapped_data)||void 0===t?void 0:t.value)&&void 0!==n?n:this.data.yScale.invert(e.y)),min:this.data.yScale.invert(u),max:this.data.yScale.invert(d),prev:this.data.yScale.invert(e.y),next:this.data.yScale.invert(e.y)}):"",textAlign:"left",background:{fillStyle:"white",strokeStyle:e.color,lineWidth:1,padding:6,borderRadius:3},coords:[this.chart.getDataXY(v,0)[0],e.y+5]}})),_=!1;x.map((e=>{if(void 0===b&&(b=e.coords[1],w=e.coords[1]),b=Math.min(b,e.coords[1]),w=Math.max(w,e.coords[1]),!_){const t=this.chart.measureText(e);_=v+t.width>y-5}return e}));const E=b<a-w,S=x.sort(((e,t)=>E?e.coords[1]-t.coords[1]:t.coords[1]-e.coords[1]));x=[],S.map(((e,t)=>{let n=e.coords[1];if(t){const e=x[t-1].coords[1];n=E?Math.max(n,e+22):Math.min(n,e-22)}x.push({...e,coords:[e.coords[0],n],..._?{coords:[this.chart.getDataXY(v-28,0)[0],n],textAlign:"end"}:{}})})),this.tooltipShapes=[{id:"21111r",type:"multiline",lineWidth:1,strokeStyle:"#cecece",coords:[[n,0],[n,a-30]]},...r.map((e=>({id:Date.now(),type:"circle",coords:[n,e.y],fillStyle:"white",strokeStyle:"white",lineWidth:0,r:5}))),...r.map((e=>({id:Date.now(),type:"circle",coords:[n,e.y],fillStyle:e.color,strokeStyle:e.color,lineWidth:0,r:3}))),...x,f]}}if(s){const e=()=>{if(!this.data||!this.chart)throw"No data";const{xMin:e,xMax:t,xForYLabels:n}=this.getMargins();let[i,r]=this.chart.getDataXY(e,0),[s]=this.chart.getDataXY(n,0),[o,l]=this.chart.getDataXY(t,0);const{minDate:c,maxDate:u,dates:d,xScale:h,yScale:p,xScaleYLabels:f,minVal:m,maxVal:g}=this.data;if(!d.length)return[];h(c)>i&&(i=h(c)),h(u)<o&&(o=h(u));const y=function(e){const{leftDate:t,rightDate:n,getX:i,leftX:r,rightX:s,height:o,measureText:a,getScreenXY:l}=e;if(!t||!n)return[];let c=[];const u=((e,t,n=!1)=>{const i=+t-+e,r=i/yC,s=i/gC,o=i/mC,a=i/fC,l=i/pC,c=i/hC;return n?{years:r,months:s,days:o,hours:a,minutes:l,seconds:c}:r>=1?{years:r,months:s}:s>=1?{months:s,days:o}:o>=1?{days:o,hours:a}:a>=1?{hours:a,minutes:l}:{minutes:l,seconds:c}})(+t,+n,!0),d=e=>({type:"text",font:"12px Arial",fillStyle:"black",textAlign:"center",...e}),h=30,p=20,f=[{id:"100 Year",getStart:e=>new Date(IC(e.getFullYear(),100,3e3),0,1),dateDelta:100*gC*12,getLabel:e=>wC(e,{year:"numeric"})},{id:"10 Year",getStart:e=>new Date(IC(e.getFullYear(),10,3e3),0,1),dateDelta:10*gC*12,getLabel:e=>wC(e,{year:"numeric"})},{id:"Yearly",getStart:e=>new Date(e.getFullYear(),0,1),dateDelta:12*gC,getLabel:e=>wC(e,{year:"numeric"})},{id:"Quarter Yearly",getStart:e=>new Date(e.getFullYear(),0,1),dateDelta:3*gC,getLabel:e=>wC(e,{month:"short"})},{id:"Monthly",getStart:e=>new Date(e.getFullYear(),e.getMonth(),1),dateDelta:gC,getLabel:e=>wC(e,{month:"short"})},{id:"Weekly",getStart:e=>new Date(e.getFullYear(),e.getMonth(),1),dateDelta:7*mC,getLabel:e=>wC(e,{day:"numeric"})},{id:"Daily",dateDelta:mC,getStart:e=>new Date(e.getFullYear(),e.getMonth(),e.getDate()),getLabel:e=>wC(e,{day:"numeric"})},{id:"Quarter Daily",dateDelta:mC/4,getStart:e=>new Date(e.getFullYear(),e.getMonth(),e.getDate()),getLabel:e=>wC(e,{hour:"2-digit",minute:"2-digit"})},{id:"Hourly",dateDelta:fC,getStart:e=>new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()),getLabel:e=>wC(e,{hour:"2-digit",minute:"2-digit"})},{id:"Quarter Hourly",dateDelta:9e5,getStart:e=>new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()),getLabel:e=>wC(e,{hour:"2-digit",minute:"2-digit"})},{id:"5 Minute",dateDelta:3e5,getStart:e=>new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()),getLabel:e=>wC(e,{hour:"2-digit",minute:"2-digit"})},{id:"Minute",dateDelta:pC,getStart:e=>new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()),getLabel:e=>wC(e,{hour:"2-digit",minute:"2-digit"})},{id:"Quarter Minute",dateDelta:15e3,getStart:e=>((e=new Date(+e)).setSeconds(0),new Date(+e)),getLabel:e=>wC(e,{hour:"2-digit",minute:"2-digit",second:"2-digit"})},{id:"Second",dateDelta:hC,getStart:e=>((e=new Date(+e)).setSeconds(0),new Date(+e)),getLabel:e=>wC(e,{hour:"2-digit",minute:"2-digit",second:"2-digit"})},{id:"250 Millisecond",dateDelta:250,getStart:e=>{const t=(e=new Date(+e)).getMilliseconds();return e.setMilliseconds(IC(t,250,750)),new Date(+e)},getLabel:e=>wC(e,{hour:"2-digit",minute:"2-digit",second:"2-digit"})+"."+e.toISOString().slice(20,-1)},{id:"100 Millisecond",dateDelta:100,getStart:e=>{const t=(e=new Date(+e)).getMilliseconds();return e.setMilliseconds(IC(t,100,900)),new Date(+e)},getLabel:e=>wC(e,{hour:"2-digit",minute:"2-digit",second:"2-digit"})+"."+e.toISOString().slice(20,-1)},{id:"10 Millisecond",dateDelta:10,getStart:e=>{const t=(e=new Date(+e)).getMilliseconds();return e.setMilliseconds(IC(t,10,900)),new Date(+e)},getLabel:e=>wC(e,{hour:"2-digit",minute:"2-digit",second:"2-digit"})+"."+e.toISOString().slice(20,-1)},{id:"Millisecond",dateDelta:1,getStart:e=>{const t=(e=new Date(+e)).getMilliseconds();return e.setMilliseconds(IC(t,1,999)),new Date(+e)},getLabel:e=>wC(e,{hour:"2-digit",minute:"2-digit",second:"2-digit"})+"."+e.toISOString().slice(20,-1)}],m={type:"text",font:"12px Arial",fillStyle:"black",textAlign:"center"};if(Number.isFinite(+t)&&+t==+n){const e=wC(t,{hour:"2-digit",minute:"2-digit",second:"2-digit"}),n=wC(t,{year:"numeric",month:"2-digit",day:"2-digit"});return[{...m,font:"16px Arial",id:"t1",text:e,coords:[i(+t),o-28]},{...m,font:"600 14px Arial",id:"t2",text:n,coords:[i(+t),o-10]}]}let g=f.map((e=>{const n=e.getStart(new Date(+t)),r=new Date(+n+e.dateDelta),s=new Date(+r+e.dateDelta),o=a(d({text:e.getLabel(new Date(2001,1,1))})).width,c=l(i(+r),0)[0],u=l(i(+s),0)[0]-c-o;return{inc:e,spacing:u,diffFromIdeal:Math.abs(u-h)}}));if(g=g.filter((e=>e.spacing>p)),!g.length)return[];const y=g.sort(((e,t)=>e.diffFromIdeal-t.diffFromIdeal))[0].inc;let v=y.getStart(t);do{let e=+v;c.push({v:e,x:i(e),label:y.getLabel(v)}),v=new Date(+v+y.dateDelta)}while(v&&+v<+n);const b=o-20,w=o-5;let x=d({id:"lt",textAlign:"start",text:wC(t,{month:"short"}),coords:[r,b]}),_=d({id:"lb",textAlign:"start",text:wC(t,{year:"numeric"}),font:"600 14px Arial",coords:[r,w]}),E=d({id:"lt",textAlign:"end",text:wC(n,{month:"short"}),coords:[s,b]}),S=d({id:"lb",textAlign:"end",text:wC(n,{year:"numeric"}),font:"600 14px Arial",coords:[s,w]});void 0!==u.seconds&&u.seconds<10?(x.text=wC(t,{hour:"2-digit",minute:"2-digit",second:"2-digit"})+"."+t.getMilliseconds(),E.text=wC(n,{hour:"2-digit",minute:"2-digit",second:"2-digit"})+"."+n.getMilliseconds(),_.text=`${t.getDate()} ${wC(t,{month:"short"})} ${t.getFullYear()}`,S.text=`${n.getDate()} ${wC(n,{month:"short"})} ${n.getFullYear()}`):void 0!==u.days&&u.days<3&&(x.text=`${t.getDate()} ${x.text}`,E.text=`${n.getDate()} ${E.text}`);const C=Math.max(a(x).width,a(_).width)+10,T=Math.max(a(E).width,a(S).width)+10,A=Math.max(l(r,0)[0]+C),k=Math.max(l(s,0)[0]-T);return[x,_,...c.map(((e,t)=>({id:"midTicks"+t,...m,text:e.label,coords:[e.x,o-10]}))).filter((e=>{const t=l(e.coords[0],0)[0],n=a(e).width;return t-n/2>A&&t+n/2<k})),E,S]}({leftDate:new Date(h.invert(i)),rightDate:new Date(h.invert(o)),leftX:i,rightX:o,getX:h,height:a,measureText:this.chart.measureText,getScreenXY:this.chart.getScreenXY}),v=function(e){const{min:t,max:n,steps:i}=e;let r=[],s=DC(t,n);const o=(n-t)/i,a=1/i*o;let l=DC(o-a,o+a);r=[s];for(;r[0]-l>t;)r=[r[0]-l,...r];for(;r[r.length-1]+l<n;)r=[...r,r[r.length-1]+l];return r}({min:m,max:g,steps:6}).map(((e,t)=>({id:`y${t}`,text:`${gT(e,1)}`,type:"text",coords:[s,Math.round(p(e))],fillStyle:"black",background:{fillStyle:"white"},font:"14px Arial "})));return[...v,...y]};this.chart.render([...this.mainShapes,e,...this.tooltipShapes])}}render(){const{className:e="",style:n={}}=this.props,i=e=>{if(e){const t=e.currentTarget.getBoundingClientRect();this.setData({xCursor:e.clientX-t.x,yCursor:e.clientY-t.y})}else this.setData({xCursor:void 0,yCursor:void 0})};return t.createElement("div",{ref:e=>{e&&(this.ref=e)},style:n,className:"charts-comp flex-col f-1 h-fit min-h-0 min-w-0 relative bg-white noselect "+e,onPointerMove:i,onPointerUp:i,onPointerCancel:()=>{i()}},t.createElement("canvas",{ref:e=>{e&&(this.canv=e)},className:"f-1 noselect"}))}}class CanvasChart{constructor(e){this.currViewStateValid=!1,this.shapes=[],this.view={xScale:1,yScale:1,xO:0,yO:0},this.getDataXY=(e,t)=>{const{view:{xScale:n,yScale:i,xO:r,yO:s}}=this;return[(e-r)/n,(t-s)/i]},this.getScreenXY=(e,t)=>{const{view:{xScale:n,yScale:i,xO:r,yO:s}}=this;let o;return void 0!==t&&(o=t*i+s),[e*n+r,o]},this.getExtent=()=>{const{w:e,h:t}=this.getWH(),[n,i]=this.getDataXY(0,0),[r,s]=this.getDataXY(e,t);return{leftX:n,topY:i,rightX:r,bottomY:s,...this.view}},this.measureText=e=>{var t;const{ctx:n}=this;if(!n)throw"No ctx";n.fillStyle=e.fillStyle,n.textAlign=null!==(t=e.textAlign)&&void 0!==t?t:n.textAlign,n.font=e.font;let i=n.measureText(e.text),r=i.fontBoundingBoxAscent+i.fontBoundingBoxDescent,s=i.actualBoundingBoxAscent+i.actualBoundingBoxDescent;return{width:i.width,fontHeight:r,actualHeight:s}},this.rawShapes=[],this.opts=e;const{node:t,canvas:n,events:i}=e;this.init();new ResizeObserver((e=>{if(this.ctx){const{offsetHeight:e,offsetWidth:i}=t;vC(n,i,e),this.render()}})).observe(t);let r=null;PC(t,{onPanStart:(e,t)=>{r={...this.view},i&&i.onPanStart&&i.onPanStart(e,t)},onPan:(e,t)=>{r&&(this.setView({...this.view,xO:r.xO+e.xDiff,yO:r.yO+e.yDiff}),n.style.cursor="move",i&&i.onPan&&i.onPan(e,t))},onPanEnd:(e,t)=>{n.style.cursor="default",i&&i.onPanEnd&&i.onPanEnd(e,t)},onDoubleTap:({x:e,y:t})=>{const n=this.view.xScale*Math.sign(1)*2,i=this.view.yScale*Math.sign(1)*2,r=CanvasChart.clampScale(this.view.xScale+n),s=CanvasChart.clampScale(this.view.yScale+i),o=r/this.view.xScale,a=s/this.view.yScale,l=e-o*(e-this.view.xO),c=t-a*(t-this.view.yO);this.setView({...this.view,xScale:r,yScale:s,xO:l,yO:c})},onSinglePinch:({delta:e,x:t,y:n,w:i,h:r})=>{const s=this.view.xScale*Math.sign(e)*.1,o=this.view.yScale*Math.sign(e)*.1,a=CanvasChart.clampScale(this.view.xScale+s),l=CanvasChart.clampScale(this.view.yScale+o),c=a/this.view.xScale,u=l/this.view.yScale,d=t-c*(t-this.view.xO),h=n-u*(n-this.view.yO);this.setView({...this.view,xScale:a,yScale:l,xO:d,yO:h})}})}static clampScale(e){return Math.min(122e5,Math.max(1e-6,e))}setView(e){var t;if(!this.opts)throw"No opts";const{yScaleLocked:n=!1,yPanLocked:i=!1,minXScale:r,maxXScale:s,events:o}=this.opts,a={...this.view};this.view={...this.view,...e},n&&(this.view.yScale=1),i&&(this.view.yO=a.yO),("number"==typeof r&&this.view.xScale<r||"number"==typeof s&&this.view.xScale>s)&&(this.view.xO=a.xO,this.view.xScale=a.xScale),null===(t=null==o?void 0:o.onExtentChange)||void 0===t||t.call(o,{...this.getExtent()}),JSON.stringify(this.view)!==JSON.stringify(a)&&this.render(this.rawShapes)}init(){if(!this.opts)return;const{node:e,canvas:t}=this.opts,{w:n,h:i}=this.getWH();this.ctx=t.getContext("2d"),this.ctx.canvas.width=n,this.ctx.canvas.height=i,vC(t,e.offsetWidth,e.offsetHeight),this.ctx.imageSmoothingEnabled=!0,e.onwheel=t=>{t.preventDefault(),t.preventDefault();let{xScale:n,yScale:i,xO:r,yO:s}=this.view;const o=e.getBoundingClientRect(),a=t.pageX-o.left,l=t.pageY-o.top,c=function(e){var t=0,n=0,i=0,r=0;"detail"in e&&(n=e.detail);"wheelDelta"in e&&(n=-e.wheelDelta/120);"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120);"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120);"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=n,n=0);i=10*t,r=10*n,"deltaY"in e&&(r=e.deltaY);"deltaX"in e&&(i=e.deltaX);(i||r)&&e.deltaMode&&(1==e.deltaMode?(i*=40,r*=40):(i*=RC,r*=RC));i&&!t&&(t=i<1?-1:1);r&&!n&&(n=r<1?-1:1);return{spinX:t,spinY:n,pixelX:i,pixelY:r}}(t),u=c.pixelY,d=c.pixelX,h=(p=u,.004*Math.abs(p));var p;let f=i*Math.exp(-Math.sign(u)*h),m=n*Math.exp(-Math.sign(u)*h);m=CanvasChart.clampScale(m),f=CanvasChart.clampScale(f);r=-d+a-m/n*(a-r),s=l-f/i*(l-s),this.setView({xO:r,yO:s,yScale:f,xScale:m})}}getWH(){const{canvas:e}=this.opts;return{w:e.offsetWidth,h:e.offsetHeight}}parseData(e){let t=[];const n=this.getExtent();return e.map((e=>{"function"==typeof e?t=t.concat(e(n)):t.push(e)})),t}render(e){let t=[];e?(this.rawShapes=[...e],t=this.parseData(e),this.shapes=t):this.shapes&&(t=[...this.shapes]);const{w:n,h:i}=this.getWH(),{ctx:r}=this;r&&(r.clearRect(0,0,n,i),t.map((e=>{var t,n;const i=e=>{if(Array.isArray(e[0]))return e.map((e=>i(e)));const t=e,[n,r]=this.getScreenXY(t[0],t[1]);return[n,r]},s=i(e.coords);if(s)if(r.lineJoin="bevel","rectangle"===e.type)r.fillStyle=e.fillStyle,r.lineWidth=e.lineWidth,r.strokeStyle=e.strokeStyle,e.borderRadius?OC(r,s[0],s[1],e.w,e.h,e.borderRadius):(r.beginPath(),r.rect(s[0],s[1],e.w,e.h)),r.fill(),r.stroke();else if("circle"===e.type)r.fillStyle=e.fillStyle,r.lineWidth=e.lineWidth,r.strokeStyle=e.strokeStyle,r.beginPath(),r.arc(s[0],s[1],e.r,0,2*Math.PI),r.fill(),r.stroke();else if("multiline"===e.type)r.lineWidth=e.lineWidth,r.strokeStyle=e.strokeStyle,s.map((([e,t],n)=>{n?r.lineTo(e,t):(r.beginPath(),r.moveTo(e,t))})),r.stroke();else if("polygon"===e.type)r.fillStyle=e.fillStyle,r.lineWidth=e.lineWidth,r.strokeStyle=e.strokeStyle,r.beginPath(),s.map((([e,t],n)=>{n?r.lineTo(e,t):(r.beginPath(),r.moveTo(e,t))})),r.closePath(),r.stroke(),r.fill();else{if("text"!==e.type)throw"Unexpected shape type: "+e.type;{const{textAlign:i="start"}=e;if(e.background){function o(e){return!(!e||e.toLowerCase()!==e)}const a=this.measureText(e),l=e.background.padding||6;r.fillStyle=null!==(t=e.background.fillStyle)&&void 0!==t?t:r.fillStyle,e.background.strokeStyle&&(r.strokeStyle=e.background.strokeStyle),r.lineWidth=null!==(n=e.background.lineWidth)&&void 0!==n?n:r.lineWidth;let c=s[0]-a.width/2-l,u=s[1]-(o(e.text),1*a.actualHeight)-l;["left","start"].includes(i)?c=s[0]-l:["right","end"].includes(i)&&(c=s[0]-a.width-l),OC(r,c,u,a.width+2*l,a.actualHeight+2*l,e.background.borderRadius||0),r.closePath(),e.background.strokeStyle&&r.stroke(),r.fill()}r.fillStyle=e.fillStyle,r.textAlign=i,r.font=e.font,r.fillText(e.text,s[0],s[1])}}})))}}class Chart extends RTComp{constructor(){super(...arguments),this.d={xCursor:null,yCursor:null},this.panning=!1}onMount(){const{setRef:e,onExtentChange:t}=this.props;this.ref&&this.canv&&(this.chart=new CanvasChart({node:this.ref,canvas:this.canv,yScaleLocked:!0,yPanLocked:!0,minXScale:1,events:{onExtentChange:e=>{null==t||t(e),this.setData({extent:e})},onPan:()=>{this.panning=!0},onPanEnd:()=>{this.panning=!1}}}),e(this.chart))}render(){const{className:e="",style:n={}}=this.props;return t.createElement("div",{ref:e=>{e&&(this.ref=e)},style:n,className:"charts-comp flex-col f-1 min-h-0 min-w-0 relative "+e,onMouseMove:e=>{const t=e.currentTarget.getBoundingClientRect();this.setData({xCursor:e.clientX-t.x,yCursor:e.clientY-t.y})},onMouseOut:()=>{this.setData({xCursor:null,yCursor:null})}},t.createElement("canvas",{ref:e=>{e&&(this.canv=e)},className:"f-1"}))}}let EC,SC,CC,TC,AC=!1,kC=[],NC=null,MC=null;function PC(e,t){const n=t=>{var n,i;if(SC=kC.find((e=>e.node.contains(t.target))),!SC)return;if(TC={ev:t,started:Date.now()},t.button&&"touch"!==t.pointerType)return;null===(i=(n=SC.events).onPress)||void 0===i||i.call(n,t),t.preventDefault(),t.stopPropagation();const r=e.getBoundingClientRect(),{clientX:s,clientY:o}=t,[a,l]=[s,o],[c,u]=[r.x,r.y],d=s-c,h=o-u,p=s-r.left,f=o-r.top,[m,g]=[0,0],[y,v]=[0,0];NC={node:e,x:s,y:o,xStart:a,yStart:l,xNode:d,yNode:h,xNodeStart:p,yNodeStart:f,xDiff:m,yDiff:g,xOffset:c,yOffset:u,xTravel:y,yTravel:v,triggered:!1}},i=t=>{var n;if(!SC)return;const{onSinglePinch:i,onDoubleTap:r,onRelease:s,onPanEnd:o}=SC.events;if(i||r)if(r&&CC&&CC.duration<200&&Date.now()-CC.ended<400){const n=e.getBoundingClientRect();r({x:t.clientX-n.x,y:t.clientY-n.y}),CC=void 0}else CC={duration:Date.now()-(null!==(n=null==TC?void 0:TC.started)&&void 0!==n?n:0),ended:Date.now()};null==s||s(t),NC&&NC.triggered&&MC&&(t.preventDefault(),null==o||o({...MC},t),SC=void 0,EC=void 0),NC=null},r=t=>{if(!SC||!TC)return;const{onSinglePinch:n,onPinch:i,onPanStart:r,onPan:s,threshold:o=15}=SC.events;if(n&&EC&&CC&&NC&&((null==TC?void 0:TC.onSinglePinch)||CC.duration<200&&Date.now()-CC.ended<400)){TC.onSinglePinch=!0,t.preventDefault(),t.stopPropagation();const i=e.getBoundingClientRect(),r=Math.hypot(t.clientX-EC.clientX,t.clientY-EC.clientY);n({x:TC.ev.clientX-i.x,y:TC.ev.clientY-i.y,w:i.width,h:i.height,totalDelta:Math.hypot(t.clientX-TC.ev.clientX,t.clientY-TC.ev.clientY),delta:(t.clientY<EC.clientY?1:-1)*r,goingUp:t.clientY<EC.clientY}),cC(15)}else if(NC){t.preventDefault(),t.stopPropagation();const{xOffset:e,yOffset:n,xStart:i,yStart:a,xDiff:l,yDiff:c,xTravel:u,yTravel:d}=NC,{clientX:h,clientY:p}=t;MC={...NC,x:h,y:p,xNode:h-e,yNode:p-n,xDiff:h-i,yDiff:p-a},MC.xTravel=u+Math.abs(MC.xDiff),MC.yTravel=d+Math.abs(MC.yDiff),!NC.triggered&&(MC.xTravel>=o||MC.yTravel>o)?(NC.triggered=!0,null==r||r({...MC},t)):NC.triggered&&(null==s||s({...MC},t))}EC=t};e.style.touchAction="none",AC||(AC=!0,window.document.body.style.touchAction="none",window.document.documentElement.style.overscrollBehavior="none",LC(window.document.body,"pointerup",i),LC(window.document.body,"pointermove",r));let s=LC(e,"pointerdown",n);return kC.push({node:e,events:t,handlers:{_onPress:n,_onRelease:i,onMove:r}}),function(){s(),kC=kC.filter((n=>n.events.onPan!==t.onPan&&n.node!==e))}}function LC(e,t,n){const i=function(r){e.isConnected?n(r):e.removeEventListener(t,i)};return e.removeEventListener(t,i),e.addEventListener(t,i,{passive:!1}),function(){e.removeEventListener(t,i)}}function OC(e,t,n,i,r,s){if(void 0===s&&(s=5),"number"==typeof s)s={tl:s,tr:s,br:s,bl:s};else{var o={tl:0,tr:0,br:0,bl:0};for(var a in o)s[a]=s[a]||o[a]}e.beginPath(),e.moveTo(t+s.tl,n),e.lineTo(t+i-s.tr,n),e.quadraticCurveTo(t+i,n,t+i,n+s.tr),e.lineTo(t+i,n+r-s.br),e.quadraticCurveTo(t+i,n+r,t+i-s.br,n+r),e.lineTo(t+s.bl,n+r),e.quadraticCurveTo(t,n+r,t,n+r-s.bl),e.lineTo(t,n+s.tl),e.quadraticCurveTo(t,n,t+s.tl,n),e.closePath()}var RC=800;function IC(e,t,n){return Math.min(n,Math.ceil(e/t)*t)}function DC(e,t){const n=t+"";let i=t;const r=n=>{let i=Number(n.split("").concat("0").join("")),r=Number(n.split("").concat("5").join(""));const s=Number(n.split("").slice(0,-1).pop());return[i,r,Number(n.split("").slice(0,-1).concat([""+(s-1)]).join("")+"0")].find((n=>Number.isFinite(n)&&n>=e&&n<=t))};for(let e=n.length;e>=0;e--){const t=r(n.slice(0,e));void 0!==t&&(i=t)}return i}const FC=[5,10,15,20,25,50,100,200];class Table extends t.Component{constructor(){super(...arguments),this.state={}}static parseCell(e,n=100,i){let r,s;return"string"==typeof e?s=cT(e,n):"number"==typeof e?s=e.toString():null===e?(s="NULL",r=t.createElement("i",{className:"text-gray-300"},"NULL")):s=void 0===e?"":e&&Array.isArray(e)?cT(`[${e.map((e=>Table.parseCell(e))).join(", \n")}]`,n):e&&"function"==typeof e.toISOString?e.toISOString():e&&"[object Object]"===Object.prototype.toString.call(e)?cT(JSON.stringify(e,null,2),n):e&&e.toString?cT(e.toString(),n):`${e}`,i?s:r||s}render(){var e,n;const{rows:i=[],cols:r=[],whiteHeader:s=!1,onSort:o,sort:a=[],onRowClick:l,onRowHover:c,tableStyle:u={},maxCharsPerCell:d=100,maxRowsPerPage:h=200,pagination:p,activeRowIndex:f=-1,bodyClass:m="",activeRowStyle:g={},className:y="",rowClass:v="",rowStyle:b={},maxRowHeight:w,onColumnReorder:x}=this.props,{draggedCol:_}=this.state;let E=r.filter((e=>!e.hidden)),{page:S=1,pageSize:C=15}=p||{};C=zC(C||25,FC)||25;let T=i.map((e=>({...e})));p&&!p.onPageChange&&(T=T.slice(S,(S+1)*C)),T.length>h&&(console.warn("Exceeded maxRowsPerPage"),T=T.slice(0,h));let A=[];Array.isArray(a)&&(A=a.map((e=>({...e}))));const k=(e,t)=>{let n=e.width?{flex:"none",width:`${e.width}px`}:{flex:1};return void 0!==t&&(null==_?void 0:_.idx)===t&&(n.opacity=.5),void 0!==t&&(null==_?void 0:_.targetIdx)===t&&(n.transition=".3s all",n.paddingLeft="2em",n.background="var(--blue-100)"),n};return t.createElement("div",{className:"table-component o-auto flex-col f-1 min-h-0 min-w-0 "+y,ref:e=>{e&&(this.ref=e)}},t.createElement("div",{role:"table",className:"min-w-fit min-h-0 b border-gray-200 flex-col h-full bg-white ",style:u},t.createElement("div",{role:"row",className:"noselect f-0 flex-row shadow bg-gray-50",onWheel:e=>{var t;function n(e){return e&&e.scrollWidth>e.clientWidth}let i,r=5,s=null===(t=e.currentTarget.parentElement)||void 0===t?void 0:t.closest(".table-component");for(;r>0;)n(s)?(i=s,r=0):(s=null==s?void 0:s.parentElement,r--);i&&(i.scrollLeft-=e.nativeEvent.wheelDeltaY||-e.deltaY)}},E.map(((e,n)=>{let i=null==A?void 0:A.find((t=>t.key===e.key)),r="flex-col h-full min-w-0 px-p5 py-p5 text-left text-xs leading-4 relative  font-medium text-gray-500 uppercase tracking-wider to-ellipsis"+(o&&e.sortable?" pointer ":"")+(s?" ":" bg-gray-50  ")+(e.onContextMenu?" contextmenu ":"")+(e.width?" f-0 ":" f-1 ");return t.createElement("div",{key:n,className:r,...e.onContextMenu?BC():{},onContextMenu:e.onContextMenu?t=>{if(e.onContextMenu&&!t.currentTarget.classList.contains("resizing-ew"))return cC(25),e.onContextMenu(t,t.nativeEvent.target,e)}:void 0,role:"columnheader",style:{...k(e,n),borderRight:"1px solid var(--gray-100)"},draggable:!0,onDragStart:x?t=>{t.dataTransfer.setData("text/plain",e.key+""),this.setState({draggedCol:{idx:n,node:t.currentTarget}})}:void 0,onDragOver:x?e=>(_&&_.idx!==n&&_.targetIdx!==n&&this.setState({draggedCol:{..._,targetIdx:n}}),e.preventDefault(),!1):void 0,onDragLeave:x?e=>{e.target===e.currentTarget&&this.setState({draggedCol:{..._,targetIdx:void 0}})}:void 0,onDragEnd:x?e=>{this.setState({draggedCol:void 0})}:void 0,onDrop:x?t=>{if(_&&_.idx!==n){let t=E.slice(0),n=t[_.idx],i=e;x(t.map((e=>e.key===n.key?i:e.key===i.key?n:e)))}this.setState({draggedCol:void 0})}:void 0,onClick:o&&e.sortable?t=>{t.button||t.target.classList.contains("resize-handle")||(i?i.asc?i.asc=!1:i=void 0:i={key:e.key,asc:!0},o((t.shiftKey?A.filter((t=>t.key!==e.key)):[]).concat(i?[i]:[])))}:void 0},t.createElement("div",{className:"flex-row fs-1 h-fit "+(e.sortable?"boolean"!=typeof(null==i?void 0:i.asc)?" sort-none ":[!1].includes(i.asc)?"sort-desc":"sort-asc":"")+(e.headerClassname||"")},t.createElement("div",{className:"flex-col min-w-0 f-shrink"},t.createElement("div",{className:"table-column-label text-ellipsis ",title:"string"==typeof e.label?e.label:void 0},e.label),void 0!==e.subLabel&&this.props.showSubLabel?t.createElement("div",{className:"table-column-sublabel text-gray-400 mt-p25 font-normal ws-nowrap text-ellipsis ",title:e.subLabelTitle},e.subLabel):null)),n<=E.length-1?t.createElement(Pan,{className:"resize-handle noselect",style:{position:"absolute",right:0,top:0,bottom:0,width:"30px",cursor:"ew-resize",marginRight:n===E.length-1?0:"-15px"},onDoubleTap:e=>{var t;const i=null===(t=this.ref)||void 0===t?void 0:t.querySelector('[role="rowgroup"]');console.log("resize to fit content please",n,i)},threshold:0,onPanStart:(e,t)=>{const n=e.node.closest('[role="columnheader"]');n&&(e.node._w=n.offsetWidth)},onPan:(e,t)=>{var i;const r=e.node.closest('[role="columnheader"]');if(r){const{xDiff:t}=e,s=Math.max(30,e.node._w+t);r.style.width=`${s}px`,r.style.flex="none";const o=null===(i=this.ref)||void 0===i?void 0:i.querySelector('[role="rowgroup"]'),a=null==o?void 0:o.querySelectorAll(`[role="row"] > *:nth-child(${n+1})`);null==a||a.forEach((e=>{e.style.width=`${s}px`,e.style.flex="none"}))}},onPanEnd:(t,n)=>{const i=t.node.closest('[role="columnheader"]');i&&e.onResize&&e.onResize(i.offsetWidth)},onPress:e=>{var t,n;const i=null===(n=null===(t=e.target)||void 0===t?void 0:t.closest)||void 0===n?void 0:n.call(t,'[role="columnheader"]');i&&(i.classList.toggle("resizing-ew",!0),cC(15),e.preventDefault(),e.stopPropagation())},onRelease:e=>{var t,n;const i=null===(n=null===(t=e.target)||void 0===t?void 0:t.closest)||void 0===n?void 0:n.call(t,'[role="columnheader"]');i&&i.classList.toggle("resizing-ew",!1)}}):null)}))),t.createElement("div",{className:"b-y border-gray-200 f-1 oy-auto ox-hidden no-scroll-bar flex-col min-w-fit "+m,role:"rowgroup",onPointerUp:l?e=>{e.target===e.currentTarget&&l(void 0,e)}:void 0},T.length?T.map(((e,n)=>t.createElement("div",{key:n+" "+Date.now(),role:"row",className:"d-row flex-row f-0 "+(v||" ")+(c?" hover ":""),style:{...f===n?g:{},...b,maxHeight:`${w||100}px`},onClick:l?t=>{var n;t.currentTarget.contains(t.target)&&!(null===(n=window.getSelection())||void 0===n?void 0:n.toString().trim())&&l(e,t)}:void 0},E.map(((i,r)=>{var s;if(i.onRenderNode)return i.onRenderNode(e,e[i.key]);const o=Table.parseCell(e[i.key],d,!0),a=i.onRender?null:Table.parseCell(e[i.key],d);return t.createElement("div",{key:r,className:(n<T.length-1?"bt":"bt bb")+" text-sm leading-5 text-gray-500 o-auto no-scroll-bar ta-left br b-gray-100 "+(i.className||"")+(i.blur?" blur ":" ")+(i.width?" f-0 ":" f-1 ")+(i.onClick?"  ":" p-p5 "),style:{...k(i),...(null===(s=i.getCellStyle)||void 0===s?void 0:s.call(i,e,e[i.key],o))||{}},role:"cell",title:o},i.onClick?t.createElement(Btn,{onClick:t=>{i.onClick&&i.onClick(e,i,t)},className:"text-indigo-600 hover:text-indigo-900 h-fit w-fit b-gray-400"},a):i.onRender?i.onRender(e,e[i.key],o):a)}))))):t.createElement("div",{className:"text-gray-300 p-2 noselect"},"No data"),p?t.createElement(Pagination,{...this.props.pagination,totalRows:null!==(n=null===(e=this.props.pagination)||void 0===e?void 0:e.totalRows)&&void 0!==n?n:i.length}):null)))}}class Pagination extends t.Component{render(){const{onPageChange:e,page:n=1,onPageSizeChange:i,pageSize:r=FC[0],totalRows:s}=this.props,o=t=>{n!==t&&(null==e||e(t))};let a=0;return s&&(a=Math.floor(s/r)),a?t.createElement("div",{className:"flex-row p-p5 mt-auto ai-center"},t.createElement(Btn,{iconPath:"M18.41,16.59L13.82,12L18.41,7.41L17,6L11,12L17,18L18.41,16.59M6,6H8V18H6V6Z",disabledInfo:1===n?"Already at first page":void 0,onClick:e=>{o(1)}}),t.createElement(Btn,{iconPath:Ce,disabledInfo:1===n?"Already at first page":void 0,onClick:e=>{o(Math.max(1,n-1))}}),t.createElement("input",{type:"number",key:Date.now(),className:"h-fit min-w-0 p-p5",style:{width:`${(n||0).toString().length+5}ch`},value:n,onChange:e=>{let t=+e.target.value;t>0&&t<=a&&o(t)}}),t.createElement(Btn,{iconPath:Te,disabledInfo:n===a?"Already at last page":void 0,onClick:e=>{o(Math.min(a,n+1))}}),t.createElement(Btn,{iconPath:"M5.59,7.41L10.18,12L5.59,16.59L7,18L13,12L7,6L5.59,7.41M16,6H18V18H16V6Z",disabledInfo:n===a?"Already at last page":void 0,onClick:e=>{o(a)}}),i?t.createElement(FormField,{title:"Page size",asColumn:!0,value:r,options:FC.map((e=>`${e}`)),onChange:e=>{i(+e)}}):null,t.createElement("div",{className:"text-gray-400 text-sm p-p5 noselect"},(+a).toLocaleString()," pages ",` (${(+(null!=s?s:0)).toLocaleString()} rows)`)):null}}function BC(){const e=e=>{if(window.isIOSDevice){const t=e.currentTarget;t._isPressed&&clearTimeout(t._isPressed),t._isPressed=null}};return{onTouchStart:e=>{if(window.isIOSDevice){const t=e.currentTarget;e.preventDefault(),t._isPressed=setTimeout((()=>{if(t._isPressed){var e=new MouseEvent("contextmenu",{bubbles:!0,cancelable:!1,view:window,button:2,buttons:0,clientX:t.getBoundingClientRect().x,clientY:t.getBoundingClientRect().y});t.dispatchEvent(e)}}),500)}},onTouchMove:e,onTouchEnd:e}}class Pan extends t.Component{constructor(){super(...arguments),this.setListeners=()=>{this.ref&&PC(this.ref,{onPanStart:this.props.onPanStart,onPan:this.props.onPan,onPanEnd:this.props.onPanEnd,onRelease:this.props.onRelease,onPress:this.props.onPress,threshold:this.props.threshold,onDoubleTap:this.props.onDoubleTap})}}componentDidMount(){this.setListeners()}render(){const{style:e={},className:n="",children:i}=this.props;return t.createElement("div",{ref:e=>{e&&(this.ref=e)},style:e,className:n},i)}}function zC(e,t){var n;return null===(n=t.map((t=>({av:t,diff:Math.abs(e-t)}))).sort(((e,t)=>e.diff-t.diff))[0])||void 0===n?void 0:n.av}var jC=n(4926);const VC=[{key:"BOOLEAN"},{key:"DATE"},{key:"DECIMAL (4,4)"},{key:"FLOAT"},{key:"GEOMETRY"},{key:"INTEGER"},{key:"JSON"},{key:"JSONB"},{key:"NUMERIC"},{key:"TEXT"},{key:"TIME"},{key:"TIMESTAMP"},{key:"TIMESTAMPZ"},{key:"TSVECTOR"},{key:"UUID"}],UC={name:"Rename",type:"Data type",foreign:"Foreign key",primary:"Primary key",drop:"Drop"};class AlterColumn extends t.Component{constructor(){super(...arguments),this.state={action:UC.name,newName:void 0,query:"",error:"",hint:"",field:"",editableQuery:!0,running:!1,onSuccess:()=>{}}}componentDidMount(){}getQuery(){}render(){const{tableName:e,db:n}=this.props;let i=this.state.field||this.props.field;const{newName:r,query:s="",editableQuery:o=!0,error:a,hint:l,running:c,onSuccess:u,action:d,dataType:h}=this.state,p=Object.values(UC).reduce(((e,t)=>({...e,[t]:{}})),{});return t.createElement("div",{className:window.isMobileDevice?" flex-col ":"flex-row ",style:{}},t.createElement(Tabs,{variant:"vertical",compactMode:!!window.isMobileDevice,onChange:t=>{const n=JSON.stringify(e),r=JSON.stringify(i),s=t===UC.drop?`\n-DROP COLUMN ${r} `:t===UC.foreign?`\nADD FOREIGN KEY (${r}) \nREFERENCES other_table ( other_column );`:t===UC.primary?`\nADD PRIMARY KEY (${r}) \n`:"";let o="";s&&(o+=`ALTER TABLE ${n} \n`+s),this.setState({action:t,query:o})},contentClass:"p-1 flex-row ai-center",items:p}),t.createElement("div",{className:"flex-col p-1 o-auto"},d?d===UC.name?t.createElement(FormField,{className:"mb-1",placeholder:"New column name",value:r,onChange:t=>{this.setState({newName:t,editableQuery:!1,query:`ALTER TABLE ${JSON.stringify(e)} \nRENAME COLUMN ${JSON.stringify(i)} \nTO ${JSON.stringify(t)} `})}}):d===UC.type?t.createElement(Select,{className:"mb-1",label:"New data type",variant:"div",value:h,fullOptions:VC,onChange:async t=>{const r=JSON.stringify(i),s=` NULLIF(${r}, '') `,o=JSON.stringify(e);let a=`USING  ${s}::${t}`;if(t.startsWith("TIMESTAMP")||"DATE"===t){a=`USING to_timestamp(${s}, 'YYYY-MM-DD HH:MI:SS')::${t}`;const e=await n.sql(`SELECT ${r} FROM ${o} WHERE  ${r} IS NOT NULL LIMIT 1`,{},{returnType:"value"});function i(e){return"string"==typeof(e+="")&&(!isNaN(e)&&!isNaN(parseFloat(e)))}if(e)if(i(e))a=`USING to_timestamp(cast(${s} as BIGINT))::${t}`;else{const n=yT(e),i=[{format:"NN NN NNNN",pg_format:"DD MM YYYY HH24:MI:SS"},{format:"NN NN NNNN NN:NN:NN",pg_format:"DD MM YYYY HH24:MI:SS"},{format:"NN NN NNNN NN:NN:NN.NNNZ",pg_format:"DD MM YYYY HH24:MI:SS.MSZ"},{format:"NNNN-NN-NN NN:NN:NN",pg_format:"YYYY-MM-DD HH24:MI:SS"},{format:"NNNN-NN-NNTNN:NN:NN",pg_format:"YYYY-MM-DDTHH24:MI:SS"},{format:"NNNN-NN-NN NN:NN:NN.NNNZ",pg_format:"YYYY-MM-DD HH24:MI:SS.MSZ"},{format:"NNNN-NN-NNTNN:NN:NN.NNNZ",pg_format:"YYYY-MM-DDTHH24:MI:SS.MSZ"}],r=i.find((e=>n.map((e=>"n"===e.type?"N".repeat(e.len):" ")).join("")===e.format));a=`USING to_timestamp(${s}, '${(null!=r?r:i[0]).pg_format}')::${t}`}"TIMESTAMPZ"===t&&(a+="at time zone 'utc'")}else t.startsWith("GEOMETRY")&&(a=`USING st_transform( \n st_setsrid( \n   st_geometryfromtext( \n        'POINT' || replace(${s}, ',', ' ')  \n   ), \n   27700 \n ), \n 4326 \n)`);this.setState({dataType:t,editableQuery:!0,query:`ALTER TABLE ${o} \nALTER COLUMN ${r} \nTYPE ${t} \n`+a})}}):null:null,s?t.createElement(t.Fragment,null,t.createElement(FormField,{className:"",value:s,asTextArea:!0,onChange:e=>{this.setState({query:e})},error:a,hint:l}),t.createElement(Btn,{style:{alignSelf:"flex-end"},className:"mt-1 ",iconPath:Ue,variant:"outline",title:"Run rename query",loading:c,onClick:async()=>{try{this.setState({running:!0}),await n.sql(s),this.setState({error:"",hint:"Success!"})}catch(e){this.setState({error:e})}this.setState({running:!1})}},"RUN")):null))}}const HC=[{key:"fixed",label:"Fixed"},{key:"fromColumn",label:"From column"},{key:"fromUrlEnding",label:"From URL extension"}],$C=[{key:"img",label:"Image"},{key:"video",label:"Video"},{key:"audio",label:"Audio"},{key:"svg",label:"SVG"},{key:"apth",label:"Path (SVG)"}],qC=[{key:"first",label:"First"},{key:"last",label:"Last"},{key:null,label:"None"}];class ColumnMenu extends RTComp{constructor(){super(...arguments),this.state={},this.d={},this.onDelta=async(e,t,n)=>{var i;const r={...e,...t,...n},{db:s,tableName:o,colName:a,tables:l}=this.props,c=this.d.w||this.props.w;if(c&&c.$cloneSync&&!this.wSub&&(this.wSub=await c.$cloneSync(((e,t)=>{this.setData({w:e},{w:t}),this.mounted&&this.forceUpdate()}))),c)if(c.columns&&Array.isArray(c.columns)){if(a&&(null===(i=null==r?void 0:r.w)||void 0===i?void 0:i.columns)){const e=ProstglesTable.getFullColumnConfig(l,c).find((e=>e.name===a));e?this.setState({column:e}):console.warn(`Column (${a}) was not found, delete?!`)}}else c.$update({columns:await TableMenu.getWCols(s[o],c,!0)})},this.onUpdate=e=>{const{w:t}=this.d,{column:n}=this.state;if(!t||!n)return;let i=t.columns.map(((t,i)=>t.name===n.name?{...t,...e}:t));t.$update({columns:i})}}render(){var e,n,i,r,s,o,a,l,c,u,d,h;const{w:p}=this.d,{column:f,l1Key:m}=this.state,{db:g,onAddFilter:y,tableName:v,onClose:b,colName:w,tables:x,showColumns:_}=this.props;if(!p||!f)return null;const E=(p.sort||[]).find((e=>e.key===f.name))||{key:f.name,asc:null},S=e=>{let t=!1,n=(p.sort||[]).map((n=>n.key===f.name?(t=!0,{...n,...e}):{...n}));null===e.asc?n=n.filter((t=>t.key!==e.key)):t||n.push(e),p.$update({sort:n})},C=x.find((e=>e.name===p.table_name)),{format:T="NONE",contentConfig:A={fromUrlEnding:!0}}=f,k="string"===(null===(e=f.info)||void 0===e?void 0:e.tsDataType)||"string"===(null===(n=f.computedConfig)||void 0===n?void 0:n.tsDataType),N=f.format&&"NONE"!==f.format||f.computedConfig;return t.createElement("div",{className:"f-1 flex-col"},t.createElement("div",{className:"f-1 flex-col p-p5 bg-gray-100 ta-left noselect"},w),t.createElement(Tabs,{compactMode:!0,variant:"vertical",contentClass:" o-auto "+("Alter"===m?" o-auto ":" p-1 "),activeKey:m,items:{Sort:{leftIconPath:"M18 21L14 17H17V7H14L18 3L22 7H19V17H22M2 19V17H12V19M2 13V11H9V13M2 7V5H6V7H2Z",style:"boolean"==typeof E.asc?{color:"var(--blue-600)"}:{},content:t.createElement("div",{className:"flex-col"},t.createElement(Select,{label:"Sort",value:!0===(null==E?void 0:E.asc)?"Ascending":!1===E.asc?"Descending":null,variant:"div",emptyLabel:"None",fullOptions:[{key:!0,label:"Ascending"},{key:!1,label:"Descending"},{key:null,label:"None"}],onChange:e=>{S({...E,asc:e})}}),"boolean"!=typeof E.asc?null:t.createElement(t.Fragment,null,t.createElement(Select,{label:"Nulls",className:"mt-1",value:(null==E?void 0:E.nulls)||null,variant:"div",fullOptions:qC,onChange:e=>{S({...E,nulls:e})}}),k&&t.createElement(FormField,{type:"checkbox",label:"Null empty text",className:"mt-1",asColumn:!0,value:E.nullEmpty,onChange:e=>{S({...E,nullEmpty:e})}})))},Style:{leftIconPath:"M19,11.5C19,11.5 17,13.67 17,15A2,2 0 0,0 19,17A2,2 0 0,0 21,15C21,13.67 19,11.5 19,11.5M5.21,10L10,5.21L14.79,10M16.56,8.94L7.62,0L6.21,1.41L8.59,3.79L3.44,8.94C2.85,9.5 2.85,10.47 3.44,11.06L8.94,16.56C9.23,16.85 9.62,17 10,17C10.38,17 10.77,16.85 11.06,16.56L16.56,11.06C17.15,10.47 17.15,9.5 16.56,8.94Z",disabledText:"Media"===f.format?"Cannot style a media format column":void 0,style:(null===(i=f.style)||void 0===i?void 0:i.type)&&"None"!==(null===(r=f.style)||void 0===r?void 0:r.type)?{color:"var(--blue-600)"}:{},content:t.createElement(StyleColumn,{column:f,onUpdate:this.onUpdate,tsDataType:(null===(s=f.info)||void 0===s?void 0:s.tsDataType)||(null===(o=f.computedConfig)||void 0===o?void 0:o.tsDataType)||"any"})},"Display format":{style:f.format?{color:"var(--blue-600)"}:{},leftIconPath:Ie,disabledText:WC(f.info||f.computedConfig).length<=1?"Only text columns can have custom formats at the moment":void 0,content:t.createElement("div",{className:"flex-col"},t.createElement(Select,{label:"Display format",value:T,variant:"div",options:WC(f.info||f.computedConfig).map((e=>e.label)),onChange:e=>{const t={format:e};"Media"!==t.format?t.contentConfig=void 0:t.contentConfig={fromUrlEnding:!0},"NONE"===t.format&&(t.format=void 0),this.onUpdate(t)}}),"HTML"===T&&t.createElement(t.Fragment,null,t.createElement(Checkbox,{className:"pt-1",checked:!Boolean(f.noSanitize),label:"Sanitize HTML. Leave unchecked if you understand the risks",onChange:e=>{this.onUpdate({noSanitize:!e.target.checked})}}),!f.noSanitize&&t.createElement(Select,{label:"Allowed tags",className:"mt-1",value:f.allowedHTMLTags||[],variant:"div",fullOptions:$C,multiSelect:!0,onChange:e=>{this.onUpdate({allowedHTMLTags:e})}})),"Media"===T&&t.createElement(t.Fragment,null,t.createElement(Select,{label:"Content type",className:"mt-1",value:null!==(l=null===(a=Object.keys(A||{}))||void 0===a?void 0:a[0])&&void 0!==l?l:"fromUrlEnding",variant:"div",fullOptions:HC,onChange:e=>{"fixed"===e?this.onUpdate({contentConfig:{fixed:"image"}}):"fromColumn"===e?this.onUpdate({contentConfig:{fromColumn:""}}):this.onUpdate({contentConfig:{fromUrlEnding:!0}})}}),"fromColumn"in A&&t.createElement(Select,{label:"Content type",className:"mt-1",value:null!==(u=null===(c=Object.keys(A||{}))||void 0===c?void 0:c[0])&&void 0!==u?u:"fixed",variant:"div",options:null!==(d=null==C?void 0:C.columns.filter((e=>e.name!==A.fromColumn&&"string"===e.tsDataType)).map((e=>e.name)))&&void 0!==d?d:[],onChange:e=>{this.onUpdate({contentConfig:{fromColumn:e}})}}),"fixed"in A&&t.createElement(Select,{label:"Content type",className:"mt-1",value:A.fixed,variant:"div",options:["image","video","audio"],onChange:e=>{this.onUpdate({contentConfig:{fixed:e}})}})))},Filter:{leftIconPath:Re,disabledText:N?"Cannot filter a computed column":void 0,style:(null===(h=p.filter)||void 0===h?void 0:h.some((e=>"fieldName"in e&&e.fieldName===f.name)))?{color:"var(--blue-600)"}:{}},Alter:{leftIconPath:"M21.71 20.29L20.29 21.71A1 1 0 0 1 18.88 21.71L7 9.85A3.81 3.81 0 0 1 6 10A4 4 0 0 1 2.22 4.7L4.76 7.24L5.29 6.71L6.71 5.29L7.24 4.76L4.7 2.22A4 4 0 0 1 10 6A3.81 3.81 0 0 1 9.85 7L21.71 18.88A1 1 0 0 1 21.71 20.29M2.29 18.88A1 1 0 0 0 2.29 20.29L3.71 21.71A1 1 0 0 0 5.12 21.71L10.59 16.25L7.76 13.42M20 2L16 4V6L13.83 8.17L15.83 10.17L18 8H20L22 4Z",disabledText:N?"Cannot alter a computed column":void 0,content:t.createElement(AlterColumn,{db:g,tableName:v,field:f.name})},Hide:{leftIconPath:Le},"Hide Others":{leftIconPath:Le},Columns:{leftIconPath:Qe},"Add Computed Column":{leftIconPath:"M11,2A2,2 0 0,1 13,4V20A2,2 0 0,1 11,22H2V2H11M4,10V14H11V10H4M4,16V20H11V16H4M4,4V8H11V4H4M15,11H18V8H20V11H23V13H20V16H18V13H15V11Z"}},onChange:async e=>{var t,n,i;if(this.d.w){if("Columns"===e||"Add Computed Column"===e)null==_||_(e);else if("Filter"===e){let e=await SmartFilter.getDefaultFilter(f,g);(null===(t=this.d.w.filter)||void 0===t?void 0:t.length)?this.d.w.$update({filter:[e,...this.d.w.filter]}):this.d.w.$update({filter:[e]}),b(),y()}else if("Hide"===e){const e=null===(n=this.d.w)||void 0===n?void 0:n.columns.map((e=>({...e,show:f.name!==e.name&&e.show})));this.d.w.$update({columns:e}),b()}else if("Hide Others"===e){const e=null===(i=this.d.w)||void 0===i?void 0:i.columns.map((e=>({...e,show:f.name===e.name})));console.log(e,this.d.w),this.d.w.$update({columns:e}),b()}this.setState({l1Key:e})}}}))}}function WC(e){if(!e)return[];let t=[{label:"Email",info:"Email link",tsDataType:"string"},{label:"Tel",info:"Telephone number link"},{label:"Media",info:"Display media (video/image/audio) from URL",tsDataType:"string"},{label:"URL",info:"Display string as a clickable URL"},{label:"HTML",info:"Display string as sanitised HTML",tsDataType:"string"},{label:"NONE",info:"Display data as is"}].filter((t=>!t.tsDataType||t.tsDataType===e.tsDataType));return t}const GC=["image","video","audio"];class MediaViewer extends RTComp{constructor(){super(...arguments),this.state={isFocused:!1,url:void 0},this.renderMedia=()=>{if(!this.state.url)return null;const{isFocused:e}=this.state,{validated:n,content_type:i}=this.state.url;let r=null;if(n){const s={style:{maxWidth:"100%",maxHeight:"100%"},className:"b b-gray-300 "};(null==i?void 0:i.startsWith("image"))?r=t.createElement("img",{loading:"lazy",src:n,...s}):(null==i?void 0:i.startsWith("video"))?r=t.createElement("video",{...s,controls:!0,src:n}):(null==i?void 0:i.startsWith("audio"))?r=t.createElement("audio",{...s,controls:!0,src:n}):!e&&n&&(r=t.createElement("a",{href:n,target:"_blank",className:"p-1 f-0"},n))}return e?r:t.createElement("div",{className:"relative f-1 noselect"},r,t.createElement("div",{className:"absolute w-full h-full pointer",style:{zIndex:1,inset:0},onClick:e=>{e.stopPropagation(),e.preventDefault(),this.setState({isFocused:!0})}}))}}static getMimeFromURL(e){var t,n;if(e&&"string"==typeof e){const i={jpg:1,jpeg:1,png:1,tiff:1,gif:1,svg:1,ico:1},r={mp3:1,wav:1},s={mp4:1,avi:1,ogg:1,webm:1,mov:1},o=null===(n=null===(t=e.split(".").slice(-1))||void 0===t?void 0:t[0])||void 0===n?void 0:n.toLowerCase();if(i[o])return"image";if(r[o])return"audio";if(s[o])return"video"}}onUnmount(){}onDelta(e){const{url:t,allowedHostnames:n}=this.props,i=async()=>{var e,n;let i;if("allowedContentTypes"in this.props||!("content_type"in this.props))if("allowedContentTypes"in this.props&&1===this.props.allowedContentTypes.length)i=this.props.allowedContentTypes[0];else{const r=await function(e){return new Promise(((t,n)=>{var i=new XMLHttpRequest;i.open("GET",e,!0),i.setRequestHeader("Range","bytes=0"),i.onreadystatechange=function(){this.readyState==this.DONE?t(this.getResponseHeader("Content-Type")):n(i.statusText)},i.send()}))}(t),s=null===(n=null===(e=null==r?void 0:r.split(";"))||void 0===e?void 0:e[0])||void 0===n?void 0:n.trim();if("allowedContentTypes"in this.props&&!this.props.allowedContentTypes.find((e=>s.startsWith(e))))throw`ContentType ${s} is not allowed. Allowed ContentTypes: ${this.props.allowedContentTypes}`;i=s}else"content_type"in this.props&&(i=this.props.content_type);const r=GC.find((e=>null==i?void 0:i.startsWith(e)));if(i&&!r)throw`ContentType prefix ${i} is not recognised/supported. Supported ContentTypes preffixes ${GC}`;this.setState({url:{raw:t,validated:t,content_type:i}})};if((null==e?void 0:e.url)&&this.rawURL!==t)if(this.rawURL=t,n)try{const e=new URL(t);if(!n.includes(e.hostname))throw`Hostname ${e.hostname} is not allowed. Allowed hostnames: ${n}`;i()}catch(e){console.error("Could check media URL",e)}else i()}render(){const{url:e,isFocused:n}=this.state,{onKeyLeft:i,onKeyRight:r}=this.props;return n?t.createElement(Popup,{open:!0,rootStyle:{padding:0},contentClassName:"o-hidden",onClose:()=>{this.setState({isFocused:!1})},title:t.createElement("a",{href:e.validated,target:"_blank",className:"p-1 f-0"},e.validated),onKeyDown:i&&r?e=>{"ArrowRight"===e.key?null==r||r():"ArrowLeft"===e.key&&(null==i||i())}:void 0},t.createElement("div",{className:"relative flex-col f-1"},this.renderMedia())):this.renderMedia()}}const YC=jC,XC=(e,t,n,i)=>({key:e,name:t,label:t,sortable:["string","number","boolean","Date"].includes(n),tsDataType:n,udt_name:"text",filter:!0,computed:i}),KC=(e,n,i,r)=>{const s={...{...XC("edit_row"," ","any",!0),filter:!1,select:!1,sortable:!1},className:"ai-center jc-center",label:t.createElement(tt(),{style:{marginLeft:"7px"},path:Ve,title:"Edit row",size:i?1:.5}),hidden:!1,width:50,getCellStyle:()=>({padding:0}),onRender:i=>t.createElement(Btn,{className:"h-full h-fit w-fit"+(window.isMobileDevice?" text-gray-300 ":" show-on-row-hover  "),title:"Edit row",iconPath:Ve,style:{padding:"12px"},onClick:async t=>{var s;if(t.stopPropagation(),!e)return;let o;const a=e.find((e=>e.is_pkey));if(a)o=[{fieldName:a.name,value:i[a.name]}];else{const t=e.filter((e=>["number","string","boolean"].includes(e.tsDataType))),n=e=>"string"==typeof e&&e.length>400?{">=":`${e.slice(0,625)}%`}:e;o=t.map((e=>({fieldName:e.name,value:n(i[e.name])})))}const l=lT(o);fT(l)||1!==await(null===(s=n.count)||void 0===s?void 0:s.call(n,l))?alert("Could not create row update filter. Your table/column selection is a missing primary key"):r(o)}})};return s};class ProstglesTable extends RTComp{constructor(){var e;super(...arguments),this.state={barchartVals:{},runningQuery:!1,sql:"",loading:!1,totalRows:0,rows:[],sort:[],joins:[],filter:{},rowCount:0,duration:0,error:"",hideTable:!0,rowDelta:null,onRowClick:null,filterPopup:!1,joinFilterStr:void 0},this.d={page:1,pageSize:null!==(e=zC(Math.round(1.2*window.innerHeight/55)||25,FC))&&void 0!==e?e:25,w:void 0,dataAge:0,wSync:void 0},this.calculatedColWidths=!1,this.loadingData=!1,this.currentDataRequestSignature="",this.getTableCols=async e=>{var n,i;let r=[];const{w:s}=this.d;if(!s)return r;const{db:o,dbs:a,tables:l}=this.props,c=s.table_name,u=l.find((e=>e.name===c)),d=null==u?void 0:u.columns;if(d){const i=e=>{var t,n;return["'",'"'].includes(null!==(t=e.at(0))&&void 0!==t?t:"")&&["'",'"'].includes(null!==(n=e.at(-1))&&void 0!==n?n:"")?e.slice(1,-1):e};r=ProstglesTable.getFullColumnConfig(l,s,e,null===(n=this.ref)||void 0===n?void 0:n.getBoundingClientRect().width).filter((e=>e.show)).map((e=>{var t,n,i,r;return{...e,tsDataType:null!==(n=null===(t=e.info||e.computedConfig)||void 0===t?void 0:t.tsDataType)&&void 0!==n?n:"any",udt_name:null!==(r=null===(i=e.info||e.computedConfig)||void 0===i?void 0:i.udt_name)&&void 0!==r?r:"text"}})).map((e=>{var n,r,u,d,h,p,f,m,g,y,v,b,w,x;return{...e,filter:null!==(r=null===(n=e.info)||void 0===n?void 0:n.filter)&&void 0!==r&&r,sortable:"json"!==(null===(u=e.info)||void 0===u?void 0:u.udt_name),computed:!!e.computedConfig,key:e.name,table:c,label:e.name+((null===(d=e.info)||void 0===d?void 0:d.references)?` (${null===(h=e.info)||void 0===h?void 0:h.references.ftable})`:""),subLabelTitle:"Data type",subLabel:t.createElement("div",{className:"flex-row ai-center"},e.computedConfig||e.format?t.createElement(tt(),{path:De,size:.75,className:"color-action ml-p25"}):null,(null===(p=e.info)||void 0===p?void 0:p.is_pkey)?t.createElement("div",{title:"Primary key",className:"flex-row ai-center"},t.createElement(tt(),{path:"M7,14A2,2 0 0,1 5,12A2,2 0 0,1 7,10A2,2 0 0,1 9,12A2,2 0 0,1 7,14M12.65,10C11.83,7.67 9.61,6 7,6A6,6 0 0,0 1,12A6,6 0 0,0 7,18C9.61,18 11.83,16.33 12.65,14H17V18H21V14H23V10H12.65Z",size:.75,className:"mr-p25"}),null===(f=e.info)||void 0===f?void 0:f.udt_name):null===(m=e.info)||void 0===m?void 0:m.udt_name,e.computedConfig&&(null!==(y=null===(g=e.computedConfig)||void 0===g?void 0:g.funcDef.outType.udt_name)&&void 0!==y?y:null===(v=e.computedConfig)||void 0===v?void 0:v.funcDef.outType.tsDataType),(null===(b=null==s?void 0:s.filter)||void 0===b?void 0:b.some((t=>"fieldName"in t&&t.fieldName===e.name&&!t.disabled)))?t.createElement(Btn,{title:"Has active filter",iconPath:Re,style:{padding:0},size:"micro",className:"color-action ml-p25",onClick:e=>{e.stopPropagation(),e.preventDefault();const t=s;t.$update({options:{showFilters:!(null==t?void 0:t.options.showFilters)}},{deepMerge:!0})}}):null),hidden:"$rowhash"===e.name,width:null!==(w=e.width)&&void 0!==w?w:100,onRender:["$duration","$age"].includes(null===(x=e.computedConfig)||void 0===x?void 0:x.funcDef.key)?t=>{var n;return Object.keys(null!==(n=t[e.name])&&void 0!==n?n:{}).map((n=>`${t[e.name][n]} ${n}`)).join(", ")}:"HTML"===e.format?n=>{var i;return t.createElement("div",{className:"relative min-w-0 min-h-0",dangerouslySetInnerHTML:{__html:e.noSanitize?null!==(i=n[e.name])&&void 0!==i?i:"":YC(n[e.name],{allowedTags:YC.defaults.allowedTags.concat(e.allowedHTMLTags||[]),parser:{lowerCaseAttributeNames:!1}})}})}:["URL","Email","Tel"].includes(e.format)?n=>t.createElement("a",{href:("Email"===e.format?"mailto:":"Tel"===e.format?"tel:":"")+i(n[e.name]),target:"_blank"},i(n[e.name])):"Media"===e.format&&e.contentConfig?n=>{var i;return n[e.name]&&t.createElement(MediaViewer,{url:n[e.name],allowedContentTypes:"fixed"in e.contentConfig?[null!==(i=e.contentConfig.fixed)&&void 0!==i?i:"image"]:"fromColumn"in e.contentConfig?[n[e.contentConfig.fromColumn]]:[MediaViewer.getMimeFromURL(n[e.name])]})}:void 0,getCellStyle:()=>"Media"===e.format?{display:"flex"}:"number"===e.tsDataType?{color:"rgb(0 110 0)"}:"Date"===e.tsDataType?{color:"rgb(25 91 239)"}:{},onContextMenu:(n,i)=>{n.preventDefault();let r={style:{padding:0},anchorEl:n.currentTarget,positioning:"beneath-left",content:t.createElement(ColumnMenu,{onAddFilter:()=>this.setState({filterPopup:!0}),db:o,dbs:a,tableName:c,colName:e.name,tables:l,w:s,onClose:()=>{this.setState({popup:void 0})},showColumns:e=>{if(!this.ref)throw"ref missing";this.setState({popup:{style:{},anchorEl:this.ref,positioning:"inside-top-center",content:t.createElement(ColumnsMenu,{w:s,db:o,tableName:c,tables:l,onClose:()=>{this.setState({popup:void 0})},showAddCompute:"Columns"!==e})}})}})};return this.setState({popup:r}),!1}}}))}s&&s.columns&&(Array.isArray(s.columns)?r=r.map((e=>{var n;const i=e;if(i&&i.style&&i.style.type&&"None"!==i.style.type){if("Barchart"===i.style.type||"Scale"===i.style.type){let{minValue:t,maxValue:r}=(null===(n=this.state.barchartVals)||void 0===n?void 0:n[e.name])||{};i.style.minValue=null!=t?t:0,i.style.maxValue=null!=r?r:0}e.getCellStyle=(t,n,r)=>{var s;const o=StyleColumn.getStyle(i,e.tsDataType,t);let a={};return(null==o?void 0:o.cellColor)&&(a={...a,background:o.cellColor}),(null==o?void 0:o.textColor)&&(a={...a,color:o.textColor}),"Barchart"===(null===(s=i.style)||void 0===s?void 0:s.type)&&(a={...a,border:"1px solid var(--gray-200)"}),a},e.onRender=(n,r,s)=>{const o=StyleColumn.getStyle(i,e.tsDataType,n);return o&&o.chipColor?t.createElement("div",{style:{backgroundColor:o.chipColor,padding:"6px 8px",borderRadius:"1em",width:"fit-content"}},s):s}}return e})):console.warn("Bad w.columns format",s.columns));const h=o[c];return h.update&&!(null===(i=s.options)||void 0===i?void 0:i.hideEditRow)&&r.unshift(KC(null!=d?d:[],h,!!(null==s?void 0:s.options.showSubLabel),(e=>{this.setState({rowPanel:{type:"update",data:e}})}))),r},this.dataAge=0,this.onDelta=async(e,t,n)=>{var i,r,s,o,a,l,c,u,d,h,p,f,m,g,y,v,b,w,x,_,E,S,C,T;const A={...e,...t,...n},{rows:k,sql:N}=this.state,{db:M,activeRow:P,onClose:L,onClickRow:O,joinFilter:R,externalFilters:I,workspace:D,tables:F}=this.props,{w:B,pageSize:z}=this.d||{};let j,{table_name:V,table_oid:U,sort:H,filter:$}=B||{},q=H,W={...$};if(!B)return;const G=Object.keys((null===(i=null==A?void 0:A.w)||void 0===i?void 0:i.options)||{}),Y=Object.keys((null==A?void 0:A.w)||{}),X=Object.keys(A||{});console.log(X,Y),M&&V&&(W=lT($||[]));const K=M[V];if(M&&V&&!K){if(!U)return alert("Table not found. Removing..."),void L();{let e=[];await Promise.all(Object.keys(M).map((async t=>{M[t].getInfo&&e.push({name:t,...await M[t].getInfo()})})));const t=e.find((e=>e.oid===U));if(t)return void await B.$update({table_name:t.name})}}Array.isArray(q)||(q=[]),(null==A?void 0:A.w)&&"filter"in A.w&&this.props.onFilter(),A.db&&console.log(Object.keys(A.db)),["showSubLabel","maxRowHeight"].some((e=>{var t,n;return(null===(t=null==A?void 0:A.w)||void 0===t?void 0:t.options)&&e in(null===(n=null==A?void 0:A.w)||void 0===n?void 0:n.options)}))&&(j=j||{}),(null===(r=null==A?void 0:A.w)||void 0===r?void 0:r.columns)&&B.$update({sort:[]}),(null===(s=null==A?void 0:A.w)||void 0===s?void 0:s.filter)&&!(null===(o=null==A?void 0:A.w)||void 0===o?void 0:o.id)&&B&&!(null==B?void 0:B.options.showFilters)&&B.$update({options:{showFilters:!0}},{deepMerge:!0}),(null===(a=null==A?void 0:A.w)||void 0===a?void 0:a.filter)&&B&&this.setData({page:1}),(null===(l=null==A?void 0:A.w)||void 0===l?void 0:l.options)&&"hideCount"in(null===(c=null==A?void 0:A.w)||void 0===c?void 0:c.options)&&(null===(u=this.state.rows)||void 0===u?void 0:u.length)&&(j={...j,dataAge:Date.now()});const Z=!(null===(d=D.options)||void 0===d?void 0:d.hideCounts)&&!B.options.hideCount;if(M&&this.state.rows&&(A.tables||A.db||!this.state.cols||(null===(h=null==A?void 0:A.w)||void 0===h?void 0:h.columns)||(null==A?void 0:A.w)&&"filter"in(null==A?void 0:A.w)||["cardRows","hideEditRow"].some((e=>G.includes(e))))&&(j={onSort:async e=>this.setState({sort:e}),loading:!1,cols:await this.getTableCols((null==j?void 0:j.rows)||this.state.rows),totalRows:Z?+(null!==(f=await(null===(p=K.count)||void 0===p?void 0:p.call(K)))&&void 0!==f?f:0):0,onRowClick:(e,t)=>{var n;e&&(null===(n=this.d.w)||void 0===n?void 0:n.columns.find((t=>!t.computedConfig&&!t.format&&Object.keys(e).includes(t.name))))?null==O||O(e,t):null==O||O(void 0,t)}}),B&&V&&M&&K&&K.find&&(!k&&K||(null===(g=null===(m=A.w)||void 0===m?void 0:m.options)||void 0===g?void 0:g.refresh)||(null==A?void 0:A.dataAge)||["pageSize","page","sort","filter","joinFilter","externalFilters","limit","cols","dataAge","db","activeRow","columns"].some((e=>e in A||A.w&&e in A.w)))){let e=ProstglesTable.simplifyFilter({$and:[W&&!fT(W)?W:void 0,this.props.joinFilter,...this.props.externalFilters].filter(vT)});const t=JSON.stringify(e),n=()=>{var e,t;return null===(t=null===(e=this.dataSub)||void 0===e?void 0:e.unsubscribe)||void 0===t?void 0:t.call(e)},i=()=>{this.autoRefresh&&(clearTimeout(this.autoRefresh),this.autoRefresh=null)},r=async(r=0)=>{var s;await n(),i(),this.dataSubFilter=t,this.dataSub=await(null===(s=K.subscribe)||void 0===s?void 0:s.call(K,e,{select:"",throttle:1e3*r},(()=>{this.setData({dataAge:Date.now()})})))};if("Realtime"===(null===(v=null===(y=null==B?void 0:B.options)||void 0===y?void 0:y.refresh)||void 0===v?void 0:v.type)&&K.subscribe&&this.dataSubFilter!==t&&r(null===(w=null===(b=null==B?void 0:B.options)||void 0===b?void 0:b.refresh)||void 0===w?void 0:w.throttleSeconds),"refresh"in((null===(x=null==A?void 0:A.w)||void 0===x?void 0:x.options)||{})){await n(),i();const{type:e="None",throttleSeconds:t=0,intervalSeconds:s=3}=(null===(_=null==B?void 0:B.options)||void 0===_?void 0:_.refresh)||{};"Realtime"===e?r(t):"Interval"===e&&s>0&&(this.autoRefresh=setInterval((()=>{this.setState({dataAge:Date.now()})}),1e3*s))}this.loadingData=!0;try{const{select:t,barchartVals:n}=await ProstglesTable.getSelect(B,F,M,e);n&&(j=j||{},j.barchartVals={...this.state.barchartVals,...n});const i=ProstglesTable.getSort(F,B),{limit:r,offset:s}=this.getPagination(),o=ProstglesTable.getDataRequestSignature({select:t,orderBy:i,limit:r,offset:s,joinFilter:R,filter:e});if((null==A?void 0:A.dataAge)||this.currentDataRequestSignature!==o){if(this.currentDataRequestSignature=o,this.setState({runningQuery:!0}),Object.keys(t).length){const n=await(null===(E=K.count)||void 0===E?void 0:E.call(K,e));let o=null!==(C=await(null===(S=K.find)||void 0===S?void 0:S.call(K,e,{select:t,orderBy:i,limit:r,offset:s})))&&void 0!==C?C:[];this.activeRowStr=JSON.stringify(R||{});let a=o.map((e=>({...e})));(null===(T=B.columns)||void 0===T?void 0:T.some((e=>Number.isFinite(e.width))))||(j=j||{},j.localCols=ProstglesTable.getFullColumnConfig(F,B,a),B.$update({columns:j.localCols}));const l=Z?`${B.table_name} - ${(null!=n?n:"??").toLocaleString()} records`:B.table_name;l!==B.name&&B.$update({name:l}),j={...j,rows:a,rowCount:n},j.joinFilterStr=R?JSON.stringify(R):void 0}else j={...j,rows:[],rowCount:0};j.error=void 0,this.dataAge=Date.now()}}catch(e){console.error(e),j={...j,error:e,cols:[]}}this.loadingData=!1}!j&&G.length&&["viewAsCard","hideCardFieldNames","cardRows","hideEditRow","showFilters"].some((e=>G.includes(e)))&&(null!=j||(j={})),j&&(j.runningQuery=!1,this.setState(j))},this.getWCols=()=>{const{w:e}=this.d,{tables:t}=this.props,{rows:n}=this.state;return e?ProstglesTable.getFullColumnConfig(t,e,n):[]},this.getPaginationProps=()=>{const{page:e,pageSize:t}=this.d,{rowCount:n}=this.state;return{page:e,pageSize:t,totalRows:n,onPageChange:e=>{this.setData({page:e})},onPageSizeChange:e=>{this.setData({pageSize:e})}}},this.getMenu=(e,n)=>{const{db:i,onLinkTable:r,onAddChart:s,dbs:o,tables:a}=this.props,l=e.columns;return l?t.createElement(TableMenu,{db:i,dbs:o,tableName:e.table_name,cols:l.filter((e=>!e.computed)),tables:a,onAddChart:s,w:e,onLinkTable:r,onClose:n}):null},this.renderCell=(e,t)=>{}}static getColWidth(e,t=[],n,i){let r=e;if(t&&!(null==e?void 0:e.some((e=>Number.isFinite(e.width))))){const e=100,s=300;let o=0,a=0;if(r=r.map((i=>{let r={...i};return t.map((t=>{const i=8*JSON.stringify(t[r[n]]||"").length,o=Number.isFinite(r.width)?r.width:i;r.width=Math.min(Math.max(i,e,o),s)})),r.width=r.width||e,r.width>=s&&a++,o+=r.width,r})),i&&i>o){const e=i-o-25;r=r.map((t=>{var n;return null!==(n=t.width)&&void 0!==n||(t.width=20),a?t.width>=s&&(t.width+=e/a):t.width+=e/r.length,t}))}}return r}static getFullColumnConfig(e,t,n,i){const{columns:r,table_name:s}=t,o=r||[],a=e.find((e=>e.name===s));if(!a)return console.error("Table not found:",s),[];const l=e=>e.computedConfig;let c=o.map((e=>({...e,info:l(e)?void 0:a.columns.find((t=>t.name===e.name))})));c=c.filter((e=>!(!e.computedConfig&&!e.info)));const u=a.columns.filter((e=>!c.find((t=>t.info&&t.name===e.name))));return c=c.concat(u.map((e=>({info:e,name:e.name,show:!0})))),c=ProstglesTable.getColWidth(c,n,"name",i),c}static async getSelect(e,t,n,i){let r,s={};return e.columns&&Array.isArray(e.columns)?await Promise.all(ProstglesTable.getFullColumnConfig(t,e).map((async t=>{var o,a,l,c,u,d,h;if(t.show){if(t.style&&["Barchart","Scale"].includes(t.style.type)){if(t.computedConfig)throw"Cannot use Scale/Barchart styling on a computed column";r=r||{};const s=await(null===(a=(o=n[e.table_name]).findOne)||void 0===a?void 0:a.call(o,i,{select:{minValue:{$min:[t.name]},maxValue:{$max:[t.name]}}})),c="Date"===(null===(l=t.info)||void 0===l?void 0:l.tsDataType);s&&(r[t.name]={minValue:c?+new Date(s.minValue):+s.minValue,maxValue:c?+new Date(s.maxValue):+s.maxValue})}if(null==t?void 0:t.computedConfig){let e=t.computedConfig.funcName,n=[t.computedConfig.column].filter(vT);if(t.computedConfig.column||t.computedConfig.args){const{args:i}=t.computedConfig;(null===(c=null==i?void 0:i.$duration)||void 0===c?void 0:c.otherColumn)?(n=[t.computedConfig.column,null===(u=null==i?void 0:i.$duration)||void 0===u?void 0:u.otherColumn],e="$age"):(null===(d=null==i?void 0:i.$string_agg)||void 0===d?void 0:d.separator)?n=[t.computedConfig.column,null===(h=null==i?void 0:i.$string_agg)||void 0===h?void 0:h.separator]:(null==i?void 0:i.$template_string)&&(n=[null==i?void 0:i.$template_string])}s[t.name]={[e]:n}}else s[t.name]=1;t.format&&"NONE"!==t.format&&("$ST_SnapToGrid"===t.format?s[t.name]={[t.format]:[t.name,.002]}:["base64","Media","URL","HTML","Email","Tel"].includes(t.format)||(s[t.name]=t.format))}}))):s={"*":1},{barchartVals:r,select:s}}static getSort(e,t){var n;const{sort:i}=t;if(!i)return[];let r=i.map((e=>({...e})));const s=null===(n=e.find((e=>e.name===t.table_name)))||void 0===n?void 0:n.columns;if(!s)return[];const o=t.columns;return r=r.filter((e=>{if(o){const t=o.find((t=>t.name===e.key));return s.some((e=>{var n,i;return(null==t?void 0:t.computedConfig)?!(null===(n=t.computedConfig)||void 0===n?void 0:n.column)||(null===(i=t.computedConfig)||void 0===i?void 0:i.column)===e.name:t?t.name===e.name:void 0}))}return s.some((t=>t.name===e.key))})),r}static simplifyFilter(e){var t,n,i,r;let s=e;if(s){for(;s&&"$and"in s&&Array.isArray(s.$and)&&s.$and.length<2||s&&"$or"in s&&Array.isArray(s.$or)&&s.$or.length<2;)s.$and&&(s=null!==(n=null===(t=s.$and)||void 0===t?void 0:t[0])&&void 0!==n?n:{}),s.$or&&(s=null!==(r=null===(i=s.$or)||void 0===i?void 0:i[0])&&void 0!==r?r:{});null!=s||(s={})}return s}async onMount(){const{db:e,dbs:t,w:n,tables:i}=this.props;if(n&&!n.filter&&n.$update({filter:[]}),e&&!this.d.wSync){let e=n.$cloneSync(((e,t)=>{this.setData({w:e},{w:t})}));this.setData({wSync:e})}}async onUnmount(){var e,t;await(null===(t=null===(e=this.dataSub)||void 0===e?void 0:e.unsubscribe)||void 0===t?void 0:t.call(e))}static getDataRequestSignature(e){if("sql"in e)return e.sql;const{filter:t,joinFilter:n,externalFilters:i,select:r,limit:s,offset:o,orderBy:a}=e;return JSON.stringify({filter:t,joinFilter:n,externalFilters:i,select:r,limit:s,offset:o,orderBy:a})}getPagination(){const{pageSize:e,page:t}=this.d;return{limit:e,offset:this.props.joinFilter?0:(t-1)*e}}getCardView(){const{rows:e=[],cols:n}=this.state,{joinFilter:i,activeRowColor:r,activeRow:s}=this.props,{w:o}=this.d,{cardRows:a=1,hideCardFieldNames:l,maxCardWidth:c="100%",hideEmptyCardCells:u,maxCardRowHeight:d,cardCellMinWidth:h=""}=(null==o?void 0:o.options)||{},p=a>1?".5em":"auto",f=1===a&&"100%"!==c?"auto":"",m=e=>{let t={};return(i||s&&JC(s.row_filter,e))&&(t={boxShadow:`inset 0 0 10px ${r}`}),t};return t.createElement("div",{className:(a>1?" flex-row-wrap ":" flex-col ")+" o-auto no-scroll-bar f-1 min-w-0 min-h-0 px-p5 bg-gray-200 pt-p5",style:{placeContent:a>1?"flex-start":void 0}},e.map(((e,i)=>t.createElement("div",{key:i,className:"card bg-white flex-row-wrap  f-0 min-w-0 "+(i||a>1?"mtt-p5":"")+(a>1?" h-fit w-fit ":""),style:{padding:window.isMobileDevice?".5em":"2em",width:a>1?`calc(${99/a}% - .5em)`:"",maxWidth:"100%"!==c?c:void 0,margin:`.5em ${p} 0 ${f}`,...m(e)},onClick:t=>{var n,i,r;(null===(n=window.getSelection())||void 0===n?void 0:n.toString())||null===(r=(i=this.props).onClickRow)||void 0===r||r.call(i,e,t)}},null==n?void 0:n.filter((t=>{var n;return!(t.hidden||u&&[null,void 0,""].includes(`${null!==(n=e[t.name])&&void 0!==n?n:""}`.trim()))})).map(((n,i)=>{var r,s,o;return t.createElement("div",{key:i,title:n.udt_name,className:" flex-col mt-1 mr-1 min-w-0 "+(a>1?" h-fit w-fit ":""),style:{minWidth:h}},!l&&t.createElement("div",{className:" text-gray-400 pointer noselect",onContextMenu:n.onContextMenu},n.name),t.createElement("div",{className:" o-auto font-18",title:"string"!=typeof e[n.name]||"Date"!==n.tsDataType&&"number"!==n.tsDataType?"":e[n.name],style:{lineHeight:1.33,...(null===(r=n.getCellStyle)||void 0===r?void 0:r.call(n,e,e[n.name],e[n.name]))||{},maxHeight:`${d||800}px`}},null!==(o=null===(s=n.onRender)||void 0===s?void 0:s.call(n,e,e[n.name],e[n.name]))&&void 0!==o?o:SmartFormField.renderValue(n,e[n.name])))}))))),t.createElement(Pagination,{...this.getPaginationProps()}))}render(){var e,n,i,r,s;const{loading:o,totalRows:a,rows:l=[],cols:c,popup:u,runningQuery:d,rowPanel:h,filterPopup:p,error:f}=this.state,{page:m,pageSize:g,w:y}=this.d,{db:v,setLinkMenu:b,joinFilter:w,activeRow:x,onAddChart:_,dbs:E,activeRowColor:S,tables:C}=this.props,T=this.activeRowStr===JSON.stringify(w||{})?{background:S}:{};let A=null;if((null==y?void 0:y.table_name)&&!v[y.table_name])A=t.createElement("div",{className:" p-2 flex-row ai-center text-red-700"},t.createElement(tt(),{path:xe,size:1,className:"mr-p5 "}),"Table ",JSON.stringify(y.table_name)," not found");else if(!o&&y&&v&&(!y.table_name||v[y.table_name]&&c)){const o=c||[],{table_name:a}=y;let p=-1;x&&x.row_filter&&(p=l.findIndex((e=>JC(x.row_filter,e))));const m=v[a],g=Boolean(null==m?void 0:m.insert);A=t.createElement(t.Fragment,null,t.createElement("div",{className:"flex-col f-1 min-h-0 min-w-0 ",ref:e=>{e&&(this.ref=e)}},(null===(e=null==y?void 0:y.options)||void 0===e?void 0:e.showFilters)?t.createElement("div",{className:" ai-center p-p5 bg-gray-200",title:"Edit filters"},t.createElement(SmartFilterBar,{db:v,w:y,tables:C,className:"",hideSort:!(null==y?void 0:y.options.viewAsCard),rightContent:g&&t.createElement(Btn,{iconPath:He,title:"Insert row",className:"shadow w-fit h-fit",color:"action",size:"small",variant:"filled",onClick:async()=>{this.setState({rowPanel:{type:"insert",data:void 0}})}})})):null,t.createElement("div",{className:"flex-col oy-auto f-1 relative bt b-gray-300"},d?t.createElement(Loading,{variant:"cover"}):null,f&&t.createElement(ErrorComponent,{style:{flex:"unset"},error:f}),(null==y?void 0:y.options.viewAsCard)?this.getCardView():t.createElement(Table,{maxCharsPerCell:null!==(i=null===(n=null==y?void 0:y.options)||void 0===n?void 0:n.maxCellChars)&&void 0!==i?i:500,maxRowHeight:null===(r=null==y?void 0:y.options)||void 0===r?void 0:r.maxRowHeight,rowStyle:w?T:{},onSort:e=>{y.$update({sort:e})},onColumnReorder:e=>{var t;const n=e.filter((e=>!(e.computed&&"edit_row"===e.key))).map((e=>e.name)),i=null===(t=this.d.w)||void 0===t?void 0:t.columns.sort(((e,t)=>n.indexOf(e.name)-n.indexOf(t.name)));null==y||y.$update({columns:i})},cols:o.filter((e=>{const t=this.getWCols();if(t&&Array.isArray(t)){const n=t.find((t=>t.name===e.name));if(n)return Boolean(n.show)}return!e.hidden})).sort(((e,t)=>{const n=this.getWCols();if(n&&Array.isArray(n)){const i=n.findIndex((t=>t.name===e.name)),r=n.findIndex((e=>e.name===t.name));if(i>-1&&r>-1)return i-r}return 0})).map((e=>({...e,headerClassname:"number"===e.tsDataType?" jc-end  ":" ",className:"number"===e.tsDataType?" ta-right ":" ",onResize:async t=>{const n=this.getWCols();if(!Array(n))return;const i=n.map((n=>(n.name===e.key&&(n.width=t),n)));y.$update({columns:i})}}))),rows:l,sort:y.sort,style:{flex:1,boxShadow:"unset"},tableStyle:{borderRadius:"unset",border:"unset"},pagination:this.getPaginationProps(),showSubLabel:null===(s=null==y?void 0:y.options)||void 0===s?void 0:s.showSubLabel,activeRowStyle:T,activeRowIndex:p,onRowClick:this.state.onRowClick}),g&&t.createElement(Btn,{iconPath:He,title:"Insert row",className:"shadow w-fit h-fit",color:"action",variant:"outline",style:{position:"absolute",right:"15px",bottom:"15px"},onClick:async()=>{this.setState({rowPanel:{type:"insert",data:void 0}})}}))),u?t.createElement(Popup,{rootStyle:u.style,anchorEl:u.anchorEl,positioning:u.positioning,clickCatchStyle:{opacity:.25,backdropFilter:"blur(1px)"},onClose:()=>{this.setState({popup:void 0})},open:!0,contentClassName:""},u.content):null,h&&t.createElement(SmartForm,{asPopup:!0,confirmUpdates:!0,hideChangesOptions:!0,db:v,tables:C,tableName:a,rowFilter:h.data,onSuccess:()=>{this.setState({dataAge:Date.now()})},onAddTable:this.props.onAddTable,onClose:()=>{this.setState({rowPanel:void 0})}}))}else A=t.createElement(Loading,{className:"m-auto absolute"});return t.createElement(Window,{w:y,quickMenuProps:{tables:C,dbs:E,setLinkMenu:b,onAddChart:_},getMenu:this.getMenu},A)}}function ZC(e){let t=Math.abs(e);return t>999999?Math.sign(e)*+(Math.abs(e)/1e6).toFixed(1)+"m":t>999?Math.sign(e)*+(Math.abs(e)/1e3).toFixed(1)+"k":e}function JC(e,t){return!(!e||!t)&&!Object.keys(e).some((n=>e[n]!==t[n]))}ProstglesTable.getJoinedTables=(e,t,n)=>{var i;const r=null===(i=e.find((e=>e.name===t)))||void 0===i?void 0:i.columns,s=(e,t)=>{if(!n[t.tableName])return;let i=!1;e.forEach((e=>{e.tableName===t.tableName&&(i=!0,e.on=[...e.on,...t.on])})),i||e.push(t)},o=[];null==r||r.filter((e=>e.references)).forEach((e=>{s(o,{tableName:e.references.ftable,on:[[e.name,e.references.fcols[0]]]})}));const a=[];return e.filter((e=>e.name!==t)).forEach((({name:e,columns:n})=>{n.forEach((n=>{var i,r;(null===(i=n.references)||void 0===i?void 0:i.ftable)===t&&s(a,{tableName:e,hasFkeys:!0,on:[[null===(r=n.references)||void 0===r?void 0:r.fcols[0],n.name]]})}))})),[...o,...a]};class AgeFilter extends RTComp{render(){var e,n,i,r,s,o,a;const{filter:l,onChange:c,tables:u,column:d,tableName:h}=this.props,{error:p}=this.state,f=null===(e=u.find((e=>e.name===h)))||void 0===e?void 0:e.columns.filter((e=>e.name!==d.name&&"Date"===e.tsDataType));if(!l||!f)return t.createElement(t.Fragment,null,"Something went wrong. Could not find column ",null==d?void 0:d.name);const m={...null!==(n=l.complexFilter)&&void 0!==n?n:{},argsLeftToRight:null===(r=null===(i=null==l?void 0:l.complexFilter)||void 0===i?void 0:i.argsLeftToRight)||void 0===r||r,comparator:null!==(o=null===(s=null==l?void 0:l.complexFilter)||void 0===s?void 0:s.comparator)&&void 0!==o?o:">"},g=e=>{c({...l,complexFilter:{...m,...e}})},y=[{key:null,label:"NOW"},...f.map((e=>({key:e.name,label:e.label})))];return t.createElement("div",{className:"flex-col gap-p25"},"$age"!==(null==l?void 0:l.type)&&t.createElement("div",{className:"flex-row p-p25 gap-p25 ai-center"},t.createElement(Btn,{size:"small",color:"action",onClick:()=>{g({argsLeftToRight:!m.argsLeftToRight})}},!1===m.argsLeftToRight?"Up to":"Since"),t.createElement(Select,{size:"small",value:null!==(a=m.otherField)&&void 0!==a?a:null,fullOptions:y,onChange:e=>{g({otherField:e})}})),t.createElement("div",{className:"flex-row p-p25 gap-p25"},t.createElement(Select,{size:"small",className:"text-blue-400",value:m.comparator,fullOptions:[...nT,...QC.filter((({key:e})=>"<>"===e||"="===e))],onChange:e=>{g({comparator:e})}}),t.createElement(FormField,{asColumn:!0,type:"text",autoComplete:"off",value:l.value,inputStyle:{padding:window.isMobileDevice?"2px 6px":"8px"},hint:"Example: 1 month 2 days",error:p,onChange:e=>{c({...l,disabled:!1,value:`${e}`})}})))}}AgeFilter.TYPES=["$age","$duration"];class FilterWrapper extends RTComp{constructor(){super(...arguments),this.state={searchTerm:""},this.onDelta=e=>{const{filter:t,db:n,tableName:i}=this.props,r=n[i];t&&(null==e?void 0:e.filter)&&"fieldName"in t&&void 0!==t.value&&r.find&&r.find(aT(t),{limit:0}).then((()=>{this.setState({error:void 0})})).catch((e=>{this.setState({error:e})}))}}render(){var e,n,i;const{onChange:r,filter:s,column:o,children:a,className:l="",style:c={},label:u=(null==o?void 0:o.name)}=this.props,{error:d}=this.state,h=!!(null==s?void 0:s.minimised),p=null!==(e=null==s?void 0:s.fieldName)&&void 0!==e?e:o.name,f=e=>{r({...s,fieldName:p,minimised:!h})},m=[...(o.tsDataType,[...tT,...eT]),...["number","Date","string"].includes(o.tsDataType)?nT:[],...["Date"].includes(o.tsDataType)?iT:[]],g="Click to expand/collapse",y=[...QC,...m],v=s&&t.createElement(Checkbox,{title:"Toggle filter",checked:!s.disabled,className:"filter-toggle bg-white mr-p5",variant:"minimal",onChange:e=>{r({...s,disabled:!e.target.checked})}});if(h){const e=26,r=n=>{if(Array.isArray(n)){if("$between"===s.type)return t.createElement(t.Fragment,null,r(s.value[0]),t.createElement("span",{className:"ws-pre text-gray-500 font-normal font-14"}," AND "),r(s.value[1]));return n.join().length>e&&n.length<5?`( ${n.map((e=>JSON.stringify(cT(e,10)))).join(", ")} ) `:t.createElement(t.Fragment,null,"( ",cT(JSON.stringify(n).slice(1,-1),e,"...")," )",t.createElement("div",{className:"min-w-0 min-h-0 o-hidden text-gray-500 ml-p5 flex-row ai-center ",style:{fontWeight:600}}," (",n.length,")"))}const i="Date"===o.tsDataType&&"string"==typeof n&&n;return n&&n instanceof Date&&n.toLocaleDateString||i?(n=new Date(n),"date"===o.udt_name||n.toISOString().endsWith("00:00:00.000Z")?n.toISOString().split("T")[0]:n.toLocaleDateString()):JSON.stringify(n||"")},{disabled:a,value:d}=s,h=null!==(i=null===(n=null==y?void 0:y.find((e=>e.key===s.type)))||void 0===n?void 0:n.label)&&void 0!==i?i:s.type;let p=r(s.value);return t.createElement("div",{title:g,className:"flex-row ai-center noselect pointer relative o-hidden "+l,style:{...c,background:"rgb(236, 247, 255)",border:"1px solid rgb(226, 226, 226)",borderRadius:"1em",padding:"2px 6px"}},v,t.createElement("button",{style:{background:"transparent",padding:"0"},onClick:f},t.createElement("div",{className:"flex-row ai-center noselect pointer relative o-hidden "},t.createElement("div",{className:"text-blue-800 font-16 mr-p25 "+(void 0===d||a?" text-gray-400 ":""),style:{fontWeight:600}},u),t.createElement("div",{className:" mr-p25 font-14 ",style:{color:"rgb(126 126 126)",textTransform:"uppercase"}},h),"not null"!==s.type&&"null"!==(null==s?void 0:s.type)&&t.createElement(t.Fragment,null,t.createElement("div",{className:"min-w-0 min-h-0 o-hidden font-16 flex-row ai-center ",style:{whiteSpace:"nowrap",fontWeight:600,color:a?"gray":"string"===o.tsDataType?"#810909":"Date"===o.tsDataType?"#0000ad":"number"===o.tsDataType?"rgb(0, 110, 0)":"black"}},p)))))}return t.createElement("div",{className:"flex-col bg-white relative "+l,style:{maxWidth:"400px",maxHeight:"50vh",...c}},t.createElement("div",{className:"flex-row ai-start p-p25 "},t.createElement("div",{title:g,className:"flex-row-wrap f-1 font-medium noselect mr-p5 pointer noselect  ai-center"},v,t.createElement(Btn,{exactClassName:"flex-row mx-p25 "+(void 0!==(null==s?void 0:s.value)?" text-blue-800 ":" text-gray-400  "),style:{marginTop:"0.25em",background:"aliceblue"},onClick:f},u),y?t.createElement(Select,{className:"mt-p25 ",title:"Choose filter type",fullOptions:y,value:(null==s?void 0:s.type)||"",onChange:(e,t)=>{let n={...s,type:e,fieldName:p};"Date"===o.tsDataType||Array.isArray(null==s?void 0:s.value)&&"$between"!==e&&"$in"!==e&&"$nin"!==e||("$between"===e||"$in"===e||"$nin"===e)&&!Array.isArray(null==s?void 0:s.value)?(delete n.value,n.disabled=!0):"string"!=typeof n.value&&tT.some((t=>t.key===e))&&(n.value+="",n.disabled=!0),r(n)}}):null),t.createElement(Btn,{iconPath:Me,title:"Delete filter",variant:"outline",onClick:()=>{r()}})),a,t.createElement(ErrorComponent,{error:d}))}}class ListFilter extends RTComp{constructor(){super(...arguments),this.state={searchTerm:""},this.setTerm=async e=>{if(this.searching){if(this.searching.term===e)return;clearTimeout(this.searching.timeout)}"string"!=typeof e?this.setState({searchingItems:!1}):(this.state.searchingItems||this.setState({searchingItems:!0}),this.searching={term:e,timeout:setTimeout((async()=>{var t,n,i,r,s,o,a;this.setState({searchingItems:!0});try{const{db:l,column:c,tableName:u,tables:d,otherFilters:h}=this.props;let p=(null===(t=null==c?void 0:c.references)||void 0===t?void 0:t.ftable)||u,f=(null===(i=null===(n=null==c?void 0:c.references)||void 0===n?void 0:n.fcols)||void 0===i?void 0:i[0])||c.name,m=Boolean(null===(r=null==c?void 0:c.references)||void 0===r?void 0:r.ftable),g=!0,y={};if(p&&(null===(s=null==l?void 0:l[p])||void 0===s?void 0:s.find)){const t=null===(o=d.find((e=>e.name===p)))||void 0===o?void 0:o.columns.find((e=>e.name===f));if(!t)throw new Error("Column not found: "+f);"jsonb"===t.udt_name&&(g=!1);const n=lT(h),i=(await SmartFormField.getSuggestions({db:l,col:t,table:p,term:e,groupBy:g,filter:m?{$existsJoined:{[u]:n}}:n})).map((e=>"jsonb"===t.udt_name?{raw:e,display:e?JSON.stringify(e):e}:{raw:e,display:e}));y={options:i,searchingItems:!1,error:void 0},this.state.options||(y={...y,allOptionsCount:i.length})}e===(null===(a=this.searching)||void 0===a?void 0:a.term)?(this.setState(y),this.searching=void 0):this.setState({searchingItems:!1,error:void 0})}catch(e){this.setState({error:e})}}),400)})},this.onDelta=async(e,t={},n)=>{const{db:i,column:r,tableName:s,tables:o,otherFilters:a}=this.props,{searchTerm:l=""}=this.state;this.state.options&&!("searchTerm"in t)||this.setTerm(l)}}render(){const{filter:e,onChange:n,tables:i,column:r,tableName:s}=this.props,{error:o,options:a,searchTerm:l,searchingItems:c,allOptionsCount:u}=this.state;if(!e)return t.createElement(t.Fragment,null,"Something went wrong. Could not find column ",null==r?void 0:r.name);if(!a)return t.createElement("div",{className:"p-1 relative f-1"},t.createElement(Loading,{delay:0}));let d=[];!l&&Array.isArray(null==e?void 0:e.value)&&(null==e?void 0:e.value.length)&&(d=null==e?void 0:e.value.filter((e=>!a.includes(e))));let h=Array.from(new Set([...d,...a.map((e=>e.display))])).map((t=>({key:t,label:t,title:`${t}`,onPress:()=>{let i=Array.isArray(e.value)?e.value.slice(0):[];i.includes(t)?i=i.filter((e=>e!==t)):i.push(t),i.length||(i=void 0),n({...e,disabled:!1,value:i})},checked:Boolean((null==e?void 0:e.value)&&Array.isArray(null==e?void 0:e.value)&&(null==e?void 0:e.value.includes(t)))})));return t.createElement(t.Fragment,null,c&&t.createElement(Loading,{variant:"cover"}),t.createElement(SearchList,{onSearch:e=>{this.setState({searchTerm:e})},noSearch:u&&u<8,id:"values",items:h,multiSelect:!0,onChange:t=>{n({...e,value:(null==t?void 0:t.length)?t:void 0})}}))}}ListFilter.TYPES=["$in","$nin"];class NumberOrDateFilter extends RTComp{constructor(){super(...arguments),this.state={},this.onDelta=async(e,t,n)=>{const{db:i,column:r,tableName:s}=this.props,o=null==i?void 0:i[s];if(!this.state.limits&&s&&(null==o?void 0:o.findOne)){const e=await o.findOne({},{select:{min:{$min:[r.name]},max:{$max:[r.name]}}});this.setState({limits:e}),this.setValue(e)}},this.setValue=(e,t=!1)=>{var n,i,r,s;const{column:o,filter:a}=this.props;let{min:l=(null===(n=null==a?void 0:a.value)||void 0===n?void 0:n[0]),max:c=(null===(i=null==a?void 0:a.value)||void 0===i?void 0:i[1]),_val:u=(null==a?void 0:a.value)}=e;const d="Date"===o.tsDataType;d&&(l=new Date(l),c=new Date(c),u=new Date(u));let h=null!==(s=null===(r=this.props.filter)||void 0===r?void 0:r.type)&&void 0!==s?s:"$between",p=[l,c];if("time"===o.udt_name)"$between"===h?(l&&c&&l>c&&(l=c),p=[l,c]):p=u;else if(null===u)p=u;else if(u&&Number.isFinite(+u))p=+u;else if(l&&Number.isFinite(+l)&&c&&Number.isFinite(+c))+l>+c&&(l=+c),p=[+l,+c];else if(l&&Number.isFinite(+l)&&"$between"===h)p=[+l,+l+1];else{if(!c||!Number.isFinite(+c)||"$between"!==h)return void console.warn("Invalid filter value");p=[+c-1,+c]}d&&null!==p&&(p=Array.isArray(p)?p.map((e=>new Date(e))):new Date(p)),this.props.onChange({fieldName:o.name,type:h,value:p,disabled:!1})}}render(){var e,n,i;const{filter:r,column:s,type:o,inputType:a,tables:l,onChange:c}=this.props;if(!s)return null;const u=null!==(e=null==r?void 0:r.type)&&void 0!==e?e:"=";let d="$between"===u?null===(n=null==r?void 0:r.value)||void 0===n?void 0:n[0]:">="===u?null==r?void 0:r.value:null,h="$between"===u?null===(i=null==r?void 0:r.value)||void 0===i?void 0:i[1]:"<="===u?null==r?void 0:r.value:null;const p={className:"p-p25 mr-p5",style:"date"===o?{}:{maxWidth:"125px"},inputStyle:{padding:"4px"},type:a,asColumn:!0};return t.createElement("div",{className:"flex-row-wrap f-1 p-p5",style:{minWidth:"150px"}},t.createElement(FormField,{...p,value:SmartFormField.parseValue(s,d),label:"Min",onChange:e=>{this.setValue({min:e})}}),t.createElement(FormField,{...p,value:SmartFormField.parseValue(s,h),label:"Max",onChange:e=>{this.setValue({max:e})}}))}}NumberOrDateFilter.TYPES=["$between"];const QC=[{key:"=",label:"="},{key:"<>",label:"!="},{key:"not null",label:"NOT NULL"},{key:"null",label:"NULL"},{key:"$in",label:"IN"},{key:"$nin",label:"NOT IN"}],eT=[{key:"@@.to_tsquery",label:"to_tsquery"},{key:"@@.plainto_tsquery",label:"plainto_tsquery"},{key:"@@.phraseto_tsquery",label:"phraseto_tsquery"},{key:"@@.websearch_to_tsquery",label:"websearch_to_tsquery"}],tT=[{key:"$ilike",label:"ILIKE"},{key:"$like",label:"LIKE"},{key:"$term_highlight",label:"CONTAINS"}],nT=[{key:"$between",label:"Between"},{key:">",label:">"},{key:">=",label:">="},{key:"<",label:"<"},{key:"<=",label:"<="}],iT=[{key:"$age",label:"Age"},{key:"$duration",label:"Duration"}],rT=["$existsJoined","$notExistsJoined"],sT=e=>Boolean(e.type&&rT.includes(e.type)),oT=e=>!sT(e.type),aT=e=>{if("fieldName"in e&&e.disabled||sT(e)&&e.filter.disabled)return;const t=e=>{let t={...e}.value;if("$age"===e.type||"$duration"===e.type){if(!e.complexFilter)return{};const{comparator:t,argsLeftToRight:n=!0,otherField:i}=e.complexFilter,r="$age"===e.type?[e.fieldName]:[e.fieldName,i].filter(vT);return n||r.reverse(),{$filter:[{$age:r},t,e.value]}}return"not null"===e.type?{[e.fieldName+".<>"]:null}:"null"===e.type?{[e.fieldName]:null}:{[[e.fieldName,"="===e.type?null:e.type].filter((e=>e)).join(".")]:t}};return eT.some((t=>t.key===e.type))&&"fieldName"in e?{[`${e.fieldName}.${e.type}`]:[e.value]}:sT(e)?{[e.type]:{[`${e.path.join(".")}`]:t(e.filter)}}:"$term_highlight"===e.type?{$term_highlight:[[e.fieldName||"*"],e.value,{matchCase:!1,edgeTruncate:30,returnType:"boolean"}]}:t(e)},lT=(e=[],t)=>{let n=e;(null==t?void 0:t.detailed)&&(n=[...e,...t.detailed]);let i=n.map((e=>aT(e)));return(null==t?void 0:t.filters)&&(i=i.concat(t.filters)),ProstglesTable.simplifyFilter({$and:i.filter(vT)})};class SmartFilter extends RTComp{constructor(){super(...arguments),this.state={searchTerm:""},this.onChange=e=>{this.props.onChange(e)}}render(){var e,n;const{addFilter:i}=this.state,{db:r,tableName:s,detailedFilter:o=[],className:a,style:l={},tables:c}=this.props,u=this.onChange,d=null===(e=c.find((e=>e.name===s)))||void 0===e?void 0:e.columns;let h;(null===(n=null==i?void 0:i.path)||void 0===n?void 0:n.length)&&(h=null==i?void 0:i.path[(null==i?void 0:i.path.length)-1]);const p=(null==d?void 0:d.length)?t.createElement("div",{key:"o",style:l,className:"flex-row-wrap ai-start min-w-0 min-h-0 "+a},o.map(((e,n)=>{var i,a,l;let h,p,f,m=s;if(sT(e)){({fieldName:p}=e.filter);const t=e.path[e.path.length-1];m=t,h=null===(i=c.find((e=>e.name===t)))||void 0===i?void 0:i.columns.find((e=>e.name===p)),f=e.path.join(" > ")+"."+p}else({fieldName:p}=e),h=d.find((e=>e.name===p));h||(h={comment:"",name:p,data_type:"text",delete:!1,element_type:"",element_udt_name:"",filter:!0,has_default:!1,insert:!1,udt_name:"text",is_nullable:!0,is_pkey:!1,label:p,ordinal_position:-1,select:!0,tsDataType:"string",update:!0});const g=null!==(l=null===(a=this.props.detailedFilter)||void 0===a?void 0:a.filter(((e,t)=>t!==n)))&&void 0!==l?l:[],y={className:"shadow  mr-p5 mt-p5 min-w-0 min-h-0",key:n+p,db:r,label:f,tableName:m,column:h,tables:c,filter:sT(e)?e.filter:e,otherFilters:sT(e)?g.filter(oT).map((t=>({type:e.type,path:[...e.path.slice(0).reverse().slice(1),this.props.tableName],filter:t}))):g,onChange:t=>{let i=[...o];t?sT(e)?i[n].filter={...t}:i[n]={...t}:i=i.filter(((e,t)=>t!==n)),u(i)}};let v=t.createElement(Filter,{...y,tables:c});return o.length>1&&n<o.length-1?t.createElement(t.Fragment,{key:"o"+n},v,t.createElement("div",{className:"mr-p5 mt-1 text-gray-600"},"AND")):v}))):null;return p}}SmartFilter.getDefaultFilter=async(e,t)=>{var n,i;const r=["number","Date"].includes((null===(n=e.info)||void 0===n?void 0:n.tsDataType)||(null===(i=e.computedConfig)||void 0===i?void 0:i.tsDataType));return{fieldName:e.name,type:r?"$between":"$in"}};class Filter extends RTComp{render(){var e,n,i,r;const{column:s,className:o="",style:a={},tables:l,onChange:c,db:u,tableName:d}=this.props,{error:h}=this.state,p=u[d],f=async(e,t)=>{var n;let i,r=e;if(r)try{await(null===(n=null==p?void 0:p.findOne)||void 0===n?void 0:n.call(p,aT(r),{select:""}))}catch(e){r={...r,disabled:!0},i=e}!!this.state.error!=!!i&&this.setState({error:i}),c(r)},m={...this.props.filter,fieldName:null!==(n=null===(e=this.props.filter)||void 0===e?void 0:e.fieldName)&&void 0!==n?n:s.name,type:null!==(r=null===(i=this.props.filter)||void 0===i?void 0:i.type)&&void 0!==r?r:"="},g=this.props.filter;let y;return y=AgeFilter.TYPES.includes(null==g?void 0:g.type)?t.createElement(AgeFilter,{...this.props,error:h}):"not null"===(null==g?void 0:g.type)||"null"===(null==g?void 0:g.type)?null:ListFilter.TYPES.includes(null==g?void 0:g.type)?t.createElement(ListFilter,{...this.props,error:h}):["$ilike","$like"].includes(m.type)||eT.some((e=>e.key===m.type))?t.createElement(FormField,{asColumn:!0,className:"m-p5",type:"text",autoComplete:"off",value:m.value,onChange:e=>{f({...m,disabled:!1,value:`${e}`})}}):"$between"===m.type?t.createElement(NumberOrDateFilter,{...this.props,type:s.tsDataType.toLowerCase(),inputType:SmartFormField.getInputType(s)}):t.createElement(SmartSearch,{className:"m-pa25",db:u,tableName:d,style:{padding:".5em"},variant:"search-no-shadow",tables:l,defaultValue:m.value,column:m.fieldName,onPressEnter:e=>{let t={...m};t.value=e,t.disabled=!1,console.log(t),f(t)},onChange:(e,{columnValue:t,term:n})=>{let i={...m};i.value=t||n,i.disabled=!1,f(i)}}),t.createElement(FilterWrapper,{...this.props,filter:m},h&&t.createElement(ErrorComponent,{error:h}),y)}}function cT(e,t,n="..."){return e.length>t?`${e.slice(0,t)}${n}`:e}const uT=e=>{const{tables:t,tableName:n,excludeTables:i=[]}=e,r=t.find((e=>e.name===n));if(!r)throw"Table info not found";const s=[],o=e=>{i.includes(e.table)||s.find((t=>t.table===e.table&&JSON.stringify(t.on)===JSON.stringify(e.on)))||s.push(e)};r.columns.forEach((e=>{if(e.references){const t={table:e.references.ftable,on:e.references.cols.map(((t,n)=>[t,e.references.fcols[n]]))};o(t)}})),t.forEach((e=>{e.name!==n&&e.columns.forEach((t=>{var i;if((null===(i=t.references)||void 0===i?void 0:i.ftable)===n){const n={table:e.name,on:t.references.fcols.map(((e,n)=>[e,t.references.cols[n]]))};o(n)}}))}));let a=s.map((e=>({...e,joins:uT({tableName:e.table,tables:t,excludeTables:[n,...i,e.table]})})));return a=a.map((e=>({...e}))),a};class SmartFormField extends RTComp{constructor(){super(...arguments),this.state={showDateInput:!0,insertMode:!1,loaded:!1},this.wasChanged=!1,this.onDelta=async(e,t,n)=>{var i,r;const{tableName:s,db:o,column:a,showSuggestions:l,tables:c,action:u}=this.props,{columnName:d}=this.state;let h={};if(o&&a&&d!==a.name){const e=async e=>{const{term:t,col:n,table:i}=e;return SmartFormField.getSuggestions({db:o,table:i,col:n,term:t})};let t,n;if(a.references&&"view"!==u){const{fcols:s,ftable:l}=a.references;if(l&&1===s.length&&(null===(i=null==o?void 0:o[l])||void 0===i?void 0:i.find)){const i=s[0],o=null===(r=c.find((e=>e.name===l)))||void 0===r?void 0:r.columns.find((e=>e.name===i));t=await e({term:"",col:o,table:l}),t.length>1&&t.length>=20&&(n=async t=>{const n=await e({term:t,col:o,table:l});this.setState({options:n})})}}else"string"===a.tsDataType&&l&&s&&o[s].find&&(this.onSuggest=async t=>await e({term:t,col:a,table:s}));h={columnName:a.name,options:t,onSearchOptions:n}}this.state.loaded||(h.loaded=!0),h&&this.setState(h)},this.onChange=async e=>{const{column:t,tableInfo:n,onChange:i}=this.props;if(this.wasChanged=!0,!t&&!n)return;let r=e;if(null==n?void 0:n.has_media){if(!Array.isArray(e)||e.some((e=>!(e instanceof File))))throw"No valid file provided";r=Array.from(e).map((e=>({data:e,name:e.name})))}else""===e&&["Date","number","boolean","Object"].includes(null==t?void 0:t.tsDataType)&&(null==t?void 0:t.is_nullable)&&(r=null);let s=null;if(t)try{r=SmartFormField.parseValue(t,e,!0)}catch(e){s=e}t&&!(null==n?void 0:n.has_media)&&("number"==typeof t.min&&"number"==typeof r&&r<t.min?r=Math.max(r,t.min):"number"==typeof t.max&&"number"==typeof r&&r>t.max&&(r=Math.min(r,t.max)));try{await(null==i?void 0:i(r))}catch(e){s=e.toString()}this.setState({error:s,newValue:r})}}static getInputType(e){return e.data_type.startsWith("timestamp")?"datetime-local":"time"===e.udt_name?"time":["email"].includes(e.name)?"email":["phone","telephone","phone_number","tel"].includes(e.name)?"tel":["zip_code","zipcode","post_code","postcode"].includes(e.name)?"postal-code":["given-name","first_name"].includes(e.name)?"given-name":["family-name","last_name"].includes(e.name)?"family-name":"boolean"===e.tsDataType?"checkbox":"string"===e.tsDataType?"text":e.tsDataType}static getInputAutocomplete(e){const t=["address-line1","address-line2","address-line3","street_address","street","address","address-level1","address-level2","address-level3","address-level4","organization","organization-title","country","country-name","postal-code","tel","given-name","family-name","email"];return t.concat(t.map((e=>e.replaceAll("-","_")))).includes(e.name.toLowerCase())?e.name.replaceAll("_","-").toLowerCase():"on"}static renderValue(e,n="",i=!0){var r;if("number"===(null==e?void 0:e.tsDataType)&&n)return(+n).toLocaleString();if(n&&(null==e?void 0:e.udt_name.startsWith("json")))return JSON.stringify(n);if(n&&["geography","geometry"].includes(null!==(r=null==e?void 0:e.udt_name)&&void 0!==r?r:""))return"object"!=typeof n||Array.isArray(n)?cT(n,6):cT(JSON.stringify(n),15);if(n&&"Date"===(null==e?void 0:e.tsDataType)){let i=n,r={day:"2-digit",month:"2-digit",year:"numeric",weekday:"short"};e.udt_name.startsWith("timestamp")&&(r={...r,hour:"numeric",minute:"numeric"});try{i=new Intl.DateTimeFormat(void 0,r).format(new Date(n))}catch(e){console.error(e)}return t.createElement(t.Fragment,null,i)}return[null,void 0].includes(n)?t.createElement("i",{className:"text-gray-400",title:i?"NULL":void 0},"NULL"):"boolean"==typeof n?t.createElement(t.Fragment,null,n.toString()):"string"==typeof n&&""===n?t.createElement("i",{className:"text-gray-400",title:i?"&quot;&quot;":void 0},"Empty String"):t.createElement(t.Fragment,null,n)}static parseValue(e,t,n=!1){if(t){if((null==e?void 0:e.udt_name.startsWith("json"))||(null==e?void 0:e.udt_name.startsWith("geo"))&&t.includes("ST_")){if(n)return"object"==typeof t?t:JSON.parse(t);try{return JSON.stringify("object"==typeof t?t:JSON.parse(t),null,2)}catch(e){return"string"==typeof t?t:t+""}}if(e.udt_name.startsWith("geo")&&"object"==typeof t&&!Array.isArray(t))return JSON.stringify(t);let i="string"==typeof t?t:+t;if("date"===e.udt_name)return new Date(i).toISOString().split("T")[0];if("timestamp"===e.udt_name)return new Date(i).toISOString().slice(0,-5);if("timestamptz"===e.udt_name)return new Date(i).toISOString();if(Array.isArray(t)&&("Array<boolean>"===e.tsDataType||"Array<number>"===e.tsDataType||"Array<string>"===e.tsDataType))return t.join(", ")}return t}static parseDefaultValue(e,t,n){if(!e||n)return t;if(![null,void 0].includes(t))return t;if(e.is_nullable&&null===t)return t;if(e.has_default&&"string"==typeof e.column_default){if(e.column_default.endsWith("::text"))return e.column_default.slice(1,-7);if(["now()","CURRENT_TIMESTAMP"].includes(e.column_default))return"date"===e.udt_name?(new Date).toISOString().split("T")[0]:(new Date).toISOString().slice(0,-5);if("number"===e.tsDataType)return Number(e.column_default)}else if(t)return SmartFormField.parseValue(e,t);return t}render(){var e;const{action:n,value:i,inputStyle:r={},placeholder:s="",variant:o,multiSelect:a,column:l,tableInfo:c,rightContent:u,hideNullBtn:d,sectionHeader:h,style:p,tableName:f}=this.props,m="rawValue"in this.props?this.props.rawValue:i,{error:g,options:y,showDateInput:v,onSearchOptions:b,loaded:w,collapsed:x}=this.state;if(!l&&!c||!w)return t.createElement(Loading,null);if(!l)return t.createElement(Loading,null);let _,E=null,S=null;try{_=SmartFormField.parseValue(l,i)}catch(e){_=i,S=e.toString()}const C="geometry"===(null==l?void 0:l.udt_name)||"geography"===(null==l?void 0:l.udt_name);"Date"===(null==l?void 0:l.tsDataType)?E=t.createElement(Btn,{title:v?"Edit as text":"Edit with picker",iconPath:v?Ie:Ee,className:"h-full",onClick:()=>this.setState({showDateInput:!v}),size:"small"}):C&&(E=t.createElement(st,{style:{height:"100%",borderRight:"1px solid var(--gray-300)"},button:t.createElement(Btn,{title:"Use my current location",iconPath:"M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8M3.05,13H1V11H3.05C3.5,6.83 6.83,3.5 11,3.05V1H13V3.05C17.17,3.5 20.5,6.83 20.95,11H23V13H20.95C20.5,17.17 17.17,20.5 13,20.95V23H11V20.95C6.83,20.5 3.5,17.17 3.05,13M12,5A7,7 0 0,0 5,12A7,7 0 0,0 12,19A7,7 0 0,0 19,12A7,7 0 0,0 12,5Z",className:"h-full",onClick:()=>this.setState({showDateInput:!v}),size:"small"}),content:t.createElement("p",null,"You will have to allow your browser to use your location data"),footerButtons:[{color:"action",label:"OK",onClick:()=>{try{navigator.geolocation.getCurrentPosition((e=>{var t=e.coords.latitude,n=e.coords.longitude;null==t?alert("GPS not activated!"):this.onChange({ST_GeomFromEWKT:[`SRID=4326;POINT(${n} ${t})`]})}))}catch(e){alert("Something went wrong: "+e.toString())}}},{label:"No thanks",onClickClose:!0}]}));const T="compact"===o;const A="view"===n||"update"===n&&!l.update||"insert"===n&&!l.insert;A&&(E=null);let k=l.hint;if(!A&&l.has_default&&l.is_pkey&&"insert"===n&&(k=k||"Column has default value. Can leave empty",!x))return t.createElement(Btn,{className:"mt-1",title:"Expand",iconPath:"M16,12A2,2 0 0,1 18,10A2,2 0 0,1 20,12A2,2 0 0,1 18,14A2,2 0 0,1 16,12M10,12A2,2 0 0,1 12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12M4,12A2,2 0 0,1 6,10A2,2 0 0,1 8,12A2,2 0 0,1 6,14A2,2 0 0,1 4,12Z",onClick:()=>{this.setState({collapsed:!x})}});let N=SmartFormField.getInputType(l).toLowerCase();N.startsWith("date")&&!v&&(N="text");const M=SmartFormField.getInputAutocomplete(l),P=A&&"update"===n;return t.createElement(t.Fragment,null,h?t.createElement("h4",{className:"noselect",style:{marginBottom:"0.5em"}},h):null,t.createElement(FormField,{id:f+"-"+l.name,style:p,className:(P?" cursor-default ":"")+(T?"":"mt-1"),inputClassName:P?" cursor-default ":"",maxWidth:"99vw",inputStyle:{...r,minWidth:0,..."checkbox"===N?{padding:"1px"}:T?{padding:"2px 6px"}:{}},key:l.name,placeholder:s,type:N,autoComplete:M,label:T?void 0:l.label,value:_,rawValue:m,options:y,title:P?"You are not allowed to update this field":"",asTextArea:(null===(e=l.udt_name)||void 0===e?void 0:e.startsWith("json"))||"string"===l.tsDataType&&"string"==typeof i&&(i.length>50||i.split("\n").length>1),readOnly:A,multiSelect:a,onChange:this.onChange,error:this.props.error||g,rightIcons:E,rightContent:u,labelAsValue:!0,onSearchOptions:b,onSuggest:this.onSuggest,nullable:l.is_nullable,inputProps:{min:l.min,max:l.max},hint:k,hideNullBtn:d,asColumn:"column"===o}))}}SmartFormField.getSuggestions=async e=>{var t,n,i;const{db:r,table:s,term:o,col:a,groupBy:l=!0,filter:c}=e,u=r[s];if(!(null==u?void 0:u.find))return console.error("Invalid column provided"),[];const d=(o||"").trimStart();try{let e={$and:[c,d?{[a.name]:{$ilike:`%${d}%`}}:{}].filter((e=>e))};const r=await u.find(e,{select:{[a.name]:1},groupBy:l,returnType:"values",limit:20});if(!r.includes("")&&"string"===a.tsDataType&&"uuid"!==a.udt_name){await(null===(t=u.findOne)||void 0===t?void 0:t.call(u,{[a.name]:""},{select:{[a.name]:"$trim"}}))&&r.unshift("")}if(!r.includes(null)){+(null!==(i=await(null===(n=u.count)||void 0===n?void 0:n.call(u,{[a.name]:null})))&&void 0!==i?i:"0")&&r.unshift(null)}return r}catch(e){return console.error(e),[]}};class ConfirmationDialog extends RTComp{constructor(){super(...arguments),this.state={}}render(){const{onClose:e,onAccept:n,acceptBtn:i,message:r,title:s,asPopup:o,positioning:a}=this.props,l=t.createElement("div",{className:"flex-col"},t.createElement("div",{className:"p-1"},r),t.createElement("div",{className:"flex-row-wrap p-p5 f-0 bt jc-around"},t.createElement(Btn,{color:i.color,variant:"filled",onClick:async()=>{await n()}},i.text),t.createElement(Btn,{variant:"outline",style:{marginLeft:"5em"},onClick:()=>e()},"Cancel")));return o?t.createElement(Popup,{open:!0,positioning:"positioning"in this.props?a:"right-panel",rootStyle:{padding:0},contentClassName:"flex-col ai-center",onClose:e,title:s},l):l}}class Success extends t.Component{render(){const{className:e=""}=this.props;return t.createElement("div",{...this.props,className:"custom-animations success-checkmark "+e},t.createElement("div",{className:"check-icon"},t.createElement("span",{className:"icon-line line-tip"}),t.createElement("span",{className:"icon-line line-long"}),t.createElement("div",{className:"icon-circle"}),t.createElement("div",{className:"icon-fix"})))}}t.Component;class SmartCardList extends RTComp{constructor(){super(...arguments),this.state={items:[]},this.onDelta=async()=>{var e;const{tableName:t,db:n,columns:i}=this.props,r=n[t];if(this.state.columns||this.setState({columns:null!=i?i:await(null===(e=r.getColumns)||void 0===e?void 0:e.call(r))}),"data"in this.props)this.setState({items:this.props.data});else{const{filter:e,limit:t=20}=this.props;if(e&&JSON.stringify(e)!==this._filterStr&&r.find){this._filterStr=JSON.stringify(e),this.setState({loading:!0});try{const n=await r.find(e,{limit:t});this.setState({items:n})}catch(e){this.setState({error:e})}this.setState({loading:!1})}}}}render(){const{tableName:e,db:n,className:i="",style:r={},disableVariantToggle:s=!0,popupFixedStyle:o,fieldConfigs:a,title:l,excludeNulls:c,tables:u}=this.props,{columns:d,loading:h,items:p}=this.state;this.state.variant||this.props.variant;return!d||h?t.createElement(Loading,null):t.createElement("div",{className:"flex-col o-auto gap-1 "+i,style:r},p.map(((i,r)=>{let a=null;return"onChange"in this.props&&(a=t.createElement(Btn,{iconPath:Me,color:"danger",className:"absolute",style:{top:"5px",right:"5px"},onClick:()=>{"onChange"in this.props&&this.props.onChange&&this.props.onChange(this.props.data.filter(((e,t)=>t!==r)))}})),t.createElement("div",{className:"relative",key:r},t.createElement(SmartCard,{db:n,tableName:e,defaultData:i,tables:u,columns:d,disableVariantToggle:s,excludeNulls:c,popupFixedStyle:o,onChanged:()=>{this._filterStr="z",this.forceUpdate()}}),a)})))}}class JoinedRecords extends RTComp{constructor(){super(...arguments),this.state={sections:[],expanded:!0},this.getDataSignature=()=>{const{tableName:e,rowFilter:t}=this.props;return JSON.stringify({tableName:e,rowFilter:t})},this.getNestedInsertPopup=()=>{var e;const{tables:n,tableName:i,db:r}=this.props,{nestedInsertTable:s}=this.state;if(this.isInsert&&s){const o=null===(e=n.find((e=>e.name===s)))||void 0===e?void 0:e.columns;return t.createElement(Popup,{open:!0,title:`Insert ${s} record`,positioning:"right-panel",onClose:()=>{this.setState({nestedInsertTable:void 0})},contentStyle:{padding:0},footerButtons:[{label:"Add",variant:"filled",color:"action",onClick:()=>{var e;null===(e=this.refNestedForm)||void 0===e||e.getErrors((e=>{var t,n;console.log(e);const i=null!==(n=null===(t=this.state.nestedInsertData)||void 0===t?void 0:t[s])&&void 0!==n?n:[];i.push(e),this.setState({nestedInsertData:{...this.state.nestedInsertData,[s]:i},nestedInsertTable:void 0},(()=>{this.props.onSetNestedInsertData(this.state.nestedInsertData)}))}))}},{label:"Remove",color:"danger",onClick:()=>{var e;null===(e=this.refNestedForm)||void 0===e||e.getErrors((e=>{console.log(e)}))}}]},t.createElement(SmartForm,{getRef:e=>{e&&(this.refNestedForm=e)},label:" ",tableName:s,db:r,tables:n,onChange:()=>{},columns:null==o?void 0:o.filter((e=>{var t;return!((null===(t=e.references)||void 0===t?void 0:t.ftable)===i)})).map((e=>e.name))}))}}}get detailedFilter(){const{tableName:e,rowFilter:t=[]}=this.props,n=t.map((({fieldName:t,type:n,value:i})=>({type:"$existsJoined",path:[e],filter:{fieldName:t,value:i,type:n,minimised:!0},minimised:!0})));return n}get joinFilter(){return lT(this.detailedFilter)}async onDelta(e,t,n){const{tables:i,db:r,tableName:s}=this.props,o=i.find((e=>e.name===s)),a=this.getDataSignature();if(o&&a!==this.dataSignature){this.dataSignature=a;const e=await Promise.all(o.joins.map((async e=>{var t,n,i,s,o;const a=this.isInsert?0:parseInt(null!==(s=null===(i=await(null===(n=null===(t=r[e.tableName])||void 0===t?void 0:t.count)||void 0===n?void 0:n.call(t,this.joinFilter)))||void 0===i?void 0:i.toString())&&void 0!==s?s:"0");let l=r[e.tableName].insert&&e.hasFkeys||!a;return{label:e.tableName,tableName:e.tableName,existingDataCount:a,canInsert:l,expanded:null===(o=this.state.sections.find((t=>t.tableName===e.tableName)))||void 0===o?void 0:o.expanded}})));this.setState({sections:e})}}get isInsert(){return!Boolean(this.props.rowFilter)}get tableHandler(){const{db:e,tableName:t}=this.props;return e[t]}getAddButton(e){const{rowFilter:n,tables:i,db:r}=this.props,s=!Boolean(n),o=i.some((t=>t.columns.some((t=>{var n;return(null===(n=t.references)||void 0===n?void 0:n.ftable)===e.tableName}))&&r[t.name].insert));if(s&&o)return r[e.tableName]?t.createElement(Btn,{key:e.tableName,title:"Add referenced record",color:"action",iconPath:He,onClick:()=>{this.setState({nestedInsertTable:e.tableName})}}):null;const{tableName:a}=this.props;return t.createElement(Btn,{iconPath:He,title:"Add new record",disabledInfo:e.canInsert?void 0:`Cannot reference more than one ${JSON.stringify(a)}`,onClick:async()=>{var t,n;const r=await(null===(n=(t=this.tableHandler).findOne)||void 0===n?void 0:n.call(t,lT(this.props.rowFilter))),s=i.find((e=>e.name===a)),o=null==s?void 0:s.joins.find((t=>t.tableName===e.tableName));if(r&&o){let t={};o.on.map((([e,n])=>{t[n]=r[e]})),this.setState({insert:{table:e.tableName,data:t}})}}})}render(){const{sections:e,insert:n,quickView:i,expanded:r,nestedInsertData:s}=this.state,{db:o,tables:a,tableName:l,onAddTable:c}=this.props;let u=null;i&&(u=t.createElement(SmartTable,{db:o,tableName:i.tableName,tables:a,filter:this.detailedFilter,onClosePopup:()=>{this.setState({quickView:void 0})}}));let d=null;if(n&&o[n.table].insert){const e=()=>{this.dataSignature=void 0,this.setState({insert:void 0})};d=t.createElement(SmartForm,{db:o,label:`Insert ${n.table} record`,hideChangesOptions:!0,showLocalChanges:!1,tableName:n.table,asPopup:!0,tables:a,defaultData:n.data,onInserted:e,onClose:e})}if(!e.length)return null;const h=a.filter((e=>e.columns.some((e=>{var t;return(null===(t=e.references)||void 0===t?void 0:t.ftable)===l}))&&o[e.name].insert)).map((e=>e.name));return t.createElement("div",{className:"flex-col b-top min-h-0"},t.createElement("h4",{title:"Toggle section",onClick:()=>this.setState({expanded:!r}),className:"m-0 p-1 pointer noselect ta-left f-0 ws-pre"},"Linked tables ",e.length>1&&t.createElement("span",{className:"text-gray-500 font-20",style:{fontWeight:"lighter"}},"  ",e.length)),u,d,this.getNestedInsertPopup(),r&&t.createElement("div",{className:"flex-col o-auto f-1"},e.map(((n,i)=>{var r,l;const u=null!==(r=this.isInsert?null==s?void 0:s[n.tableName].length:n.existingDataCount)&&void 0!==r?r:0,d=u?void 0:"No records to show";let p=t.createElement("span",{className:"ws-pre text-gray-500 font-18",style:{fontWeight:"normal"}},"  ",u.toLocaleString());this.isInsert&&!u&&(p=null);let f=null;if(this.isInsert){if(!h.includes(n.tableName))return null;{const{nestedInsertData:e}=this.state;f=t.createElement(SmartCardList,{key:n.tableName,db:o,tableName:n.tableName,tables:a,className:"px-1",data:null!==(l=null==e?void 0:e[n.tableName])&&void 0!==l?l:[],onChange:e=>{this.setState({nestedInsertData:{...this.state.nestedInsertData,[n.tableName]:e},nestedInsertTable:void 0},(()=>{this.props.onSetNestedInsertData(this.state.nestedInsertData)}))}})}}else f=t.createElement("div",{className:"flex-col"},u>20&&t.createElement("div",null,"Showing top ",20," records"),t.createElement(SmartCardList,{key:n.tableName,db:o,tableName:n.tableName,tables:a,filter:this.joinFilter,className:"px-1"}));return t.createElement("div",{key:n.tableName+this.dataSignature,className:"flex-col min-h-0 f-0 relative"},t.createElement("div",{className:"flex-row ai-center noselect pointer f-0 bg-white",style:n.expanded?{position:"sticky",top:0,zIndex:432432,borderBottom:"1px solid #cecece",marginBottom:".5em"}:void 0},t.createElement(Btn,{className:"f-1 p-p5 ta-left font-20 bold jc-start",title:"Expand section",disabledInfo:d,color:"action",onClick:()=>{const t=e.map((e=>({...e,expanded:e.tableName===n.tableName?!e.expanded:e.expanded})));this.setState({sections:t})},iconPath:n.expanded?"M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z":Te},n.tableName,p),c&&t.createElement(Btn,{iconPath:Pe,title:"Open in table",disabledInfo:d,onClick:async()=>{this.setState({quickView:{tableName:n.tableName}})}}),this.getAddButton(n)),n.expanded&&f)}))))}}class SmartForm extends RTComp{constructor(){super(...arguments),this.state={columns:void 0,error:void 0,currentRow:void 0,newRow:void 0,success:"",confirmUpdates:void 0,showLocalChanges:void 0,rowFilter:void 0,localChanges:[],errors:void 0,tableInfo:void 0,defaultColumnData:{},insertMode:void 0,loaded:!1,sendingData:!1,collapseChanges:!1},this.onMount=async()=>{var e,t,n,i,r;const{columns:s,tableName:o,db:a,lang:l,includeMedia:c=!0,rowFilter:u,tables:d}=this.props,h=a[o],p=null===(e=d.find((e=>e.name===o)))||void 0===e?void 0:e.info;if(!(null==h?void 0:h.getInfo)||!(null==h?void 0:h.getColumns)||!p)throw"Table getInfo/getColumns hooks not available/published: "+o;let f;(null===(t=p.dynamicRules)||void 0===t?void 0:t.update)&&"update"===this.getAction()&&(f={rule:"update",filter:lT(u),data:{thisIsBad:1}});let m,g=await h.getColumns(l,f);s&&(g=s.map((e=>{if("string"==typeof e)return g.find((t=>t.name===e));{const t=g.find((t=>t.name===e.name));if(!t)return;return e.sectionHeader?{...t,...e}:{...t}}})).filter(vT)),(null==p?void 0:p.has_media)&&p.media_table_name&&c&&(null===(n=a[p.media_table_name])||void 0===n?void 0:n.getInfo)&&(m=await(null===(r=null===(i=a[p.media_table_name])||void 0===i?void 0:i.getInfo)||void 0===r?void 0:r.call(i)));let y={};u||g.map((e=>{y[e.name]=SmartFormField.parseDefaultValue(e,void 0,!1)})),this.setState({columns:g,tableInfo:p,mediaTableInfo:m,defaultColumnData:y,loaded:this.state.loaded||Boolean(!u)})},this.getErrors=async e=>{const{defaultData:t={},rowFilter:n,cannotBeNullMessage:i="Must not be empty"}=this.props,{columns:r,newRow:s={},defaultColumnData:o={}}=this.state,a={...o,...t,...s};let l;if(this.getDisplayedColumns().filter((e=>!e.is_nullable&&(e.insert||e.update))).map((e=>{var t;(!n&&(t=null==a?void 0:a[e.name],[void 0,null].includes(t))&&!e.has_default||null===(null==a?void 0:a[e.name]))&&(l=l||{},l[e.name]=i)})),l)this.setState({errors:l});else{let t;this.props.onValidateValue&&r?await Promise.all(r.map((async e=>{var n,i;const r=await(null===(i=(n=this.props).onValidateValue)||void 0===i?void 0:i.call(n,a[e.name],a,e));r&&(t=t||{},t={...t,[e.name]:r})}))):this.props.onValidate&&r&&(t=await this.props.onValidate(a,r));const n=t||await e(a);n&&!fT(n)&&this.setState({errors:n})}},this.onDelta=async(e,t,n)=>{var i,r;const{tableName:s,db:o,getRef:a}=this.props;a&&a({getErrors:this.getErrors});const l=this.getRowFilter();if(((null==e?void 0:e.rowFilter)||(null==t?void 0:t.rowFilter))&&JSON.stringify((null===(i=this.rowSub)||void 0===i?void 0:i.filter)||"")!==JSON.stringify(l||"")){if(!l)return void console.error("rowFilter missing");await(null===(r=this.rowSub)||void 0===r?void 0:r.unsubscribe());const e=o[s],t=async()=>{var t;this.setState({loaded:!0,currentRow:await(null===(t=e.findOne)||void 0===t?void 0:t.call(e,l,{select:await this.getSelect()}))})};if(e.subscribeOne)try{this.rowSub=await e.subscribeOne(l,{select:await this.getSelect()},(e=>{e&&this.setState({currentRow:e,loaded:!0})}))}catch(e){console.error("Could not subscribe",e),t()}else t()}},this.onUnmount=async()=>{this.rowSub&&await this.rowSub.unsubscribe()},this.getSelect=async()=>{var e,t;const{tableName:n,db:i,includeMedia:r=!0}=this.props,{tableInfo:s}=this.state;let o=s;s||(o=await(null===(t=null===(e=i[n])||void 0===e?void 0:e.getInfo)||void 0===t?void 0:t.call(e)),this.setState({tableInfo:o}));let a={$rowhash:1,"*":1};return r&&(null==o?void 0:o.media_table_name)&&(a[o.media_table_name]="*"),a},this.getRowFilter=()=>{var e,t;const n=(null===(e=this.state)||void 0===e?void 0:e.rowFilter)||(null===(t=this.props)||void 0===t?void 0:t.rowFilter);if(n)return lT(n)},this.getRow=async()=>{var e,t;const{tableName:n,db:i,includeMedia:r=!0}=this.props;return null===(t=(e=i[n]).find)||void 0===t?void 0:t.call(e,this.getRowFilter(),{select:await this.getSelect()})},this.checkRow=async()=>{const e=this.getRowFilter();await this.getRow();return e},this.setData=async(e,t)=>{var n,i,r,s,o;this.wasChanged=!0;const{db:a,tableName:l,rowFilter:c,onChange:u,onSuccess:d}=this.props,{currentRow:h={},localChanges:p,confirmUpdates:f=null!==(n=this.props.confirmUpdates)&&void 0!==n&&n,showLocalChanges:m=null!==(i=this.props.showLocalChanges)&&void 0!==i&&i,errors:g}=this.state;let y,v={...this.state.newRow||{},[e.name]:t},b=Object.keys(v).reduce(((e,t)=>({...e,[t]:h[t]})),{}),w={};if("update"===this.getAction()&&h&&dT(v).forEach((e=>{v[e]===h[e]&&e in h&&delete v[e]})),u||!c||f)w={...w,newRow:v};else try{const n=await(null===(s=(r=a[l]).update)||void 0===s?void 0:s.call(r,c,{[e.name]:t},{returning:"*"}));null==d||d("update",n)}catch(e){throw e.txt||e}!f&&c&&e.is_pkey&&(w={...w,rowFilter:{...(null===(o=this.props)||void 0===o?void 0:o.rowFilter)||{},[e.name]:t}}),null==u||u(v),g&&(y={...g},delete y[e.name],w={...w,errors:y}),this.setState({...w,localChanges:p.slice(0).concat([{oldRow:b,newRow:v}])})},this.closed=!1,this.wasChanged=!1,this.onClose=()=>{const{onClose:e,rowFilter:t}=this.props;t||!this.wasChanged||this.closed?null==e||e(!0):this.setState({confirmPopup:{acceptBtn:{color:"danger",text:"Discard"},onClose:e,message:"Are you sure you want to close this? You will lose your changes",onAccept:()=>null==e?void 0:e(!1)}})},this.getThisRow=()=>{const{newRow:e,currentRow:t={},defaultColumnData:n={},clonedRow:i}=this.state,{defaultData:r={}}=this.props;return i?{...i,...e}:{...t,...n,...r,...e}},this.parseError=e=>{let t={error:e.err||e.txt||e.msg||e};if(Object.keys(e||{}).length&&e.constraint){let n=[],i={};e.columns?n=e.columns:e.column&&(n=[e.column]),n.forEach((t=>{var n;if(null===(n=this.state.columns)||void 0===n?void 0:n.find((e=>e.name===t))){let n=e.constraint;"unique_violation"===e.code_info&&(n="This value already exists in the table (Unique constraint). Use something else"),i[t]=n}})),Object.keys(i).length&&(t={errors:i})}this.setState({...t,sendingData:!1})},this.getAction=()=>{const{db:e,tableName:t,rowFilter:n}=this.props,{clonedRow:i}=this.state;let r="view";return n&&(this.tableHandler.update||this.tableHandler.delete)&&!i?r="update":!this.tableHandler.insert||n&&!i||(r="insert"),r},this.getDisplayedColumns=()=>{this.getAction();return this.state.columns||[]},this.getUpperFooter=()=>{const{onChange:e,rowFilter:n,tableName:i,db:r,onAddTable:s,tables:o,showJoinedTables:a=!0}=this.props,{columns:l,newRow:c,tableInfo:u,currentRow:d,collapseChanges:h}=this.state,p=this.getAction(),f=e&&"update"===p&&Object.keys(c||{}).length;return t.createElement("div",{className:"flex-col o-auto min-h-0 min-w-0 w-full f-0 ",style:{boxShadow:"0px 3px 9px 0px #404040",clipPath:"inset(-10px 0px 0px 0px)",minHeight:"1px",maxHeight:"30vh"}},a&&t.createElement(JoinedRecords,{db:r,onAddTable:s,rowFilter:n,tableName:i,tables:o,onSetNestedInsertData:e=>{this.setState({newRow:{...this.state.newRow,...e}})}}),f?t.createElement(t.Fragment,null,t.createElement("div",{className:"noselect flex-row ai-center pointer  "+(h?" ":"  mb-p5 "),style:{borderTop:"1px solid #cecece"},onClick:()=>this.setState({collapseChanges:!h})},t.createElement("h4",{className:"noselect  f-1 px-1"},"Changes (",Object.keys(c||{}).length,"):"),t.createElement(Btn,{className:"f-0 ",iconPath:h?Je:Ze,title:"Collapse/Expand changes",size:"small"})),!h&&t.createElement("div",{className:"flex-col w-full ai-start "+(f?" p-1 ":" ")},dT(null!=c?c:{}).map((e=>{if(!c||!d)return null;const n=null==l?void 0:l.find((t=>t.name===e));let i=null,r=null;return!n&&(null==u?void 0:u.media_table_name)===e&&Array.isArray(c[e])?(r=JSON.stringify([d[e].map((e=>e.name))]).slice(1,-1),i=JSON.stringify([c[e].map((e=>e.name))]).slice(1,-1)):(r=SmartFormField.renderValue(n,d[e]),i=SmartFormField.renderValue(n,c[e])),t.createElement("div",{key:e,className:"flex-row mb-p5 ai-center w-full"},t.createElement("div",{className:"flex-col mb-p5 ta-left o-auto "},t.createElement("div",{className:"text-gray-500 font-14 mb-p25"},(null==n?void 0:n.label)||e,": "),t.createElement("div",{title:"Old value",className:" text-red-500 o-auto",style:{maxHeight:"100px"}},r),t.createElement("div",{title:"New value",className:" text-green-500 o-auto",style:{maxHeight:"100px"}},i)),t.createElement(Btn,{iconPath:Me,size:"small",title:"Remove update",onClick:()=>{this.setState({newRow:pT(c,void 0,[e])})}}))})))):null)}}get tableHandler(){const{db:e,tableName:t,rowFilter:n}=this.props,i=e[t];if(!i)throw`${t} handler missing`;return i}render(){var e,n,i,r,s,o;const{db:a,tableName:l,onChange:c,showSuggestions:u,label:d,hideChangesOptions:h=!1,includeMedia:p=!0,asPopup:f,onInserted:m,enableInsert:g=!0,onSuccess:y,tables:v,className:b}=this.props,{error:w,columns:x,newRow:_,success:E,localChanges:S,errors:C={},tableInfo:T,confirmUpdates:A=null!==(e=this.props.confirmUpdates)&&void 0!==e&&e,showLocalChanges:k=null!==(n=this.props.showLocalChanges)&&void 0!==n&&n,confirmPopup:N,insertMode:M,mediaTableInfo:P,loaded:L,sendingData:O=!1,currentRow:R,collapseChanges:I,clonedRow:D,searchReferencedRow:F}=this.state,B=a[l],z=this.getAction();let j="view"===z||this.props.hideNullBtn,V=null;if("view"!==z&&k&&!c&&(V=S.length?t.createElement("div",{className:"flex-col ai-start o-auto",style:{maxHeight:"30%"}},S.map((({oldRow:e,newRow:n},i)=>t.createElement("div",{key:i,className:"mt-p5 flex-col ai-start"},"update"===z?t.createElement(t.Fragment,null,t.createElement("div",{className:"p-p25"},"Old data: ",JSON.stringify(e)),t.createElement("div",{className:"p-p25"},"New data: ",JSON.stringify(n))):t.createElement("div",{className:"p-p25"},JSON.stringify(n)))))):t.createElement("div",{className:"p-1"},"No local changes")),!x||!L)return t.createElement(Loading,{className:"absolute "+b});let U=this.getThisRow(),H=null;if(N)H=t.createElement(ConfirmationDialog,{onClose:()=>{this.setState({confirmPopup:void 0})},onAccept:async()=>{await N.onAccept(),this.setState({confirmPopup:void 0})},message:N.message,acceptBtn:N.acceptBtn});else if(!c){const e="view"===z?null:"update"===z?t.createElement(t.Fragment,null,A&&B.update&&_?t.createElement(Btn,{color:"action",className:"mt-1 mr-1",variant:"filled",disabledInfo:Object.keys(_||{}).length?void 0:`No data to ${z}`,onClick:async()=>{this.getErrors((async e=>{e&&this.setState({confirmPopup:{message:"Are you sure you want to update this row?",acceptBtn:{text:"Update row!",color:"action"},onAccept:async()=>{let e;this.setState({confirmPopup:void 0,sendingData:!0});try{e=await this.checkRow();const t=await B.update(e,_,{returning:"*"});null==y||y("update",t),this.setState({error:null,success:"updated",sendingData:!1}),this.closed=!0,setTimeout((()=>{var e,t;this.mounted&&(null===(t=null===(e=this.props)||void 0===e?void 0:e.onClose)||void 0===t||t.call(e,!0))}),2e3)}catch(t){this.parseError(t),console.error(t,e,_)}},onClose:()=>this.setState({confirmPopup:void 0})}})}))}},"Update"):null,B.delete?t.createElement(Btn,{color:"danger",variant:"outline",title:"Remove this row from table",className:"mt-1 mr-1",onClick:async()=>{this.setState({confirmPopup:{message:"Are you sure you want to delete this?",acceptBtn:{text:"Delete!",color:"danger"},onAccept:async()=>{this.setState({confirmPopup:void 0,sendingData:!0});try{await B.delete(await this.checkRow()),null==y||y("delete"),this.setState({error:null,success:"deleted",sendingData:!1}),this.closed=!0,setTimeout((()=>{var e,t;this.mounted&&(null===(t=null===(e=this.props)||void 0===e?void 0:e.onClose)||void 0===t||t.call(e,!0))}),2e3)}catch(e){this.parseError(e),console.error(e)}},onClose:()=>this.setState({confirmPopup:void 0})}})}},"Delete"):null,B.insert?t.createElement(Btn,{color:"action",variant:"outline",title:"Prepare a duplicate insert that excludes primary key fields",className:"mt-1 mr-1",onClick:async()=>{try{const e=await B.find(this.props.rowFilter);if(1===e.length){const t=v.find((e=>e.name===l));let n=e[0];null==t||t.columns.map((e=>{e.is_pkey&&delete n[e.name]})),this.setState({clonedRow:n})}else this.setState({error:"Could not clone row because the row filter refers to more than 1 row"})}catch(e){this.parseError(e),console.error(e)}}},"Clone"):null):t.createElement(t.Fragment,null,t.createElement(Btn,{color:"action",className:"mt-1 mr-1",variant:"filled",onClick:async()=>{this.getErrors((async e=>{if(e)try{this.setState({sendingData:!0});const e=await B.insert(this.getThisRow(),(null!=m?m:y)?{returning:"*"}:{});null==y||y("insert",e),null==m||m(e),this.setState({error:null,success:"inserted",sendingData:!1}),this.closed=!0,setTimeout((()=>{var e,t;this.mounted&&(null===(t=null===(e=this.props)||void 0===e?void 0:e.onClose)||void 0===t||t.call(e,!0))}),2e3)}catch(e){this.parseError(e),console.error(e)}}))}},"Insert"));H=t.createElement("div",{className:"flex-row-wrap p-p5 f-0 bt jc-around"},E&&!w?null:e,t.createElement(Btn,{className:"mt-1 mr-1",variant:"outline",onClick:this.onClose},"view"===z?"Close":"Cancel"))}let $=null;if((null==T?void 0:T.has_media)&&p){const e=T.media_table_name;$=e&&t.createElement(FileInput,{className:"mt-p5",label:(null==P?void 0:P.comment)||e,media:(null==U?void 0:U[e])||[],onAdd:t=>{const n=(null==_?void 0:_[e])||[];this.setData({name:e,is_pkey:!1},[...n,...t])},onDelete:async t=>{if("id"in t&&t.id){if(a[e].update){await a[e].update({id:t.id},{deleted:!0});null==y||y("update")}}else{const n=(null==_?void 0:_[e])||[];this.setData({name:e,is_pkey:!1},n.filter((e=>e.name!==t.name)))}}})}let q=null;if(M&&1===(null===(r=null===(i=null==M?void 0:M.references)||void 0===i?void 0:i.fcols)||void 0===r?void 0:r.length)&&(null===(o=null==a?void 0:a[null===(s=null==M?void 0:M.references)||void 0===s?void 0:s.ftable])||void 0===o?void 0:o.insert)&&(q=t.createElement(SmartForm,{asPopup:!0,tables:v,db:a,hideNullBtn:j,tableName:M.references.ftable,hideChangesOptions:!0,onClose:()=>{this.setState({insertMode:void 0})},onInserted:e=>{x.filter((e=>{var t,n;return(null===(t=e.references)||void 0===t?void 0:t.ftable)===(null===(n=null==M?void 0:M.references)||void 0===n?void 0:n.ftable)})).map((t=>{var n;null===(n=t.references)||void 0===n||n.fcols.map((n=>{this.setData(t,e[n])}))})),this.setState({insertMode:void 0})}})),F){const{tableName:e,col:n,fcols:i}=F;return t.createElement(SmartTable,{title:`Find ${e} record`,db:a,tables:v,tableName:e,onClickRow:e=>{if(!e)throw new Error("row missing");this.setData(n,e[i[0]]),this.setState({searchReferencedRow:void 0})},onClosePopup:()=>{this.setState({searchReferencedRow:void 0})}})}const W=this.getRowFilter(),G=W?l+" ("+Object.keys(W).map((e=>`${e}: ${JSON.stringify(W[e])}`)).join(" AND ")+")":z+" "+((null==T?void 0:T.comment)||l),Y=null!=d?d:(D?"[Cloned row] ":"")+G,X=f||!d&&"label"in this.props?null:Y?t.createElement("h4",{style:{margin:0,padding:"1em",paddingBottom:".5em"}},Y):null;let K=t.createElement("div",{className:"flex-col f-1 min-h-0 bt relative "+(O?" no-pointer-events noselect ":" ")+b},O?t.createElement("div",{className:"absolute bg-gray-600 flex-col ai-center jc-center",style:{inset:0,zIndex:1,opacity:.4}},t.createElement(Loading,null)):null,q,X,t.createElement("div",{className:"flex-col f-1 o-auto min-h-0 min-w-0 p-1",style:{paddingTop:0}},this.getDisplayedColumns().map(((e,n)=>{var i;(U||{})[e.name];let r=null,s=null;const o=null===(i=null==e?void 0:e.references)||void 0===i?void 0:i.ftable,c=null==a?void 0:a[o];g&&"insert"===z&&o&&(null==c?void 0:c.insert)&&(s=t.createElement(Btn,{iconPath:He,onClick:()=>{this.setState({insertMode:e})}}));let d=null;if("view"!==z&&o&&(null==c?void 0:c.find)){d=v.some((e=>e.name===o&&e.columns.length>1))?t.createElement(Btn,{iconPath:qe,title:"Find record",onClick:async()=>{var t,n;null===(t=v.find((e=>e.name===o)))||void 0===t||t.columns;this.setState({searchReferencedRow:{tableName:o,fcols:null===(n=null==e?void 0:e.references)||void 0===n?void 0:n.fcols,col:e}})}}):null}return(s||d)&&(r=t.createElement("div",{className:"flex-row"},d,s)),t.createElement(SmartFormField,{tables:v,key:n,db:a,tableName:l,action:z,column:e,value:(U||{})[e.name]||"",rawValue:(U||{})[e.name],onChange:t=>this.setData(e,t),showSuggestions:u,error:C[e.name],rightContent:r,hideNullBtn:j,sectionHeader:e.sectionHeader,style:e.sectionHeader?{marginTop:"1em"}:{},variant:"column"})})),$),h||"view"===z?null:t.createElement(t.Fragment,null,c||"insert"===z?null:t.createElement(Checkbox,{label:"Confirm updates",checked:A,onChange:({currentTarget:e})=>{this.setState({confirmUpdates:e.checked})}}),c?null:t.createElement(Checkbox,{label:"Show local changes",checked:k,onChange:({currentTarget:e})=>{this.setState({showLocalChanges:e.checked})}})),V,this.getUpperFooter(),t.createElement(ErrorComponent,{error:w,className:"f-0",style:{flex:"none",padding:"1em"}}),E&&!w?t.createElement("div",{className:"text-green-600 p-1 flex-col"},t.createElement("div",{className:"text-green-600 p-1 flex-col mb-p5"}," Row ",E,"! "),t.createElement(Success,null)):null,H);return f?t.createElement(Popup,{title:Y,open:!0,contentClassName:"",positioning:"right-panel",onClose:this.onClose},K):K}}const dT=Object.keys,hT=(e,t)=>("string"==typeof t&&(t=t.split(".")),t.reduce(((e,t)=>e&&"undefined"!==e[t]?e[t]:void 0),e));function pT(e,t=[],n=[]){if(!t.length&&!n.length)return{};let i=Object.keys(e);if(e&&i.length){let r={};return i.forEach((i=>{(t.length&&t.includes(i)||n.length&&!n.includes(i))&&(r[i]=e[i])})),r}return e}function fT(e){return 0===Object.keys(null!=e?e:{}).length}function mT(e,t=[]){let n=t;if(!n.length)return{};if(e&&n.length){let t={};return n.forEach((n=>{t[n]=e[n]})),t}return e}function gT(e,t){var n,i=[{value:1,symbol:""},{value:1e3,symbol:"k"},{value:1e6,symbol:"M"},{value:1e9,symbol:"G"},{value:1e12,symbol:"T"},{value:1e15,symbol:"P"},{value:1e18,symbol:"E"}];for(n=i.length-1;n>0&&!(e>=i[n].value);n--);return(e/i[n].value).toFixed(t).replace(/\.0+$|(\.[0-9]*[1-9])0+$/,"$1")+i[n].symbol}function yT(e){if(e&&"string"==typeof e){let t,n=[];return e.split("").map(((i,r)=>{const s=i.match(/[A-Za-z]/)?"c":i.match(/[0-9.]/)?"n":"s",o={idx:r,len:1,val:i,type:s,decimalPlaces:0};t?t.type!==s?(n.push(t),t=o):(t.len=r-t.idx+1,t.val+=i):t=o,r===e.length-1&&(t.len=r-t.idx+1,n.push(t))})),n.map((e=>("n"===e.type&&e.val.includes(".")&&(e.decimalPlaces=e.len-1-e.val.indexOf(".")),e)))}return[]}const vT=e=>null!=e;class ErrorComponent extends t.Component{constructor(){super(...arguments),this.scrollIntoView=()=>{const{error:e}=this.props;e&&this.ref&&this.ref.scrollIntoView&&(this.ref.scrollIntoViewIfNeeded?this.ref.scrollIntoViewIfNeeded():this.ref.scrollIntoView())}}componentDidMount(){this.scrollIntoView()}componentDidUpdate(){this.scrollIntoView()}render(){const{error:e,className:n="",style:i={},pre:r=!1,findMsg:s=!1,withIcon:o=!1}=this.props,a=e=>{let t="";return"string"==typeof e?t=e:Array.isArray(e)?t=a(e):e&&!fT(e)&&Object.keys(e).length?(s&&(t=hT(e,"err.err_msg")||hT(e,"err.constraint")||hT(e,"err.txt")||e.err_msg||JSON.stringify(e)),t||(t=Object.keys(e).map((t=>`${t}: ${JSON.stringify(e[t],null,2)}`)).join("\n"))):t=hT(e,"toString")?e.toString():JSON.stringify(e),"string"==typeof t&&t.length&&(t=t.trim(),t.startsWith('"')&&t.endsWith('"')&&(t=t.slice(1,-1)),t.toLowerCase().startsWith("error: ")&&(t=t.slice(7)),t=t.replace(/\\"/g,'"')),t};return t.createElement("div",{ref:e=>{e&&(this.ref=e)},className:"f-1 flex-row ai-start text-red-800 p-1 o-auto min-w-0 min-h-0 o-auto "+(r?" ws-pre ":"")+n,style:{whiteSpace:"pre-line",textAlign:"left",display:e?"flex":"none",padding:"0 4px",...i,minWidth:"150px"}},(a(e)+"").slice(0,300),o&&t.createElement(tt(),{size:2,className:"ml-1",path:we}))}}class ErrorTrap extends t.Component{constructor(){super(...arguments),this.state={error:"",errorInfo:""}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t})}render(){const{error:e,errorInfo:n}=this.state,i=hT(this.props,"children.type.name");let r={error:e,stack:hT(n,"componentStack")||n};return i&&(r={component:i,...r}),e?t.createElement(ErrorComponent,{error:r}):this.props.children}}class List extends t.Component{render(){const{className:e="",style:n={},items:i,onReorder:r,onClose:s,selectedValue:o,checkedValues:a,anchorRef:l,anchorContent:c}=this.props,u=t.createElement("ul",{className:"list-comp f-1 o-auto min-h-0 min-w-0 no-scroll-bar"+e,role:"list",ref:e=>{e&&(this.refList=e)},style:{padding:0,...n}},i.length?i.map(((e,n)=>t.createElement("li",{key:n,role:"listitem",draggable:Boolean(r),onDrag:r?e=>{const t=e.currentTarget,n=t.parentElement;t.style.display="none";Array.from(n.children).map(((t,i)=>{const r=t.getBoundingClientRect();let s=e.clientY>r.y&&e.clientY<r.y+r.height;const o=s?"35px":"";o!==t.style.paddingTop&&(t.style.paddingTop=o),s&&(n._targetIdx=i)}));const i=n.getBoundingClientRect();e.clientY>i.y+i.height?n.scrollTop+=10:e.clientY<i.y&&(n.scrollTop-=10)}:void 0,onDragEnd:r?async e=>{const t=e.currentTarget,s=t.parentElement;let o=s._targetIdx,a=i.slice(0);var l,c,u;l=n,c=o,u=a.splice(l,1)[0],a.splice(c,0,u),await r(a),setTimeout((()=>{Array.from(s.children).map((e=>{e.style.paddingTop=""})),t.style.display="flex"}),1)}:void 0,className:"flex-row  p-p5 pointer "+(e.key===o?" selected ":""),onClick:e.onPress?t=>e.onPress(t):void 0,onKeyUp:e.onPress?t=>{"Enter"===t.key&&e.onPress(t)}:void 0},e.content||t.createElement(t.Fragment,null,e.contentLeft||null,t.createElement("label",{className:"mr-p5 f-1 flex-row pointer noselect",style:e.style},e.node||e.label||e.key),e.contentRight||null,a?t.createElement(Checkbox,{className:"f-0",checked:a.includes(e.key),style:{marginRight:"12px"}}):null)))):t.createElement("div",{className:"p-p5"},"No results"));let d,h;return l&&(d=l,h=u),c&&(d=this.popupAnchor,h=t.createElement("div",{className:"list-comp w-fit flex-col bg-white",style:{padding:0,margin:0,textDecoration:"none",listStyle:"none"}},t.createElement("div",{ref:e=>{e&&(this.popupAnchor=e)},className:"f-0 min-h-0 min-w-0 m-p5 flex-row jc-start "},h),u)),d&&h?t.createElement(Popup,{open:!0,rootStyle:{padding:0},anchorEl:d,positioning:"beneath-left",clickCatchStyle:{opacity:0},onClose:s,contentClassName:"rounded",focusTrap:!1},h):d||h?null:u}}class FormField extends t.Component{constructor(){super(...arguments),this.state={},this.setResizer=()=>{const{asTextArea:e,autoResize:t=!0}=this.props;if(this.rootDiv&&e&&t&&!this.textArea){const e=this.rootDiv.querySelector("textarea");e&&(this.textArea=e,e.addEventListener("input",this.resize,!1),setTimeout((()=>{this.resize()}),10))}},this.resize=()=>{if(this.textArea){const e=this.textArea,t=Math.min(100,e.scrollHeight),n=e.scrollWidth;let i=e.offsetWidth;i=Number.isFinite(i)&&i>=e.offsetWidth?i:e.offsetWidth;let r=e.offsetHeight;r=Number.isFinite(r)&&r>=e.offsetWidth?r:e.offsetHeight,i<n&&(e.style.width="",e.style.width=n+"px"),r<t&&(e.style.height="",e.style.height=t+"px")}},this.searchOptions=e=>{this.props.onSearchOptions&&this.props.onSearchOptions(e).then((e=>{this.setState({options:e})}))},this.mounted=!1,this.focus=e=>{},this.blur=e=>{},this.onChange=e=>{const{onChange:t,onSuggest:n}=this.props;if(!t)return;const i="file"===e.type?e.files:"checkbox"===e.type?e.checked:e.value;if(t(i),!n)return;this.changing&&clearTimeout(this.changing.timeout);const r=this.changing?100:0;this.changing={value:i,timeout:setTimeout((async()=>{if(this.mounted&&this.changing){const{onSuggest:e}=this.props,{value:t}=this.changing;if(e){const n=await e(this.changing.value);this.setState({suggestions:1===n.length&&n[0]===t?void 0:n})}this.changing=void 0}}),r)}},this.cursorPosition=0}componentDidMount(){this.mounted=!0,this.setResizer()}componentWillUnmount(){this.mounted=!1,this.textArea&&this.textArea.removeEventListener("input",this.resize,!1)}componentDidUpdate(e){const t=this.props.error,n=e.error;this.rootDiv&&e&&this.props&&(t||n)&&t!==n&&(this.rootDiv.scrollIntoViewIfNeeded?this.rootDiv.scrollIntoViewIfNeeded({block:"end",behavior:"smooth"}):this.rootDiv.scrollIntoView({block:"end",behavior:"smooth"})),this.setResizer(),e.value!==this.props.value&&(this.resize(),this.inputRef&&/text|password|search|tel|url/.test(this.inputRef.type)&&void 0!==this.cursorPosition&&(this.inputRef.selectionStart=this.cursorPosition,this.inputRef.selectionEnd=this.cursorPosition))}render(){var e,n,i,r;const{onChange:s,label:o,value:a,defaultValue:l,id:c,options:u,required:d=!1,readOnly:h=!1,type:p="text",autoComplete:f="on",error:m,hint:g,placeholder:y,className:v="",inputClassName:b="",style:w={},inputStyle:x={},asTextArea:_=!1,accept:E,onInput:S,asColumn:C,rightIcons:T=null,rightContent:A=null,title:k,nullable:N=!1,multiSelect:M,labelAsValue:P,onSuggest:L,options:O=(null===(e=this.state)||void 0===e?void 0:e.options),name:R=(null===(n=this.props)||void 0===n?void 0:n.type),inputProps:I={},hideNullBtn:D=!1,maxWidth:F="400px",rawValue:B,labelClass:z="",labelStyle:j={}}=this.props,{suggestions:V,activeSuggestionIdx:U=0}=this.state,H=[B,l,a].find((e=>void 0!==e));let $=O?{width:"fit-content",minWidth:0}:{};const q={pointerEvents:"none",touchAction:"none"};(O||"checkbox"===p)&&h&&($={...$,backgroundColor:"var(--gray-100)",...q});let W={value:[void 0,null].includes(a)?"":a};h&&(W={value:a}),l&&(W={defaultValue:l});let G=" font-semibold ";"checkbox"!==p&&(G+=" bg-white ",$={...$}),p.startsWith("file")&&(G+=" pointer ");let Y={};"color"===p&&a&&($={...$,backgroundColor:a||"white",cursor:"pointer"},Y={opacity:0}),"checkbox"===p&&(W={checked:Boolean(a||l)},$={...$,minWidth:0,width:"fit-content",border:"none",overflow:"visible"}),_&&($={...$,border:"none",overflow:"visible"}),G+=" "+b;const X={id:c,key:c,ref:e=>{e&&(this.inputRef=e)},required:d,readOnly:h,className:G,type:p,accept:E,...W,autoComplete:f,onInput:S,placeholder:y,name:R,...I,style:{...Y,...x,...I.style},onChange:({currentTarget:e})=>(this.cursorPosition=e.selectionStart,this.onChange(e)),onFocus:e=>{var t;null===(t=null==I?void 0:I.onFocus)||void 0===t||t.call(I,e)},...p.startsWith("file")?{onDragOver:e=>{e.currentTarget.classList.toggle("active-drop-target",!0)},onDrop:e=>{e.currentTarget.classList.toggle("active-drop-target",!1)},onDragEnd:e=>{e.currentTarget.classList.toggle("active-drop-target",!1)},onDragExit:e=>{e.currentTarget.classList.toggle("active-drop-target",!1)},onDragLeave:e=>{e.currentTarget.classList.toggle("active-drop-target",!1)}}:{}},K=e=>{null==s||s(e),this.setState({suggestions:void 0})},Z=async()=>{if(L){const e=await L(a);this.setState({suggestions:e})}},J=_?t.createElement("textarea",{...X,style:{width:"100%",minWidth:"5em",minHeight:"2em",whiteSpace:"pre-line",borderRadius:".5em",...X.style}}):"checkbox"===p?t.createElement(Checkbox,{...X}):t.createElement("input",{...X,style:{..."file"!==X.type?{padding:window.isMobileDevice?"2px 6px":".5em .5em 4px .5em"}:{paddingBottom:"4px"},minHeight:"28px",...X.style}});let Q,ee;return T&&(Q=T),!h&&s&&N&&!D&&(ee=t.createElement(Btn,{color:null===H?"action":void 0,title:null!==H?"Change to NULL":"Value is NULL",onClick:e=>{null!==H&&s(null,e)}},"NULL")),t.createElement("div",{className:"form-field min-w-0 "+v,style:w,ref:e=>{e&&(this.rootDiv=e)},onBlur:()=>{V&&this.setState({suggestions:void 0})},onKeyDown:e=>{var t,n;if(["text","search"].includes(p)&&"INPUT"===(null===(t=document.activeElement)||void 0===t?void 0:t.nodeName)&&(null===(n=this.refWrapper)||void 0===n?void 0:n.contains(document.activeElement)))if("Enter"===e.key)(null==V?void 0:V.length)&&U>-1?K(V[U]):V&&this.setState({suggestions:void 0});else if(["ArrowUp","ArrowDown"].includes(e.key)){if(null==V?void 0:V.length){let t=-1;["ArrowDown"].includes(e.key)&&(t=1);let n=Number.isFinite(U)?Math.max(0,U+t):0;n>V.length-1&&(n=0),this.setState({activeSuggestionIdx:n})}else if(["ArrowDown"].includes(e.key)&&!a&&L)Z();else{const t=document.activeElement;if("number"!=typeof t.selectionStart)return;this.cursorPosition=t.selectionStart;const n=yT(t.value),i=t.selectionStart,r=n.find((e=>"n"===e.type&&e.idx<=i&&e.idx+e.len>=i));if(r){this.inputSelStart=i;const s="ArrowUp"===e.key;t.value=n.map((t=>{if(t.idx===r.idx){let t=e.altKey?.1:e.ctrlKey?10:1,n=e.altKey?1:0,i=+r.val+(s?t:-t);i=Math.max(i,0);let o=i.toFixed(r.decimalPlaces||n).padStart(r.len,"0");return r.decimalPlaces&&o.endsWith("."+new Array(r.decimalPlaces).fill("0").join(""))&&(o=o.slice(0,-r.decimalPlaces-1)),o}return t.val})).join(""),this.onChange(t)}else this.inputSelStart=void 0}e.preventDefault(),e.stopPropagation()}}},t.createElement("div",{className:("checkbox"===p||C?" ":" ai-center ")+(C?" flex-col ":" flex-row-wrap "),title:k},o?t.createElement("label",{htmlFor:c,className:"main-label ta-left noselect text-gray-500 "+(c?" pointer ":" ")+z,style:{flex:.5,...h?q:{},...j}},o):null,t.createElement("div",{className:"flex-row f-1 ai-center min-w-0"},t.createElement("div",{className:"flex-col f-1 min-w-0",style:{maxWidth:"100%"}},t.createElement("div",{className:"input-wrapper focus-border  flex-row relative w-full "+(m?" error ":""),ref:e=>{e&&(this.refWrapper=e)},style:{...$,maxWidth:_?"100%":F}},Array.isArray(O)?t.createElement(Select,{className:"noselect f-1 bg-white",style:{background:"white"},options:O,onSearch:(null===(i=this.props)||void 0===i?void 0:i.onSearchOptions)?e=>this.searchOptions(e):void 0,onChange:s?e=>{s(e)}:void 0,value:H,required:d,multiSelect:M,labelAsValue:P}):J,(null===(r=this.props)||void 0===r?void 0:r.onSuggest)&&V?t.createElement(List,{anchorRef:this.refWrapper,selectedValue:V[U],items:V.map((e=>({key:e,node:null===e?t.createElement("i",null,"NULL"):""===e.trim()?t.createElement("i",null,"Empty"):null,onPress:t=>{K(e)}}))),onClose:()=>{this.setState({suggestions:void 0})}}):null,Q||ee?t.createElement("div",{className:"flex-row ai-start jc-center "+("checkbox"===p||_?" ":"  bl b-gray-300 "),style:{right:"2px",top:0,bottom:0,background:"white"}},Q,ee):null,m?t.createElement(tt(),{size:1,className:"text-red-500 absolute",path:we,style:{top:"2px",right:"6px",backgroundColor:"white"}}):null),m?t.createElement(ErrorComponent,{error:m,style:{padding:0,marginTop:".5em"}}):null,g&&t.createElement("p",{className:"ta-left text-gray-400 mx-0 text-sm noselect my-p5"},g)),A?t.createElement("div",{className:"f-0"},A):null)))}}class Register extends t.Component{constructor(){super(...arguments),this.state={name:"",email:"",password:"",passwordConfirmation:"",registered:!1,registering:!1,acceptedTOS:!1,acceptedTOSErr:"",error:"",name_err:"",email_err:"",password_err:"",passwordConfirmation_err:""},this.submit=async()=>{const{name:e,email:t,password:n,passwordConfirmation:i,registered:r=!1,registering:s=!1,acceptedTOS:o=!1,acceptedTOSErr:a="",error:l="",name_err:c,email_err:u,password_err:d,passwordConfirmation_err:h}=this.state,{db:p,methods:f}=this.props;let m=!0;if(o?this.setState({acceptedTOSErr:""}):(m=!1,this.setState({acceptedTOSErr:"You must agree to our terms"})),m){this.setState({registering:!0});try{await f.register({name:e,email:t,password:n,acceptedTOS:o});this.setState({registering:!1,registered:"Registration has been received. You will soon be contacted to attend an interview. Thank you!"})}catch(e){this.setState({error:hT(e,"err")||e,registering:!1})}}}}render(){const e="card my-1 flex-col max-w m-auto bg-white",{name:n,email:i,password:r,passwordConfirmation:s,registered:o=!1,registering:a=!1,acceptedTOS:l=!1,acceptedTOSErr:c="",error:u="",name_err:d,email_err:h,password_err:p,passwordConfirmation_err:f}=this.state,{db:m,methods:g}=this.props;return o?t.createElement("div",{className:e},t.createElement("p",{className:"text-lg font-bold text-gray-600"},"Thank you, registration has been received!"),t.createElement("p",{className:"text-lg font-bold text-gray-600"},"You will soon be contacted to schedule an interview"),t.createElement(ye,{to:"/"},"Home")):t.createElement("form",{className:e+(a?" no-interaction ":" "),onSubmit:e=>{e.preventDefault(),this.submit()}},t.createElement("h1",{style:{marginTop:"12px"}},"Register"),t.createElement(FormField,{label:"Name",id:"name",className:"mt-1",type:"name",error:d,onChange:e=>{this.setState({name:e})}}),t.createElement(FormField,{label:"Email",id:"email",className:"mt-1",type:"email",error:h,onChange:e=>{this.setState({email:e})}}),t.createElement(FormField,{label:"Password",id:"password",className:"mt-1",type:"password",error:p,onChange:e=>{this.setState({email:e})}}),t.createElement(FormField,{label:"Repeat password",id:"repeat_password",className:"mt-1",type:"password",error:f,onChange:e=>{this.setState({passwordConfirmation:e})}}),t.createElement("h4",{className:"mt-2 mb-0"},"Terms"),t.createElement("div",{className:"mt-1"},t.createElement("div",{className:"flex items-center pointer pt-2"},t.createElement("input",{checked:l,onChange:e=>{const t=e.target.checked?{}:{acceptedTOSErr:""};this.setState({acceptedTOS:e.target.checked,...t})},id:"tos",type:"checkbox",className:"pointer"}),t.createElement("label",{htmlFor:"tos",className:"ml-p5 pointer noselect"},"I've read and accepted your ",t.createElement(ye,{to:"/tos",className:"link-anchor"},"terms and conditions")," and ",t.createElement(ye,{to:"/privacy",className:"link-anchor"},"privacy policy"))),t.createElement("p",{className:"mt-2 text-sm text-red-600 "+(c?" block ":" hidden "),id:"tos-error"},c)),t.createElement("p",{className:"mt-2 text-sm text-red-600 "+(u?" block ":" hidden ")},u),t.createElement("div",{className:"flex-row-wrap",style:{justifyContent:"flex-end",marginTop:"2em"}},t.createElement("button",{type:"button",className:"secondary mt-1 mr-1"},"Cancel"),t.createElement("button",{type:"submit",className:"mt-1"},a?t.createElement(Loading,{style:{margin:"-4px 10px"}}):"Submit")))}}const bT=["disable","allow","prefer","require","verify-ca","verify-full"];class NewConnection extends t.Component{constructor(){super(...arguments),this.state={conNotFound:!1,editMode:!1,nameErr:"",connection:{id:void 0,name:void 0,type:"Standard",db_user:"postgres",db_pass:"",db_name:"postgres",db_host:"localhost",db_port:5432,db_ssl:bT[0],prgl_url:"",prgl_params:"",db_conn:"",db_watch_shema:!0},status:"",statusOK:!1},this.componentDidMount=async()=>{var e,t,n;const i=null===(n=null===(t=null===(e=this.props)||void 0===e?void 0:e.match)||void 0===t?void 0:t.params)||void 0===n?void 0:n.id,{dbs:r}=this.props;if(i&&r){const e=await r.connections.findOne({id:i});e?this.setState({connection:{...e,type:e.db_conn?"Connection URI":"Standard"},editMode:!0}):this.setState({conNotFound:!0})}},this.testConnection=async()=>{const{connection:e}=this.state,{methods:t}=this.props;try{await t.testDBConnection(e),this.setState({status:"OK",statusOK:!0})}catch(e){console.log(e),this.setState({status:e.err_msg,statusOK:!1})}}}render(){const{nameErr:e,connection:n,status:i,statusOK:r,conNotFound:s,editMode:o}=this.state,{type:a,db_host:l,db_name:c,db_user:u,db_pass:d,db_port:h,db_ssl:p,db_conn:f,prgl_url:m,prgl_params:g,db_watch_shema:y}=n,{dbs:v,methods:b,history:w,dbsTables:x}=this.props;if(s)return t.createElement("div",null,t.createElement("p",null,"Connection not found"),t.createElement(ye,{to:"/"},"Go back"));const _=e=>{this.setState({nameErr:"",status:"",statusOK:!1,connection:{...this.state.connection,...e}})};return t.createElement("div",{className:"flex-col w-fit as-center min-h-0",style:{maxWidth:"100%"}},t.createElement(ye,{className:"p-1  b-gray-400 round flex-row ai-center",to:"/connections"},t.createElement(tt(),{path:_e,size:1}),t.createElement("div",{className:"ml-p5"},"Connections")),t.createElement("div",{className:"card m-1 flex-col bg-white  min-h-0 ",style:{maxWidth:"100%"}},t.createElement("div",{className:"flex-col f-1 o-auto min-h-0"},t.createElement(FormField,{label:"Connection name",type:"text",className:"mt-1",required:!0,error:e,value:n.name,asColumn:!0,onChange:e=>{_({name:e})}}),t.createElement("h4",{className:"my-1"},"Connection type"),t.createElement("div",{className:"flex-row c--spaced "},t.createElement("button",{className:"toggle "+("Standard"===a?" toggled ":""),onClick:()=>{_({type:"Standard"})}},"Standard"),t.createElement("button",{className:"toggle "+("Connection URI"===a?" toggled ":""),onClick:()=>{_({type:"Connection URI"})}},"URL")),"Prostgles"===a?t.createElement(t.Fragment,null,t.createElement(FormField,{label:"Socket URL",type:"url",className:"mt-1",required:!0,value:m,onChange:e=>{_({prgl_url:e})}}),t.createElement(FormField,{label:"Socket params (JSON)",type:"text",className:"mt-1",required:!0,value:g,onChange:e=>{_({prgl_params:e})},hint:'{ "path": "/socket" } '})):"Connection URI"===a?t.createElement(t.Fragment,null,t.createElement(FormField,{label:"Connection URI",type:"text",className:"mt-1",required:!0,value:f,onChange:e=>{_({db_conn:e})},hint:"postgres://user:pass@host:port/database?ssl=true"})):t.createElement(t.Fragment,null,t.createElement("div",{className:"flex-col "},t.createElement("div",{className:"flex-col c--spaced p-1"},t.createElement(FormField,{asColumn:!0,id:"u",value:u,label:"User",type:"text",autoComplete:"off",onChange:e=>_({db_user:e})}),t.createElement(FormField,{asColumn:!0,id:"pass",value:d,label:"Password",type:"text",autoComplete:"off",onChange:e=>_({db_pass:e})}),t.createElement(FormField,{asColumn:!0,id:"d",value:c,label:"Database",type:"text",autoComplete:"off",onChange:e=>_({db_name:e})}),t.createElement(FormField,{asColumn:!0,id:"h",value:l,label:"Host",type:"text",autoComplete:"off",onChange:e=>_({db_host:e})}),t.createElement(FormField,{asColumn:!0,id:"p",value:h,label:"Port",type:"number",autoComplete:"off",onChange:e=>_({db_port:e})}),t.createElement(FormField,{asColumn:!0,id:"s",label:"SSL Mode",options:bT,className:"mt-1",required:!0,value:p,onChange:e=>{_({db_ssl:e})}}),t.createElement(FormField,{asColumn:!0,id:"swatch",label:"Watch schema",className:"mt-1 ",hint:"Will reload on schema change. Requires superuser for best experience",required:!0,type:"checkbox",labelStyle:{flex:"unset"},value:y,onChange:e=>{_({db_watch_shema:e})}})))),"Prostgles"!==a?t.createElement("div",{className:"flex-row-wrap my-1 jc-center"},t.createElement(Btn,{className:"b rounded b-gray-400 mr-1",onClick:this.testConnection},"Test"),i?t.createElement("div",{style:{padding:"1em",borderRadius:"8px"},className:"chip flex-col p-1 "+(r?"green":"red")},t.createElement("span",null,"Connection status:"),t.createElement("span",null,i)):null):null),t.createElement("div",{className:"flex-row ai-center mt-1 "},o?t.createElement(Btn,{color:"danger",className:"b rounded b-red-400 mr-1",onClick:async e=>{var t,i;try{await v.workspaces.count({connection_id:n.id});const e=(await Promise.all(null!==(i=null===(t=x.find((e=>"connections"===e.name)))||void 0===t?void 0:t.joins.filter((e=>{var t;return(null===(t=v[e.tableName])||void 0===t?void 0:t.count)&&e.on.some((([e,t])=>"connection_id"===t))})).map((async e=>{var t,n;return{tableName:e.tableName,count:null!==(n=await(null===(t=v[e.tableName])||void 0===t?void 0:t.count()))&&void 0!==n?n:0}})))&&void 0!==i?i:[])).filter((e=>e.count));e.length&&alert(`Could not delete because there is related data: ${e.map((e=>`${e.tableName}: ${e.count}`)).join(", ")}`);await b.deleteConnection(n.id);w.push("/")}catch(e){console.log(e);const t=hT(e,"err.err_msg")||hT(e,"err.constraint")||hT(e,"err.txt")||e.err_msg||JSON.stringify(e);this.setState({nameErr:t})}}},"Delete"):null,o&&t.createElement(Btn,{variant:"outline",color:"action",title:"Clone connection",className:"f-0 mx-1 w-fit ",onClick:async e=>{this.setState({editMode:!1})}},"Clone"),t.createElement(Btn,{className:"f-1 ",variant:"filled",color:"action",onClickMessage:async(e,t)=>{try{const e={...n};if(o||delete e.id,!o&&await v.connections.findOne({name:n.name}))return void this.setState({nameErr:"Already exists. Chose another name"});const i=await b.createConnection(e);o||w.push("/connections/"+i.id),t({ok:"Updated!"})}catch(e){console.log(e);const t=hT(e,"err.err_msg")||hT(e,"err.constraint")||hT(e,"err.txt")||e.err_msg||JSON.stringify(e);this.setState({status:t,statusOK:!1})}}},o?"Update":"Create"))))}}class Login extends t.Component{constructor(){super(...arguments),this.state={password:"",username:"",usernameErr:"",passErr:"",remember_me:!1,forgotPassword:!1,resetusername:"",resetusernameErr:"",didReset:!1}}async signIn(){const{username:e,password:t,remember_me:n}=this.state,i={usernameErr:"Username and/or password is incorrect"};if(e)if(t)try{const{pathname:r,search:s}=window.location,o=await wT(r+s,{username:e,password:t,remember_me:n});console.log(await o.text()),o&&200===o.status?window.location.href=o.url:this.setState(i)}catch(e){console.error(e),e&&e.content&&"pending"===e.content.reason?this.setState({usernameErr:"Your account has not been approved yet"}):this.setState(i)}else this.setState({passErr:"Cannot be empty"});else this.setState({usernameErr:"Cannot be empty"})}render(){const{username:e,password:n,remember_me:i,usernameErr:r,passErr:s,forgotPassword:o,resetusername:a,resetusernameErr:l,didReset:c}=this.state;return t.createElement("div",{className:"card m-auto w-fit bg-white flex"},t.createElement("div",{style:{maxWidth:"400px"},className:"flex-col "},t.createElement("div",{className:" "},t.createElement("div",null,t.createElement("h2",{className:"mt-0"},"Sign in")),t.createElement("form",{onSubmit:e=>{e.preventDefault()}},t.createElement(FormField,{id:"username",value:e,type:"username",label:"Username",asColumn:!0,onChange:e=>{this.setState({username:e,usernameErr:"",passErr:""})},error:r}),t.createElement(FormField,{id:"password",value:n,type:"password",label:"Password",asColumn:!0,onChange:e=>{this.setState({password:e,usernameErr:"",passErr:""})},error:s}),t.createElement("div",{className:"mt-2"},t.createElement("span",{className:"block w-full rounded-md shadow-sm"},t.createElement("button",{onClick:e=>{this.signIn()},className:"w-full flex justify-center border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-500 focus:outline-none focus:border-indigo-700 focus:shadow-outline-indigo active:bg-indigo-700 transition duration-150 ease-in-out"},"Sign in")))))),(()=>{if(!o)return null;const e=[];return c&&e.push({label:"Reset Password",onClick:async()=>{if(!c)if(a&&a.trim())try{this.setState({didReset:!0})}catch(e){console.error(e),this.setState({resetusernameErr:"Something went wrong"})}else this.setState({resetusernameErr:"Required"})},color:"action"}),e.push({label:"Cancel",onClickClose:!0}),t.createElement(Popup,{open:!0,title:"Forgot your password?",footerButtons:e,onClose:()=>{this.setState({forgotPassword:!1,didReset:!1,resetusername:""})}},t.createElement("div",{className:"mb-1"},t.createElement(FormField,{id:"username-reset-pwd",type:"username",label:"Enter the username address associated with your account, and we'll send you a link to reset your password.",asColumn:!0,onChange:e=>{this.setState({resetusername:e,resetusernameErr:"",passErr:""})},error:l}),c&&t.createElement("div",{className:"mt-1 text-green-600"},"Thanks, we've sent you a password reset link to this username address (unless there is no account associated with it)")))})())}}async function wT(e,t){return await fetch(e,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)})}var xT=n(9139),_T=n.n(xT);const ET=Object.create(null);ET.open="0",ET.close="1",ET.ping="2",ET.pong="3",ET.message="4",ET.upgrade="5",ET.noop="6";const ST=Object.create(null);Object.keys(ET).forEach((e=>{ST[ET[e]]=e}));const CT={type:"error",data:"parser error"},TT="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),AT="function"==typeof ArrayBuffer,kT=(e,t)=>{const n=new FileReader;return n.onload=function(){const e=n.result.split(",")[1];t("b"+e)},n.readAsDataURL(e)},NT=({type:e,data:t},n,i)=>{return TT&&t instanceof Blob?n?i(t):kT(t,i):AT&&(t instanceof ArrayBuffer||(r=t,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer))?n?i(t):kT(new Blob([t]),i):i(ET[e]+(t||""));var r},MT="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",PT="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<MT.length;e++)PT[MT.charCodeAt(e)]=e;const LT="function"==typeof ArrayBuffer,OT=(e,t)=>{if(LT){const n=(e=>{let t,n,i,r,s,o=.75*e.length,a=e.length,l=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const c=new ArrayBuffer(o),u=new Uint8Array(c);for(t=0;t<a;t+=4)n=PT[e.charCodeAt(t)],i=PT[e.charCodeAt(t+1)],r=PT[e.charCodeAt(t+2)],s=PT[e.charCodeAt(t+3)],u[l++]=n<<2|i>>4,u[l++]=(15&i)<<4|r>>2,u[l++]=(3&r)<<6|63&s;return c})(e);return RT(n,t)}return{base64:!0,data:e}},RT=(e,t)=>"blob"===t&&e instanceof ArrayBuffer?new Blob([e]):e,IT=(e,t)=>{if("string"!=typeof e)return{type:"message",data:RT(e,t)};const n=e.charAt(0);if("b"===n)return{type:"message",data:OT(e.substring(1),t)};return ST[n]?e.length>1?{type:ST[n],data:e.substring(1)}:{type:ST[n]}:CT},DT=String.fromCharCode(30);function FT(e){if(e)return function(e){for(var t in FT.prototype)e[t]=FT.prototype[t];return e}(e)}FT.prototype.on=FT.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},FT.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},FT.prototype.off=FT.prototype.removeListener=FT.prototype.removeAllListeners=FT.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,i=this._callbacks["$"+e];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r=0;r<i.length;r++)if((n=i[r])===t||n.fn===t){i.splice(r,1);break}return 0===i.length&&delete this._callbacks["$"+e],this},FT.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(n){i=0;for(var r=(n=n.slice(0)).length;i<r;++i)n[i].apply(this,t)}return this},FT.prototype.emitReserved=FT.prototype.emit,FT.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},FT.prototype.hasListeners=function(e){return!!this.listeners(e).length};const BT="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function zT(e,...t){return t.reduce(((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t)),{})}const jT=setTimeout,VT=clearTimeout;function UT(e,t){t.useNativeTimers?(e.setTimeoutFn=jT.bind(BT),e.clearTimeoutFn=VT.bind(BT)):(e.setTimeoutFn=setTimeout.bind(BT),e.clearTimeoutFn=clearTimeout.bind(BT))}class TransportError extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class Transport extends FT{constructor(e){super(),this.writable=!1,UT(this,e),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new TransportError(e,t,n)),this}open(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=IT(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}}const HT="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),$T={};let qT,WT=0,GT=0;function YT(e){let t="";do{t=HT[e%64]+t,e=Math.floor(e/64)}while(e>0);return t}function XT(){const e=YT(+new Date);return e!==qT?(WT=0,qT=e):e+"."+YT(WT++)}for(;GT<64;GT++)$T[HT[GT]]=GT;function KT(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}let ZT=!1;try{ZT="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}const JT=ZT;function QT(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||JT))return new XMLHttpRequest}catch(e){}if(!t)try{return new(BT[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function eA(){}const tA=null!=new QT({xdomain:!1}).responseType;class Request extends FT{constructor(e,t){super(),UT(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.create()}create(){const e=zT(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new QT(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&t.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{4===t.readyState&&(200===t.status||1223===t.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof t.status?t.status:0)}),0))},t.send(this.data)}catch(e){return void this.setTimeoutFn((()=>{this.onError(e)}),0)}"undefined"!=typeof document&&(this.index=Request.requestsCount++,Request.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=eA,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete Request.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}if(Request.requestsCount=0,Request.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",nA);else if("function"==typeof addEventListener){addEventListener("onpagehide"in BT?"pagehide":"unload",nA,!1)}function nA(){for(let e in Request.requests)Request.requests.hasOwnProperty(e)&&Request.requests[e].abort()}const iA="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),rA=BT.WebSocket||BT.MozWebSocket,sA="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();const oA={websocket:class WS extends Transport{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,n=sA?{}:zT(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=sA?new rA(e,t,n):t?new rA(e,t):new rA(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;NT(n,this.supportsBinary,(e=>{try{this.ws.send(e)}catch(e){}i&&iA((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let n="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=XT()),this.supportsBinary||(e.b64=1);const i=KT(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(i.length?"?"+i:"")}check(){return!!rA}},polling:class Polling extends Transport{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const t="https:"===location.protocol;let n=location.port;n||(n=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port,this.xs=e.secure!==t}const t=e&&e.forceBase64;this.supportsBinary=tA&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const n=e.split(DT),i=[];for(let e=0;e<n.length;e++){const r=IT(n[e],t);if(i.push(r),"error"===r.type)break}return i})(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const n=e.length,i=new Array(n);let r=0;e.forEach(((e,s)=>{NT(e,!1,(e=>{i[s]=e,++r===n&&t(i.join(DT))}))}))})(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let n="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=XT()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port);const i=KT(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(i.length?"?"+i:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new Request(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}},aA=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,lA=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function cA(e){const t=e,n=e.indexOf("["),i=e.indexOf("]");-1!=n&&-1!=i&&(e=e.substring(0,n)+e.substring(n,i).replace(/:/g,";")+e.substring(i,e.length));let r=aA.exec(e||""),s={},o=14;for(;o--;)s[lA[o]]=r[o]||"";return-1!=n&&-1!=i&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=function(e,t){const n=/\/{2,9}/g,i=t.replace(n,"/").split("/");"/"!=t.substr(0,1)&&0!==t.length||i.splice(0,1);"/"==t.substr(t.length-1,1)&&i.splice(i.length-1,1);return i}(0,s.path),s.queryKey=function(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,i){t&&(n[t]=i)})),n}(0,s.query),s}class Socket extends FT{constructor(e,t={}){super(),e&&"object"==typeof e&&(t=e,e=null),e?(e=cA(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=cA(t.host).host),UT(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},n=e.split("&");for(let e=0,i=n.length;e<i;e++){let i=n[e].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",(()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())}),!1),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new oA[e](n)}open(){let e;if(this.opts.rememberUpgrade&&Socket.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(e){let t=this.createTransport(e),n=!1;Socket.priorWebsocketSuccess=!1;const i=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",(e=>{if(!n)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Socket.priorWebsocketSuccess="websocket"===t.name,this.transport.pause((()=>{n||"closed"!==this.readyState&&(c(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}})))};function r(){n||(n=!0,c(),t.close(),t=null)}const s=e=>{const n=new Error("probe error: "+e);n.transport=t.name,r(),this.emitReserved("upgradeError",n)};function o(){s("transport closed")}function a(){s("socket closed")}function l(e){t&&e.name!==t.name&&r()}const c=()=>{t.removeListener("open",i),t.removeListener("error",s),t.removeListener("close",o),this.off("close",a),this.off("upgrading",l)};t.once("open",i),t.once("error",s),t.once("close",o),this.once("close",a),this.once("upgrading",l),t.open()}onOpen(){if(this.readyState="open",Socket.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let n=0;n<this.writeBuffer.length;n++){const i=this.writeBuffer[n].data;if(i&&(e+="string"==typeof(t=i)?function(e){let t=0,n=0;for(let i=0,r=e.length;i<r;i++)t=e.charCodeAt(i),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(i++,n+=4);return n}(t):Math.ceil(1.33*(t.byteLength||t.size))),n>0&&e>this.maxPayload)return this.writeBuffer.slice(0,n);e+=2}var t;return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,i){if("function"==typeof t&&(i=t,t=void 0),"function"==typeof n&&(i=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const r={type:e,data:t,options:n};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?n():e()})):this.upgrading?n():e()),this}onError(e){Socket.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let n=0;const i=e.length;for(;n<i;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}Socket.protocol=4;Socket.protocol;const uA="function"==typeof ArrayBuffer,dA=Object.prototype.toString,hA="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===dA.call(Blob),pA="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===dA.call(File);function fA(e){return uA&&(e instanceof ArrayBuffer||(e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||hA&&e instanceof Blob||pA&&e instanceof File}function mA(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(mA(e[t]))return!0;return!1}if(fA(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return mA(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&mA(e[t]))return!0;return!1}function gA(e){const t=[],n=e.data,i=e;return i.data=yA(n,t),i.attachments=t.length,{packet:i,buffers:t}}function yA(e,t){if(!e)return e;if(fA(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){const n=new Array(e.length);for(let i=0;i<e.length;i++)n[i]=yA(e[i],t);return n}if("object"==typeof e&&!(e instanceof Date)){const n={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=yA(e[i],t));return n}return e}function vA(e,t){return e.data=bA(e.data,t),e.attachments=void 0,e}function bA(e,t){if(!e)return e;if(e&&e._placeholder)return t[e.num];if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=bA(e[n],t);else if("object"==typeof e)for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=bA(e[n],t));return e}const wA=5;var xA;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(xA||(xA={}));class Encoder{constructor(e){this.replacer=e}encode(e){return e.type!==xA.EVENT&&e.type!==xA.ACK||!mA(e)?[this.encodeAsString(e)]:(e.type=e.type===xA.EVENT?xA.BINARY_EVENT:xA.BINARY_ACK,this.encodeAsBinary(e))}encodeAsString(e){let t=""+e.type;return e.type!==xA.BINARY_EVENT&&e.type!==xA.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=gA(e),n=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(n),i}}class Decoder extends FT{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e)t=this.decodeString(e),t.type===xA.BINARY_EVENT||t.type===xA.BINARY_ACK?(this.reconstructor=new BinaryReconstructor(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t);else{if(!fA(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(void 0===xA[n.type])throw new Error("unknown packet type "+n.type);if(n.type===xA.BINARY_EVENT||n.type===xA.BINARY_ACK){const i=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const r=e.substring(i,t);if(r!=Number(r)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(r)}if("/"===e.charAt(t+1)){const i=t+1;for(;++t;){if(","===e.charAt(t))break;if(t===e.length)break}n.nsp=e.substring(i,t)}else n.nsp="/";const i=e.charAt(t+1);if(""!==i&&Number(i)==i){const i=t+1;for(;++t;){const n=e.charAt(t);if(null==n||Number(n)!=n){--t;break}if(t===e.length)break}n.id=Number(e.substring(i,t+1))}if(e.charAt(++t)){const i=this.tryParse(e.substr(t));if(!Decoder.isPayloadValid(n.type,i))throw new Error("invalid payload");n.data=i}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case xA.CONNECT:return"object"==typeof t;case xA.DISCONNECT:return void 0===t;case xA.CONNECT_ERROR:return"string"==typeof t||"object"==typeof t;case xA.EVENT:case xA.BINARY_EVENT:return Array.isArray(t)&&t.length>0;case xA.ACK:case xA.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class BinaryReconstructor{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=vA(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function _A(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const EA=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class socket_Socket extends FT{constructor(e,t,n){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[_A(e,"open",this.onopen.bind(this)),_A(e,"packet",this.onpacket.bind(this)),_A(e,"error",this.onerror.bind(this)),_A(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(EA.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');t.unshift(e);const n={type:xA.EVENT,data:t,options:{}};if(n.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++,i=t.pop();this._registerAckCallback(e,i),n.id=e}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){const n=this.flags.timeout;if(void 0===n)return void(this.acks[e]=t);const i=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))}),n);this.acks[e]=(...e)=>{this.io.clearTimeoutFn(i),t.apply(this,[null,...e])}}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth((e=>{this.packet({type:xA.CONNECT,data:e})})):this.packet({type:xA.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case xA.CONNECT:if(e.data&&e.data.sid){const t=e.data.sid;this.onconnect(t)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case xA.EVENT:case xA.BINARY_EVENT:this.onevent(e);break;case xA.ACK:case xA.BINARY_ACK:this.onack(e);break;case xA.DISCONNECT:this.ondisconnect();break;case xA.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e)}ack(e){const t=this;let n=!1;return function(...i){n||(n=!0,t.packet({type:xA.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e){this.id=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e),this.packet(e)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:xA.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function SA(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}SA.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},SA.prototype.reset=function(){this.attempts=0},SA.prototype.setMin=function(e){this.ms=e},SA.prototype.setMax=function(e){this.max=e},SA.prototype.setJitter=function(e){this.jitter=e};class manager_Manager extends FT{constructor(t,n){var i;super(),this.nsps={},this.subs=[],t&&"object"==typeof t&&(n=t,t=void 0),(n=n||{}).path=n.path||"/socket.io",this.opts=n,UT(this,n),this.reconnection(!1!==n.reconnection),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(i=n.randomizationFactor)&&void 0!==i?i:.5),this.backoff=new SA({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==n.timeout?2e4:n.timeout),this._readyState="closed",this.uri=t;const r=n.parser||e;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=!1!==n.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Socket(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const i=_A(t,"open",(function(){n.onopen(),e&&e()})),r=_A(t,"error",(t=>{n.cleanup(),n._readyState="closed",this.emitReserved("error",t),e?e(t):n.maybeReconnectOnOpen()}));if(!1!==this._timeout){const e=this._timeout;0===e&&i();const n=this.setTimeoutFn((()=>{i(),t.close(),t.emit("error",new Error("timeout"))}),e);this.opts.autoUnref&&n.unref(),this.subs.push((function(){clearTimeout(n)}))}return this.subs.push(i),this.subs.push(r),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(_A(e,"ping",this.onping.bind(this)),_A(e,"data",this.ondata.bind(this)),_A(e,"error",this.onerror.bind(this)),_A(e,"close",this.onclose.bind(this)),_A(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){this.decoder.add(e)}ondecoded(e){this.emitReserved("packet",e)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n||(n=new socket_Socket(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const e of t){if(this.nsps[e].active)return}this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn((()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()})))}),t);this.opts.autoUnref&&n.unref(),this.subs.push((function(){clearTimeout(n)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const CA={};function TA(e,t){"object"==typeof e&&(t=e,e=void 0);const n=function(e,t="",n){let i=e;n=n||"undefined"!=typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==n?n.protocol+"//"+e:"https://"+e),i=cA(e)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const r=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+r+":"+i.port+t,i.href=i.protocol+"://"+r+(n&&n.port===i.port?"":":"+i.port),i}(e,(t=t||{}).path||"/socket.io"),i=n.source,r=n.id,s=n.path,o=CA[r]&&s in CA[r].nsps;let a;return t.forceNew||t["force new connection"]||!1===t.multiplex||o?a=new manager_Manager(i,t):(CA[r]||(CA[r]=new manager_Manager(i,t)),a=CA[r]),n.query&&!t.query&&(t.query=n.queryKey),a.socket(n.path,t)}Object.assign(TA,{Manager:manager_Manager,Socket:socket_Socket,io:TA,connect:TA});class Project extends RTComp{constructor(){super(...arguments),this.state={loading:!0,error:"",dbMethods:void 0,showFeedback:!1,feedback:{email:"",details:""}},this.loaded=!1,this.sub=null,this.getDashboardDB=async e=>{try{this.dashboardSocket&&this.dashboardSocket.disconnect();const{dbs:t,methods:n}=this.props,i=await n.startConnection(e.id);if(!i)return void this.setState({dbProject:t});this.dashboardSocket=TA({path:i,reconnectionDelay:1e3,reconnection:!0}),_T()({socket:this.dashboardSocket,onReconnect:()=>{console.log("dashboardSocket onReconnect"),window.__prglIsImporting||this.setState({dbKey:"dbs"+Date.now()})},onReady:async(e,t,n,i)=>{const r=await Dashboard.getTables(null!=n?n:[],void 0,e);this.setState({dbProject:e,dbTables:r,dbMethods:t,dbKey:"dbs"+Date.now()}),window.db=e}}).catch(console.error)}catch(e){console.error(e),this.setState({error:e})}}}onMount(){}async onDelta(e,t,n){const{dbProject:i}=this.state,{dbs:r,methods:s}=this.props;if({...e,...t,...n}.dbs&&(this.loaded=!1,this.setState({dbProject:void 0})),r&&Object.keys(s).length>0&&!this.loaded){window.dbs=r,this.loaded=!0;const e=hT(this.props,"match.params.cid"),t=(hT(this.props,"match.params.wid"),await r.connections.findOne({id:e}));t&&(i||this.getDashboardDB(t)),this.setState({connection:t,loading:!1})}}onUnmount(){var e;null===(e=this.dashboardSocket)||void 0===e||e.disconnect()}render(){var e,n,i,r;const{error:s,loading:o=!0,dbProject:a,showFeedback:l,dbMethods:c,connection:u,feedback:d,dbTables:h}=this.state,{dbs:p,dbsTables:f}=this.props;if(o)return t.createElement("div",{className:"f-1 flex-col bg-gray-700 h-full w-full ai-center jc-center"},t.createElement(Loading,{className:"mt-4 mx-auto"}));if(!u||s)return t.createElement("div",{className:"flex-col w-full h-full ai-center "},u?t.createElement(ErrorComponent,{error:s,findMsg:!0}):t.createElement("div",{className:"p-1 mt-2"},"This project was not found"),t.createElement(ye,{to:"/"},"Go back"));const m=t.createElement("div",{className:"flex-col text-gray-500 w-fit ai-center noselect ml-auto"},t.createElement("div",{className:"flex-row ai-center"},t.createElement(ye,{className:"text-gray-300 ndo-decor b-gray-400 round flex-row ai-center",to:"/connections"},t.createElement(tt(),{path:_e,size:1}),t.createElement("div",{className:"ml-p5"},"Connections")),t.createElement("div",{className:"f-1 ml-1 p-p25 font-12 text-ellipsis"},Project.getConnectionTitle(u,!0)),t.createElement(Btn,{className:"ml-1 text-white bg-gray-800",style:{margin:"6px"},variant:"outline",onClick:()=>{this.setState({showFeedback:!0})}},"Feedback"),l&&t.createElement(Popup,{open:!0,title:"Send feedback",positioning:"top-center",onClose:()=>{this.setState({showFeedback:!1})}},d.success&&t.createElement("div",{className:"flex-col"},t.createElement(Success,null),t.createElement("p",null,"Feedback was sent! Thanks a lot!")),d.error&&t.createElement(ErrorComponent,{error:d.error}),t.createElement(FormField,{id:"email",type:"email",label:"Email (optional)",asColumn:!0,value:d.email,onChange:e=>{this.setState({feedback:{...d,email:e}})}}),t.createElement(FormField,{id:"text",type:"text",label:"Details",asColumn:!0,className:"mt-1",value:d.details,asTextArea:!0,onChange:e=>{e.length<500&&this.setState({feedback:{...d,details:e}})},hint:500-`${d.details}`.length+"/500"}),t.createElement("p",null,"Other options: ",t.createElement("a",{target:"_blank",href:"https://github.com/prostgles/ui/issues/new/choose"},"open an issue")," or ",t.createElement("a",{href:"mailto:prostgles@protonmail.com"},"email us")),t.createElement("div",{className:"flex-row pt-1 jc-around"},!d.success&&t.createElement(Btn,{color:"action",variant:"filled",disabledInfo:d.details?void 0:"Must provide some details",onClick:async()=>{try{const e=await wT("https://prostgles.com/feedback",d),t=await e.json();if(t.error)throw t.error;this.setState({feedback:{...d,success:!0}}),setTimeout((()=>{this.mounted&&this.setState({showFeedback:!1,feedback:{email:"",details:""}})}),3e3)}catch(e){this.setState({feedback:{...d,error:e}})}}},"Send"),t.createElement(Btn,{variant:"filled",onClick:()=>{this.setState({showFeedback:!1,feedback:{email:"",details:""}})}},"Cancel")))));return p&&a&&c&&f&&h?t.createElement("div",{className:"f-1 flex-col bg-gray-700 h-full w-full min-h-0 min-w-0 relative",style:{maxWidth:"100vw",maxHeight:"100vh"}},t.createElement("div",{className:"f-1 w-full h-full flex-col"},t.createElement(Dashboard,{db:a,dbs:p,dbsTables:f,dbMethods:c,workspaceId:null===(n=null===(e=this.props.match)||void 0===e?void 0:e.params)||void 0===n?void 0:n.wid,connectionId:null===(r=null===(i=this.props.match)||void 0===i?void 0:i.params)||void 0===r?void 0:r.cid,topRightControls:m,dbSchemaTables:h,showAccessManagement:this.props.showAccessManagement}))):t.createElement(Loading,{className:"m-auto",message:"Connecting to database..."})}}Project.getConnectionTitle=(e,t=!1)=>t?e.db_conn||`${e.db_user}@${e.db_host}:${e.db_port||"5432"}/${e.db_name}`:e.db_conn||`postgres://${e.db_user}:***@${e.db_host}:${e.db_port||"5432"}/${e.db_name}`;const AA=ae(Project);class Connections extends RTComp{constructor(){super(...arguments),this.state={connections:[]},this.loaded=!1}onDelta(){const{dbs:e}=this.props;e&&!this.loaded&&(this.loaded=!0,e.connections.find({},{select:{"*":1,crtd:{$datetime:["created"]}}}).then((e=>{this.mounted&&this.setState({connections:e})})))}render(){const{dbs:e,methods:n}=this.props,{connections:i,showStateConn:r,showStateConfirm:s}=this.state;if(!this.loaded)return t.createElement(Loading,null);let o;return s&&(o=t.createElement(ConfirmationDialog,{positioning:void 0,message:"Editing state data directly may break functionality. Proceed at your own risk!",onClose:()=>{this.setState({showStateConfirm:!1})},onAccept:()=>{this.setState({showStateConn:!0,showStateConfirm:!1})},acceptBtn:{color:"action",text:"OK"},asPopup:!0})),t.createElement("div",{className:"flex-col p-p5 f-1 w-full min-h-0",style:{maxWidth:"800px"}},o,t.createElement("div",{className:"flex-row ai-center"},n.createConnection&&t.createElement(ye,{to:"/new-connection",className:"text-blue-600 noselect button mb-1 mt-1 flex-row ai-center w-fit rounded b b-blue-400 p-p5 no-decor bg-white",title:"Create a new connection"},t.createElement(tt(),{path:He,size:1}),"New connection"),t.createElement(Checkbox,{className:"ml-auto ",inputClassname:"bg-white",checked:!!r,label:"Show state conneciton",onChange:e=>{e.target.checked?this.setState({showStateConfirm:!0}):this.setState({showStateConn:e.target.checked})}})),t.createElement("div",{className:"flex-col noselect o-auto min-h-0 pb-1"},i.filter((e=>r||!e.is_state_db)).map(((n,i)=>t.createElement("div",{key:i,className:"flex-row card p-1 bg-white text-black "+(i?"mt-p5":""),title:"Open database",style:{minWidth:"250px"}},t.createElement(ye,{key:i,to:"/connections/"+n.id,className:"no-decor  min-w-0 text-ellipsis f-1 "+(i?"mt-p5":"")},t.createElement("div",{className:"flex-col pr-1"},t.createElement("div",{className:"text-ellipsis font-20"},n.name||AA.getConnectionTitle(n,!0)),t.createElement("div",{className:"flex-row mt-1 ws-pre"},t.createElement("div",{className:"font-12"},"Created: "),t.createElement("div",{className:"font-12 capitalize text-xl font-medium"},n.crtd)),n.is_state_db&&t.createElement("div",{className:"flex-row mt-1 ai-center gap-1"},t.createElement(tt(),{className:"text-yellow-500 mtt-1",size:1,path:Be,title:""}),t.createElement("span",{className:"text-yellow-500 no-decor"},"All Prostgles connection and dashboard data is stored here. Edit at your own risk")))),t.createElement("div",{className:"flex-row ai-center c--fit gap-1"},t.createElement(ye,{to:"/access-management/"+n.id,title:"Manage access",className:"no-decor text-black"},t.createElement(tt(),{path:be,size:1})),!n.is_state_db&&e.connections.update&&t.createElement(ye,{to:"/edit-connection/"+n.id,title:"Edit connection",className:"no-decor text-black"},t.createElement(tt(),{path:je,size:1})),t.createElement(Btn,{title:"Close all windows",className:"mtt-p5 text-gray-300",iconPath:"M12,5C12.74,5 13.47,5.1 14.15,5.29L15.78,2.46C16.06,2 16.67,1.82 17.15,2.1C17.63,2.37 17.79,3 17.5,3.46L16,6.07C17.22,6.78 18.23,7.79 18.93,9H5.07C5.77,7.79 6.78,6.78 8,6.07L6.5,3.46C6.21,3 6.37,2.37 6.85,2.1C7.33,1.82 7.94,2 8.22,2.46L9.85,5.29C10.53,5.1 11.26,5 12,5M20,13C20,17.17 16.82,20.59 12.75,20.97V10.5H19.6C19.86,11.29 20,12.13 20,13M4,13C4,12.13 4.14,11.29 4.4,10.5H11.25V20.97C7.18,20.59 4,17.17 4,13Z",onClick:async()=>{const t=await e.workspaces.findOne({name:n.id});t&&(e.windows.update({workspace_id:t.id},{closed:!0}),alert("Windows have been closed"))}})))))))}}class NavBar extends t.Component{constructor(){super(...arguments),this.state={navCollapsed:!0,profileCollapsed:!0,email:""},this.getData=async()=>{}}componentDidMount(){this.getData()}componentDidUpdate(e){}render(){const{options:e=[],history:n,title:i}=this.props,{navCollapsed:r}=this.state;return t.createElement("nav",{className:"flex-row bg-indigo-900 noselect w-full  "+(r?" mobile-collapsed ":"")},t.createElement("div",{className:"flex-col f-1"},!i&&t.createElement("button",{className:"hamburger hidden",onClick:()=>{this.setState({navCollapsed:!r})}},r?t.createElement("svg",{className:"block h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 6h16M4 12h16M4 18h16"})):t.createElement("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"}))),t.createElement("div",{className:"navwrapper flex-row ",onClick:()=>{this.setState({navCollapsed:!0})}},i?t.createElement("div",{className:"flex-row ai-center text-white",style:{minHeight:"60px"}},t.createElement("button",{className:"f-0 ml-1",onClick:()=>{n.goBack()}},t.createElement(tt(),{path:_e,size:1})),t.createElement("div",{className:"f-1 ml-1"},i)):e.map(((e,n)=>e.href?t.createElement("a",{key:n,href:e.href,className:"text-gray-300 text-white-hover ai-center px-1 pt-1 border-transparent bb text-sm font-medium "+(n?" ml-8 ":"")+"transition-150 "}," ",e.label," "):t.createElement(ye,{key:n,to:e.to,exact:e.exact,className:"text-gray-300 text-white-hover items-center px-1 pt-1 border-transparent bb text-sm font-medium "+(n?" ml-8 ":"")+"transition-150 "}," ",e.label," "))),t.createElement(ye,{key:"account",to:"/account",style:{marginLeft:"auto",padding:"10px"},className:" text-gray-300 text-white-hover items-center border-transparent bb text-sm "},t.createElement(tt(),{path:be,size:1})))))}}const kA=ae(NavBar);t.Component;class UserManager extends RTComp{constructor(){super(...arguments),this.state={collapsed:!0},this.loaded=!1,this.onDelta=async()=>{const{dbs:e}=this.props}}onUnmount(){}render(){const{dbs:e,dbsTables:n,user:i}=this.props,{collapsed:r}=this.state;if(!n)return null;let s=t.createElement(SmartTable,{db:e,tableName:"users",tables:n,showInsert:!0,allowEdit:!0,className:"w-full"});return"admin"!==(null==i?void 0:i.type)&&(s=t.createElement("div",null,"Must be admin to access this section")),t.createElement("div",{className:"flex-col relative w-full f-1"},s)}}class Account extends t.Component{constructor(){super(...arguments),this.state={}}async componentDidMount(){const{dbs:e,user:t,methods:n}=this.props;if(t){const n=await e.users.findOne({id:t.uid});this.setState({user:n})}}render(){const{dbs:e,user:n,dbsTables:i}=this.props;if(e&&i)return t.createElement("div",{className:" f-1 flex-col w-full gap-1 p-p5",style:{maxWidth:"700px"}},t.createElement(Btn,{variant:"filled",href:"/logout",style:{alignSelf:"end"}},"Logout"),t.createElement(SmartForm,{className:"shadow bg-white",label:"My account",db:e,tableName:"users",tables:i,rowFilter:[{fieldName:"id",value:null==n?void 0:n.uid}],hideChangesOptions:!0,confirmUpdates:!0}))}}class UserTypeSelect extends RTComp{constructor(){super(...arguments),this.state={loading:!1,tables:[],allUserTypes:[],existingACUserTypes:[]},this.d={},this.loaded=!1}async onDelta(e,t,n){const{dbs:i}=this.props;this.loaded||(this.loaded=!0,this.ugSub=await i.user_types.subscribe({},{select:{id:1},returnType:"values"},(e=>{this.setState({allUserTypes:e})})))}async onUnmount(){var e;null===(e=this.ugSub)||void 0===e||e.unsubscribe()}render(){const{allUserTypes:e,error:n,existingACUserTypes:i}=this.state,{dbs:r,userTypes:s,onChange:o}=this.props;return e.length?t.createElement(st,{button:t.createElement("div",{className:"flex-col gap-1"},s.length?t.createElement("div",{className:"flex-row-wrap gap-p5"},s.map((e=>t.createElement(Chip,{key:e,value:e,className:"bg-white",style:{background:"white"}})))):null,1===s.length&&"admin"===s[0]?t.createElement("div",{className:"flex-row gap-1 text-yellow-600 ai-center "},t.createElement(tt(),{path:we,size:1}),t.createElement("div",null,"There are no unnassigned user types left. Update existing rules to free up user types or create new user types")):t.createElement("div",{className:"flex-row gap-1"},t.createElement(Btn,{iconPath:je,className:"bg-white",variant:"outline",color:"action",size:"small"},"Select"))),onClickClose:!1,contentStyle:{padding:0}},t.createElement(SearchList,{onMultiToggle:e=>{o(e.filter((e=>e.checked)).map((e=>e.key)))},id:"targetUserGroups",items:e.map((e=>{let t="",n="";if("admin"===e)n="Cannot change admin",t="Can always access everything";else{i.includes(e)&&(n="Need to remove from existing access rule first",t="Already assigned permissions")}return{key:e,checked:s.includes(e),disabledInfo:n,subLabel:t,onPress:()=>{o(s.includes(e)?s.filter((t=>t!==e)):s.concat([e]))}}})).sort(((e,t)=>+!!e.disabledInfo-+!!t.disabledInfo)),onNoResultsContent:e=>t.createElement("div",{className:"flex-row bg-white ai-center"},t.createElement("div",{className:"p-p5"},"Not found"),t.createElement(Btn,{onClick:()=>{r.user_types.insert({id:e}).catch((e=>{alert("Something went wrong inserting user_type: "+e.toString())}))},iconPath:He,size:"small",variant:"outline",color:"action",className:"ml-auto"},"create"))})):t.createElement(Loading,null)}}class AccessControlDBS extends RTComp{constructor(){super(...arguments),this.state={loading:!1,userTypes:[],selectedUserTypes:[],rules:[],userTypesThatCanManageUsers:[],userTypesThatCanManageConnections:[]},this.d={},this.loaded=!1}async onDelta(e,t,n){const{dbs:i,user:r}=this.props;this.ugSub||(this.conSub=await i.access_control.subscribe({connection_id:r.state_db_id},{},(e=>{this.setState({rules:e})})),this.ugSub=await i.user_types.subscribe({},{},(e=>{this.setState({userTypes:e})})))}async onUnmount(){var e,t;null===(e=this.ugSub)||void 0===e||e.unsubscribe(),null===(t=this.conSub)||void 0===t||t.unsubscribe()}render(){const{userTypes:e,userTypesThatCanManageUsers:n,userTypesThatCanManageConnections:i}=this.state,{dbs:r,dbsTables:s}=this.props;return e.length&&r?t.createElement("div",{className:"flex-col f-1 p-1 gap-2"},t.createElement("div",null,"Admin users will always have full access to everything"),t.createElement("div",null,t.createElement("h3",null,"Can create/edit/delete users"),t.createElement(UserTypeSelect,{userTypes:n,dbs:r,onChange:e=>{this.setState({userTypesThatCanManageUsers:e})}})),t.createElement("div",null,t.createElement("h3",null,"Can create/edit/delete connections"),t.createElement(UserTypeSelect,{userTypes:i,dbs:r,onChange:e=>{this.setState({userTypesThatCanManageConnections:e})}}))):t.createElement(Loading,null)}}window.isIOSDevice=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document,window.isMobileDevice=/Mobi/i.test(window.navigator.userAgent);class App extends t.Component{constructor(){super(...arguments),this.state={dbsKey:"",title:"",methods:null,auth:void 0,isAdminOrSupport:!1,dbsInfo:{},dbsConnected:!1},this.componentDidMount=async()=>{window.document.title="Prostgles UI";const e=await(await fetch("/dbs")).json();if(e.ok){const e=TA({path:"/iosckt",reconnection:!0,reconnectionDelay:2e3,reconnectionAttempts:5});e.on("reconnect",(e=>{console.log("reconnect")})),e.on("pls-restart",(e=>{setTimeout((()=>window.location.reload()),2e3)})),e.on("redirect",(e=>{window.location=e})),_T()({socket:e,onReconnect:()=>{this.setState({dbsKey:"dbs"+Date.now()})},onReady:async(t,n,i,r)=>{window.dbs=t,window.dbsSocket=e,window.methods=n;const s=hT(r,"user.type");this.setState({dbsKey:"dbs"+Date.now(),dbs:t,dbsTables:await Dashboard.getTables(null!=i?i:[],void 0,t),methods:n,socket:e,auth:r,isAdminOrSupport:["admin","support"].includes(s),dbsConnected:!0})}})}this.setState({dbsInfo:e})}}render(){const{isAdminOrSupport:e,dbs:n,dbsTables:i,methods:r,auth:s,socket:o,dbsInfo:a,dbsKey:l,dbsConnected:c}=this.state,u=null==s?void 0:s.user,d=n?{setTitle:e=>{this.state.title!==e&&this.setState({title:e})},dbs:n,dbsTables:i,socket:o,methods:r,user:u,auth:s}:void 0;if(e&&[{label:"Home",href:"/",exact:!0},{label:"Connections",to:"/connections",exact:!0}].push({label:"Dashboard",to:"/dashboard",exact:!1}),!a&&!c)return t.createElement("div",{className:"flex-row m-auto ai-center jc-center  p-2"},t.createElement(Loading,{className:""}),t.createElement("div",{className:"ml-1"},"Connecting to database..."));if(a.err)return t.createElement("div",{className:"flex-col m-auto ai-center jc-center  p-2"},t.createElement("div",{className:"ml-1 text-lg font-bold mb-1 pre"},"Could not connect to state database. Ensure /server/.env file (or environment variables) point to a running and accessible postgres server database"),t.createElement(ErrorComponent,{error:a.err,withIcon:!0}));const h=[{label:"Connections",to:"connections"},{label:"Users",to:"users",forAdmin:!0},{label:"Permissions",to:"access-management",forAdmin:!0}].filter((e=>{var t;return!e.forAdmin||"admin"===(null===(t=null==d?void 0:d.user)||void 0===t?void 0:t.type)})),p=t.createElement(kA,{options:h}),f=(e,n)=>t.createElement("div",{className:"flex-col ai-center w-full f-1"},p,n&&!(null==d?void 0:d.user)?t.createElement("div",{className:"flex-col jc-center ai-center h-full gap-2 m-2"},t.createElement(ye,{to:"login"},"Login"),t.createElement(ye,{to:"register"},"Register")):e);return t.createElement(le,{key:l},t.createElement(oe,{className:"flex-col f-1"},t.createElement(ee,{path:"/",exact:!0,render:e=>(window.location="/connections",f(t.createElement("div",{className:"flex-col ai-center jc-center f-1 min-h-0"},t.createElement(ye,{to:"connections"},"Connections")),!0))}),t.createElement(ee,{path:"/connections",exact:!0,render:e=>f(t.createElement(Connections,{...d,...e}),!0)}),d&&[t.createElement(ee,{key:"1",path:"/users",render:e=>f(t.createElement(UserManager,{...d,...e}))}),t.createElement(ee,{key:"2",path:"/account",component:()=>f(t.createElement(Account,{...d}))}),t.createElement(ee,{key:"3",path:"/connections/:cid/:wid?",render:e=>t.createElement(AA,{...d,...e})}),t.createElement(ee,{key:"5",path:"/access-management",exact:!0,render:e=>f(t.createElement(AccessControlDBS,{...d,dbsTables:d.dbsTables,...e}),!0)}),t.createElement(ee,{key:"4",path:"/access-management/:cid?",render:e=>t.createElement(AA,{...d,...e,showAccessManagement:!0})}),t.createElement(ee,{key:"6",path:"/new-connection",render:e=>t.createElement(NewConnection,{...d,...e})}),t.createElement(ee,{key:"7",path:"/edit-connection/:id",render:e=>t.createElement(NewConnection,{...d,...e})})],t.createElement(ee,{path:"/login",component:()=>t.createElement(Login,{...d})}),t.createElement(ee,{path:"/register",component:()=>t.createElement(Register,{...d})}),t.createElement(ee,{path:"*",component:ve})))}}r.render(t.createElement(App,null),document.getElementById("root"))})(),i})()}));